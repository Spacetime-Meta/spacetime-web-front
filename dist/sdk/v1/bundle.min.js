!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var i in n)("object"==typeof exports?exports:e)[i]=n[i]}}(window,(function(){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=31)}([function(e,t){e.exports=function(){throw new Error("define cannot be used indirect")}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t.extractVersion=o,t.wrapPeerConnectionEvent=function(e,t,n){if(!e.RTCPeerConnection)return;var i=e.RTCPeerConnection.prototype,r=i.addEventListener;i.addEventListener=function(e,i){if(e!==t)return r.apply(this,arguments);var s=function(e){var t=n(e);t&&(i.handleEvent?i.handleEvent(t):i(t))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(i,s),r.apply(this,[e,s])};var s=i.removeEventListener;i.removeEventListener=function(e,n){if(e!==t||!this._eventMap||!this._eventMap[t])return s.apply(this,arguments);if(!this._eventMap[t].has(n))return s.apply(this,arguments);var i=this._eventMap[t].get(n);return this._eventMap[t].delete(n),0===this._eventMap[t].size&&delete this._eventMap[t],0===Object.keys(this._eventMap).length&&delete this._eventMap,s.apply(this,[e,i])},Object.defineProperty(i,"on"+t,{get:function(){return this["_on"+t]},set:function(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})},t.disableLog=function(e){if("boolean"!=typeof e)return new Error("Argument type: "+(void 0===e?"undefined":i(e))+". Please use a boolean.");return r=e,e?"adapter.js logging disabled":"adapter.js logging enabled"},t.disableWarnings=function(e){if("boolean"!=typeof e)return new Error("Argument type: "+(void 0===e?"undefined":i(e))+". Please use a boolean.");return s=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled")},t.log=function(){if("object"===("undefined"==typeof window?"undefined":i(window))){if(r)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}},t.deprecated=function(e,t){if(!s)return;console.warn(e+" is deprecated, please use "+t+" instead.")},t.detectBrowser=function(e){var t={browser:null,version:null};if(void 0===e||!e.navigator)return t.browser="Not a browser.",t;var n=e.navigator;if(n.mozGetUserMedia)t.browser="firefox",t.version=o(n.userAgent,/Firefox\/(\d+)\./,1);else if(n.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection&&!e.RTCIceGatherer)t.browser="chrome",t.version=o(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(n.mediaDevices&&n.userAgent.match(/Edge\/(\d+).(\d+)$/))t.browser="edge",t.version=o(n.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!e.RTCPeerConnection||!n.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=o(n.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return t},t.compactObject=function e(t){if(!a(t))return t;return Object.keys(t).reduce((function(n,i){var r=a(t[i]),s=r?e(t[i]):t[i],o=r&&!Object.keys(s).length;return void 0===s||o?n:Object.assign(n,function(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n;return e}({},i,s))}),{})},t.walkStats=c,t.filterStats=function(e,t,n){var i=n?"outbound-rtp":"inbound-rtp",r=new Map;if(null===t)return r;var s=[];return e.forEach((function(e){"track"===e.type&&e.trackIdentifier===t.id&&s.push(e)})),s.forEach((function(t){e.forEach((function(n){n.type===i&&n.trackId===t.id&&c(e,n,r)}))})),r};var r=!0,s=!0;function o(e,t,n){var i=e.match(t);return i&&i.length>=n&&parseInt(i[n],10)}function a(e){return"[object Object]"===Object.prototype.toString.call(e)}function c(e,t,n){t&&!n.has(t.id)&&(n.set(t.id,t),Object.keys(t).forEach((function(i){i.endsWith("Id")?c(e,e.get(t[i]),n):i.endsWith("Ids")&&t[i].forEach((function(t){c(e,e.get(t),n)}))})))}},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t){(function(t){e.exports=t}).call(this,{})},function(e,t,n){var i=n(6).BufferBuilder,r=n(6).binaryFeatures,s={unpack:function(e){return new o(e).unpack()},pack:function(e){var t=new a;return t.pack(e),t.getBuffer()}};function o(e){this.index=0,this.dataBuffer=e,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}function a(){this.bufferBuilder=new i}function c(e){var t=e.charCodeAt(0);return t<=2047?"00":t<=65535?"000":t<=2097151?"0000":t<=67108863?"00000":"000000"}e.exports=s,o.prototype.unpack=function(){var e,t=this.unpack_uint8();if(t<128)return t;if((224^t)<32)return(224^t)-32;if((e=160^t)<=15)return this.unpack_raw(e);if((e=176^t)<=15)return this.unpack_string(e);if((e=144^t)<=15)return this.unpack_array(e);if((e=128^t)<=15)return this.unpack_map(e);switch(t){case 192:return null;case 193:return;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 212:case 213:case 214:case 215:return;case 216:return e=this.unpack_uint16(),this.unpack_string(e);case 217:return e=this.unpack_uint32(),this.unpack_string(e);case 218:return e=this.unpack_uint16(),this.unpack_raw(e);case 219:return e=this.unpack_uint32(),this.unpack_raw(e);case 220:return e=this.unpack_uint16(),this.unpack_array(e);case 221:return e=this.unpack_uint32(),this.unpack_array(e);case 222:return e=this.unpack_uint16(),this.unpack_map(e);case 223:return e=this.unpack_uint32(),this.unpack_map(e)}},o.prototype.unpack_uint8=function(){var e=255&this.dataView[this.index];return this.index++,e},o.prototype.unpack_uint16=function(){var e=this.read(2),t=256*(255&e[0])+(255&e[1]);return this.index+=2,t},o.prototype.unpack_uint32=function(){var e=this.read(4),t=256*(256*(256*e[0]+e[1])+e[2])+e[3];return this.index+=4,t},o.prototype.unpack_uint64=function(){var e=this.read(8),t=256*(256*(256*(256*(256*(256*(256*e[0]+e[1])+e[2])+e[3])+e[4])+e[5])+e[6])+e[7];return this.index+=8,t},o.prototype.unpack_int8=function(){var e=this.unpack_uint8();return e<128?e:e-256},o.prototype.unpack_int16=function(){var e=this.unpack_uint16();return e<32768?e:e-65536},o.prototype.unpack_int32=function(){var e=this.unpack_uint32();return e<Math.pow(2,31)?e:e-Math.pow(2,32)},o.prototype.unpack_int64=function(){var e=this.unpack_uint64();return e<Math.pow(2,63)?e:e-Math.pow(2,64)},o.prototype.unpack_raw=function(e){if(this.length<this.index+e)throw new Error("BinaryPackFailure: index is out of range "+this.index+" "+e+" "+this.length);var t=this.dataBuffer.slice(this.index,this.index+e);return this.index+=e,t},o.prototype.unpack_string=function(e){for(var t,n,i=this.read(e),r=0,s="";r<e;)(t=i[r])<128?(s+=String.fromCharCode(t),r++):(192^t)<32?(n=(192^t)<<6|63&i[r+1],s+=String.fromCharCode(n),r+=2):(n=(15&t)<<12|(63&i[r+1])<<6|63&i[r+2],s+=String.fromCharCode(n),r+=3);return this.index+=e,s},o.prototype.unpack_array=function(e){for(var t=new Array(e),n=0;n<e;n++)t[n]=this.unpack();return t},o.prototype.unpack_map=function(e){for(var t={},n=0;n<e;n++){var i=this.unpack(),r=this.unpack();t[i]=r}return t},o.prototype.unpack_float=function(){var e=this.unpack_uint32(),t=(e>>23&255)-127;return(0===e>>31?1:-1)*(8388607&e|8388608)*Math.pow(2,t-23)},o.prototype.unpack_double=function(){var e=this.unpack_uint32(),t=this.unpack_uint32(),n=(e>>20&2047)-1023;return(0===e>>31?1:-1)*((1048575&e|1048576)*Math.pow(2,n-20)+t*Math.pow(2,n-52))},o.prototype.read=function(e){var t=this.index;if(t+e<=this.length)return this.dataView.subarray(t,t+e);throw new Error("BinaryPackFailure: read index out of range")},a.prototype.getBuffer=function(){return this.bufferBuilder.getBuffer()},a.prototype.pack=function(e){var t=typeof e;if("string"===t)this.pack_string(e);else if("number"===t)Math.floor(e)===e?this.pack_integer(e):this.pack_double(e);else if("boolean"===t)!0===e?this.bufferBuilder.append(195):!1===e&&this.bufferBuilder.append(194);else if("undefined"===t)this.bufferBuilder.append(192);else{if("object"!==t)throw new Error('Type "'+t+'" not yet supported');if(null===e)this.bufferBuilder.append(192);else{var n=e.constructor;if(n==Array)this.pack_array(e);else if(n==Blob||n==File||e instanceof Blob||e instanceof File)this.pack_bin(e);else if(n==ArrayBuffer)r.useArrayBufferView?this.pack_bin(new Uint8Array(e)):this.pack_bin(e);else if("BYTES_PER_ELEMENT"in e)r.useArrayBufferView?this.pack_bin(new Uint8Array(e.buffer)):this.pack_bin(e.buffer);else if(n==Object||n.toString().startsWith("class"))this.pack_object(e);else if(n==Date)this.pack_string(e.toString());else{if("function"!=typeof e.toBinaryPack)throw new Error('Type "'+n.toString()+'" not yet supported');this.bufferBuilder.append(e.toBinaryPack())}}}this.bufferBuilder.flush()},a.prototype.pack_bin=function(e){var t=e.length||e.byteLength||e.size;if(t<=15)this.pack_uint8(160+t);else if(t<=65535)this.bufferBuilder.append(218),this.pack_uint16(t);else{if(!(t<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(219),this.pack_uint32(t)}this.bufferBuilder.append(e)},a.prototype.pack_string=function(e){var t=function(e){return e.length>600?new Blob([e]).size:e.replace(/[^\u0000-\u007F]/g,c).length}(e);if(t<=15)this.pack_uint8(176+t);else if(t<=65535)this.bufferBuilder.append(216),this.pack_uint16(t);else{if(!(t<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(217),this.pack_uint32(t)}this.bufferBuilder.append(e)},a.prototype.pack_array=function(e){var t=e.length;if(t<=15)this.pack_uint8(144+t);else if(t<=65535)this.bufferBuilder.append(220),this.pack_uint16(t);else{if(!(t<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(221),this.pack_uint32(t)}for(var n=0;n<t;n++)this.pack(e[n])},a.prototype.pack_integer=function(e){if(e>=-32&&e<=127)this.bufferBuilder.append(255&e);else if(e>=0&&e<=255)this.bufferBuilder.append(204),this.pack_uint8(e);else if(e>=-128&&e<=127)this.bufferBuilder.append(208),this.pack_int8(e);else if(e>=0&&e<=65535)this.bufferBuilder.append(205),this.pack_uint16(e);else if(e>=-32768&&e<=32767)this.bufferBuilder.append(209),this.pack_int16(e);else if(e>=0&&e<=4294967295)this.bufferBuilder.append(206),this.pack_uint32(e);else if(e>=-2147483648&&e<=2147483647)this.bufferBuilder.append(210),this.pack_int32(e);else if(e>=-0x8000000000000000&&e<=0x8000000000000000)this.bufferBuilder.append(211),this.pack_int64(e);else{if(!(e>=0&&e<=0x10000000000000000))throw new Error("Invalid integer");this.bufferBuilder.append(207),this.pack_uint64(e)}},a.prototype.pack_double=function(e){var t=0;e<0&&(t=1,e=-e);var n=Math.floor(Math.log(e)/Math.LN2),i=e/Math.pow(2,n)-1,r=Math.floor(i*Math.pow(2,52)),s=Math.pow(2,32),o=t<<31|n+1023<<20|r/s&1048575,a=r%s;this.bufferBuilder.append(203),this.pack_int32(o),this.pack_int32(a)},a.prototype.pack_object=function(e){var t=Object.keys(e).length;if(t<=15)this.pack_uint8(128+t);else if(t<=65535)this.bufferBuilder.append(222),this.pack_uint16(t);else{if(!(t<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(223),this.pack_uint32(t)}for(var n in e)e.hasOwnProperty(n)&&(this.pack(n),this.pack(e[n]))},a.prototype.pack_uint8=function(e){this.bufferBuilder.append(e)},a.prototype.pack_uint16=function(e){this.bufferBuilder.append(e>>8),this.bufferBuilder.append(255&e)},a.prototype.pack_uint32=function(e){var t=4294967295&e;this.bufferBuilder.append((4278190080&t)>>>24),this.bufferBuilder.append((16711680&t)>>>16),this.bufferBuilder.append((65280&t)>>>8),this.bufferBuilder.append(255&t)},a.prototype.pack_uint64=function(e){var t=e/Math.pow(2,32),n=e%Math.pow(2,32);this.bufferBuilder.append((4278190080&t)>>>24),this.bufferBuilder.append((16711680&t)>>>16),this.bufferBuilder.append((65280&t)>>>8),this.bufferBuilder.append(255&t),this.bufferBuilder.append((4278190080&n)>>>24),this.bufferBuilder.append((16711680&n)>>>16),this.bufferBuilder.append((65280&n)>>>8),this.bufferBuilder.append(255&n)},a.prototype.pack_int8=function(e){this.bufferBuilder.append(255&e)},a.prototype.pack_int16=function(e){this.bufferBuilder.append((65280&e)>>8),this.bufferBuilder.append(255&e)},a.prototype.pack_int32=function(e){this.bufferBuilder.append(e>>>24&255),this.bufferBuilder.append((16711680&e)>>>16),this.bufferBuilder.append((65280&e)>>>8),this.bufferBuilder.append(255&e)},a.prototype.pack_int64=function(e){var t=Math.floor(e/Math.pow(2,32)),n=e%Math.pow(2,32);this.bufferBuilder.append((4278190080&t)>>>24),this.bufferBuilder.append((16711680&t)>>>16),this.bufferBuilder.append((65280&t)>>>8),this.bufferBuilder.append(255&t),this.bufferBuilder.append((4278190080&n)>>>24),this.bufferBuilder.append((16711680&n)>>>16),this.bufferBuilder.append((65280&n)>>>8),this.bufferBuilder.append(255&n)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=(0,n(8).adapterFactory)({window:"undefined"==typeof window?void 0:window});t.default=i},function(e,t){var n={};n.useBlobBuilder=function(){try{return new Blob([]),!1}catch(e){return!0}}(),n.useArrayBufferView=!n.useBlobBuilder&&function(){try{return 0===new Blob([new Uint8Array([])]).size}catch(e){return!0}}(),e.exports.binaryFeatures=n;var i=e.exports.BlobBuilder;function r(){this._pieces=[],this._parts=[]}"undefined"!=typeof window&&(i=e.exports.BlobBuilder=window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder||window.BlobBuilder),r.prototype.append=function(e){"number"==typeof e?this._pieces.push(e):(this.flush(),this._parts.push(e))},r.prototype.flush=function(){if(this._pieces.length>0){var e=new Uint8Array(this._pieces);n.useArrayBufferView||(e=e.buffer),this._parts.push(e),this._pieces=[]}},r.prototype.getBuffer=function(){if(this.flush(),n.useBlobBuilder){for(var e=new i,t=0,r=this._parts.length;t<r;t++)e.append(this._parts[t]);return e.getBlob()}return new Blob(this._parts)},e.exports.BufferBuilder=r},function(e,t,n){"use strict";var i={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};i.localCName=i.generateIdentifier(),i.splitLines=function(e){return e.trim().split("\n").map((function(e){return e.trim()}))},i.splitSections=function(e){return e.split("\nm=").map((function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"}))},i.getDescription=function(e){var t=i.splitSections(e);return t&&t[0]},i.getMediaSections=function(e){var t=i.splitSections(e);return t.shift(),t},i.matchPrefix=function(e,t){return i.splitLines(e).filter((function(e){return 0===e.indexOf(t)}))},i.parseCandidate=function(e){for(var t,n={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]},i=8;i<t.length;i+=2)switch(t[i]){case"raddr":n.relatedAddress=t[i+1];break;case"rport":n.relatedPort=parseInt(t[i+1],10);break;case"tcptype":n.tcpType=t[i+1];break;case"ufrag":n.ufrag=t[i+1],n.usernameFragment=t[i+1];break;default:n[t[i]]=t[i+1]}return n},i.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);var n=e.type;return t.push("typ"),t.push(n),"host"!==n&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},i.parseIceOptions=function(e){return e.substr(14).split(" ")},i.parseRtpMap=function(e){var t=e.substr(9).split(" "),n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.channels=3===t.length?parseInt(t[2],10):1,n.numChannels=n.channels,n},i.writeRtpMap=function(e){var t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);var n=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==n?"/"+n:"")+"\r\n"},i.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},i.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},i.parseFmtp=function(e){for(var t,n={},i=e.substr(e.indexOf(" ")+1).split(";"),r=0;r<i.length;r++)n[(t=i[r].trim().split("="))[0].trim()]=t[1];return n},i.writeFmtp=function(e){var t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var i=[];Object.keys(e.parameters).forEach((function(t){e.parameters[t]?i.push(t+"="+e.parameters[t]):i.push(t)})),t+="a=fmtp:"+n+" "+i.join(";")+"\r\n"}return t},i.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},i.writeRtcpFb=function(e){var t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach((function(e){t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"})),t},i.parseSsrcMedia=function(e){var t=e.indexOf(" "),n={ssrc:parseInt(e.substr(7,t-7),10)},i=e.indexOf(":",t);return i>-1?(n.attribute=e.substr(t+1,i-t-1),n.value=e.substr(i+1)):n.attribute=e.substr(t+1),n},i.parseSsrcGroup=function(e){var t=e.substr(13).split(" ");return{semantics:t.shift(),ssrcs:t.map((function(e){return parseInt(e,10)}))}},i.getMid=function(e){var t=i.matchPrefix(e,"a=mid:")[0];if(t)return t.substr(6)},i.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}},i.getDtlsParameters=function(e,t){return{role:"auto",fingerprints:i.matchPrefix(e+t,"a=fingerprint:").map(i.parseFingerprint)}},i.writeDtlsParameters=function(e,t){var n="a=setup:"+t+"\r\n";return e.fingerprints.forEach((function(e){n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"})),n},i.parseCryptoLine=function(e){var t=e.substr(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},i.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"==typeof e.keyParams?i.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},i.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;var t=e.substr(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},i.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},i.getCryptoParameters=function(e,t){return i.matchPrefix(e+t,"a=crypto:").map(i.parseCryptoLine)},i.getIceParameters=function(e,t){var n=i.matchPrefix(e+t,"a=ice-ufrag:")[0],r=i.matchPrefix(e+t,"a=ice-pwd:")[0];return n&&r?{usernameFragment:n.substr(12),password:r.substr(10)}:null},i.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},i.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},n=i.splitLines(e)[0].split(" "),r=3;r<n.length;r++){var s=n[r],o=i.matchPrefix(e,"a=rtpmap:"+s+" ")[0];if(o){var a=i.parseRtpMap(o),c=i.matchPrefix(e,"a=fmtp:"+s+" ");switch(a.parameters=c.length?i.parseFmtp(c[0]):{},a.rtcpFeedback=i.matchPrefix(e,"a=rtcp-fb:"+s+" ").map(i.parseRtcpFb),t.codecs.push(a),a.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(a.name.toUpperCase())}}}return i.matchPrefix(e,"a=extmap:").forEach((function(e){t.headerExtensions.push(i.parseExtmap(e))})),t},i.writeRtpDescription=function(e,t){var n="";n+="m="+e+" ",n+=t.codecs.length>0?"9":"0",n+=" UDP/TLS/RTP/SAVPF ",n+=t.codecs.map((function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType})).join(" ")+"\r\n",n+="c=IN IP4 0.0.0.0\r\n",n+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach((function(e){n+=i.writeRtpMap(e),n+=i.writeFmtp(e),n+=i.writeRtcpFb(e)}));var r=0;return t.codecs.forEach((function(e){e.maxptime>r&&(r=e.maxptime)})),r>0&&(n+="a=maxptime:"+r+"\r\n"),n+="a=rtcp-mux\r\n",t.headerExtensions&&t.headerExtensions.forEach((function(e){n+=i.writeExtmap(e)})),n},i.parseRtpEncodingParameters=function(e){var t,n=[],r=i.parseRtpParameters(e),s=-1!==r.fecMechanisms.indexOf("RED"),o=-1!==r.fecMechanisms.indexOf("ULPFEC"),a=i.matchPrefix(e,"a=ssrc:").map((function(e){return i.parseSsrcMedia(e)})).filter((function(e){return"cname"===e.attribute})),c=a.length>0&&a[0].ssrc,l=i.matchPrefix(e,"a=ssrc-group:FID").map((function(e){return e.substr(17).split(" ").map((function(e){return parseInt(e,10)}))}));l.length>0&&l[0].length>1&&l[0][0]===c&&(t=l[0][1]),r.codecs.forEach((function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var i={ssrc:c,codecPayloadType:parseInt(e.parameters.apt,10)};c&&t&&(i.rtx={ssrc:t}),n.push(i),s&&((i=JSON.parse(JSON.stringify(i))).fec={ssrc:c,mechanism:o?"red+ulpfec":"red"},n.push(i))}})),0===n.length&&c&&n.push({ssrc:c});var u=i.matchPrefix(e,"b=");return u.length&&(u=0===u[0].indexOf("b=TIAS:")?parseInt(u[0].substr(7),10):0===u[0].indexOf("b=AS:")?1e3*parseInt(u[0].substr(5),10)*.95-16e3:void 0,n.forEach((function(e){e.maxBitrate=u}))),n},i.parseRtcpParameters=function(e){var t={},n=i.matchPrefix(e,"a=ssrc:").map((function(e){return i.parseSsrcMedia(e)})).filter((function(e){return"cname"===e.attribute}))[0];n&&(t.cname=n.value,t.ssrc=n.ssrc);var r=i.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=r.length>0,t.compound=0===r.length;var s=i.matchPrefix(e,"a=rtcp-mux");return t.mux=s.length>0,t},i.parseMsid=function(e){var t,n=i.matchPrefix(e,"a=msid:");if(1===n.length)return{stream:(t=n[0].substr(7).split(" "))[0],track:t[1]};var r=i.matchPrefix(e,"a=ssrc:").map((function(e){return i.parseSsrcMedia(e)})).filter((function(e){return"msid"===e.attribute}));return r.length>0?{stream:(t=r[0].value.split(" "))[0],track:t[1]}:void 0},i.parseSctpDescription=function(e){var t,n=i.parseMLine(e),r=i.matchPrefix(e,"a=max-message-size:");r.length>0&&(t=parseInt(r[0].substr(19),10)),isNaN(t)&&(t=65536);var s=i.matchPrefix(e,"a=sctp-port:");if(s.length>0)return{port:parseInt(s[0].substr(12),10),protocol:n.fmt,maxMessageSize:t};if(i.matchPrefix(e,"a=sctpmap:").length>0){var o=i.matchPrefix(e,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(o[0],10),protocol:o[1],maxMessageSize:t}}},i.writeSctpDescription=function(e,t){var n=[];return n="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&n.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),n.join("")},i.generateSessionId=function(){return Math.random().toString().substr(2,21)},i.writeSessionBoilerplate=function(e,t,n){var r=void 0!==t?t:2;return"v=0\r\no="+(n||"thisisadapterortc")+" "+(e||i.generateSessionId())+" "+r+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},i.writeMediaSection=function(e,t,n,r){var s=i.writeRtpDescription(e.kind,t);if(s+=i.writeIceParameters(e.iceGatherer.getLocalParameters()),s+=i.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===n?"actpass":"active"),s+="a=mid:"+e.mid+"\r\n",e.direction?s+="a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?s+="a=sendrecv\r\n":e.rtpSender?s+="a=sendonly\r\n":e.rtpReceiver?s+="a=recvonly\r\n":s+="a=inactive\r\n",e.rtpSender){var o="msid:"+r.id+" "+e.rtpSender.track.id+"\r\n";s+="a="+o,s+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+o,e.sendEncodingParameters[0].rtx&&(s+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+o,s+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return s+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+i.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(s+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+i.localCName+"\r\n"),s},i.getDirection=function(e,t){for(var n=i.splitLines(e),r=0;r<n.length;r++)switch(n[r]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[r].substr(2)}return t?i.getDirection(t):"sendrecv"},i.getKind=function(e){return i.splitLines(e)[0].split(" ")[0].substr(2)},i.isRejected=function(e){return"0"===e.split(" ",2)[1]},i.parseMLine=function(e){var t=i.splitLines(e)[0].substr(2).split(" ");return{kind:t[0],port:parseInt(t[1],10),protocol:t[2],fmt:t.slice(3).join(" ")}},i.parseOLine=function(e){var t=i.matchPrefix(e,"o=")[0].substr(2).split(" ");return{username:t[0],sessionId:t[1],sessionVersion:parseInt(t[2],10),netType:t[3],addressType:t[4],address:t[5]}},i.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;for(var t=i.splitLines(e),n=0;n<t.length;n++)if(t[n].length<2||"="!==t[n].charAt(1))return!1;return!0},e.exports=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.adapterFactory=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.window,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0},l=i.log,u=i.detectBrowser(t),h={browserDetails:u,commonShim:c,extractVersion:i.extractVersion,disableLog:i.disableLog,disableWarnings:i.disableWarnings};switch(u.browser){case"chrome":if(!r||!r.shimPeerConnection||!n.shimChrome)return l("Chrome shim is not included in this adapter release."),h;if(null===u.version)return l("Chrome shim can not determine version, not shimming."),h;l("adapter.js shimming chrome."),h.browserShim=r,c.shimAddIceCandidateNullOrEmpty(t,u),r.shimGetUserMedia(t,u),r.shimMediaStream(t,u),r.shimPeerConnection(t,u),r.shimOnTrack(t,u),r.shimAddTrackRemoveTrack(t,u),r.shimGetSendersWithDtmf(t,u),r.shimGetStats(t,u),r.shimSenderReceiverGetStats(t,u),r.fixNegotiationNeeded(t,u),c.shimRTCIceCandidate(t,u),c.shimConnectionState(t,u),c.shimMaxMessageSize(t,u),c.shimSendThrowTypeError(t,u),c.removeExtmapAllowMixed(t,u);break;case"firefox":if(!o||!o.shimPeerConnection||!n.shimFirefox)return l("Firefox shim is not included in this adapter release."),h;l("adapter.js shimming firefox."),h.browserShim=o,c.shimAddIceCandidateNullOrEmpty(t,u),o.shimGetUserMedia(t,u),o.shimPeerConnection(t,u),o.shimOnTrack(t,u),o.shimRemoveStream(t,u),o.shimSenderGetStats(t,u),o.shimReceiverGetStats(t,u),o.shimRTCDataChannel(t,u),o.shimAddTransceiver(t,u),o.shimGetParameters(t,u),o.shimCreateOffer(t,u),o.shimCreateAnswer(t,u),c.shimRTCIceCandidate(t,u),c.shimConnectionState(t,u),c.shimMaxMessageSize(t,u),c.shimSendThrowTypeError(t,u);break;case"edge":if(!s||!s.shimPeerConnection||!n.shimEdge)return l("MS edge shim is not included in this adapter release."),h;l("adapter.js shimming edge."),h.browserShim=s,s.shimGetUserMedia(t,u),s.shimGetDisplayMedia(t,u),s.shimPeerConnection(t,u),s.shimReplaceTrack(t,u),c.shimMaxMessageSize(t,u),c.shimSendThrowTypeError(t,u);break;case"safari":if(!a||!n.shimSafari)return l("Safari shim is not included in this adapter release."),h;l("adapter.js shimming safari."),h.browserShim=a,c.shimAddIceCandidateNullOrEmpty(t,u),a.shimRTCIceServerUrls(t,u),a.shimCreateOfferLegacy(t,u),a.shimCallbacksAPI(t,u),a.shimLocalStreamsAPI(t,u),a.shimRemoteStreamsAPI(t,u),a.shimTrackEventTransceiver(t,u),a.shimGetUserMedia(t,u),a.shimAudioContext(t,u),c.shimRTCIceCandidate(t,u),c.shimMaxMessageSize(t,u),c.shimSendThrowTypeError(t,u),c.removeExtmapAllowMixed(t,u);break;default:l("Unsupported browser!")}return h};var i=l(n(1)),r=l(n(9)),s=l(n(12)),o=l(n(17)),a=l(n(20)),c=l(n(21));function l(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.shimGetDisplayMedia=t.shimGetUserMedia=void 0;var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=n(10);Object.defineProperty(t,"shimGetUserMedia",{enumerable:!0,get:function(){return r.shimGetUserMedia}});var s=n(11);Object.defineProperty(t,"shimGetDisplayMedia",{enumerable:!0,get:function(){return s.shimGetDisplayMedia}}),t.shimMediaStream=function(e){e.MediaStream=e.MediaStream||e.webkitMediaStream},t.shimOnTrack=function(e){if("object"===(void 0===e?"undefined":i(e))&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var n=this;return this._ontrackpoly||(this._ontrackpoly=function(t){t.stream.addEventListener("addtrack",(function(i){var r=void 0;r=e.RTCPeerConnection.prototype.getReceivers?n.getReceivers().find((function(e){return e.track&&e.track.id===i.track.id})):{track:i.track};var s=new Event("track");s.track=i.track,s.receiver=r,s.transceiver={receiver:r},s.streams=[t.stream],n.dispatchEvent(s)})),t.stream.getTracks().forEach((function(i){var r=void 0;r=e.RTCPeerConnection.prototype.getReceivers?n.getReceivers().find((function(e){return e.track&&e.track.id===i.id})):{track:i};var s=new Event("track");s.track=i,s.receiver=r,s.transceiver={receiver:r},s.streams=[t.stream],n.dispatchEvent(s)}))},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else o.wrapPeerConnectionEvent(e,"track",(function(e){return e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e}))},t.shimGetSendersWithDtmf=function(e){if("object"===(void 0===e?"undefined":i(e))&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){var t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,i){var r=n.apply(this,arguments);return r||(r=t(this,e),this._senders.push(r)),r};var r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){r.apply(this,arguments);var t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}var s=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var n=this;this._senders=this._senders||[],s.apply(this,[e]),e.getTracks().forEach((function(e){n._senders.push(t(n,e))}))};var o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;this._senders=this._senders||[],o.apply(this,[e]),e.getTracks().forEach((function(e){var n=t._senders.find((function(t){return t.track===e}));n&&t._senders.splice(t._senders.indexOf(n),1)}))}}else if("object"===(void 0===e?"undefined":i(e))&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){var a=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){var e=this,t=a.apply(this,[]);return t.forEach((function(t){return t._pc=e})),t},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}},t.shimGetStats=function(e){if(!e.RTCPeerConnection)return;var t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){var e=this,n=Array.prototype.slice.call(arguments),i=n[0],r=n[1],s=n[2];if(arguments.length>0&&"function"==typeof i)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!=typeof i))return t.apply(this,[]);var o=function(e){var t={};return e.result().forEach((function(e){var n={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach((function(t){n[t]=e.stat(t)})),t[n.id]=n})),t},a=function(e){return new Map(Object.keys(e).map((function(t){return[t,e[t]]})))};if(arguments.length>=2){var c=function(e){r(a(o(e)))};return t.apply(this,[c,i])}return new Promise((function(n,i){t.apply(e,[function(e){n(a(o(e)))},i])})).then(r,s)}},t.shimSenderReceiverGetStats=function(e){if(!("object"===(void 0===e?"undefined":i(e))&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,n=t.apply(this,[]);return n.forEach((function(t){return t._pc=e})),n});var n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){var e=this;return this._pc.getStats().then((function(t){return o.filterStats(t,e.track,!0)}))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){var r=e.RTCPeerConnection.prototype.getReceivers;r&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,t=r.apply(this,[]);return t.forEach((function(t){return t._pc=e})),t}),o.wrapPeerConnectionEvent(e,"track",(function(e){return e.receiver._pc=e.srcElement,e})),e.RTCRtpReceiver.prototype.getStats=function(){var e=this;return this._pc.getStats().then((function(t){return o.filterStats(t,e.track,!1)}))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;var s=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){var t=arguments[0],n=void 0,i=void 0,r=void 0;return this.getSenders().forEach((function(e){e.track===t&&(n?r=!0:n=e)})),this.getReceivers().forEach((function(e){return e.track===t&&(i?r=!0:i=e),e.track===t})),r||n&&i?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):n?n.getStats():i?i.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return s.apply(this,arguments)}},t.shimAddTrackRemoveTrackWithNative=c,t.shimAddTrackRemoveTrack=function(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return c(e);var n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this,t=n.apply(this);return this._reverseStreams=this._reverseStreams||{},t.map((function(t){return e._reverseStreams[t.id]}))};var i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){var n=this;if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach((function(e){if(n.getSenders().find((function(t){return t.track===e})))throw new DOMException("Track already exists.","InvalidAccessError")})),!this._reverseStreams[t.id]){var r=new e.MediaStream(t.getTracks());this._streams[t.id]=r,this._reverseStreams[r.id]=t,t=r}i.apply(this,[t])};var r=e.RTCPeerConnection.prototype.removeStream;function s(e,t){var n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((function(t){var i=e._reverseStreams[t],r=e._streams[i.id];n=n.replace(new RegExp(r.id,"g"),i.id)})),new RTCSessionDescription({type:t.type,sdp:n})}function o(e,t){var n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((function(t){var i=e._reverseStreams[t],r=e._streams[i.id];n=n.replace(new RegExp(i.id,"g"),r.id)})),new RTCSessionDescription({type:t.type,sdp:n})}e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},r.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,n){var i=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var r=[].slice.call(arguments,1);if(1!==r.length||!r[0].getTracks().find((function(e){return e===t})))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");var s=this.getSenders().find((function(e){return e.track===t}));if(s)throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};var o=this._streams[n.id];if(o)o.addTrack(t),Promise.resolve().then((function(){i.dispatchEvent(new Event("negotiationneeded"))}));else{var a=new e.MediaStream([t]);this._streams[n.id]=a,this._reverseStreams[a.id]=n,this.addStream(a)}return this.getSenders().find((function(e){return e.track===t}))},["createOffer","createAnswer"].forEach((function(t){var n=e.RTCPeerConnection.prototype[t],i=a({},t,(function(){var e=this,t=arguments,i=arguments.length&&"function"==typeof arguments[0];return i?n.apply(this,[function(n){var i=s(e,n);t[0].apply(null,[i])},function(e){t[1]&&t[1].apply(null,e)},arguments[2]]):n.apply(this,arguments).then((function(t){return s(e,t)}))}));e.RTCPeerConnection.prototype[t]=i[t]}));var l=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=o(this,arguments[0]),l.apply(this,arguments)):l.apply(this,arguments)};var u=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get:function(){var e=u.get.apply(this);return""===e.type?e:s(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(e._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};var n=void 0;Object.keys(this._streams).forEach((function(i){t._streams[i].getTracks().find((function(t){return e.track===t}))&&(n=t._streams[i])})),n&&(1===n.getTracks().length?this.removeStream(this._reverseStreams[n.id]):n.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}},t.shimPeerConnection=function(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection);if(!e.RTCPeerConnection)return;t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){var n=e.RTCPeerConnection.prototype[t],i=a({},t,(function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}));e.RTCPeerConnection.prototype[t]=i[t]}))},t.fixNegotiationNeeded=function(e,t){o.wrapPeerConnectionEvent(e,"negotiationneeded",(function(e){var n=e.target;if(!(t.version<72||n.getConfiguration&&"plan-b"===n.getConfiguration().sdpSemantics)||"stable"===n.signalingState)return e}))};var o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(1));function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map((function(t){return e._shimmedLocalStreams[t][0]}))};var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){if(!n)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var i=t.apply(this,arguments);return this._shimmedLocalStreams[n.id]?-1===this._shimmedLocalStreams[n.id].indexOf(i)&&this._shimmedLocalStreams[n.id].push(i):this._shimmedLocalStreams[n.id]=[n,i],i};var n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var t=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach((function(e){if(t.getSenders().find((function(t){return t.track===e})))throw new DOMException("Track already exists.","InvalidAccessError")}));var i=this.getSenders();n.apply(this,arguments);var r=this.getSenders().filter((function(e){return-1===i.indexOf(e)}));this._shimmedLocalStreams[e.id]=[e].concat(r)};var i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],i.apply(this,arguments)};var r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach((function(n){var i=t._shimmedLocalStreams[n].indexOf(e);-1!==i&&t._shimmedLocalStreams[n].splice(i,1),1===t._shimmedLocalStreams[n].length&&delete t._shimmedLocalStreams[n]})),r.apply(this,arguments)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t.shimGetUserMedia=function(e,t){var n=e&&e.navigator;if(!n.mediaDevices)return;var s=function(e){if("object"!==(void 0===e?"undefined":i(e))||e.mandatory||e.optional)return e;var t={};return Object.keys(e).forEach((function(n){if("require"!==n&&"advanced"!==n&&"mediaSource"!==n){var r="object"===i(e[n])?e[n]:{ideal:e[n]};void 0!==r.exact&&"number"==typeof r.exact&&(r.min=r.max=r.exact);var s=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==r.ideal){t.optional=t.optional||[];var o={};"number"==typeof r.ideal?(o[s("min",n)]=r.ideal,t.optional.push(o),(o={})[s("max",n)]=r.ideal,t.optional.push(o)):(o[s("",n)]=r.ideal,t.optional.push(o))}void 0!==r.exact&&"number"!=typeof r.exact?(t.mandatory=t.mandatory||{},t.mandatory[s("",n)]=r.exact):["min","max"].forEach((function(e){void 0!==r[e]&&(t.mandatory=t.mandatory||{},t.mandatory[s(e,n)]=r[e])}))}})),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},o=function(e,o){if(t.version>=61)return o(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"===i(e.audio)){var a=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])};a((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),a(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=s(e.audio)}if(e&&"object"===i(e.video)){var c=e.video.facingMode;c=c&&("object"===(void 0===c?"undefined":i(c))?c:{ideal:c});var l=t.version<66;if(c&&("user"===c.exact||"environment"===c.exact||"user"===c.ideal||"environment"===c.ideal)&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||l)){delete e.video.facingMode;var u=void 0;if("environment"===c.exact||"environment"===c.ideal?u=["back","rear"]:"user"!==c.exact&&"user"!==c.ideal||(u=["front"]),u)return n.mediaDevices.enumerateDevices().then((function(t){var n=(t=t.filter((function(e){return"videoinput"===e.kind}))).find((function(e){return u.some((function(t){return e.label.toLowerCase().includes(t)}))}));return!n&&t.length&&u.includes("back")&&(n=t[t.length-1]),n&&(e.video.deviceId=c.exact?{exact:n.deviceId}:{ideal:n.deviceId}),e.video=s(e.video),r("chrome: "+JSON.stringify(e)),o(e)}))}e.video=s(e.video)}return r("chrome: "+JSON.stringify(e)),o(e)},a=function(e){return t.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=function(e,t,i){o(e,(function(e){n.webkitGetUserMedia(e,t,(function(e){i&&i(a(e))}))}))}.bind(n),n.mediaDevices.getUserMedia){var c=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(e){return o(e,(function(e){return c(e).then((function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach((function(e){e.stop()})),new DOMException("","NotFoundError");return t}),(function(e){return Promise.reject(a(e))}))}))}}};var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(1)).log},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.shimGetDisplayMedia=function(e,t){if(e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices)return;if(!e.navigator.mediaDevices)return;if("function"!=typeof t)return void console.error("shimGetDisplayMedia: getSourceId argument is not a function");e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then((function(t){var i=n.video&&n.video.width,r=n.video&&n.video.height,s=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:s||3}},i&&(n.video.mandatory.maxWidth=i),r&&(n.video.mandatory.maxHeight=r),e.navigator.mediaDevices.getUserMedia(n)}))}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.shimGetDisplayMedia=t.shimGetUserMedia=void 0;var i=n(13);Object.defineProperty(t,"shimGetUserMedia",{enumerable:!0,get:function(){return i.shimGetUserMedia}});var r=n(14);Object.defineProperty(t,"shimGetDisplayMedia",{enumerable:!0,get:function(){return r.shimGetDisplayMedia}}),t.shimPeerConnection=function(e,t){if(e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(e){return e}),e.RTCSessionDescription||(e.RTCSessionDescription=function(e){return e}),t.version<15025)){var n=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,"enabled");Object.defineProperty(e.MediaStreamTrack.prototype,"enabled",{set:function(e){n.set.call(this,e);var t=new Event("enabled");t.enabled=e,this.dispatchEvent(t)}})}e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)&&Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new e.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}});e.RTCDtmfSender&&!e.RTCDTMFSender&&(e.RTCDTMFSender=e.RTCDtmfSender);var i=(0,l.default)(e,t.version);e.RTCPeerConnection=function(e){return e&&e.iceServers&&(e.iceServers=(0,a.filterIceServers)(e.iceServers,t.version),o.log("ICE servers after filtering:",e.iceServers)),new i(e)},e.RTCPeerConnection.prototype=i.prototype},t.shimReplaceTrack=function(e){e.RTCRtpSender&&!("replaceTrack"in e.RTCRtpSender.prototype)&&(e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack)};var s,o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(1)),a=n(15),c=n(16),l=(s=c)&&s.__esModule?s:{default:s}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.shimGetUserMedia=function(e){var t=e&&e.navigator,n=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return n(e).catch((function(e){return Promise.reject(function(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString:function(){return this.name}}}(e))}))}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.shimGetDisplayMedia=function(e){if(!("getDisplayMedia"in e.navigator))return;if(!e.navigator.mediaDevices)return;if(e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices)return;e.navigator.mediaDevices.getDisplayMedia=e.navigator.getDisplayMedia.bind(e.navigator)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.filterIceServers=function(e,t){var n=!1;return(e=JSON.parse(JSON.stringify(e))).filter((function(e){if(e&&(e.urls||e.url)){var t=e.urls||e.url;e.url&&!e.urls&&i.deprecated("RTCIceServer.url","RTCIceServer.urls");var r="string"==typeof t;return r&&(t=[t]),t=t.filter((function(e){if(0===e.indexOf("stun:"))return!1;var t=e.startsWith("turn")&&!e.startsWith("turn:[")&&e.includes("transport=udp");return t&&!n?(n=!0,!0):t&&!n})),delete e.url,e.urls=r?t[0]:t,!!t.length}}))};var i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(1))},function(e,t,n){"use strict";var i=n(7);function r(e,t,n,r,s){var o=i.writeRtpDescription(e.kind,t);if(o+=i.writeIceParameters(e.iceGatherer.getLocalParameters()),o+=i.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===n?"actpass":s||"active"),o+="a=mid:"+e.mid+"\r\n",e.rtpSender&&e.rtpReceiver?o+="a=sendrecv\r\n":e.rtpSender?o+="a=sendonly\r\n":e.rtpReceiver?o+="a=recvonly\r\n":o+="a=inactive\r\n",e.rtpSender){var a=e.rtpSender._initialTrackId||e.rtpSender.track.id;e.rtpSender._initialTrackId=a;var c="msid:"+(r?r.id:"-")+" "+a+"\r\n";o+="a="+c,o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+c,e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+c,o+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+i.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+i.localCName+"\r\n"),o}function s(e,t){var n={codecs:[],headerExtensions:[],fecMechanisms:[]},i=function(e,t){e=parseInt(e,10);for(var n=0;n<t.length;n++)if(t[n].payloadType===e||t[n].preferredPayloadType===e)return t[n]},r=function(e,t,n,r){var s=i(e.parameters.apt,n),o=i(t.parameters.apt,r);return s&&o&&s.name.toLowerCase()===o.name.toLowerCase()};return e.codecs.forEach((function(i){for(var s=0;s<t.codecs.length;s++){var o=t.codecs[s];if(i.name.toLowerCase()===o.name.toLowerCase()&&i.clockRate===o.clockRate){if("rtx"===i.name.toLowerCase()&&i.parameters&&o.parameters.apt&&!r(i,o,e.codecs,t.codecs))continue;(o=JSON.parse(JSON.stringify(o))).numChannels=Math.min(i.numChannels,o.numChannels),n.codecs.push(o),o.rtcpFeedback=o.rtcpFeedback.filter((function(e){for(var t=0;t<i.rtcpFeedback.length;t++)if(i.rtcpFeedback[t].type===e.type&&i.rtcpFeedback[t].parameter===e.parameter)return!0;return!1}));break}}})),e.headerExtensions.forEach((function(e){for(var i=0;i<t.headerExtensions.length;i++){var r=t.headerExtensions[i];if(e.uri===r.uri){n.headerExtensions.push(r);break}}})),n}function o(e,t,n){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(n)}function a(e,t){var n=e.getRemoteCandidates().find((function(e){return t.foundation===e.foundation&&t.ip===e.ip&&t.port===e.port&&t.priority===e.priority&&t.protocol===e.protocol&&t.type===e.type}));return n||e.addRemoteCandidate(t),!n}function c(e,t){var n=new Error(t);return n.name=e,n.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[e],n}e.exports=function(e,t){function n(t,n){n.addTrack(t),n.dispatchEvent(new e.MediaStreamTrackEvent("addtrack",{track:t}))}function l(t,n,i,r){var s=new Event("track");s.track=n,s.receiver=i,s.transceiver={receiver:i},s.streams=r,e.setTimeout((function(){t._dispatchEvent("track",s)}))}var u=function(n){var r=this,s=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach((function(e){r[e]=s[e].bind(s)})),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",n=JSON.parse(JSON.stringify(n||{})),this.usingBundle="max-bundle"===n.bundlePolicy,"negotiate"===n.rtcpMuxPolicy)throw c("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(n.rtcpMuxPolicy||(n.rtcpMuxPolicy="require"),n.iceTransportPolicy){case"all":case"relay":break;default:n.iceTransportPolicy="all"}switch(n.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:n.bundlePolicy="balanced"}if(n.iceServers=function(e,t){var n=!1;return(e=JSON.parse(JSON.stringify(e))).filter((function(e){if(e&&(e.urls||e.url)){var i=e.urls||e.url;e.url&&!e.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var r="string"==typeof i;return r&&(i=[i]),i=i.filter((function(e){return 0===e.indexOf("turn:")&&-1!==e.indexOf("transport=udp")&&-1===e.indexOf("turn:[")&&!n?(n=!0,!0):0===e.indexOf("stun:")&&t>=14393&&-1===e.indexOf("?transport=udp")})),delete e.url,e.urls=r?i[0]:i,!!i.length}}))}(n.iceServers||[],t),this._iceGatherers=[],n.iceCandidatePoolSize)for(var o=n.iceCandidatePoolSize;o>0;o--)this._iceGatherers.push(new e.RTCIceGatherer({iceServers:n.iceServers,gatherPolicy:n.iceTransportPolicy}));else n.iceCandidatePoolSize=0;this._config=n,this.transceivers=[],this._sdpSessionId=i.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(u.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(u.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),u.prototype.onicecandidate=null,u.prototype.onaddstream=null,u.prototype.ontrack=null,u.prototype.onremovestream=null,u.prototype.onsignalingstatechange=null,u.prototype.oniceconnectionstatechange=null,u.prototype.onconnectionstatechange=null,u.prototype.onicegatheringstatechange=null,u.prototype.onnegotiationneeded=null,u.prototype.ondatachannel=null,u.prototype._dispatchEvent=function(e,t){this._isClosed||(this.dispatchEvent(t),"function"==typeof this["on"+e]&&this["on"+e](t))},u.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",e)},u.prototype.getConfiguration=function(){return this._config},u.prototype.getLocalStreams=function(){return this.localStreams},u.prototype.getRemoteStreams=function(){return this.remoteStreams},u.prototype._createTransceiver=function(e,t){var n=this.transceivers.length>0,i={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&n)i.iceTransport=this.transceivers[0].iceTransport,i.dtlsTransport=this.transceivers[0].dtlsTransport;else{var r=this._createIceAndDtlsTransports();i.iceTransport=r.iceTransport,i.dtlsTransport=r.dtlsTransport}return t||this.transceivers.push(i),i},u.prototype.addTrack=function(t,n){if(this._isClosed)throw c("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var i;if(this.transceivers.find((function(e){return e.track===t})))throw c("InvalidAccessError","Track already exists.");for(var r=0;r<this.transceivers.length;r++)this.transceivers[r].track||this.transceivers[r].kind!==t.kind||(i=this.transceivers[r]);return i||(i=this._createTransceiver(t.kind)),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(n)&&this.localStreams.push(n),i.track=t,i.stream=n,i.rtpSender=new e.RTCRtpSender(t,i.dtlsTransport),i.rtpSender},u.prototype.addStream=function(e){var n=this;if(t>=15025)e.getTracks().forEach((function(t){n.addTrack(t,e)}));else{var i=e.clone();e.getTracks().forEach((function(e,t){var n=i.getTracks()[t];e.addEventListener("enabled",(function(e){n.enabled=e.enabled}))})),i.getTracks().forEach((function(e){n.addTrack(e,i)}))}},u.prototype.removeTrack=function(t){if(this._isClosed)throw c("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(t instanceof e.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var n=this.transceivers.find((function(e){return e.rtpSender===t}));if(!n)throw c("InvalidAccessError","Sender was not created by this connection.");var i=n.stream;n.rtpSender.stop(),n.rtpSender=null,n.track=null,n.stream=null,-1===this.transceivers.map((function(e){return e.stream})).indexOf(i)&&this.localStreams.indexOf(i)>-1&&this.localStreams.splice(this.localStreams.indexOf(i),1),this._maybeFireNegotiationNeeded()},u.prototype.removeStream=function(e){var t=this;e.getTracks().forEach((function(e){var n=t.getSenders().find((function(t){return t.track===e}));n&&t.removeTrack(n)}))},u.prototype.getSenders=function(){return this.transceivers.filter((function(e){return!!e.rtpSender})).map((function(e){return e.rtpSender}))},u.prototype.getReceivers=function(){return this.transceivers.filter((function(e){return!!e.rtpReceiver})).map((function(e){return e.rtpReceiver}))},u.prototype._createIceGatherer=function(t,n){var i=this;if(n&&t>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var r=new e.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(r,"state",{value:"new",writable:!0}),this.transceivers[t].bufferedCandidateEvents=[],this.transceivers[t].bufferCandidates=function(e){var n=!e.candidate||0===Object.keys(e.candidate).length;r.state=n?"completed":"gathering",null!==i.transceivers[t].bufferedCandidateEvents&&i.transceivers[t].bufferedCandidateEvents.push(e)},r.addEventListener("localcandidate",this.transceivers[t].bufferCandidates),r},u.prototype._gather=function(t,n){var r=this,s=this.transceivers[n].iceGatherer;if(!s.onlocalcandidate){var o=this.transceivers[n].bufferedCandidateEvents;this.transceivers[n].bufferedCandidateEvents=null,s.removeEventListener("localcandidate",this.transceivers[n].bufferCandidates),s.onlocalcandidate=function(e){if(!(r.usingBundle&&n>0)){var o=new Event("icecandidate");o.candidate={sdpMid:t,sdpMLineIndex:n};var a=e.candidate,c=!a||0===Object.keys(a).length;if(c)"new"!==s.state&&"gathering"!==s.state||(s.state="completed");else{"new"===s.state&&(s.state="gathering"),a.component=1,a.ufrag=s.getLocalParameters().usernameFragment;var l=i.writeCandidate(a);o.candidate=Object.assign(o.candidate,i.parseCandidate(l)),o.candidate.candidate=l,o.candidate.toJSON=function(){return{candidate:o.candidate.candidate,sdpMid:o.candidate.sdpMid,sdpMLineIndex:o.candidate.sdpMLineIndex,usernameFragment:o.candidate.usernameFragment}}}var u=i.getMediaSections(r._localDescription.sdp);u[o.candidate.sdpMLineIndex]+=c?"a=end-of-candidates\r\n":"a="+o.candidate.candidate+"\r\n",r._localDescription.sdp=i.getDescription(r._localDescription.sdp)+u.join("");var h=r.transceivers.every((function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state}));"gathering"!==r.iceGatheringState&&(r.iceGatheringState="gathering",r._emitGatheringStateChange()),c||r._dispatchEvent("icecandidate",o),h&&(r._dispatchEvent("icecandidate",new Event("icecandidate")),r.iceGatheringState="complete",r._emitGatheringStateChange())}},e.setTimeout((function(){o.forEach((function(e){s.onlocalcandidate(e)}))}),0)}},u.prototype._createIceAndDtlsTransports=function(){var t=this,n=new e.RTCIceTransport(null);n.onicestatechange=function(){t._updateIceConnectionState(),t._updateConnectionState()};var i=new e.RTCDtlsTransport(n);return i.ondtlsstatechange=function(){t._updateConnectionState()},i.onerror=function(){Object.defineProperty(i,"state",{value:"failed",writable:!0}),t._updateConnectionState()},{iceTransport:n,dtlsTransport:i}},u.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;t&&(delete t.onlocalcandidate,delete this.transceivers[e].iceGatherer);var n=this.transceivers[e].iceTransport;n&&(delete n.onicestatechange,delete this.transceivers[e].iceTransport);var i=this.transceivers[e].dtlsTransport;i&&(delete i.ondtlsstatechange,delete i.onerror,delete this.transceivers[e].dtlsTransport)},u.prototype._transceive=function(e,n,r){var o=s(e.localCapabilities,e.remoteCapabilities);n&&e.rtpSender&&(o.encodings=e.sendEncodingParameters,o.rtcp={cname:i.localCName,compound:e.rtcpParameters.compound},e.recvEncodingParameters.length&&(o.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(o)),r&&e.rtpReceiver&&o.codecs.length>0&&("video"===e.kind&&e.recvEncodingParameters&&t<15019&&e.recvEncodingParameters.forEach((function(e){delete e.rtx})),e.recvEncodingParameters.length?o.encodings=e.recvEncodingParameters:o.encodings=[{}],o.rtcp={compound:e.rtcpParameters.compound},e.rtcpParameters.cname&&(o.rtcp.cname=e.rtcpParameters.cname),e.sendEncodingParameters.length&&(o.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(o))},u.prototype.setLocalDescription=function(e){var t,n,r=this;if(-1===["offer","answer"].indexOf(e.type))return Promise.reject(c("TypeError",'Unsupported type "'+e.type+'"'));if(!o("setLocalDescription",e.type,r.signalingState)||r._isClosed)return Promise.reject(c("InvalidStateError","Can not set local "+e.type+" in state "+r.signalingState));if("offer"===e.type)t=i.splitSections(e.sdp),n=t.shift(),t.forEach((function(e,t){var n=i.parseRtpParameters(e);r.transceivers[t].localCapabilities=n})),r.transceivers.forEach((function(e,t){r._gather(e.mid,t)}));else if("answer"===e.type){t=i.splitSections(r._remoteDescription.sdp),n=t.shift();var a=i.matchPrefix(n,"a=ice-lite").length>0;t.forEach((function(e,t){var o=r.transceivers[t],c=o.iceGatherer,l=o.iceTransport,u=o.dtlsTransport,h=o.localCapabilities,d=o.remoteCapabilities;if(!(i.isRejected(e)&&0===i.matchPrefix(e,"a=bundle-only").length)&&!o.rejected){var p=i.getIceParameters(e,n),f=i.getDtlsParameters(e,n);a&&(f.role="server"),r.usingBundle&&0!==t||(r._gather(o.mid,t),"new"===l.state&&l.start(c,p,a?"controlling":"controlled"),"new"===u.state&&u.start(f));var m=s(h,d);r._transceive(o,m.codecs.length>0,!1)}}))}return r._localDescription={type:e.type,sdp:e.sdp},"offer"===e.type?r._updateSignalingState("have-local-offer"):r._updateSignalingState("stable"),Promise.resolve()},u.prototype.setRemoteDescription=function(r){var u=this;if(-1===["offer","answer"].indexOf(r.type))return Promise.reject(c("TypeError",'Unsupported type "'+r.type+'"'));if(!o("setRemoteDescription",r.type,u.signalingState)||u._isClosed)return Promise.reject(c("InvalidStateError","Can not set remote "+r.type+" in state "+u.signalingState));var h={};u.remoteStreams.forEach((function(e){h[e.id]=e}));var d=[],p=i.splitSections(r.sdp),f=p.shift(),m=i.matchPrefix(f,"a=ice-lite").length>0,g=i.matchPrefix(f,"a=group:BUNDLE ").length>0;u.usingBundle=g;var v=i.matchPrefix(f,"a=ice-options:")[0];return u.canTrickleIceCandidates=!!v&&v.substr(14).split(" ").indexOf("trickle")>=0,p.forEach((function(o,c){var l=i.splitLines(o),p=i.getKind(o),v=i.isRejected(o)&&0===i.matchPrefix(o,"a=bundle-only").length,y=l[0].substr(2).split(" ")[2],x=i.getDirection(o,f),w=i.parseMsid(o),b=i.getMid(o)||i.generateIdentifier();if(v||"application"===p&&("DTLS/SCTP"===y||"UDP/DTLS/SCTP"===y))u.transceivers[c]={mid:b,kind:p,protocol:y,rejected:!0};else{var A,S,_,M,T,E,C,R,P;!v&&u.transceivers[c]&&u.transceivers[c].rejected&&(u.transceivers[c]=u._createTransceiver(p,!0));var L,D,I=i.parseRtpParameters(o);v||(L=i.getIceParameters(o,f),(D=i.getDtlsParameters(o,f)).role="client"),C=i.parseRtpEncodingParameters(o);var k=i.parseRtcpParameters(o),O=i.matchPrefix(o,"a=end-of-candidates",f).length>0,B=i.matchPrefix(o,"a=candidate:").map((function(e){return i.parseCandidate(e)})).filter((function(e){return 1===e.component}));if(("offer"===r.type||"answer"===r.type)&&!v&&g&&c>0&&u.transceivers[c]&&(u._disposeIceAndDtlsTransports(c),u.transceivers[c].iceGatherer=u.transceivers[0].iceGatherer,u.transceivers[c].iceTransport=u.transceivers[0].iceTransport,u.transceivers[c].dtlsTransport=u.transceivers[0].dtlsTransport,u.transceivers[c].rtpSender&&u.transceivers[c].rtpSender.setTransport(u.transceivers[0].dtlsTransport),u.transceivers[c].rtpReceiver&&u.transceivers[c].rtpReceiver.setTransport(u.transceivers[0].dtlsTransport)),"offer"!==r.type||v){if("answer"===r.type&&!v){S=(A=u.transceivers[c]).iceGatherer,_=A.iceTransport,M=A.dtlsTransport,T=A.rtpReceiver,E=A.sendEncodingParameters,R=A.localCapabilities,u.transceivers[c].recvEncodingParameters=C,u.transceivers[c].remoteCapabilities=I,u.transceivers[c].rtcpParameters=k,B.length&&"new"===_.state&&(!m&&!O||g&&0!==c?B.forEach((function(e){a(A.iceTransport,e)})):_.setRemoteCandidates(B)),g&&0!==c||("new"===_.state&&_.start(S,L,"controlling"),"new"===M.state&&M.start(D)),!s(A.localCapabilities,A.remoteCapabilities).codecs.filter((function(e){return"rtx"===e.name.toLowerCase()})).length&&A.sendEncodingParameters[0].rtx&&delete A.sendEncodingParameters[0].rtx,u._transceive(A,"sendrecv"===x||"recvonly"===x,"sendrecv"===x||"sendonly"===x),!T||"sendrecv"!==x&&"sendonly"!==x?delete A.rtpReceiver:(P=T.track,w?(h[w.stream]||(h[w.stream]=new e.MediaStream),n(P,h[w.stream]),d.push([P,T,h[w.stream]])):(h.default||(h.default=new e.MediaStream),n(P,h.default),d.push([P,T,h.default])))}}else{(A=u.transceivers[c]||u._createTransceiver(p)).mid=b,A.iceGatherer||(A.iceGatherer=u._createIceGatherer(c,g)),B.length&&"new"===A.iceTransport.state&&(!O||g&&0!==c?B.forEach((function(e){a(A.iceTransport,e)})):A.iceTransport.setRemoteCandidates(B)),R=e.RTCRtpReceiver.getCapabilities(p),t<15019&&(R.codecs=R.codecs.filter((function(e){return"rtx"!==e.name}))),E=A.sendEncodingParameters||[{ssrc:1001*(2*c+2)}];var N,z=!1;if("sendrecv"===x||"sendonly"===x){if(z=!A.rtpReceiver,T=A.rtpReceiver||new e.RTCRtpReceiver(A.dtlsTransport,p),z)P=T.track,w&&"-"===w.stream||(w?(h[w.stream]||(h[w.stream]=new e.MediaStream,Object.defineProperty(h[w.stream],"id",{get:function(){return w.stream}})),Object.defineProperty(P,"id",{get:function(){return w.track}}),N=h[w.stream]):(h.default||(h.default=new e.MediaStream),N=h.default)),N&&(n(P,N),A.associatedRemoteMediaStreams.push(N)),d.push([P,T,N])}else A.rtpReceiver&&A.rtpReceiver.track&&(A.associatedRemoteMediaStreams.forEach((function(t){var n=t.getTracks().find((function(e){return e.id===A.rtpReceiver.track.id}));n&&function(t,n){n.removeTrack(t),n.dispatchEvent(new e.MediaStreamTrackEvent("removetrack",{track:t}))}(n,t)})),A.associatedRemoteMediaStreams=[]);A.localCapabilities=R,A.remoteCapabilities=I,A.rtpReceiver=T,A.rtcpParameters=k,A.sendEncodingParameters=E,A.recvEncodingParameters=C,u._transceive(u.transceivers[c],!1,z)}}})),void 0===u._dtlsRole&&(u._dtlsRole="offer"===r.type?"active":"passive"),u._remoteDescription={type:r.type,sdp:r.sdp},"offer"===r.type?u._updateSignalingState("have-remote-offer"):u._updateSignalingState("stable"),Object.keys(h).forEach((function(t){var n=h[t];if(n.getTracks().length){if(-1===u.remoteStreams.indexOf(n)){u.remoteStreams.push(n);var i=new Event("addstream");i.stream=n,e.setTimeout((function(){u._dispatchEvent("addstream",i)}))}d.forEach((function(e){var t=e[0],i=e[1];n.id===e[2].id&&l(u,t,i,[n])}))}})),d.forEach((function(e){e[2]||l(u,e[0],e[1],[])})),e.setTimeout((function(){u&&u.transceivers&&u.transceivers.forEach((function(e){e.iceTransport&&"new"===e.iceTransport.state&&e.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),e.iceTransport.addRemoteCandidate({}))}))}),4e3),Promise.resolve()},u.prototype.close=function(){this.transceivers.forEach((function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()})),this._isClosed=!0,this._updateSignalingState("closed")},u.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",t)},u.prototype._maybeFireNegotiationNeeded=function(){var t=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,e.setTimeout((function(){if(t.needNegotiation){t.needNegotiation=!1;var e=new Event("negotiationneeded");t._dispatchEvent("negotiationneeded",e)}}),0))},u.prototype._updateIceConnectionState=function(){var e,t={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach((function(e){e.iceTransport&&!e.rejected&&t[e.iceTransport.state]++})),e="new",t.failed>0?e="failed":t.checking>0?e="checking":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0?e="connected":t.completed>0&&(e="completed"),e!==this.iceConnectionState){this.iceConnectionState=e;var n=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",n)}},u.prototype._updateConnectionState=function(){var e,t={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach((function(e){e.iceTransport&&e.dtlsTransport&&!e.rejected&&(t[e.iceTransport.state]++,t[e.dtlsTransport.state]++)})),t.connected+=t.completed,e="new",t.failed>0?e="failed":t.connecting>0?e="connecting":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0&&(e="connected"),e!==this.connectionState){this.connectionState=e;var n=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",n)}},u.prototype.createOffer=function(){var n=this;if(n._isClosed)return Promise.reject(c("InvalidStateError","Can not call createOffer after close"));var s=n.transceivers.filter((function(e){return"audio"===e.kind})).length,o=n.transceivers.filter((function(e){return"video"===e.kind})).length,a=arguments[0];if(a){if(a.mandatory||a.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==a.offerToReceiveAudio&&(s=!0===a.offerToReceiveAudio?1:!1===a.offerToReceiveAudio?0:a.offerToReceiveAudio),void 0!==a.offerToReceiveVideo&&(o=!0===a.offerToReceiveVideo?1:!1===a.offerToReceiveVideo?0:a.offerToReceiveVideo)}for(n.transceivers.forEach((function(e){"audio"===e.kind?--s<0&&(e.wantReceive=!1):"video"===e.kind&&--o<0&&(e.wantReceive=!1)}));s>0||o>0;)s>0&&(n._createTransceiver("audio"),s--),o>0&&(n._createTransceiver("video"),o--);var l=i.writeSessionBoilerplate(n._sdpSessionId,n._sdpSessionVersion++);n.transceivers.forEach((function(r,s){var o=r.track,a=r.kind,c=r.mid||i.generateIdentifier();r.mid=c,r.iceGatherer||(r.iceGatherer=n._createIceGatherer(s,n.usingBundle));var l=e.RTCRtpSender.getCapabilities(a);t<15019&&(l.codecs=l.codecs.filter((function(e){return"rtx"!==e.name}))),l.codecs.forEach((function(e){"H264"===e.name&&void 0===e.parameters["level-asymmetry-allowed"]&&(e.parameters["level-asymmetry-allowed"]="1"),r.remoteCapabilities&&r.remoteCapabilities.codecs&&r.remoteCapabilities.codecs.forEach((function(t){e.name.toLowerCase()===t.name.toLowerCase()&&e.clockRate===t.clockRate&&(e.preferredPayloadType=t.payloadType)}))})),l.headerExtensions.forEach((function(e){(r.remoteCapabilities&&r.remoteCapabilities.headerExtensions||[]).forEach((function(t){e.uri===t.uri&&(e.id=t.id)}))}));var u=r.sendEncodingParameters||[{ssrc:1001*(2*s+1)}];o&&t>=15019&&"video"===a&&!u[0].rtx&&(u[0].rtx={ssrc:u[0].ssrc+1}),r.wantReceive&&(r.rtpReceiver=new e.RTCRtpReceiver(r.dtlsTransport,a)),r.localCapabilities=l,r.sendEncodingParameters=u})),"max-compat"!==n._config.bundlePolicy&&(l+="a=group:BUNDLE "+n.transceivers.map((function(e){return e.mid})).join(" ")+"\r\n"),l+="a=ice-options:trickle\r\n",n.transceivers.forEach((function(e,t){l+=r(e,e.localCapabilities,"offer",e.stream,n._dtlsRole),l+="a=rtcp-rsize\r\n",!e.iceGatherer||"new"===n.iceGatheringState||0!==t&&n.usingBundle||(e.iceGatherer.getLocalCandidates().forEach((function(e){e.component=1,l+="a="+i.writeCandidate(e)+"\r\n"})),"completed"===e.iceGatherer.state&&(l+="a=end-of-candidates\r\n"))}));var u=new e.RTCSessionDescription({type:"offer",sdp:l});return Promise.resolve(u)},u.prototype.createAnswer=function(){var n=this;if(n._isClosed)return Promise.reject(c("InvalidStateError","Can not call createAnswer after close"));if("have-remote-offer"!==n.signalingState&&"have-local-pranswer"!==n.signalingState)return Promise.reject(c("InvalidStateError","Can not call createAnswer in signalingState "+n.signalingState));var o=i.writeSessionBoilerplate(n._sdpSessionId,n._sdpSessionVersion++);n.usingBundle&&(o+="a=group:BUNDLE "+n.transceivers.map((function(e){return e.mid})).join(" ")+"\r\n"),o+="a=ice-options:trickle\r\n";var a=i.getMediaSections(n._remoteDescription.sdp).length;n.transceivers.forEach((function(e,i){if(!(i+1>a)){if(e.rejected)return"application"===e.kind?"DTLS/SCTP"===e.protocol?o+="m=application 0 DTLS/SCTP 5000\r\n":o+="m=application 0 "+e.protocol+" webrtc-datachannel\r\n":"audio"===e.kind?o+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n":"video"===e.kind&&(o+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"),void(o+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+e.mid+"\r\n");var c;if(e.stream)"audio"===e.kind?c=e.stream.getAudioTracks()[0]:"video"===e.kind&&(c=e.stream.getVideoTracks()[0]),c&&t>=15019&&"video"===e.kind&&!e.sendEncodingParameters[0].rtx&&(e.sendEncodingParameters[0].rtx={ssrc:e.sendEncodingParameters[0].ssrc+1});var l=s(e.localCapabilities,e.remoteCapabilities);!l.codecs.filter((function(e){return"rtx"===e.name.toLowerCase()})).length&&e.sendEncodingParameters[0].rtx&&delete e.sendEncodingParameters[0].rtx,o+=r(e,l,"answer",e.stream,n._dtlsRole),e.rtcpParameters&&e.rtcpParameters.reducedSize&&(o+="a=rtcp-rsize\r\n")}}));var l=new e.RTCSessionDescription({type:"answer",sdp:o});return Promise.resolve(l)},u.prototype.addIceCandidate=function(e){var t,n=this;return e&&void 0===e.sdpMLineIndex&&!e.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise((function(r,s){if(!n._remoteDescription)return s(c("InvalidStateError","Can not add ICE candidate without a remote description"));if(e&&""!==e.candidate){var o=e.sdpMLineIndex;if(e.sdpMid)for(var l=0;l<n.transceivers.length;l++)if(n.transceivers[l].mid===e.sdpMid){o=l;break}var u=n.transceivers[o];if(!u)return s(c("OperationError","Can not add ICE candidate"));if(u.rejected)return r();var h=Object.keys(e.candidate).length>0?i.parseCandidate(e.candidate):{};if("tcp"===h.protocol&&(0===h.port||9===h.port))return r();if(h.component&&1!==h.component)return r();if((0===o||o>0&&u.iceTransport!==n.transceivers[0].iceTransport)&&!a(u.iceTransport,h))return s(c("OperationError","Can not add ICE candidate"));var d=e.candidate.trim();0===d.indexOf("a=")&&(d=d.substr(2)),(t=i.getMediaSections(n._remoteDescription.sdp))[o]+="a="+(h.type?d:"end-of-candidates")+"\r\n",n._remoteDescription.sdp=i.getDescription(n._remoteDescription.sdp)+t.join("")}else for(var p=0;p<n.transceivers.length&&(n.transceivers[p].rejected||(n.transceivers[p].iceTransport.addRemoteCandidate({}),(t=i.getMediaSections(n._remoteDescription.sdp))[p]+="a=end-of-candidates\r\n",n._remoteDescription.sdp=i.getDescription(n._remoteDescription.sdp)+t.join(""),!n.usingBundle));p++);r()}))},u.prototype.getStats=function(t){if(t&&t instanceof e.MediaStreamTrack){var n=null;if(this.transceivers.forEach((function(e){e.rtpSender&&e.rtpSender.track===t?n=e.rtpSender:e.rtpReceiver&&e.rtpReceiver.track===t&&(n=e.rtpReceiver)})),!n)throw c("InvalidAccessError","Invalid selector.");return n.getStats()}var i=[];return this.transceivers.forEach((function(e){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach((function(t){e[t]&&i.push(e[t].getStats())}))})),Promise.all(i).then((function(e){var t=new Map;return e.forEach((function(e){e.forEach((function(e){t.set(e.id,e)}))})),t}))};["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach((function(t){var n=e[t];if(n&&n.prototype&&n.prototype.getStats){var i=n.prototype.getStats;n.prototype.getStats=function(){return i.apply(this).then((function(e){var t=new Map;return Object.keys(e).forEach((function(n){var i;e[n].type={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[(i=e[n]).type]||i.type,t.set(n,e[n])})),t}))}}}));var h=["createOffer","createAnswer"];return h.forEach((function(e){var t=u.prototype[e];u.prototype[e]=function(){var e=arguments;return"function"==typeof e[0]||"function"==typeof e[1]?t.apply(this,[arguments[2]]).then((function(t){"function"==typeof e[0]&&e[0].apply(null,[t])}),(function(t){"function"==typeof e[1]&&e[1].apply(null,[t])})):t.apply(this,arguments)}})),(h=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach((function(e){var t=u.prototype[e];u.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]||"function"==typeof e[2]?t.apply(this,arguments).then((function(){"function"==typeof e[1]&&e[1].apply(null)}),(function(t){"function"==typeof e[2]&&e[2].apply(null,[t])})):t.apply(this,arguments)}})),["getStats"].forEach((function(e){var t=u.prototype[e];u.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]?t.apply(this,arguments).then((function(){"function"==typeof e[1]&&e[1].apply(null)})):t.apply(this,arguments)}})),u}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.shimGetDisplayMedia=t.shimGetUserMedia=void 0;var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=n(18);Object.defineProperty(t,"shimGetUserMedia",{enumerable:!0,get:function(){return r.shimGetUserMedia}});var s=n(19);Object.defineProperty(t,"shimGetDisplayMedia",{enumerable:!0,get:function(){return s.shimGetDisplayMedia}}),t.shimOnTrack=function(e){"object"===(void 0===e?"undefined":i(e))&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},t.shimPeerConnection=function(e,t){if("object"!==(void 0===e?"undefined":i(e))||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection);t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){var n=e.RTCPeerConnection.prototype[t],i=function(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n;return e}({},t,(function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}));e.RTCPeerConnection.prototype[t]=i[t]}));var n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){var e=Array.prototype.slice.call(arguments),i=e[0],s=e[1],o=e[2];return r.apply(this,[i||null]).then((function(e){if(t.version<53&&!s)try{e.forEach((function(e){e.type=n[e.type]||e.type}))}catch(t){if("TypeError"!==t.name)throw t;e.forEach((function(t,i){e.set(i,Object.assign({},t,{type:n[t.type]||t.type}))}))}return e})).then(s,o)}},t.shimSenderGetStats=function(e){if("object"!==(void 0===e?"undefined":i(e))||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,n=t.apply(this,[]);return n.forEach((function(t){return t._pc=e})),n});var n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=n.apply(this,arguments);return e._pc=this,e});e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}},t.shimReceiverGetStats=function(e){if("object"!==(void 0===e?"undefined":i(e))||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;var t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,n=t.apply(this,[]);return n.forEach((function(t){return t._pc=e})),n});o.wrapPeerConnectionEvent(e,"track",(function(e){return e.receiver._pc=e.srcElement,e})),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}},t.shimRemoveStream=function(e){if(!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype)return;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;o.deprecated("removeStream","removeTrack"),this.getSenders().forEach((function(n){n.track&&e.getTracks().includes(n.track)&&t.removeTrack(n)}))}},t.shimRTCDataChannel=function(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)},t.shimAddTransceiver=function(e){if("object"!==(void 0===e?"undefined":i(e))||!e.RTCPeerConnection)return;var t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];var e=arguments[1],n=e&&"sendEncodings"in e;n&&e.sendEncodings.forEach((function(e){if("rid"in e){if(!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.")}if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")}));var i=t.apply(this,arguments);if(n){var r=i.sender,s=r.getParameters();(!("encodings"in s)||1===s.encodings.length&&0===Object.keys(s.encodings[0]).length)&&(s.encodings=e.sendEncodings,r.sendEncodings=e.sendEncodings,this.setParametersPromises.push(r.setParameters(s).then((function(){delete r.sendEncodings})).catch((function(){delete r.sendEncodings}))))}return i})},t.shimGetParameters=function(e){if("object"!==(void 0===e?"undefined":i(e))||!e.RTCRtpSender)return;var t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){var e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})},t.shimCreateOffer=function(e){if("object"!==(void 0===e?"undefined":i(e))||!e.RTCPeerConnection)return;var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){var e=this,n=arguments;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((function(){return t.apply(e,n)})).finally((function(){e.setParametersPromises=[]})):t.apply(this,arguments)}},t.shimCreateAnswer=function(e){if("object"!==(void 0===e?"undefined":i(e))||!e.RTCPeerConnection)return;var t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){var e=this,n=arguments;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((function(){return t.apply(e,n)})).finally((function(){e.setParametersPromises=[]})):t.apply(this,arguments)}};var o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(1))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t.shimGetUserMedia=function(e,t){var n=e&&e.navigator,s=e&&e.MediaStreamTrack;if(n.getUserMedia=function(e,t,i){r.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(e).then(t,i)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){var o=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])},a=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(e){return"object"===(void 0===e?"undefined":i(e))&&"object"===i(e.audio)&&(e=JSON.parse(JSON.stringify(e)),o(e.audio,"autoGainControl","mozAutoGainControl"),o(e.audio,"noiseSuppression","mozNoiseSuppression")),a(e)},s&&s.prototype.getSettings){var c=s.prototype.getSettings;s.prototype.getSettings=function(){var e=c.apply(this,arguments);return o(e,"mozAutoGainControl","autoGainControl"),o(e,"mozNoiseSuppression","noiseSuppression"),e}}if(s&&s.prototype.applyConstraints){var l=s.prototype.applyConstraints;s.prototype.applyConstraints=function(e){return"audio"===this.kind&&"object"===(void 0===e?"undefined":i(e))&&(e=JSON.parse(JSON.stringify(e)),o(e,"autoGainControl","mozAutoGainControl"),o(e,"noiseSuppression","mozNoiseSuppression")),l.apply(this,[e])}}}};var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(1))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.shimGetDisplayMedia=function(e,t){if(e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices)return;if(!e.navigator.mediaDevices)return;e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){var i=new DOMException("getDisplayMedia without video constraints is undefined");return i.name="NotFoundError",i.code=8,Promise.reject(i)}return!0===n.video?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t.shimLocalStreamsAPI=function(e){if("object"!==(void 0===e?"undefined":i(e))||!e.RTCPeerConnection)return;"getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams});if(!("addStream"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){var n=this;this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach((function(i){return t.call(n,i,e)})),e.getVideoTracks().forEach((function(i){return t.call(n,i,e)}))},e.RTCPeerConnection.prototype.addTrack=function(e){for(var n=this,i=arguments.length,r=Array(i>1?i-1:0),s=1;s<i;s++)r[s-1]=arguments[s];return r&&r.forEach((function(e){n._localStreams?n._localStreams.includes(e)||n._localStreams.push(e):n._localStreams=[e]})),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;this._localStreams||(this._localStreams=[]);var n=this._localStreams.indexOf(e);if(-1!==n){this._localStreams.splice(n,1);var i=e.getTracks();this.getSenders().forEach((function(e){i.includes(e.track)&&t.removeTrack(e)}))}})},t.shimRemoteStreamsAPI=function(e){if("object"!==(void 0===e?"undefined":i(e))||!e.RTCPeerConnection)return;"getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]});if(!("onaddstream"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){var t=this;this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=function(e){e.streams.forEach((function(e){if(t._remoteStreams||(t._remoteStreams=[]),!t._remoteStreams.includes(e)){t._remoteStreams.push(e);var n=new Event("addstream");n.stream=e,t.dispatchEvent(n)}}))})}});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach((function(t){if(e._remoteStreams||(e._remoteStreams=[]),!(e._remoteStreams.indexOf(t)>=0)){e._remoteStreams.push(t);var n=new Event("addstream");n.stream=t,e.dispatchEvent(n)}}))}),t.apply(e,arguments)}}},t.shimCallbacksAPI=function(e){if("object"!==(void 0===e?"undefined":i(e))||!e.RTCPeerConnection)return;var t=e.RTCPeerConnection.prototype,n=t.createOffer,r=t.createAnswer,s=t.setLocalDescription,o=t.setRemoteDescription,a=t.addIceCandidate;t.createOffer=function(e,t){var i=arguments.length>=2?arguments[2]:arguments[0],r=n.apply(this,[i]);return t?(r.then(e,t),Promise.resolve()):r},t.createAnswer=function(e,t){var n=arguments.length>=2?arguments[2]:arguments[0],i=r.apply(this,[n]);return t?(i.then(e,t),Promise.resolve()):i};var c=function(e,t,n){var i=s.apply(this,[e]);return n?(i.then(t,n),Promise.resolve()):i};t.setLocalDescription=c,c=function(e,t,n){var i=o.apply(this,[e]);return n?(i.then(t,n),Promise.resolve()):i},t.setRemoteDescription=c,c=function(e,t,n){var i=a.apply(this,[e]);return n?(i.then(t,n),Promise.resolve()):i},t.addIceCandidate=c},t.shimGetUserMedia=function(e){var t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){var n=t.mediaDevices,i=n.getUserMedia.bind(n);t.mediaDevices.getUserMedia=function(e){return i(s(e))}}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,n,i){t.mediaDevices.getUserMedia(e).then(n,i)}.bind(t))},t.shimConstraints=s,t.shimRTCIceServerUrls=function(e){if(!e.RTCPeerConnection)return;var t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,n){if(e&&e.iceServers){for(var i=[],s=0;s<e.iceServers.length;s++){var o=e.iceServers[s];!o.hasOwnProperty("urls")&&o.hasOwnProperty("url")?(r.deprecated("RTCIceServer.url","RTCIceServer.urls"),(o=JSON.parse(JSON.stringify(o))).urls=o.url,delete o.url,i.push(o)):i.push(e.iceServers[s])}e.iceServers=i}return new t(e,n)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return t.generateCertificate}})},t.shimTrackEventTransceiver=function(e){"object"===(void 0===e?"undefined":i(e))&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},t.shimCreateOfferLegacy=function(e){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);var n=this.getTransceivers().find((function(e){return"audio"===e.receiver.track.kind}));!1===e.offerToReceiveAudio&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0!==e.offerToReceiveAudio||n||this.addTransceiver("audio"),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);var i=this.getTransceivers().find((function(e){return"video"===e.receiver.track.kind}));!1===e.offerToReceiveVideo&&i?"sendrecv"===i.direction?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":"recvonly"===i.direction&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):!0!==e.offerToReceiveVideo||i||this.addTransceiver("video")}return t.apply(this,arguments)}},t.shimAudioContext=function(e){if("object"!==(void 0===e?"undefined":i(e))||e.AudioContext)return;e.AudioContext=e.webkitAudioContext};var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(1));function s(e){return e&&void 0!==e.video?Object.assign({},e,{video:r.compactObject(e.video)}):e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t.shimRTCIceCandidate=function(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;var t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"===(void 0===e?"undefined":i(e))&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){var n=new t(e),r=o.default.parseCandidate(e.candidate),s=Object.assign(n,r);return s.toJSON=function(){return{candidate:s.candidate,sdpMid:s.sdpMid,sdpMLineIndex:s.sdpMLineIndex,usernameFragment:s.usernameFragment}},s}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,a.wrapPeerConnectionEvent(e,"icecandidate",(function(t){return t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t}))},t.shimMaxMessageSize=function(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp}});var n=function(e){if(!e||!e.sdp)return!1;var t=o.default.splitSections(e.sdp);return t.shift(),t.some((function(e){var t=o.default.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")}))},i=function(e){var t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;var n=parseInt(t[1],10);return n!=n?-1:n},r=function(e){var n=65536;return"firefox"===t.browser&&(n=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),n},s=function(e,n){var i=65536;"firefox"===t.browser&&57===t.version&&(i=65535);var r=o.default.matchPrefix(e.sdp,"a=max-message-size:");return r.length>0?i=parseInt(r[0].substr(19),10):"firefox"===t.browser&&-1!==n&&(i=2147483637),i},a=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76){var e=this.getConfiguration(),o=e.sdpSemantics;"plan-b"===o&&Object.defineProperty(this,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){var c=i(arguments[0]),l=r(c),u=s(arguments[0],c),h=void 0;h=0===l&&0===u?Number.POSITIVE_INFINITY:0===l||0===u?Math.max(l,u):Math.min(l,u);var d={};Object.defineProperty(d,"maxMessageSize",{get:function(){return h}}),this._sctp=d}return a.apply(this,arguments)}},t.shimSendThrowTypeError=function(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(e,t){var n=e.send;e.send=function(){var i=arguments[0],r=i.length||i.size||i.byteLength;if("open"===e.readyState&&t.sctp&&r>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return n.apply(e,arguments)}}var n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){var e=n.apply(this,arguments);return t(e,this),e},a.wrapPeerConnectionEvent(e,"datachannel",(function(e){return t(e.channel,e.target),e}))},t.shimConnectionState=function(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;var t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get:function(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get:function(){return this._onconnectionstatechange||null},set:function(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach((function(e){var n=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=function(e){var t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;var n=new Event("connectionstatechange",e);t.dispatchEvent(n)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n.apply(this,arguments)}}))},t.removeExtmapAllowMixed=function(e,t){if(!e.RTCPeerConnection)return;if("chrome"===t.browser&&t.version>=71)return;if("safari"===t.browser&&t.version>=605)return;var n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(t){if(t&&t.sdp&&-1!==t.sdp.indexOf("\na=extmap-allow-mixed")){var i=t.sdp.split("\n").filter((function(e){return"a=extmap-allow-mixed"!==e.trim()})).join("\n");e.RTCSessionDescription&&t instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:t.type,sdp:i}):t.sdp=i}return n.apply(this,arguments)}},t.shimAddIceCandidateNullOrEmpty=function(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;var n=e.RTCPeerConnection.prototype.addIceCandidate;if(!n||0===n.length)return;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===t.browser&&t.version<78||"firefox"===t.browser&&t.version<68||"safari"===t.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}};var r,s=n(7),o=(r=s)&&r.__esModule?r:{default:r},a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(1))},function(e,t,n){var i=n(23),r=n(24),s=n(25),o=n(26),a=n(27),c=n(28),l=n(29);l.alea=i,l.xor128=r,l.xorwow=s,l.xorshift7=o,l.xor4096=a,l.tychei=c,e.exports=l},function(e,t,n){(function(e){var i;!function(e,r,s){function o(e){var t,n=this,i=(t=4022871197,function(e){e=String(e);for(var n=0;n<e.length;n++){var i=.02519603282416938*(t+=e.charCodeAt(n));i-=t=i>>>0,t=(i*=t)>>>0,t+=4294967296*(i-=t)}return 2.3283064365386963e-10*(t>>>0)});n.next=function(){var e=2091639*n.s0+2.3283064365386963e-10*n.c;return n.s0=n.s1,n.s1=n.s2,n.s2=e-(n.c=0|e)},n.c=1,n.s0=i(" "),n.s1=i(" "),n.s2=i(" "),n.s0-=i(e),n.s0<0&&(n.s0+=1),n.s1-=i(e),n.s1<0&&(n.s1+=1),n.s2-=i(e),n.s2<0&&(n.s2+=1),i=null}function a(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function c(e,t){var n=new o(e),i=t&&t.state,r=n.next;return r.int32=function(){return 4294967296*n.next()|0},r.double=function(){return r()+11102230246251565e-32*(2097152*r()|0)},r.quick=r,i&&("object"==typeof i&&a(i,n),r.state=function(){return a(n,{})}),r}r&&r.exports?r.exports=c:n(0)&&n(3)?void 0===(i=function(){return c}.call(t,n,t,r))||(r.exports=i):this.alea=c}(0,e,n(0))}).call(this,n(2)(e))},function(e,t,n){(function(e){var i;!function(e,r,s){function o(e){var t=this,n="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:n+=e;for(var i=0;i<n.length+64;i++)t.x^=0|n.charCodeAt(i),t.next()}function a(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function c(e,t){var n=new o(e),i=t&&t.state,r=function(){return(n.next()>>>0)/4294967296};return r.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},r.int32=n.next,r.quick=r,i&&("object"==typeof i&&a(i,n),r.state=function(){return a(n,{})}),r}r&&r.exports?r.exports=c:n(0)&&n(3)?void 0===(i=function(){return c}.call(t,n,t,r))||(r.exports=i):this.xor128=c}(0,e,n(0))}).call(this,n(2)(e))},function(e,t,n){(function(e){var i;!function(e,r,s){function o(e){var t=this,n="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:n+=e;for(var i=0;i<n.length+64;i++)t.x^=0|n.charCodeAt(i),i==n.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function a(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function c(e,t){var n=new o(e),i=t&&t.state,r=function(){return(n.next()>>>0)/4294967296};return r.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},r.int32=n.next,r.quick=r,i&&("object"==typeof i&&a(i,n),r.state=function(){return a(n,{})}),r}r&&r.exports?r.exports=c:n(0)&&n(3)?void 0===(i=function(){return c}.call(t,n,t,r))||(r.exports=i):this.xorwow=c}(0,e,n(0))}).call(this,n(2)(e))},function(e,t,n){(function(e){var i;!function(e,r,s){function o(e){var t=this;t.next=function(){var e,n,i=t.x,r=t.i;return e=i[r],n=(e^=e>>>7)^e<<24,n^=(e=i[r+1&7])^e>>>10,n^=(e=i[r+3&7])^e>>>3,n^=(e=i[r+4&7])^e<<7,e=i[r+7&7],n^=(e^=e<<13)^e<<9,i[r]=n,t.i=r+1&7,n},function(e,t){var n,i=[];if(t===(0|t))i[0]=t;else for(t=""+t,n=0;n<t.length;++n)i[7&n]=i[7&n]<<15^t.charCodeAt(n)+i[n+1&7]<<13;for(;i.length<8;)i.push(0);for(n=0;n<8&&0===i[n];++n);for(8==n?i[7]=-1:i[n],e.x=i,e.i=0,n=256;n>0;--n)e.next()}(t,e)}function a(e,t){return t.x=e.x.slice(),t.i=e.i,t}function c(e,t){null==e&&(e=+new Date);var n=new o(e),i=t&&t.state,r=function(){return(n.next()>>>0)/4294967296};return r.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},r.int32=n.next,r.quick=r,i&&(i.x&&a(i,n),r.state=function(){return a(n,{})}),r}r&&r.exports?r.exports=c:n(0)&&n(3)?void 0===(i=function(){return c}.call(t,n,t,r))||(r.exports=i):this.xorshift7=c}(0,e,n(0))}).call(this,n(2)(e))},function(e,t,n){(function(e){var i;!function(e,r,s){function o(e){var t=this;t.next=function(){var e,n,i=t.w,r=t.X,s=t.i;return t.w=i=i+1640531527|0,n=r[s+34&127],e=r[s=s+1&127],n^=n<<13,e^=e<<17,n^=n>>>15,e^=e>>>12,n=r[s]=n^e,t.i=s,n+(i^i>>>16)|0},function(e,t){var n,i,r,s,o,a=[],c=128;for(t===(0|t)?(i=t,t=null):(t+="\0",i=0,c=Math.max(c,t.length)),r=0,s=-32;s<c;++s)t&&(i^=t.charCodeAt((s+32)%t.length)),0===s&&(o=i),i^=i<<10,i^=i>>>15,i^=i<<4,i^=i>>>13,s>=0&&(o=o+1640531527|0,r=0==(n=a[127&s]^=i+o)?r+1:0);for(r>=128&&(a[127&(t&&t.length||0)]=-1),r=127,s=512;s>0;--s)i=a[r+34&127],n=a[r=r+1&127],i^=i<<13,n^=n<<17,i^=i>>>15,n^=n>>>12,a[r]=i^n;e.w=o,e.X=a,e.i=r}(t,e)}function a(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function c(e,t){null==e&&(e=+new Date);var n=new o(e),i=t&&t.state,r=function(){return(n.next()>>>0)/4294967296};return r.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},r.int32=n.next,r.quick=r,i&&(i.X&&a(i,n),r.state=function(){return a(n,{})}),r}r&&r.exports?r.exports=c:n(0)&&n(3)?void 0===(i=function(){return c}.call(t,n,t,r))||(r.exports=i):this.xor4096=c}(0,e,n(0))}).call(this,n(2)(e))},function(e,t,n){(function(e){var i;!function(e,r,s){function o(e){var t=this,n="";t.next=function(){var e=t.b,n=t.c,i=t.d,r=t.a;return e=e<<25^e>>>7^n,n=n-i|0,i=i<<24^i>>>8^r,r=r-e|0,t.b=e=e<<20^e>>>12^n,t.c=n=n-i|0,t.d=i<<16^n>>>16^r,t.a=r-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):n+=e;for(var i=0;i<n.length+20;i++)t.b^=0|n.charCodeAt(i),t.next()}function a(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function c(e,t){var n=new o(e),i=t&&t.state,r=function(){return(n.next()>>>0)/4294967296};return r.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},r.int32=n.next,r.quick=r,i&&("object"==typeof i&&a(i,n),r.state=function(){return a(n,{})}),r}r&&r.exports?r.exports=c:n(0)&&n(3)?void 0===(i=function(){return c}.call(t,n,t,r))||(r.exports=i):this.tychei=c}(0,e,n(0))}).call(this,n(2)(e))},function(e,t,n){var i;!function(r,s,o){var a,c=o.pow(256,6),l=o.pow(2,52),u=2*l;function h(e,t,n){var i=[],h=f(function e(t,n){var i,r=[],s=typeof t;if(n&&"object"==s)for(i in t)try{r.push(e(t[i],n-1))}catch(e){}return r.length?r:"string"==s?t:t+"\0"}((t=1==t?{entropy:!0}:t||{}).entropy?[e,m(s)]:null==e?function(){try{var e;return a&&(e=a.randomBytes)?e=e(256):(e=new Uint8Array(256),(r.crypto||r.msCrypto).getRandomValues(e)),m(e)}catch(e){var t=r.navigator,n=t&&t.plugins;return[+new Date,r,n,r.screen,m(s)]}}():e,3),i),g=new d(i),v=function(){for(var e=g.g(6),t=c,n=0;e<l;)e=256*(e+n),t*=256,n=g.g(1);for(;e>=u;)e/=2,t/=2,n>>>=1;return(e+n)/t};return v.int32=function(){return 0|g.g(4)},v.quick=function(){return g.g(4)/4294967296},v.double=v,f(m(g.S),s),(t.pass||n||function(e,t,n,i){return i&&(i.S&&p(i,g),e.state=function(){return p(g,{})}),n?(o.random=e,t):e})(v,h,"global"in t?t.global:this==o,t.state)}function d(e){var t,n=e.length,i=this,r=0,s=i.i=i.j=0,o=i.S=[];for(n||(e=[n++]);r<256;)o[r]=r++;for(r=0;r<256;r++)o[r]=o[s=255&s+e[r%n]+(t=o[r])],o[s]=t;(i.g=function(e){for(var t,n=0,r=i.i,s=i.j,o=i.S;e--;)t=o[r=255&r+1],n=256*n+o[255&(o[r]=o[s=255&s+t])+(o[s]=t)];return i.i=r,i.j=s,n})(256)}function p(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function f(e,t){for(var n,i=e+"",r=0;r<i.length;)t[255&r]=255&(n^=19*t[255&r])+i.charCodeAt(r++);return m(t)}function m(e){return String.fromCharCode.apply(0,e)}if(f(o.random(),s),e.exports){e.exports=h;try{a=n(30)}catch(e){}}else void 0===(i=function(){return h}.call(t,n,t,e))||(e.exports=i)}("undefined"!=typeof self?self:this,[],Math)},function(e,t){},function(e,t,n){"use strict";n.r(t),n.d(t,"VirtualEnvironment",(function(){return Qm}));var i={};n.r(i),n.d(i,"Deflate",(function(){return Ou})),n.d(i,"AsyncDeflate",(function(){return Bu})),n.d(i,"deflate",(function(){return Nu})),n.d(i,"deflateSync",(function(){return zu})),n.d(i,"Inflate",(function(){return Fu})),n.d(i,"AsyncInflate",(function(){return Uu})),n.d(i,"inflate",(function(){return Hu})),n.d(i,"inflateSync",(function(){return Vu})),n.d(i,"Gzip",(function(){return Gu})),n.d(i,"AsyncGzip",(function(){return Wu})),n.d(i,"gzip",(function(){return ju})),n.d(i,"gzipSync",(function(){return Ju})),n.d(i,"Gunzip",(function(){return Xu})),n.d(i,"AsyncGunzip",(function(){return qu})),n.d(i,"gunzip",(function(){return Zu})),n.d(i,"gunzipSync",(function(){return Yu})),n.d(i,"Zlib",(function(){return Ku})),n.d(i,"AsyncZlib",(function(){return Qu})),n.d(i,"zlib",(function(){return $u})),n.d(i,"zlibSync",(function(){return eh})),n.d(i,"Unzlib",(function(){return th})),n.d(i,"AsyncUnzlib",(function(){return nh})),n.d(i,"unzlib",(function(){return ih})),n.d(i,"unzlibSync",(function(){return rh})),n.d(i,"compress",(function(){return ju})),n.d(i,"AsyncCompress",(function(){return Wu})),n.d(i,"compressSync",(function(){return Ju})),n.d(i,"Compress",(function(){return Gu})),n.d(i,"Decompress",(function(){return sh})),n.d(i,"AsyncDecompress",(function(){return oh})),n.d(i,"decompress",(function(){return ah})),n.d(i,"decompressSync",(function(){return ch})),n.d(i,"DecodeUTF8",(function(){return fh})),n.d(i,"EncodeUTF8",(function(){return mh})),n.d(i,"strToU8",(function(){return gh})),n.d(i,"strFromU8",(function(){return vh})),n.d(i,"ZipPassThrough",(function(){return Mh})),n.d(i,"ZipDeflate",(function(){return Th})),n.d(i,"AsyncZipDeflate",(function(){return Eh})),n.d(i,"Zip",(function(){return Ch})),n.d(i,"zip",(function(){return Rh})),n.d(i,"zipSync",(function(){return Ph})),n.d(i,"UnzipPassThrough",(function(){return Lh})),n.d(i,"UnzipInflate",(function(){return Dh})),n.d(i,"AsyncUnzipInflate",(function(){return Ih})),n.d(i,"Unzip",(function(){return kh})),n.d(i,"unzip",(function(){return Oh})),n.d(i,"unzipSync",(function(){return Bh}));
/**
 * @license
 * Copyright 2010-2022 Three.js Authors
 * SPDX-License-Identifier: MIT
 */
const r=0,s=1,o=2,a=0,c=1,l=2,u=3;class h{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;const n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;const n=this._listeners[e];if(void 0!==n){const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}dispatchEvent(e){if(void 0===this._listeners)return;const t=this._listeners[e.type];if(void 0!==t){e.target=this;const n=t.slice(0);for(let t=0,i=n.length;t<i;t++)n[t].call(this,e);e.target=null}}}const d=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let p=1234567;const f=Math.PI/180,m=180/Math.PI;function g(){const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(d[255&e]+d[e>>8&255]+d[e>>16&255]+d[e>>24&255]+"-"+d[255&t]+d[t>>8&255]+"-"+d[t>>16&15|64]+d[t>>24&255]+"-"+d[63&n|128]+d[n>>8&255]+"-"+d[n>>16&255]+d[n>>24&255]+d[255&i]+d[i>>8&255]+d[i>>16&255]+d[i>>24&255]).toLowerCase()}function v(e,t,n){return Math.max(t,Math.min(n,e))}function y(e,t){return(e%t+t)%t}function x(e,t,n){return(1-n)*e+n*t}function w(e){return 0==(e&e-1)&&0!==e}function b(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function A(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}var S=Object.freeze({__proto__:null,DEG2RAD:f,RAD2DEG:m,generateUUID:g,clamp:v,euclideanModulo:y,mapLinear:function(e,t,n,i,r){return i+(e-t)*(r-i)/(n-t)},inverseLerp:function(e,t,n){return e!==t?(n-e)/(t-e):0},lerp:x,damp:function(e,t,n,i){return x(e,t,1-Math.exp(-n*i))},pingpong:function(e,t=1){return t-Math.abs(y(e,2*t)-t)},smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*(3-2*e)},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},seededRandom:function(e){void 0!==e&&(p=e);let t=p+=1831565813;return t=Math.imul(t^t>>>15,1|t),t^=t+Math.imul(t^t>>>7,61|t),((t^t>>>14)>>>0)/4294967296},degToRad:function(e){return e*f},radToDeg:function(e){return e*m},isPowerOfTwo:w,ceilPowerOfTwo:b,floorPowerOfTwo:A,setQuaternionFromProperEuler:function(e,t,n,i,r){const s=Math.cos,o=Math.sin,a=s(n/2),c=o(n/2),l=s((t+i)/2),u=o((t+i)/2),h=s((t-i)/2),d=o((t-i)/2),p=s((i-t)/2),f=o((i-t)/2);switch(r){case"XYX":e.set(a*u,c*h,c*d,a*l);break;case"YZY":e.set(c*d,a*u,c*h,a*l);break;case"ZXZ":e.set(c*h,c*d,a*u,a*l);break;case"XZX":e.set(a*u,c*f,c*p,a*l);break;case"YXY":e.set(c*p,a*u,c*f,a*l);break;case"ZYZ":e.set(c*f,c*p,a*u,a*l);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}},normalize:function(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return Math.round(65535*e);case Uint8Array:return Math.round(255*e);case Int16Array:return Math.round(32767*e);case Int8Array:return Math.round(127*e);default:throw new Error("Invalid component type.")}},denormalize:function(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}});class _{constructor(e=0,t=0){_.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6],this.y=i[1]*t+i[4]*n+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t,n){return void 0!==n&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),i=Math.sin(t),r=this.x-e.x,s=this.y-e.y;return this.x=r*n-s*i+e.x,this.y=r*i+s*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class M{constructor(){M.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(e,t,n,i,r,s,o,a,c){const l=this.elements;return l[0]=e,l[1]=i,l[2]=o,l[3]=t,l[4]=r,l[5]=a,l[6]=n,l[7]=s,l[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,r=this.elements,s=n[0],o=n[3],a=n[6],c=n[1],l=n[4],u=n[7],h=n[2],d=n[5],p=n[8],f=i[0],m=i[3],g=i[6],v=i[1],y=i[4],x=i[7],w=i[2],b=i[5],A=i[8];return r[0]=s*f+o*v+a*w,r[3]=s*m+o*y+a*b,r[6]=s*g+o*x+a*A,r[1]=c*f+l*v+u*w,r[4]=c*m+l*y+u*b,r[7]=c*g+l*x+u*A,r[2]=h*f+d*v+p*w,r[5]=h*m+d*y+p*b,r[8]=h*g+d*x+p*A,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],s=e[4],o=e[5],a=e[6],c=e[7],l=e[8];return t*s*l-t*o*c-n*r*l+n*o*a+i*r*c-i*s*a}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],s=e[4],o=e[5],a=e[6],c=e[7],l=e[8],u=l*s-o*c,h=o*a-l*r,d=c*r-s*a,p=t*u+n*h+i*d;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const f=1/p;return e[0]=u*f,e[1]=(i*c-l*n)*f,e[2]=(o*n-i*s)*f,e[3]=h*f,e[4]=(l*t-i*a)*f,e[5]=(i*r-o*t)*f,e[6]=d*f,e[7]=(n*a-c*t)*f,e[8]=(s*t-n*r)*f,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,i,r,s,o){const a=Math.cos(r),c=Math.sin(r);return this.set(n*a,n*c,-n*(a*s+c*o)+s+e,-i*c,i*a,-i*(-c*s+a*o)+o+t,0,0,1),this}scale(e,t){const n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=t,n[4]*=t,n[7]*=t,this}rotate(e){const t=Math.cos(e),n=Math.sin(e),i=this.elements,r=i[0],s=i[3],o=i[6],a=i[1],c=i[4],l=i[7];return i[0]=t*r+n*a,i[3]=t*s+n*c,i[6]=t*o+n*l,i[1]=-n*r+t*a,i[4]=-n*s+t*c,i[7]=-n*o+t*l,this}translate(e,t){const n=this.elements;return n[0]+=e*n[2],n[3]+=e*n[5],n[6]+=e*n[8],n[1]+=t*n[2],n[4]+=t*n[5],n[7]+=t*n[8],this}equals(e){const t=this.elements,n=e.elements;for(let e=0;e<9;e++)if(t[e]!==n[e])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}function T(e){for(let t=e.length-1;t>=0;--t)if(e[t]>65535)return!0;return!1}Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array;function E(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}function C(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function R(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}const P={srgb:{"srgb-linear":C},"srgb-linear":{srgb:R}},L={legacyMode:!0,get workingColorSpace(){return"srgb-linear"},set workingColorSpace(e){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(e,t,n){if(this.legacyMode||t===n||!t||!n)return e;if(P[t]&&void 0!==P[t][n]){const i=P[t][n];return e.r=i(e.r),e.g=i(e.g),e.b=i(e.b),e}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(e,t){return this.convert(e,this.workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this.workingColorSpace)}},D={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},I={r:0,g:0,b:0},k={h:0,s:0,l:0},O={h:0,s:0,l:0};function B(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}function N(e,t){return t.r=e.r,t.g=e.g,t.b=e.b,t}class z{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,void 0===t&&void 0===n?this.set(e):this.setRGB(e,t,n)}set(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t="srgb"){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,L.toWorkingColorSpace(this,t),this}setRGB(e,t,n,i="srgb-linear"){return this.r=e,this.g=t,this.b=n,L.toWorkingColorSpace(this,i),this}setHSL(e,t,n,i="srgb-linear"){if(e=y(e,1),t=v(t,0,1),n=v(n,0,1),0===t)this.r=this.g=this.b=n;else{const i=n<=.5?n*(1+t):n+t-n*t,r=2*n-i;this.r=B(r,i,e+1/3),this.g=B(r,i,e),this.b=B(r,i,e-1/3)}return L.toWorkingColorSpace(this,i),this}setStyle(e,t="srgb"){function n(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let i;if(i=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let e;const r=i[1],s=i[2];switch(r){case"rgb":case"rgba":if(e=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.r=Math.min(255,parseInt(e[1],10))/255,this.g=Math.min(255,parseInt(e[2],10))/255,this.b=Math.min(255,parseInt(e[3],10))/255,L.toWorkingColorSpace(this,t),n(e[4]),this;if(e=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.r=Math.min(100,parseInt(e[1],10))/100,this.g=Math.min(100,parseInt(e[2],10))/100,this.b=Math.min(100,parseInt(e[3],10))/100,L.toWorkingColorSpace(this,t),n(e[4]),this;break;case"hsl":case"hsla":if(e=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s)){const i=parseFloat(e[1])/360,r=parseInt(e[2],10)/100,s=parseInt(e[3],10)/100;return n(e[4]),this.setHSL(i,r,s,t)}}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){const e=i[1],n=e.length;if(3===n)return this.r=parseInt(e.charAt(0)+e.charAt(0),16)/255,this.g=parseInt(e.charAt(1)+e.charAt(1),16)/255,this.b=parseInt(e.charAt(2)+e.charAt(2),16)/255,L.toWorkingColorSpace(this,t),this;if(6===n)return this.r=parseInt(e.charAt(0)+e.charAt(1),16)/255,this.g=parseInt(e.charAt(2)+e.charAt(3),16)/255,this.b=parseInt(e.charAt(4)+e.charAt(5),16)/255,L.toWorkingColorSpace(this,t),this}return e&&e.length>0?this.setColorName(e,t):this}setColorName(e,t="srgb"){const n=D[e.toLowerCase()];return void 0!==n?this.setHex(n,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=C(e.r),this.g=C(e.g),this.b=C(e.b),this}copyLinearToSRGB(e){return this.r=R(e.r),this.g=R(e.g),this.b=R(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e="srgb"){return L.fromWorkingColorSpace(N(this,I),e),v(255*I.r,0,255)<<16^v(255*I.g,0,255)<<8^v(255*I.b,0,255)<<0}getHexString(e="srgb"){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t="srgb-linear"){L.fromWorkingColorSpace(N(this,I),t);const n=I.r,i=I.g,r=I.b,s=Math.max(n,i,r),o=Math.min(n,i,r);let a,c;const l=(o+s)/2;if(o===s)a=0,c=0;else{const e=s-o;switch(c=l<=.5?e/(s+o):e/(2-s-o),s){case n:a=(i-r)/e+(i<r?6:0);break;case i:a=(r-n)/e+2;break;case r:a=(n-i)/e+4}a/=6}return e.h=a,e.s=c,e.l=l,e}getRGB(e,t="srgb-linear"){return L.fromWorkingColorSpace(N(this,I),t),e.r=I.r,e.g=I.g,e.b=I.b,e}getStyle(e="srgb"){return L.fromWorkingColorSpace(N(this,I),e),"srgb"!==e?`color(${e} ${I.r} ${I.g} ${I.b})`:`rgb(${255*I.r|0},${255*I.g|0},${255*I.b|0})`}offsetHSL(e,t,n){return this.getHSL(k),k.h+=e,k.s+=t,k.l+=n,this.setHSL(k.h,k.s,k.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(k),e.getHSL(O);const n=x(k.h,O.h,t),i=x(k.s,O.s,t),r=x(k.l,O.l,t);return this.setHSL(n,i,r),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),!0===e.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}let F;z.NAMES=D;class U{static getDataURL(e){if(/^data:/i.test(e.src))return e.src;if("undefined"==typeof HTMLCanvasElement)return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===F&&(F=E("canvas")),F.width=e.width,F.height=e.height;const n=F.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=F}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const t=E("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const i=n.getImageData(0,0,e.width,e.height),r=i.data;for(let e=0;e<r.length;e++)r[e]=255*C(r[e]/255);return n.putImageData(i,0,0),t}if(e.data){const t=e.data.slice(0);for(let e=0;e<t.length;e++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[e]=Math.floor(255*C(t[e]/255)):t[e]=C(t[e]);return{data:t,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}class H{constructor(e=null){this.isSource=!0,this.uuid=g(),this.data=e,this.version=0}set needsUpdate(e){!0===e&&this.version++}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.images[this.uuid])return e.images[this.uuid];const n={uuid:this.uuid,url:""},i=this.data;if(null!==i){let e;if(Array.isArray(i)){e=[];for(let t=0,n=i.length;t<n;t++)i[t].isDataTexture?e.push(V(i[t].image)):e.push(V(i[t]))}else e=V(i);n.url=e}return t||(e.images[this.uuid]=n),n}}function V(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?U.getDataURL(e):e.data?{data:Array.from(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let G=0;class W extends h{constructor(e=W.DEFAULT_IMAGE,t=W.DEFAULT_MAPPING,n=1001,i=1001,r=1006,s=1008,o=1023,a=1009,c=1,l=3e3){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:G++}),this.uuid=g(),this.name="",this.source=new H(e),this.mipmaps=[],this.mapping=t,this.wrapS=n,this.wrapT=i,this.magFilter=r,this.minFilter=s,this.anisotropy=c,this.format=o,this.internalFormat=null,this.type=a,this.offset=new _(0,0),this.repeat=new _(1,1),this.center=new _(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new M,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=l,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];const n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(300!==this.mapping)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case 1e3:e.x=e.x-Math.floor(e.x);break;case 1001:e.x=e.x<0?0:1;break;case 1002:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case 1e3:e.y=e.y-Math.floor(e.y);break;case 1001:e.y=e.y<0?0:1;break;case 1002:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&(this.version++,this.source.needsUpdate=!0)}}W.DEFAULT_IMAGE=null,W.DEFAULT_MAPPING=300;class j{constructor(e=0,t=0,n=0,i=1){j.prototype.isVector4=!0,this.x=e,this.y=t,this.z=n,this.w=i}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,r=this.w,s=e.elements;return this.x=s[0]*t+s[4]*n+s[8]*i+s[12]*r,this.y=s[1]*t+s[5]*n+s[9]*i+s[13]*r,this.z=s[2]*t+s[6]*n+s[10]*i+s[14]*r,this.w=s[3]*t+s[7]*n+s[11]*i+s[15]*r,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,i,r;const s=e.elements,o=s[0],a=s[4],c=s[8],l=s[1],u=s[5],h=s[9],d=s[2],p=s[6],f=s[10];if(Math.abs(a-l)<.01&&Math.abs(c-d)<.01&&Math.abs(h-p)<.01){if(Math.abs(a+l)<.1&&Math.abs(c+d)<.1&&Math.abs(h+p)<.1&&Math.abs(o+u+f-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const e=(o+1)/2,s=(u+1)/2,m=(f+1)/2,g=(a+l)/4,v=(c+d)/4,y=(h+p)/4;return e>s&&e>m?e<.01?(n=0,i=.707106781,r=.707106781):(n=Math.sqrt(e),i=g/n,r=v/n):s>m?s<.01?(n=.707106781,i=0,r=.707106781):(i=Math.sqrt(s),n=g/i,r=y/i):m<.01?(n=.707106781,i=.707106781,r=0):(r=Math.sqrt(m),n=v/r,i=y/r),this.set(n,i,r,t),this}let m=Math.sqrt((p-h)*(p-h)+(c-d)*(c-d)+(l-a)*(l-a));return Math.abs(m)<.001&&(m=1),this.x=(p-h)/m,this.y=(c-d)/m,this.z=(l-a)/m,this.w=Math.acos((o+u+f-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t,n){return void 0!==n&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class J extends h{constructor(e,t,n={}){super(),this.isWebGLRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new j(0,0,e,t),this.scissorTest=!1,this.viewport=new j(0,0,e,t);const i={width:e,height:t,depth:1};this.texture=new W(i,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=void 0!==n.generateMipmaps&&n.generateMipmaps,this.texture.internalFormat=void 0!==n.internalFormat?n.internalFormat:null,this.texture.minFilter=void 0!==n.minFilter?n.minFilter:1006,this.depthBuffer=void 0===n.depthBuffer||n.depthBuffer,this.stencilBuffer=void 0!==n.stencilBuffer&&n.stencilBuffer,this.depthTexture=void 0!==n.depthTexture?n.depthTexture:null,this.samples=void 0!==n.samples?n.samples:0}setSize(e,t,n=1){this.width===e&&this.height===t&&this.depth===n||(this.width=e,this.height=t,this.depth=n,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new H(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class X extends W{constructor(e=null,t=1,n=1,i=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:n,depth:i},this.magFilter=1003,this.minFilter=1003,this.wrapR=1001,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class q extends W{constructor(e=null,t=1,n=1,i=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:n,depth:i},this.magFilter=1003,this.minFilter=1003,this.wrapR=1001,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Z{constructor(e=0,t=0,n=0,i=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=n,this._w=i}static slerp(e,t,n,i){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),n.slerpQuaternions(e,t,i)}static slerpFlat(e,t,n,i,r,s,o){let a=n[i+0],c=n[i+1],l=n[i+2],u=n[i+3];const h=r[s+0],d=r[s+1],p=r[s+2],f=r[s+3];if(0===o)return e[t+0]=a,e[t+1]=c,e[t+2]=l,void(e[t+3]=u);if(1===o)return e[t+0]=h,e[t+1]=d,e[t+2]=p,void(e[t+3]=f);if(u!==f||a!==h||c!==d||l!==p){let e=1-o;const t=a*h+c*d+l*p+u*f,n=t>=0?1:-1,i=1-t*t;if(i>Number.EPSILON){const r=Math.sqrt(i),s=Math.atan2(r,t*n);e=Math.sin(e*s)/r,o=Math.sin(o*s)/r}const r=o*n;if(a=a*e+h*r,c=c*e+d*r,l=l*e+p*r,u=u*e+f*r,e===1-o){const e=1/Math.sqrt(a*a+c*c+l*l+u*u);a*=e,c*=e,l*=e,u*=e}}e[t]=a,e[t+1]=c,e[t+2]=l,e[t+3]=u}static multiplyQuaternionsFlat(e,t,n,i,r,s){const o=n[i],a=n[i+1],c=n[i+2],l=n[i+3],u=r[s],h=r[s+1],d=r[s+2],p=r[s+3];return e[t]=o*p+l*u+a*d-c*h,e[t+1]=a*p+l*h+c*u-o*d,e[t+2]=c*p+l*d+o*h-a*u,e[t+3]=l*p-o*u-a*h-c*d,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const n=e._x,i=e._y,r=e._z,s=e._order,o=Math.cos,a=Math.sin,c=o(n/2),l=o(i/2),u=o(r/2),h=a(n/2),d=a(i/2),p=a(r/2);switch(s){case"XYZ":this._x=h*l*u+c*d*p,this._y=c*d*u-h*l*p,this._z=c*l*p+h*d*u,this._w=c*l*u-h*d*p;break;case"YXZ":this._x=h*l*u+c*d*p,this._y=c*d*u-h*l*p,this._z=c*l*p-h*d*u,this._w=c*l*u+h*d*p;break;case"ZXY":this._x=h*l*u-c*d*p,this._y=c*d*u+h*l*p,this._z=c*l*p+h*d*u,this._w=c*l*u-h*d*p;break;case"ZYX":this._x=h*l*u-c*d*p,this._y=c*d*u+h*l*p,this._z=c*l*p-h*d*u,this._w=c*l*u+h*d*p;break;case"YZX":this._x=h*l*u+c*d*p,this._y=c*d*u+h*l*p,this._z=c*l*p-h*d*u,this._w=c*l*u-h*d*p;break;case"XZY":this._x=h*l*u-c*d*p,this._y=c*d*u-h*l*p,this._z=c*l*p+h*d*u,this._w=c*l*u+h*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return!1!==t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,i=Math.sin(n);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],i=t[4],r=t[8],s=t[1],o=t[5],a=t[9],c=t[2],l=t[6],u=t[10],h=n+o+u;if(h>0){const e=.5/Math.sqrt(h+1);this._w=.25/e,this._x=(l-a)*e,this._y=(r-c)*e,this._z=(s-i)*e}else if(n>o&&n>u){const e=2*Math.sqrt(1+n-o-u);this._w=(l-a)/e,this._x=.25*e,this._y=(i+s)/e,this._z=(r+c)/e}else if(o>u){const e=2*Math.sqrt(1+o-n-u);this._w=(r-c)/e,this._x=(i+s)/e,this._y=.25*e,this._z=(a+l)/e}else{const e=2*Math.sqrt(1+u-n-o);this._w=(s-i)/e,this._x=(r+c)/e,this._y=(a+l)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(v(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(0===n)return this;const i=Math.min(1,t/n);return this.slerp(e,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,i=e._y,r=e._z,s=e._w,o=t._x,a=t._y,c=t._z,l=t._w;return this._x=n*l+s*o+i*c-r*a,this._y=i*l+s*a+r*o-n*c,this._z=r*l+s*c+n*a-i*o,this._w=s*l-n*o-i*a-r*c,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const n=this._x,i=this._y,r=this._z,s=this._w;let o=s*e._w+n*e._x+i*e._y+r*e._z;if(o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),o>=1)return this._w=s,this._x=n,this._y=i,this._z=r,this;const a=1-o*o;if(a<=Number.EPSILON){const e=1-t;return this._w=e*s+t*this._w,this._x=e*n+t*this._x,this._y=e*i+t*this._y,this._z=e*r+t*this._z,this.normalize(),this._onChangeCallback(),this}const c=Math.sqrt(a),l=Math.atan2(c,o),u=Math.sin((1-t)*l)/c,h=Math.sin(t*l)/c;return this._w=s*u+this._w*h,this._x=n*u+this._x*h,this._y=i*u+this._y*h,this._z=r*u+this._z*h,this._onChangeCallback(),this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){const e=Math.random(),t=Math.sqrt(1-e),n=Math.sqrt(e),i=2*Math.PI*Math.random(),r=2*Math.PI*Math.random();return this.set(t*Math.cos(i),n*Math.sin(r),n*Math.cos(r),t*Math.sin(i))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class Y{constructor(e=0,t=0,n=0){Y.prototype.isVector3=!0,this.x=e,this.y=t,this.z=n}set(e,t,n){return void 0===n&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(Q.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(Q.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6]*i,this.y=r[1]*t+r[4]*n+r[7]*i,this.z=r[2]*t+r[5]*n+r[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,r=e.elements,s=1/(r[3]*t+r[7]*n+r[11]*i+r[15]);return this.x=(r[0]*t+r[4]*n+r[8]*i+r[12])*s,this.y=(r[1]*t+r[5]*n+r[9]*i+r[13])*s,this.z=(r[2]*t+r[6]*n+r[10]*i+r[14])*s,this}applyQuaternion(e){const t=this.x,n=this.y,i=this.z,r=e.x,s=e.y,o=e.z,a=e.w,c=a*t+s*i-o*n,l=a*n+o*t-r*i,u=a*i+r*n-s*t,h=-r*t-s*n-o*i;return this.x=c*a+h*-r+l*-o-u*-s,this.y=l*a+h*-s+u*-r-c*-o,this.z=u*a+h*-o+c*-s-l*-r,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[4]*n+r[8]*i,this.y=r[1]*t+r[5]*n+r[9]*i,this.z=r[2]*t+r[6]*n+r[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e,t){return void 0!==t?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,i=e.y,r=e.z,s=t.x,o=t.y,a=t.z;return this.x=i*a-r*o,this.y=r*s-n*a,this.z=n*o-i*s,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return K.copy(this).projectOnVector(e),this.sub(K)}reflect(e){return this.sub(K.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(v(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,i=this.z-e.z;return t*t+n*n+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const i=Math.sin(t)*e;return this.x=i*Math.sin(n),this.y=Math.cos(t)*e,this.z=i*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=i,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t,n){return void 0!==n&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=2*(Math.random()-.5),t=Math.random()*Math.PI*2,n=Math.sqrt(1-e**2);return this.x=n*Math.cos(t),this.y=n*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const K=new Y,Q=new Z;class ${constructor(e=new Y(1/0,1/0,1/0),t=new Y(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,n=1/0,i=1/0,r=-1/0,s=-1/0,o=-1/0;for(let a=0,c=e.length;a<c;a+=3){const c=e[a],l=e[a+1],u=e[a+2];c<t&&(t=c),l<n&&(n=l),u<i&&(i=u),c>r&&(r=c),l>s&&(s=l),u>o&&(o=u)}return this.min.set(t,n,i),this.max.set(r,s,o),this}setFromBufferAttribute(e){let t=1/0,n=1/0,i=1/0,r=-1/0,s=-1/0,o=-1/0;for(let a=0,c=e.count;a<c;a++){const c=e.getX(a),l=e.getY(a),u=e.getZ(a);c<t&&(t=c),l<n&&(n=l),u<i&&(i=u),c>r&&(r=c),l>s&&(s=l),u>o&&(o=u)}return this.min.set(t,n,i),this.max.set(r,s,o),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=te.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const n=e.geometry;if(void 0!==n)if(t&&null!=n.attributes&&void 0!==n.attributes.position){const t=n.attributes.position;for(let n=0,i=t.count;n<i;n++)te.fromBufferAttribute(t,n).applyMatrix4(e.matrixWorld),this.expandByPoint(te)}else null===n.boundingBox&&n.computeBoundingBox(),ne.copy(n.boundingBox),ne.applyMatrix4(e.matrixWorld),this.union(ne);const i=e.children;for(let e=0,n=i.length;e<n;e++)this.expandByObject(i[e],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,te),te.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(le),ue.subVectors(this.max,le),ie.subVectors(e.a,le),re.subVectors(e.b,le),se.subVectors(e.c,le),oe.subVectors(re,ie),ae.subVectors(se,re),ce.subVectors(ie,se);let t=[0,-oe.z,oe.y,0,-ae.z,ae.y,0,-ce.z,ce.y,oe.z,0,-oe.x,ae.z,0,-ae.x,ce.z,0,-ce.x,-oe.y,oe.x,0,-ae.y,ae.x,0,-ce.y,ce.x,0];return!!pe(t,ie,re,se,ue)&&(t=[1,0,0,0,1,0,0,0,1],!!pe(t,ie,re,se,ue)&&(he.crossVectors(oe,ae),t=[he.x,he.y,he.z],pe(t,ie,re,se,ue)))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return te.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return this.getCenter(e.center),e.radius=.5*this.getSize(te).length(),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(ee[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),ee[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),ee[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),ee[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),ee[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),ee[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),ee[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),ee[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(ee)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const ee=[new Y,new Y,new Y,new Y,new Y,new Y,new Y,new Y],te=new Y,ne=new $,ie=new Y,re=new Y,se=new Y,oe=new Y,ae=new Y,ce=new Y,le=new Y,ue=new Y,he=new Y,de=new Y;function pe(e,t,n,i,r){for(let s=0,o=e.length-3;s<=o;s+=3){de.fromArray(e,s);const o=r.x*Math.abs(de.x)+r.y*Math.abs(de.y)+r.z*Math.abs(de.z),a=t.dot(de),c=n.dot(de),l=i.dot(de);if(Math.max(-Math.max(a,c,l),Math.min(a,c,l))>o)return!1}return!0}const fe=new $,me=new Y,ge=new Y,ve=new Y;class ye{constructor(e=new Y,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;void 0!==t?n.copy(t):fe.setFromPoints(e).getCenter(n);let i=0;for(let t=0,r=e.length;t<r;t++)i=Math.max(i,n.distanceToSquared(e[t]));return this.radius=Math.sqrt(i),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){ve.subVectors(e,this.center);const t=ve.lengthSq();if(t>this.radius*this.radius){const e=Math.sqrt(t),n=.5*(e-this.radius);this.center.add(ve.multiplyScalar(n/e)),this.radius+=n}return this}union(e){return!0===this.center.equals(e.center)?ge.set(0,0,1).multiplyScalar(e.radius):ge.subVectors(e.center,this.center).normalize().multiplyScalar(e.radius),this.expandByPoint(me.copy(e.center).add(ge)),this.expandByPoint(me.copy(e.center).sub(ge)),this}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const xe=new Y,we=new Y,be=new Y,Ae=new Y,Se=new Y,_e=new Y,Me=new Y;class Te{constructor(e=new Y,t=new Y(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,xe)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(n).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=xe.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(xe.copy(this.direction).multiplyScalar(t).add(this.origin),xe.distanceToSquared(e))}distanceSqToSegment(e,t,n,i){we.copy(e).add(t).multiplyScalar(.5),be.copy(t).sub(e).normalize(),Ae.copy(this.origin).sub(we);const r=.5*e.distanceTo(t),s=-this.direction.dot(be),o=Ae.dot(this.direction),a=-Ae.dot(be),c=Ae.lengthSq(),l=Math.abs(1-s*s);let u,h,d,p;if(l>0)if(u=s*a-o,h=s*o-a,p=r*l,u>=0)if(h>=-p)if(h<=p){const e=1/l;u*=e,h*=e,d=u*(u+s*h+2*o)+h*(s*u+h+2*a)+c}else h=r,u=Math.max(0,-(s*h+o)),d=-u*u+h*(h+2*a)+c;else h=-r,u=Math.max(0,-(s*h+o)),d=-u*u+h*(h+2*a)+c;else h<=-p?(u=Math.max(0,-(-s*r+o)),h=u>0?-r:Math.min(Math.max(-r,-a),r),d=-u*u+h*(h+2*a)+c):h<=p?(u=0,h=Math.min(Math.max(-r,-a),r),d=h*(h+2*a)+c):(u=Math.max(0,-(s*r+o)),h=u>0?r:Math.min(Math.max(-r,-a),r),d=-u*u+h*(h+2*a)+c);else h=s>0?-r:r,u=Math.max(0,-(s*h+o)),d=-u*u+h*(h+2*a)+c;return n&&n.copy(this.direction).multiplyScalar(u).add(this.origin),i&&i.copy(be).multiplyScalar(h).add(we),d}intersectSphere(e,t){xe.subVectors(e.center,this.origin);const n=xe.dot(this.direction),i=xe.dot(xe)-n*n,r=e.radius*e.radius;if(i>r)return null;const s=Math.sqrt(r-i),o=n-s,a=n+s;return o<0&&a<0?null:o<0?this.at(a,t):this.at(o,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return null===n?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);if(0===t)return!0;return e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,i,r,s,o,a;const c=1/this.direction.x,l=1/this.direction.y,u=1/this.direction.z,h=this.origin;return c>=0?(n=(e.min.x-h.x)*c,i=(e.max.x-h.x)*c):(n=(e.max.x-h.x)*c,i=(e.min.x-h.x)*c),l>=0?(r=(e.min.y-h.y)*l,s=(e.max.y-h.y)*l):(r=(e.max.y-h.y)*l,s=(e.min.y-h.y)*l),n>s||r>i?null:((r>n||n!=n)&&(n=r),(s<i||i!=i)&&(i=s),u>=0?(o=(e.min.z-h.z)*u,a=(e.max.z-h.z)*u):(o=(e.max.z-h.z)*u,a=(e.min.z-h.z)*u),n>a||o>i?null:((o>n||n!=n)&&(n=o),(a<i||i!=i)&&(i=a),i<0?null:this.at(n>=0?n:i,t)))}intersectsBox(e){return null!==this.intersectBox(e,xe)}intersectTriangle(e,t,n,i,r){Se.subVectors(t,e),_e.subVectors(n,e),Me.crossVectors(Se,_e);let s,o=this.direction.dot(Me);if(o>0){if(i)return null;s=1}else{if(!(o<0))return null;s=-1,o=-o}Ae.subVectors(this.origin,e);const a=s*this.direction.dot(_e.crossVectors(Ae,_e));if(a<0)return null;const c=s*this.direction.dot(Se.cross(Ae));if(c<0)return null;if(a+c>o)return null;const l=-s*Ae.dot(Me);return l<0?null:this.at(l/o,r)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class Ee{constructor(){Ee.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(e,t,n,i,r,s,o,a,c,l,u,h,d,p,f,m){const g=this.elements;return g[0]=e,g[4]=t,g[8]=n,g[12]=i,g[1]=r,g[5]=s,g[9]=o,g[13]=a,g[2]=c,g[6]=l,g[10]=u,g[14]=h,g[3]=d,g[7]=p,g[11]=f,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new Ee).fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,i=1/Ce.setFromMatrixColumn(e,0).length(),r=1/Ce.setFromMatrixColumn(e,1).length(),s=1/Ce.setFromMatrixColumn(e,2).length();return t[0]=n[0]*i,t[1]=n[1]*i,t[2]=n[2]*i,t[3]=0,t[4]=n[4]*r,t[5]=n[5]*r,t[6]=n[6]*r,t[7]=0,t[8]=n[8]*s,t[9]=n[9]*s,t[10]=n[10]*s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const t=this.elements,n=e.x,i=e.y,r=e.z,s=Math.cos(n),o=Math.sin(n),a=Math.cos(i),c=Math.sin(i),l=Math.cos(r),u=Math.sin(r);if("XYZ"===e.order){const e=s*l,n=s*u,i=o*l,r=o*u;t[0]=a*l,t[4]=-a*u,t[8]=c,t[1]=n+i*c,t[5]=e-r*c,t[9]=-o*a,t[2]=r-e*c,t[6]=i+n*c,t[10]=s*a}else if("YXZ"===e.order){const e=a*l,n=a*u,i=c*l,r=c*u;t[0]=e+r*o,t[4]=i*o-n,t[8]=s*c,t[1]=s*u,t[5]=s*l,t[9]=-o,t[2]=n*o-i,t[6]=r+e*o,t[10]=s*a}else if("ZXY"===e.order){const e=a*l,n=a*u,i=c*l,r=c*u;t[0]=e-r*o,t[4]=-s*u,t[8]=i+n*o,t[1]=n+i*o,t[5]=s*l,t[9]=r-e*o,t[2]=-s*c,t[6]=o,t[10]=s*a}else if("ZYX"===e.order){const e=s*l,n=s*u,i=o*l,r=o*u;t[0]=a*l,t[4]=i*c-n,t[8]=e*c+r,t[1]=a*u,t[5]=r*c+e,t[9]=n*c-i,t[2]=-c,t[6]=o*a,t[10]=s*a}else if("YZX"===e.order){const e=s*a,n=s*c,i=o*a,r=o*c;t[0]=a*l,t[4]=r-e*u,t[8]=i*u+n,t[1]=u,t[5]=s*l,t[9]=-o*l,t[2]=-c*l,t[6]=n*u+i,t[10]=e-r*u}else if("XZY"===e.order){const e=s*a,n=s*c,i=o*a,r=o*c;t[0]=a*l,t[4]=-u,t[8]=c*l,t[1]=e*u+r,t[5]=s*l,t[9]=n*u-i,t[2]=i*u-n,t[6]=o*l,t[10]=r*u+e}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(Pe,e,Le)}lookAt(e,t,n){const i=this.elements;return ke.subVectors(e,t),0===ke.lengthSq()&&(ke.z=1),ke.normalize(),De.crossVectors(n,ke),0===De.lengthSq()&&(1===Math.abs(n.z)?ke.x+=1e-4:ke.z+=1e-4,ke.normalize(),De.crossVectors(n,ke)),De.normalize(),Ie.crossVectors(ke,De),i[0]=De.x,i[4]=Ie.x,i[8]=ke.x,i[1]=De.y,i[5]=Ie.y,i[9]=ke.y,i[2]=De.z,i[6]=Ie.z,i[10]=ke.z,this}multiply(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,r=this.elements,s=n[0],o=n[4],a=n[8],c=n[12],l=n[1],u=n[5],h=n[9],d=n[13],p=n[2],f=n[6],m=n[10],g=n[14],v=n[3],y=n[7],x=n[11],w=n[15],b=i[0],A=i[4],S=i[8],_=i[12],M=i[1],T=i[5],E=i[9],C=i[13],R=i[2],P=i[6],L=i[10],D=i[14],I=i[3],k=i[7],O=i[11],B=i[15];return r[0]=s*b+o*M+a*R+c*I,r[4]=s*A+o*T+a*P+c*k,r[8]=s*S+o*E+a*L+c*O,r[12]=s*_+o*C+a*D+c*B,r[1]=l*b+u*M+h*R+d*I,r[5]=l*A+u*T+h*P+d*k,r[9]=l*S+u*E+h*L+d*O,r[13]=l*_+u*C+h*D+d*B,r[2]=p*b+f*M+m*R+g*I,r[6]=p*A+f*T+m*P+g*k,r[10]=p*S+f*E+m*L+g*O,r[14]=p*_+f*C+m*D+g*B,r[3]=v*b+y*M+x*R+w*I,r[7]=v*A+y*T+x*P+w*k,r[11]=v*S+y*E+x*L+w*O,r[15]=v*_+y*C+x*D+w*B,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],i=e[8],r=e[12],s=e[1],o=e[5],a=e[9],c=e[13],l=e[2],u=e[6],h=e[10],d=e[14];return e[3]*(+r*a*u-i*c*u-r*o*h+n*c*h+i*o*d-n*a*d)+e[7]*(+t*a*d-t*c*h+r*s*h-i*s*d+i*c*l-r*a*l)+e[11]*(+t*c*u-t*o*d-r*s*u+n*s*d+r*o*l-n*c*l)+e[15]*(-i*o*l-t*a*u+t*o*h+i*s*u-n*s*h+n*a*l)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],s=e[4],o=e[5],a=e[6],c=e[7],l=e[8],u=e[9],h=e[10],d=e[11],p=e[12],f=e[13],m=e[14],g=e[15],v=u*m*c-f*h*c+f*a*d-o*m*d-u*a*g+o*h*g,y=p*h*c-l*m*c-p*a*d+s*m*d+l*a*g-s*h*g,x=l*f*c-p*u*c+p*o*d-s*f*d-l*o*g+s*u*g,w=p*u*a-l*f*a-p*o*h+s*f*h+l*o*m-s*u*m,b=t*v+n*y+i*x+r*w;if(0===b)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const A=1/b;return e[0]=v*A,e[1]=(f*h*r-u*m*r-f*i*d+n*m*d+u*i*g-n*h*g)*A,e[2]=(o*m*r-f*a*r+f*i*c-n*m*c-o*i*g+n*a*g)*A,e[3]=(u*a*r-o*h*r-u*i*c+n*h*c+o*i*d-n*a*d)*A,e[4]=y*A,e[5]=(l*m*r-p*h*r+p*i*d-t*m*d-l*i*g+t*h*g)*A,e[6]=(p*a*r-s*m*r-p*i*c+t*m*c+s*i*g-t*a*g)*A,e[7]=(s*h*r-l*a*r+l*i*c-t*h*c-s*i*d+t*a*d)*A,e[8]=x*A,e[9]=(p*u*r-l*f*r-p*n*d+t*f*d+l*n*g-t*u*g)*A,e[10]=(s*f*r-p*o*r+p*n*c-t*f*c-s*n*g+t*o*g)*A,e[11]=(l*o*r-s*u*r-l*n*c+t*u*c+s*n*d-t*o*d)*A,e[12]=w*A,e[13]=(l*f*i-p*u*i+p*n*h-t*f*h-l*n*m+t*u*m)*A,e[14]=(p*o*i-s*f*i-p*n*a+t*f*a+s*n*m-t*o*m)*A,e[15]=(s*u*i-l*o*i+l*n*a-t*u*a-s*n*h+t*o*h)*A,this}scale(e){const t=this.elements,n=e.x,i=e.y,r=e.z;return t[0]*=n,t[4]*=i,t[8]*=r,t[1]*=n,t[5]*=i,t[9]*=r,t[2]*=n,t[6]*=i,t[10]*=r,t[3]*=n,t[7]*=i,t[11]*=r,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,i))}makeTranslation(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),i=Math.sin(t),r=1-n,s=e.x,o=e.y,a=e.z,c=r*s,l=r*o;return this.set(c*s+n,c*o-i*a,c*a+i*o,0,c*o+i*a,l*o+n,l*a-i*s,0,c*a-i*o,l*a+i*s,r*a*a+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,i,r,s){return this.set(1,n,r,0,e,1,s,0,t,i,1,0,0,0,0,1),this}compose(e,t,n){const i=this.elements,r=t._x,s=t._y,o=t._z,a=t._w,c=r+r,l=s+s,u=o+o,h=r*c,d=r*l,p=r*u,f=s*l,m=s*u,g=o*u,v=a*c,y=a*l,x=a*u,w=n.x,b=n.y,A=n.z;return i[0]=(1-(f+g))*w,i[1]=(d+x)*w,i[2]=(p-y)*w,i[3]=0,i[4]=(d-x)*b,i[5]=(1-(h+g))*b,i[6]=(m+v)*b,i[7]=0,i[8]=(p+y)*A,i[9]=(m-v)*A,i[10]=(1-(h+f))*A,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,t,n){const i=this.elements;let r=Ce.set(i[0],i[1],i[2]).length();const s=Ce.set(i[4],i[5],i[6]).length(),o=Ce.set(i[8],i[9],i[10]).length();this.determinant()<0&&(r=-r),e.x=i[12],e.y=i[13],e.z=i[14],Re.copy(this);const a=1/r,c=1/s,l=1/o;return Re.elements[0]*=a,Re.elements[1]*=a,Re.elements[2]*=a,Re.elements[4]*=c,Re.elements[5]*=c,Re.elements[6]*=c,Re.elements[8]*=l,Re.elements[9]*=l,Re.elements[10]*=l,t.setFromRotationMatrix(Re),n.x=r,n.y=s,n.z=o,this}makePerspective(e,t,n,i,r,s){void 0===s&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const o=this.elements,a=2*r/(t-e),c=2*r/(n-i),l=(t+e)/(t-e),u=(n+i)/(n-i),h=-(s+r)/(s-r),d=-2*s*r/(s-r);return o[0]=a,o[4]=0,o[8]=l,o[12]=0,o[1]=0,o[5]=c,o[9]=u,o[13]=0,o[2]=0,o[6]=0,o[10]=h,o[14]=d,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}makeOrthographic(e,t,n,i,r,s){const o=this.elements,a=1/(t-e),c=1/(n-i),l=1/(s-r),u=(t+e)*a,h=(n+i)*c,d=(s+r)*l;return o[0]=2*a,o[4]=0,o[8]=0,o[12]=-u,o[1]=0,o[5]=2*c,o[9]=0,o[13]=-h,o[2]=0,o[6]=0,o[10]=-2*l,o[14]=-d,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let e=0;e<16;e++)if(t[e]!==n[e])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}const Ce=new Y,Re=new Ee,Pe=new Y(0,0,0),Le=new Y(1,1,1),De=new Y,Ie=new Y,ke=new Y,Oe=new Ee,Be=new Z;class Ne{constructor(e=0,t=0,n=0,i=Ne.DefaultOrder){this.isEuler=!0,this._x=e,this._y=t,this._z=n,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,i=this._order){return this._x=e,this._y=t,this._z=n,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,n=!0){const i=e.elements,r=i[0],s=i[4],o=i[8],a=i[1],c=i[5],l=i[9],u=i[2],h=i[6],d=i[10];switch(t){case"XYZ":this._y=Math.asin(v(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-l,d),this._z=Math.atan2(-s,r)):(this._x=Math.atan2(h,c),this._z=0);break;case"YXZ":this._x=Math.asin(-v(l,-1,1)),Math.abs(l)<.9999999?(this._y=Math.atan2(o,d),this._z=Math.atan2(a,c)):(this._y=Math.atan2(-u,r),this._z=0);break;case"ZXY":this._x=Math.asin(v(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-u,d),this._z=Math.atan2(-s,c)):(this._y=0,this._z=Math.atan2(a,r));break;case"ZYX":this._y=Math.asin(-v(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(h,d),this._z=Math.atan2(a,r)):(this._x=0,this._z=Math.atan2(-s,c));break;case"YZX":this._z=Math.asin(v(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-l,c),this._y=Math.atan2(-u,r)):(this._x=0,this._y=Math.atan2(o,d));break;case"XZY":this._z=Math.asin(-v(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(h,c),this._y=Math.atan2(o,r)):(this._x=Math.atan2(-l,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===n&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return Oe.makeRotationFromQuaternion(e),this.setFromRotationMatrix(Oe,t,n)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return Be.setFromEuler(this),this.setFromQuaternion(Be,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}toVector3(){console.error("THREE.Euler: .toVector3() has been removed. Use Vector3.setFromEuler() instead")}}Ne.DefaultOrder="XYZ",Ne.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class ze{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return 0!=(this.mask&e.mask)}isEnabled(e){return 0!=(this.mask&(1<<e|0))}}let Fe=0;const Ue=new Y,He=new Z,Ve=new Ee,Ge=new Y,We=new Y,je=new Y,Je=new Z,Xe=new Y(1,0,0),qe=new Y(0,1,0),Ze=new Y(0,0,1),Ye={type:"added"},Ke={type:"removed"};class Qe extends h{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Fe++}),this.uuid=g(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Qe.DefaultUp.clone();const e=new Y,t=new Ne,n=new Z,i=new Y(1,1,1);t._onChange((function(){n.setFromEuler(t,!1)})),n._onChange((function(){t.setFromQuaternion(n,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new Ee},normalMatrix:{value:new M}}),this.matrix=new Ee,this.matrixWorld=new Ee,this.matrixAutoUpdate=Qe.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new ze,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return He.setFromAxisAngle(e,t),this.quaternion.multiply(He),this}rotateOnWorldAxis(e,t){return He.setFromAxisAngle(e,t),this.quaternion.premultiply(He),this}rotateX(e){return this.rotateOnAxis(Xe,e)}rotateY(e){return this.rotateOnAxis(qe,e)}rotateZ(e){return this.rotateOnAxis(Ze,e)}translateOnAxis(e,t){return Ue.copy(e).applyQuaternion(this.quaternion),this.position.add(Ue.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(Xe,e)}translateY(e){return this.translateOnAxis(qe,e)}translateZ(e){return this.translateOnAxis(Ze,e)}localToWorld(e){return e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return e.applyMatrix4(Ve.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?Ge.copy(e):Ge.set(e,t,n);const i=this.parent;this.updateWorldMatrix(!0,!1),We.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Ve.lookAt(We,Ge,this.up):Ve.lookAt(Ge,We,this.up),this.quaternion.setFromRotationMatrix(Ve),i&&(Ve.extractRotation(i.matrixWorld),He.setFromRotationMatrix(Ve),this.quaternion.premultiply(He.invert()))}add(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(Ye)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}const t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(Ke)),this}removeFromParent(){const e=this.parent;return null!==e&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){const t=this.children[e];t.parent=null,t.dispatchEvent(Ke)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),Ve.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),Ve.multiply(e.parent.matrixWorld)),e.applyMatrix4(Ve),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,i=this.children.length;n<i;n++){const i=this.children[n].getObjectByProperty(e,t);if(void 0!==i)return i}}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(We,e,je),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(We,Je,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverse(e)}traverseVisible(e){if(!1===this.visible)return;e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].updateMatrixWorld(e)}updateWorldMatrix(e,t){const n=this.parent;if(!0===e&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t){const e=this.children;for(let t=0,n=e.length;t<n;t++)e[t].updateWorldMatrix(!1,!0)}}toJSON(e){const t=void 0===e||"string"==typeof e,n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const i={};function r(t,n){return void 0===t[n.uuid]&&(t[n.uuid]=n.toJSON(e)),n.uuid}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),!0===this.castShadow&&(i.castShadow=!0),!0===this.receiveShadow&&(i.receiveShadow=!0),!1===this.visible&&(i.visible=!1),!1===this.frustumCulled&&(i.frustumCulled=!1),0!==this.renderOrder&&(i.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(i.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&(i.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=r(e.geometries,this.geometry);const t=this.geometry.parameters;if(void 0!==t&&void 0!==t.shapes){const n=t.shapes;if(Array.isArray(n))for(let t=0,i=n.length;t<i;t++){const i=n[t];r(e.shapes,i)}else r(e.shapes,n)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(r(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const t=[];for(let n=0,i=this.material.length;n<i;n++)t.push(r(e.materials,this.material[n]));i.material=t}else i.material=r(e.materials,this.material);if(this.children.length>0){i.children=[];for(let t=0;t<this.children.length;t++)i.children.push(this.children[t].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(let t=0;t<this.animations.length;t++){const n=this.animations[t];i.animations.push(r(e.animations,n))}}if(t){const t=s(e.geometries),i=s(e.materials),r=s(e.textures),o=s(e.images),a=s(e.shapes),c=s(e.skeletons),l=s(e.animations),u=s(e.nodes);t.length>0&&(n.geometries=t),i.length>0&&(n.materials=i),r.length>0&&(n.textures=r),o.length>0&&(n.images=o),a.length>0&&(n.shapes=a),c.length>0&&(n.skeletons=c),l.length>0&&(n.animations=l),u.length>0&&(n.nodes=u)}return n.object=i,n;function s(e){const t=[];for(const n in e){const i=e[n];delete i.metadata,t.push(i)}return t}}clone(e){return(new this.constructor).copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let t=0;t<e.children.length;t++){const n=e.children[t];this.add(n.clone())}return this}}Qe.DefaultUp=new Y(0,1,0),Qe.DefaultMatrixAutoUpdate=!0;const $e=new Y,et=new Y,tt=new Y,nt=new Y,it=new Y,rt=new Y,st=new Y,ot=new Y,at=new Y,ct=new Y;class lt{constructor(e=new Y,t=new Y,n=new Y){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,i){i.subVectors(n,t),$e.subVectors(e,t),i.cross($e);const r=i.lengthSq();return r>0?i.multiplyScalar(1/Math.sqrt(r)):i.set(0,0,0)}static getBarycoord(e,t,n,i,r){$e.subVectors(i,t),et.subVectors(n,t),tt.subVectors(e,t);const s=$e.dot($e),o=$e.dot(et),a=$e.dot(tt),c=et.dot(et),l=et.dot(tt),u=s*c-o*o;if(0===u)return r.set(-2,-1,-1);const h=1/u,d=(c*a-o*l)*h,p=(s*l-o*a)*h;return r.set(1-d-p,p,d)}static containsPoint(e,t,n,i){return this.getBarycoord(e,t,n,i,nt),nt.x>=0&&nt.y>=0&&nt.x+nt.y<=1}static getUV(e,t,n,i,r,s,o,a){return this.getBarycoord(e,t,n,i,nt),a.set(0,0),a.addScaledVector(r,nt.x),a.addScaledVector(s,nt.y),a.addScaledVector(o,nt.z),a}static isFrontFacing(e,t,n,i){return $e.subVectors(n,t),et.subVectors(e,t),$e.cross(et).dot(i)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,i){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[i]),this}setFromAttributeAndIndices(e,t,n,i){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,i),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return $e.subVectors(this.c,this.b),et.subVectors(this.a,this.b),.5*$e.cross(et).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return lt.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return lt.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,n,i,r){return lt.getUV(e,this.a,this.b,this.c,t,n,i,r)}containsPoint(e){return lt.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return lt.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const n=this.a,i=this.b,r=this.c;let s,o;it.subVectors(i,n),rt.subVectors(r,n),ot.subVectors(e,n);const a=it.dot(ot),c=rt.dot(ot);if(a<=0&&c<=0)return t.copy(n);at.subVectors(e,i);const l=it.dot(at),u=rt.dot(at);if(l>=0&&u<=l)return t.copy(i);const h=a*u-l*c;if(h<=0&&a>=0&&l<=0)return s=a/(a-l),t.copy(n).addScaledVector(it,s);ct.subVectors(e,r);const d=it.dot(ct),p=rt.dot(ct);if(p>=0&&d<=p)return t.copy(r);const f=d*c-a*p;if(f<=0&&c>=0&&p<=0)return o=c/(c-p),t.copy(n).addScaledVector(rt,o);const m=l*p-d*u;if(m<=0&&u-l>=0&&d-p>=0)return st.subVectors(r,i),o=(u-l)/(u-l+(d-p)),t.copy(i).addScaledVector(st,o);const g=1/(m+f+h);return s=f*g,o=h*g,t.copy(n).addScaledVector(it,s).addScaledVector(rt,o)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let ut=0;class ht extends h{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:ut++}),this.uuid=g(),this.name="",this.type="Material",this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=100,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=7680,this.stencilZFail=7680,this.stencilZPass=7680,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(const t in e){const n=e[t];if(void 0===n){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}if("shading"===t){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===n;continue}const i=this[t];void 0!==i?i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):this[t]=n:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}}toJSON(e){const t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});const n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function i(e){const t=[];for(const n in e){const i=e[n];delete i.metadata,t.push(i)}return t}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),void 0!==this.sheen&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.iridescence&&(n.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(n.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(n.blending=this.blending),0!==this.side&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.colorWrite=this.colorWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,void 0!==this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(n.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=this.flatShading),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),!1===this.fog&&(n.fog=!1),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),t){const t=i(e.textures),r=i(e.images);t.length>0&&(n.textures=t),r.length>0&&(n.images=r)}return n}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(null!==t){const e=t.length;n=new Array(e);for(let i=0;i!==e;++i)n[i]=t[i].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}}class dt extends ht{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new z(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const pt=new Y,ft=new _;class mt{constructor(e,t,n){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===n,this.usage=35044,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let i=0,r=this.itemSize;i<r;i++)this.array[e+i]=t.array[n+i];return this}copyArray(e){return this.array.set(e),this}copyColorsArray(e){const t=this.array;let n=0;for(let i=0,r=e.length;i<r;i++){let r=e[i];void 0===r&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",i),r=new z),t[n++]=r.r,t[n++]=r.g,t[n++]=r.b}return this}copyVector2sArray(e){const t=this.array;let n=0;for(let i=0,r=e.length;i<r;i++){let r=e[i];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",i),r=new _),t[n++]=r.x,t[n++]=r.y}return this}copyVector3sArray(e){const t=this.array;let n=0;for(let i=0,r=e.length;i<r;i++){let r=e[i];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",i),r=new Y),t[n++]=r.x,t[n++]=r.y,t[n++]=r.z}return this}copyVector4sArray(e){const t=this.array;let n=0;for(let i=0,r=e.length;i<r;i++){let r=e[i];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",i),r=new j),t[n++]=r.x,t[n++]=r.y,t[n++]=r.z,t[n++]=r.w}return this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,n=this.count;t<n;t++)ft.fromBufferAttribute(this,t),ft.applyMatrix3(e),this.setXY(t,ft.x,ft.y);else if(3===this.itemSize)for(let t=0,n=this.count;t<n;t++)pt.fromBufferAttribute(this,t),pt.applyMatrix3(e),this.setXYZ(t,pt.x,pt.y,pt.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)pt.fromBufferAttribute(this,t),pt.applyMatrix4(e),this.setXYZ(t,pt.x,pt.y,pt.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)pt.fromBufferAttribute(this,t),pt.applyNormalMatrix(e),this.setXYZ(t,pt.x,pt.y,pt.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)pt.fromBufferAttribute(this,t),pt.transformDirection(e),this.setXYZ(t,pt.x,pt.y,pt.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){return this.array[e*this.itemSize]}setX(e,t){return this.array[e*this.itemSize]=t,this}getY(e){return this.array[e*this.itemSize+1]}setY(e,t){return this.array[e*this.itemSize+1]=t,this}getZ(e){return this.array[e*this.itemSize+2]}setZ(e,t){return this.array[e*this.itemSize+2]=t,this}getW(e){return this.array[e*this.itemSize+3]}setW(e,t){return this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this}setXYZW(e,t,n,i,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this.array[e+3]=r,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),35044!==this.usage&&(e.usage=this.usage),0===this.updateRange.offset&&-1===this.updateRange.count||(e.updateRange=this.updateRange),e}}class gt extends mt{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class vt extends mt{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class yt extends mt{constructor(e,t,n){super(new Float32Array(e),t,n)}}let xt=0;const wt=new Ee,bt=new Qe,At=new Y,St=new $,_t=new $,Mt=new Y;class Tt extends h{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:xt++}),this.uuid=g(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(T(e)?vt:gt)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(void 0!==n){const t=(new M).getNormalMatrix(e);n.applyNormalMatrix(t),n.needsUpdate=!0}const i=this.attributes.tangent;return void 0!==i&&(i.transformDirection(e),i.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return wt.makeRotationFromQuaternion(e),this.applyMatrix4(wt),this}rotateX(e){return wt.makeRotationX(e),this.applyMatrix4(wt),this}rotateY(e){return wt.makeRotationY(e),this.applyMatrix4(wt),this}rotateZ(e){return wt.makeRotationZ(e),this.applyMatrix4(wt),this}translate(e,t,n){return wt.makeTranslation(e,t,n),this.applyMatrix4(wt),this}scale(e,t,n){return wt.makeScale(e,t,n),this.applyMatrix4(wt),this}lookAt(e){return bt.lookAt(e),bt.updateMatrix(),this.applyMatrix4(bt.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(At).negate(),this.translate(At.x,At.y,At.z),this}setFromPoints(e){const t=[];for(let n=0,i=e.length;n<i;n++){const i=e[n];t.push(i.x,i.y,i.z||0)}return this.setAttribute("position",new yt(t,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new $);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new Y(-1/0,-1/0,-1/0),new Y(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let e=0,n=t.length;e<n;e++){const n=t[e];St.setFromBufferAttribute(n),this.morphTargetsRelative?(Mt.addVectors(this.boundingBox.min,St.min),this.boundingBox.expandByPoint(Mt),Mt.addVectors(this.boundingBox.max,St.max),this.boundingBox.expandByPoint(Mt)):(this.boundingBox.expandByPoint(St.min),this.boundingBox.expandByPoint(St.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new ye);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new Y,1/0);if(e){const n=this.boundingSphere.center;if(St.setFromBufferAttribute(e),t)for(let e=0,n=t.length;e<n;e++){const n=t[e];_t.setFromBufferAttribute(n),this.morphTargetsRelative?(Mt.addVectors(St.min,_t.min),St.expandByPoint(Mt),Mt.addVectors(St.max,_t.max),St.expandByPoint(Mt)):(St.expandByPoint(_t.min),St.expandByPoint(_t.max))}St.getCenter(n);let i=0;for(let t=0,r=e.count;t<r;t++)Mt.fromBufferAttribute(e,t),i=Math.max(i,n.distanceToSquared(Mt));if(t)for(let r=0,s=t.length;r<s;r++){const s=t[r],o=this.morphTargetsRelative;for(let t=0,r=s.count;t<r;t++)Mt.fromBufferAttribute(s,t),o&&(At.fromBufferAttribute(e,t),Mt.add(At)),i=Math.max(i,n.distanceToSquared(Mt))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const n=e.array,i=t.position.array,r=t.normal.array,s=t.uv.array,o=i.length/3;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new mt(new Float32Array(4*o),4));const a=this.getAttribute("tangent").array,c=[],l=[];for(let e=0;e<o;e++)c[e]=new Y,l[e]=new Y;const u=new Y,h=new Y,d=new Y,p=new _,f=new _,m=new _,g=new Y,v=new Y;function y(e,t,n){u.fromArray(i,3*e),h.fromArray(i,3*t),d.fromArray(i,3*n),p.fromArray(s,2*e),f.fromArray(s,2*t),m.fromArray(s,2*n),h.sub(u),d.sub(u),f.sub(p),m.sub(p);const r=1/(f.x*m.y-m.x*f.y);isFinite(r)&&(g.copy(h).multiplyScalar(m.y).addScaledVector(d,-f.y).multiplyScalar(r),v.copy(d).multiplyScalar(f.x).addScaledVector(h,-m.x).multiplyScalar(r),c[e].add(g),c[t].add(g),c[n].add(g),l[e].add(v),l[t].add(v),l[n].add(v))}let x=this.groups;0===x.length&&(x=[{start:0,count:n.length}]);for(let e=0,t=x.length;e<t;++e){const t=x[e],i=t.start;for(let e=i,r=i+t.count;e<r;e+=3)y(n[e+0],n[e+1],n[e+2])}const w=new Y,b=new Y,A=new Y,S=new Y;function M(e){A.fromArray(r,3*e),S.copy(A);const t=c[e];w.copy(t),w.sub(A.multiplyScalar(A.dot(t))).normalize(),b.crossVectors(S,t);const n=b.dot(l[e])<0?-1:1;a[4*e]=w.x,a[4*e+1]=w.y,a[4*e+2]=w.z,a[4*e+3]=n}for(let e=0,t=x.length;e<t;++e){const t=x[e],i=t.start;for(let e=i,r=i+t.count;e<r;e+=3)M(n[e+0]),M(n[e+1]),M(n[e+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(void 0!==t){let n=this.getAttribute("normal");if(void 0===n)n=new mt(new Float32Array(3*t.count),3),this.setAttribute("normal",n);else for(let e=0,t=n.count;e<t;e++)n.setXYZ(e,0,0,0);const i=new Y,r=new Y,s=new Y,o=new Y,a=new Y,c=new Y,l=new Y,u=new Y;if(e)for(let h=0,d=e.count;h<d;h+=3){const d=e.getX(h+0),p=e.getX(h+1),f=e.getX(h+2);i.fromBufferAttribute(t,d),r.fromBufferAttribute(t,p),s.fromBufferAttribute(t,f),l.subVectors(s,r),u.subVectors(i,r),l.cross(u),o.fromBufferAttribute(n,d),a.fromBufferAttribute(n,p),c.fromBufferAttribute(n,f),o.add(l),a.add(l),c.add(l),n.setXYZ(d,o.x,o.y,o.z),n.setXYZ(p,a.x,a.y,a.z),n.setXYZ(f,c.x,c.y,c.z)}else for(let e=0,o=t.count;e<o;e+=3)i.fromBufferAttribute(t,e+0),r.fromBufferAttribute(t,e+1),s.fromBufferAttribute(t,e+2),l.subVectors(s,r),u.subVectors(i,r),l.cross(u),n.setXYZ(e+0,l.x,l.y,l.z),n.setXYZ(e+1,l.x,l.y,l.z),n.setXYZ(e+2,l.x,l.y,l.z);this.normalizeNormals(),n.needsUpdate=!0}}merge(e,t){if(!e||!e.isBufferGeometry)return void console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e);void 0===t&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const n=this.attributes;for(const i in n){if(void 0===e.attributes[i])continue;const r=n[i].array,s=e.attributes[i],o=s.array,a=s.itemSize*t,c=Math.min(o.length,r.length-a);for(let e=0,t=a;e<c;e++,t++)r[t]=o[e]}return this}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)Mt.fromBufferAttribute(e,t),Mt.normalize(),e.setXYZ(t,Mt.x,Mt.y,Mt.z)}toNonIndexed(){function e(e,t){const n=e.array,i=e.itemSize,r=e.normalized,s=new n.constructor(t.length*i);let o=0,a=0;for(let r=0,c=t.length;r<c;r++){o=e.isInterleavedBufferAttribute?t[r]*e.data.stride+e.offset:t[r]*i;for(let e=0;e<i;e++)s[a++]=n[o++]}return new mt(s,i,r)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new Tt,n=this.index.array,i=this.attributes;for(const r in i){const s=e(i[r],n);t.setAttribute(r,s)}const r=this.morphAttributes;for(const i in r){const s=[],o=r[i];for(let t=0,i=o.length;t<i;t++){const i=e(o[t],n);s.push(i)}t.morphAttributes[i]=s}t.morphTargetsRelative=this.morphTargetsRelative;const s=this.groups;for(let e=0,n=s.length;e<n;e++){const n=s[e];t.addGroup(n.start,n.count,n.materialIndex)}return t}toJSON(){const e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const t=this.parameters;for(const n in t)void 0!==t[n]&&(e[n]=t[n]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const t in n){const i=n[t];e.data.attributes[t]=i.toJSON(e.data)}const i={};let r=!1;for(const t in this.morphAttributes){const n=this.morphAttributes[t],s=[];for(let t=0,i=n.length;t<i;t++){const i=n[t];s.push(i.toJSON(e.data))}s.length>0&&(i[t]=s,r=!0)}r&&(e.data.morphAttributes=i,e.data.morphTargetsRelative=this.morphTargetsRelative);const s=this.groups;s.length>0&&(e.data.groups=JSON.parse(JSON.stringify(s)));const o=this.boundingSphere;return null!==o&&(e.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),e}clone(){return(new this.constructor).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;null!==n&&this.setIndex(n.clone(t));const i=e.attributes;for(const e in i){const n=i[e];this.setAttribute(e,n.clone(t))}const r=e.morphAttributes;for(const e in r){const n=[],i=r[e];for(let e=0,r=i.length;e<r;e++)n.push(i[e].clone(t));this.morphAttributes[e]=n}this.morphTargetsRelative=e.morphTargetsRelative;const s=e.groups;for(let e=0,t=s.length;e<t;e++){const t=s[e];this.addGroup(t.start,t.count,t.materialIndex)}const o=e.boundingBox;null!==o&&(this.boundingBox=o.clone());const a=e.boundingSphere;return null!==a&&(this.boundingSphere=a.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,void 0!==e.parameters&&(this.parameters=Object.assign({},e.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}const Et=new Ee,Ct=new Te,Rt=new ye,Pt=new Y,Lt=new Y,Dt=new Y,It=new Y,kt=new Y,Ot=new Y,Bt=new Y,Nt=new Y,zt=new Y,Ft=new _,Ut=new _,Ht=new _,Vt=new Y,Gt=new Y;class Wt extends Qe{constructor(e=new Tt,t=new dt){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}raycast(e,t){const n=this.geometry,i=this.material,r=this.matrixWorld;if(void 0===i)return;if(null===n.boundingSphere&&n.computeBoundingSphere(),Rt.copy(n.boundingSphere),Rt.applyMatrix4(r),!1===e.ray.intersectsSphere(Rt))return;if(Et.copy(r).invert(),Ct.copy(e.ray).applyMatrix4(Et),null!==n.boundingBox&&!1===Ct.intersectsBox(n.boundingBox))return;let s;const o=n.index,a=n.attributes.position,c=n.morphAttributes.position,l=n.morphTargetsRelative,u=n.attributes.uv,h=n.attributes.uv2,d=n.groups,p=n.drawRange;if(null!==o)if(Array.isArray(i))for(let n=0,r=d.length;n<r;n++){const r=d[n],f=i[r.materialIndex];for(let n=Math.max(r.start,p.start),i=Math.min(o.count,Math.min(r.start+r.count,p.start+p.count));n<i;n+=3){const i=o.getX(n),d=o.getX(n+1),p=o.getX(n+2);s=jt(this,f,e,Ct,a,c,l,u,h,i,d,p),s&&(s.faceIndex=Math.floor(n/3),s.face.materialIndex=r.materialIndex,t.push(s))}}else{for(let n=Math.max(0,p.start),r=Math.min(o.count,p.start+p.count);n<r;n+=3){const r=o.getX(n),d=o.getX(n+1),p=o.getX(n+2);s=jt(this,i,e,Ct,a,c,l,u,h,r,d,p),s&&(s.faceIndex=Math.floor(n/3),t.push(s))}}else if(void 0!==a)if(Array.isArray(i))for(let n=0,r=d.length;n<r;n++){const r=d[n],o=i[r.materialIndex];for(let n=Math.max(r.start,p.start),i=Math.min(a.count,Math.min(r.start+r.count,p.start+p.count));n<i;n+=3){s=jt(this,o,e,Ct,a,c,l,u,h,n,n+1,n+2),s&&(s.faceIndex=Math.floor(n/3),s.face.materialIndex=r.materialIndex,t.push(s))}}else{for(let n=Math.max(0,p.start),r=Math.min(a.count,p.start+p.count);n<r;n+=3){s=jt(this,i,e,Ct,a,c,l,u,h,n,n+1,n+2),s&&(s.faceIndex=Math.floor(n/3),t.push(s))}}}}function jt(e,t,n,i,r,s,o,a,c,l,u,h){Pt.fromBufferAttribute(r,l),Lt.fromBufferAttribute(r,u),Dt.fromBufferAttribute(r,h);const d=e.morphTargetInfluences;if(s&&d){Bt.set(0,0,0),Nt.set(0,0,0),zt.set(0,0,0);for(let e=0,t=s.length;e<t;e++){const t=d[e],n=s[e];0!==t&&(It.fromBufferAttribute(n,l),kt.fromBufferAttribute(n,u),Ot.fromBufferAttribute(n,h),o?(Bt.addScaledVector(It,t),Nt.addScaledVector(kt,t),zt.addScaledVector(Ot,t)):(Bt.addScaledVector(It.sub(Pt),t),Nt.addScaledVector(kt.sub(Lt),t),zt.addScaledVector(Ot.sub(Dt),t)))}Pt.add(Bt),Lt.add(Nt),Dt.add(zt)}e.isSkinnedMesh&&(e.boneTransform(l,Pt),e.boneTransform(u,Lt),e.boneTransform(h,Dt));const p=function(e,t,n,i,r,s,o,a){let c;if(c=1===t.side?i.intersectTriangle(o,s,r,!0,a):i.intersectTriangle(r,s,o,2!==t.side,a),null===c)return null;Gt.copy(a),Gt.applyMatrix4(e.matrixWorld);const l=n.ray.origin.distanceTo(Gt);return l<n.near||l>n.far?null:{distance:l,point:Gt.clone(),object:e}}(e,t,n,i,Pt,Lt,Dt,Vt);if(p){a&&(Ft.fromBufferAttribute(a,l),Ut.fromBufferAttribute(a,u),Ht.fromBufferAttribute(a,h),p.uv=lt.getUV(Vt,Pt,Lt,Dt,Ft,Ut,Ht,new _)),c&&(Ft.fromBufferAttribute(c,l),Ut.fromBufferAttribute(c,u),Ht.fromBufferAttribute(c,h),p.uv2=lt.getUV(Vt,Pt,Lt,Dt,Ft,Ut,Ht,new _));const e={a:l,b:u,c:h,normal:new Y,materialIndex:0};lt.getNormal(Pt,Lt,Dt,e.normal),p.face=e}return p}class Jt extends Tt{constructor(e=1,t=1,n=1,i=1,r=1,s=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:i,heightSegments:r,depthSegments:s};const o=this;i=Math.floor(i),r=Math.floor(r),s=Math.floor(s);const a=[],c=[],l=[],u=[];let h=0,d=0;function p(e,t,n,i,r,s,p,f,m,g,v){const y=s/m,x=p/g,w=s/2,b=p/2,A=f/2,S=m+1,_=g+1;let M=0,T=0;const E=new Y;for(let s=0;s<_;s++){const o=s*x-b;for(let a=0;a<S;a++){const h=a*y-w;E[e]=h*i,E[t]=o*r,E[n]=A,c.push(E.x,E.y,E.z),E[e]=0,E[t]=0,E[n]=f>0?1:-1,l.push(E.x,E.y,E.z),u.push(a/m),u.push(1-s/g),M+=1}}for(let e=0;e<g;e++)for(let t=0;t<m;t++){const n=h+t+S*e,i=h+t+S*(e+1),r=h+(t+1)+S*(e+1),s=h+(t+1)+S*e;a.push(n,i,s),a.push(i,r,s),T+=6}o.addGroup(d,T,v),d+=T,h+=M}p("z","y","x",-1,-1,n,t,e,s,r,0),p("z","y","x",1,-1,n,t,-e,s,r,1),p("x","z","y",1,1,e,n,t,i,s,2),p("x","z","y",1,-1,e,n,-t,i,s,3),p("x","y","z",1,-1,e,t,n,i,r,4),p("x","y","z",-1,-1,e,t,-n,i,r,5),this.setIndex(a),this.setAttribute("position",new yt(c,3)),this.setAttribute("normal",new yt(l,3)),this.setAttribute("uv",new yt(u,2))}static fromJSON(e){return new Jt(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function Xt(e){const t={};for(const n in e){t[n]={};for(const i in e[n]){const r=e[n][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?t[n][i]=r.clone():Array.isArray(r)?t[n][i]=r.slice():t[n][i]=r}}return t}function qt(e){const t={};for(let n=0;n<e.length;n++){const i=Xt(e[n]);for(const e in i)t[e]=i[e]}return t}const Zt={clone:Xt,merge:qt};class Yt extends ht{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Xt(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const n in this.uniforms){const i=this.uniforms[n].value;i&&i.isTexture?t.uniforms[n]={type:"t",value:i.toJSON(e).uuid}:i&&i.isColor?t.uniforms[n]={type:"c",value:i.getHex()}:i&&i.isVector2?t.uniforms[n]={type:"v2",value:i.toArray()}:i&&i.isVector3?t.uniforms[n]={type:"v3",value:i.toArray()}:i&&i.isVector4?t.uniforms[n]={type:"v4",value:i.toArray()}:i&&i.isMatrix3?t.uniforms[n]={type:"m3",value:i.toArray()}:i&&i.isMatrix4?t.uniforms[n]={type:"m4",value:i.toArray()}:t.uniforms[n]={value:i}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;const n={};for(const e in this.extensions)!0===this.extensions[e]&&(n[e]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}}class Kt extends Qe{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Ee,this.projectionMatrix=new Ee,this.projectionMatrixInverse=new Ee}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}class Qt extends Kt{constructor(e=50,t=1,n=.1,i=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=i,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=2*m*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*f*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*m*Math.atan(Math.tan(.5*f*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,n,i,r,s){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(.5*f*this.fov)/this.zoom,n=2*t,i=this.aspect*n,r=-.5*i;const s=this.view;if(null!==this.view&&this.view.enabled){const e=s.fullWidth,o=s.fullHeight;r+=s.offsetX*i/e,t-=s.offsetY*n/o,i*=s.width/e,n*=s.height/o}const o=this.filmOffset;0!==o&&(r+=e*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+i,t,t-n,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}class $t extends Qe{constructor(e,t,n){if(super(),this.type="CubeCamera",!0!==n.isWebGLCubeRenderTarget)return void console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");this.renderTarget=n;const i=new Qt(90,1,e,t);i.layers=this.layers,i.up.set(0,-1,0),i.lookAt(new Y(1,0,0)),this.add(i);const r=new Qt(90,1,e,t);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new Y(-1,0,0)),this.add(r);const s=new Qt(90,1,e,t);s.layers=this.layers,s.up.set(0,0,1),s.lookAt(new Y(0,1,0)),this.add(s);const o=new Qt(90,1,e,t);o.layers=this.layers,o.up.set(0,0,-1),o.lookAt(new Y(0,-1,0)),this.add(o);const a=new Qt(90,1,e,t);a.layers=this.layers,a.up.set(0,-1,0),a.lookAt(new Y(0,0,1)),this.add(a);const c=new Qt(90,1,e,t);c.layers=this.layers,c.up.set(0,-1,0),c.lookAt(new Y(0,0,-1)),this.add(c)}update(e,t){null===this.parent&&this.updateMatrixWorld();const n=this.renderTarget,[i,r,s,o,a,c]=this.children,l=e.getRenderTarget(),u=e.toneMapping,h=e.xr.enabled;e.toneMapping=0,e.xr.enabled=!1;const d=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0),e.render(t,i),e.setRenderTarget(n,1),e.render(t,r),e.setRenderTarget(n,2),e.render(t,s),e.setRenderTarget(n,3),e.render(t,o),e.setRenderTarget(n,4),e.render(t,a),n.texture.generateMipmaps=d,e.setRenderTarget(n,5),e.render(t,c),e.setRenderTarget(l),e.toneMapping=u,e.xr.enabled=h,n.texture.needsPMREMUpdate=!0}}class en extends W{constructor(e,t,n,i,r,s,o,a,c,l){super(e=void 0!==e?e:[],t=void 0!==t?t:301,n,i,r,s,o,a,c,l),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class tn extends J{constructor(e,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const n={width:e,height:e,depth:1},i=[n,n,n,n,n,n];this.texture=new en(i,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps,this.texture.minFilter=void 0!==t.minFilter?t.minFilter:1006}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:"\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t"},i=new Jt(5,5,5),r=new Yt({name:"CubemapFromEquirect",uniforms:Xt(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:1,blending:0});r.uniforms.tEquirect.value=t;const s=new Wt(i,r),o=t.minFilter;1008===t.minFilter&&(t.minFilter=1006);return new $t(1,10,this).update(e,s),t.minFilter=o,s.geometry.dispose(),s.material.dispose(),this}clear(e,t,n,i){const r=e.getRenderTarget();for(let r=0;r<6;r++)e.setRenderTarget(this,r),e.clear(t,n,i);e.setRenderTarget(r)}}const nn=new Y,rn=new Y,sn=new M;class on{constructor(e=new Y(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,i){return this.normal.set(e,t,n),this.constant=i,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const i=nn.subVectors(n,t).cross(rn.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){const n=e.delta(nn),i=this.normal.dot(n);if(0===i)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;const r=-(e.start.dot(this.normal)+this.constant)/i;return r<0||r>1?null:t.copy(n).multiplyScalar(r).add(e.start)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||sn.getNormalMatrix(e),i=this.coplanarPoint(nn).applyMatrix4(e),r=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(r),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}}const an=new ye,cn=new Y;class ln{constructor(e=new on,t=new on,n=new on,i=new on,r=new on,s=new on){this.planes=[e,t,n,i,r,s]}set(e,t,n,i,r,s){const o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(n),o[3].copy(i),o[4].copy(r),o[5].copy(s),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e){const t=this.planes,n=e.elements,i=n[0],r=n[1],s=n[2],o=n[3],a=n[4],c=n[5],l=n[6],u=n[7],h=n[8],d=n[9],p=n[10],f=n[11],m=n[12],g=n[13],v=n[14],y=n[15];return t[0].setComponents(o-i,u-a,f-h,y-m).normalize(),t[1].setComponents(o+i,u+a,f+h,y+m).normalize(),t[2].setComponents(o+r,u+c,f+d,y+g).normalize(),t[3].setComponents(o-r,u-c,f-d,y-g).normalize(),t[4].setComponents(o-s,u-l,f-p,y-v).normalize(),t[5].setComponents(o+s,u+l,f+p,y+v).normalize(),this}intersectsObject(e){const t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),an.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(an)}intersectsSprite(e){return an.center.set(0,0,0),an.radius=.7071067811865476,an.applyMatrix4(e.matrixWorld),this.intersectsSphere(an)}intersectsSphere(e){const t=this.planes,n=e.center,i=-e.radius;for(let e=0;e<6;e++){if(t[e].distanceToPoint(n)<i)return!1}return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const i=t[n];if(cn.x=i.normal.x>0?e.max.x:e.min.x,cn.y=i.normal.y>0?e.max.y:e.min.y,cn.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint(cn)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function un(){let e=null,t=!1,n=null,i=null;function r(t,s){n(t,s),i=e.requestAnimationFrame(r)}return{start:function(){!0!==t&&null!==n&&(i=e.requestAnimationFrame(r),t=!0)},stop:function(){e.cancelAnimationFrame(i),t=!1},setAnimationLoop:function(e){n=e},setContext:function(t){e=t}}}function hn(e,t){const n=t.isWebGL2,i=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),i.get(e)},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);const n=i.get(t);n&&(e.deleteBuffer(n.buffer),i.delete(t))},update:function(t,r){if(t.isGLBufferAttribute){const e=i.get(t);return void((!e||e.version<t.version)&&i.set(t,{buffer:t.buffer,type:t.type,bytesPerElement:t.elementSize,version:t.version}))}t.isInterleavedBufferAttribute&&(t=t.data);const s=i.get(t);void 0===s?i.set(t,function(t,i){const r=t.array,s=t.usage,o=e.createBuffer();let a;if(e.bindBuffer(i,o),e.bufferData(i,r,s),t.onUploadCallback(),r instanceof Float32Array)a=5126;else if(r instanceof Uint16Array)if(t.isFloat16BufferAttribute){if(!n)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");a=5131}else a=5123;else if(r instanceof Int16Array)a=5122;else if(r instanceof Uint32Array)a=5125;else if(r instanceof Int32Array)a=5124;else if(r instanceof Int8Array)a=5120;else if(r instanceof Uint8Array)a=5121;else{if(!(r instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+r);a=5121}return{buffer:o,type:a,bytesPerElement:r.BYTES_PER_ELEMENT,version:t.version}}(t,r)):s.version<t.version&&(!function(t,i,r){const s=i.array,o=i.updateRange;e.bindBuffer(r,t),-1===o.count?e.bufferSubData(r,0,s):(n?e.bufferSubData(r,o.offset*s.BYTES_PER_ELEMENT,s,o.offset,o.count):e.bufferSubData(r,o.offset*s.BYTES_PER_ELEMENT,s.subarray(o.offset,o.offset+o.count)),o.count=-1)}(s.buffer,t,r),s.version=t.version)}}}class dn extends Tt{constructor(e=1,t=1,n=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:i};const r=e/2,s=t/2,o=Math.floor(n),a=Math.floor(i),c=o+1,l=a+1,u=e/o,h=t/a,d=[],p=[],f=[],m=[];for(let e=0;e<l;e++){const t=e*h-s;for(let n=0;n<c;n++){const i=n*u-r;p.push(i,-t,0),f.push(0,0,1),m.push(n/o),m.push(1-e/a)}}for(let e=0;e<a;e++)for(let t=0;t<o;t++){const n=t+c*e,i=t+c*(e+1),r=t+1+c*(e+1),s=t+1+c*e;d.push(n,i,s),d.push(i,r,s)}this.setIndex(d),this.setAttribute("position",new yt(p,3)),this.setAttribute("normal",new yt(f,3)),this.setAttribute("uv",new yt(m,2))}static fromJSON(e){return new dn(e.width,e.height,e.widthSegments,e.heightSegments)}}const pn={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( V * D );\n}\n#ifdef USE_IRIDESCENCE\nvec3 BRDF_GGX_Iridescence( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float iridescence, const in vec3 iridescenceFresnel, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = mix(F_Schlick( f0, f90, dotVH ), iridescenceFresnel, iridescence);\n\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( V * D );\n}\n#endif\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif",iridescence_fragment:"#ifdef USE_IRIDESCENCE\nconst mat3 XYZ_TO_REC709 = mat3(\n    3.2404542, -0.9692660,  0.0556434,\n   -1.5371385,  1.8760108, -0.2040259,\n   -0.4985314,  0.0415560,  1.0572252\n);\nvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n   vec3 sqrtF0 = sqrt( fresnel0 );\n   return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n}\nvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n   return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n}\nfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n   return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n}\nvec3 evalSensitivity( float OPD, vec3 shift ) {\n   float phase = 2.0 * PI * OPD * 1.0e-9;\n   vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n   vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n   vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n   vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( -pow2( phase ) * var );\n   xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[0] ) * exp( -4.5282e+09 * pow2( phase ) );\n   xyz /= 1.0685e-7;\n   vec3 srgb = XYZ_TO_REC709 * xyz;\n   return srgb;\n}\nvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n   vec3 I;\n   float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n   float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n   float cosTheta2Sq = 1.0 - sinTheta2Sq;\n   if ( cosTheta2Sq < 0.0 ) {\n       return vec3( 1.0 );\n   }\n   float cosTheta2 = sqrt( cosTheta2Sq );\n   float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n   float R12 = F_Schlick( R0, 1.0, cosTheta1 );\n   float R21 = R12;\n   float T121 = 1.0 - R12;\n   float phi12 = 0.0;\n   if ( iridescenceIOR < outsideIOR ) phi12 = PI;\n   float phi21 = PI - phi12;\n   vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );   vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n   vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n   vec3 phi23 = vec3( 0.0 );\n   if ( baseIOR[0] < iridescenceIOR ) phi23[0] = PI;\n   if ( baseIOR[1] < iridescenceIOR ) phi23[1] = PI;\n   if ( baseIOR[2] < iridescenceIOR ) phi23[2] = PI;\n   float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n   vec3 phi = vec3( phi21 ) + phi23;\n   vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n   vec3 r123 = sqrt( R123 );\n   vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n   vec3 C0 = R12 + Rs;\n   I = C0;\n   vec3 Cm = Rs - T121;\n   for ( int m = 1; m <= 2; ++m ) {\n       Cm *= r123;\n       vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n       I += Cm * Sm;\n   }\n   return max( I, vec3( 0.0 ) );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= r1 ) {\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\t\t} else if ( roughness >= r4 ) {\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\t\t} else if ( roughness >= r5 ) {\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\t\t} else if ( roughness >= r6 ) {\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"vec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointLightInfo( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotLightInfo( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalLightInfo( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#else\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\t#ifdef SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULARINTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;\n\t\t#endif\n\t\t#ifdef USE_SPECULARCOLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vUv ).rgb;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( ior - 1.0 ) / ( ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;\n\t#endif\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec3 sheenSpecular = vec3( 0.0 );\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\treflectedLight.directSpecular += irradiance * BRDF_GGX_Iridescence( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness );\n\t#else\n\t\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\nfloat dotNVi = saturate( dot( normal, geometry.viewDir ) );\nif ( material.iridescenceThickness == 0.0 ) {\n\tmaterial.iridescence = 0.0;\n} else {\n\tmaterial.iridescence = saturate( material.iridescence );\n}\nif ( material.iridescence > 0.0 ) {\n\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometry.normal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform ivec2 morphTargetsTextureSize;\n\t\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",output_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= transmissionAlpha + 0.1;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tuniform int boneTextureSize;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tfloat j = i * 4.0;\n\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\ty = dy * ( y + 0.5 );\n\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\treturn bone;\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tfloat transmissionAlpha = 1.0;\n\tfloat transmissionFactor = transmission;\n\tfloat thicknessFactor = thickness;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\ttransmissionFactor *= texture2D( transmissionMap, vUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tthicknessFactor *= texture2D( thicknessMap, vUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmission = getIBLVolumeRefraction(\n\t\tn, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,\n\t\tattenuationColor, attenuationDistance );\n\ttotalDiffuse = mix( totalDiffuse, transmission.rgb, transmissionFactor );\n\ttransmissionAlpha = mix( transmissionAlpha, transmission.a, transmissionFactor );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\t#ifdef texture2DLodEXT\n\t\t\treturn texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#else\n\t\t\treturn texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#endif\n\t}\n\tvec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( attenuationDistance == 0.0 ) {\n\t\t\treturn radiance;\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance * radiance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );\n\t}\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tgl_FragColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tgl_FragColor = vec4( mix( pow( gl_FragColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), gl_FragColor.rgb * 0.0773993808, vec3( lessThanEqual( gl_FragColor.rgb, vec3( 0.04045 ) ) ) ), gl_FragColor.w );\n\t#endif\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULARINTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n\t#ifdef USE_SPECULARCOLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;\n\t#endif\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}"},fn={common:{diffuse:{value:new z(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new M},uv2Transform:{value:new M},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new _(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new z(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new z(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new M}},sprite:{diffuse:{value:new z(16777215)},opacity:{value:1},center:{value:new _(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new M}}},mn={basic:{uniforms:qt([fn.common,fn.specularmap,fn.envmap,fn.aomap,fn.lightmap,fn.fog]),vertexShader:pn.meshbasic_vert,fragmentShader:pn.meshbasic_frag},lambert:{uniforms:qt([fn.common,fn.specularmap,fn.envmap,fn.aomap,fn.lightmap,fn.emissivemap,fn.fog,fn.lights,{emissive:{value:new z(0)}}]),vertexShader:pn.meshlambert_vert,fragmentShader:pn.meshlambert_frag},phong:{uniforms:qt([fn.common,fn.specularmap,fn.envmap,fn.aomap,fn.lightmap,fn.emissivemap,fn.bumpmap,fn.normalmap,fn.displacementmap,fn.fog,fn.lights,{emissive:{value:new z(0)},specular:{value:new z(1118481)},shininess:{value:30}}]),vertexShader:pn.meshphong_vert,fragmentShader:pn.meshphong_frag},standard:{uniforms:qt([fn.common,fn.envmap,fn.aomap,fn.lightmap,fn.emissivemap,fn.bumpmap,fn.normalmap,fn.displacementmap,fn.roughnessmap,fn.metalnessmap,fn.fog,fn.lights,{emissive:{value:new z(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:pn.meshphysical_vert,fragmentShader:pn.meshphysical_frag},toon:{uniforms:qt([fn.common,fn.aomap,fn.lightmap,fn.emissivemap,fn.bumpmap,fn.normalmap,fn.displacementmap,fn.gradientmap,fn.fog,fn.lights,{emissive:{value:new z(0)}}]),vertexShader:pn.meshtoon_vert,fragmentShader:pn.meshtoon_frag},matcap:{uniforms:qt([fn.common,fn.bumpmap,fn.normalmap,fn.displacementmap,fn.fog,{matcap:{value:null}}]),vertexShader:pn.meshmatcap_vert,fragmentShader:pn.meshmatcap_frag},points:{uniforms:qt([fn.points,fn.fog]),vertexShader:pn.points_vert,fragmentShader:pn.points_frag},dashed:{uniforms:qt([fn.common,fn.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:pn.linedashed_vert,fragmentShader:pn.linedashed_frag},depth:{uniforms:qt([fn.common,fn.displacementmap]),vertexShader:pn.depth_vert,fragmentShader:pn.depth_frag},normal:{uniforms:qt([fn.common,fn.bumpmap,fn.normalmap,fn.displacementmap,{opacity:{value:1}}]),vertexShader:pn.meshnormal_vert,fragmentShader:pn.meshnormal_frag},sprite:{uniforms:qt([fn.sprite,fn.fog]),vertexShader:pn.sprite_vert,fragmentShader:pn.sprite_frag},background:{uniforms:{uvTransform:{value:new M},t2D:{value:null}},vertexShader:pn.background_vert,fragmentShader:pn.background_frag},cube:{uniforms:qt([fn.envmap,{opacity:{value:1}}]),vertexShader:pn.cube_vert,fragmentShader:pn.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:pn.equirect_vert,fragmentShader:pn.equirect_frag},distanceRGBA:{uniforms:qt([fn.common,fn.displacementmap,{referencePosition:{value:new Y},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:pn.distanceRGBA_vert,fragmentShader:pn.distanceRGBA_frag},shadow:{uniforms:qt([fn.lights,fn.fog,{color:{value:new z(0)},opacity:{value:1}}]),vertexShader:pn.shadow_vert,fragmentShader:pn.shadow_frag}};function gn(e,t,n,i,r,s){const o=new z(0);let a,c,l=!0===r?0:1,u=null,h=0,d=null;function p(e,t){n.buffers.color.setClear(e.r,e.g,e.b,t,s)}return{getClearColor:function(){return o},setClearColor:function(e,t=1){o.set(e),l=t,p(o,l)},getClearAlpha:function(){return l},setClearAlpha:function(e){l=e,p(o,l)},render:function(n,r){let s=!1,f=!0===r.isScene?r.background:null;f&&f.isTexture&&(f=t.get(f));const m=e.xr,g=m.getSession&&m.getSession();g&&"additive"===g.environmentBlendMode&&(f=null),null===f?p(o,l):f&&f.isColor&&(p(f,1),s=!0),(e.autoClear||s)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),f&&(f.isCubeTexture||306===f.mapping)?(void 0===c&&(c=new Wt(new Jt(1,1,1),new Yt({name:"BackgroundCubeMaterial",uniforms:Xt(mn.cube.uniforms),vertexShader:mn.cube.vertexShader,fragmentShader:mn.cube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),c.geometry.deleteAttribute("uv"),c.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(c.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(c)),c.material.uniforms.envMap.value=f,c.material.uniforms.flipEnvMap.value=f.isCubeTexture&&!1===f.isRenderTargetTexture?-1:1,u===f&&h===f.version&&d===e.toneMapping||(c.material.needsUpdate=!0,u=f,h=f.version,d=e.toneMapping),c.layers.enableAll(),n.unshift(c,c.geometry,c.material,0,0,null)):f&&f.isTexture&&(void 0===a&&(a=new Wt(new dn(2,2),new Yt({name:"BackgroundMaterial",uniforms:Xt(mn.background.uniforms),vertexShader:mn.background.vertexShader,fragmentShader:mn.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1})),a.geometry.deleteAttribute("normal"),Object.defineProperty(a.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(a)),a.material.uniforms.t2D.value=f,!0===f.matrixAutoUpdate&&f.updateMatrix(),a.material.uniforms.uvTransform.value.copy(f.matrix),u===f&&h===f.version&&d===e.toneMapping||(a.material.needsUpdate=!0,u=f,h=f.version,d=e.toneMapping),a.layers.enableAll(),n.unshift(a,a.geometry,a.material,0,0,null))}}}function vn(e,t,n,i){const r=e.getParameter(34921),s=i.isWebGL2?null:t.get("OES_vertex_array_object"),o=i.isWebGL2||null!==s,a={},c=p(null);let l=c,u=!1;function h(t){return i.isWebGL2?e.bindVertexArray(t):s.bindVertexArrayOES(t)}function d(t){return i.isWebGL2?e.deleteVertexArray(t):s.deleteVertexArrayOES(t)}function p(e){const t=[],n=[],i=[];for(let e=0;e<r;e++)t[e]=0,n[e]=0,i[e]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:n,attributeDivisors:i,object:e,attributes:{},index:null}}function f(){const e=l.newAttributes;for(let t=0,n=e.length;t<n;t++)e[t]=0}function m(e){g(e,0)}function g(n,r){const s=l.newAttributes,o=l.enabledAttributes,a=l.attributeDivisors;if(s[n]=1,0===o[n]&&(e.enableVertexAttribArray(n),o[n]=1),a[n]!==r){(i.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[i.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,r),a[n]=r}}function v(){const t=l.newAttributes,n=l.enabledAttributes;for(let i=0,r=n.length;i<r;i++)n[i]!==t[i]&&(e.disableVertexAttribArray(i),n[i]=0)}function y(t,n,r,s,o,a){!0!==i.isWebGL2||5124!==r&&5125!==r?e.vertexAttribPointer(t,n,r,s,o,a):e.vertexAttribIPointer(t,n,r,o,a)}function x(){w(),u=!0,l!==c&&(l=c,h(l.object))}function w(){c.geometry=null,c.program=null,c.wireframe=!1}return{setup:function(r,c,d,x,w){let b=!1;if(o){const t=function(t,n,r){const o=!0===r.wireframe;let c=a[t.id];void 0===c&&(c={},a[t.id]=c);let l=c[n.id];void 0===l&&(l={},c[n.id]=l);let u=l[o];void 0===u&&(u=p(i.isWebGL2?e.createVertexArray():s.createVertexArrayOES()),l[o]=u);return u}(x,d,c);l!==t&&(l=t,h(l.object)),b=function(e,t,n,i){const r=l.attributes,s=t.attributes;let o=0;const a=n.getAttributes();for(const t in a){if(a[t].location>=0){const n=r[t];let i=s[t];if(void 0===i&&("instanceMatrix"===t&&e.instanceMatrix&&(i=e.instanceMatrix),"instanceColor"===t&&e.instanceColor&&(i=e.instanceColor)),void 0===n)return!0;if(n.attribute!==i)return!0;if(i&&n.data!==i.data)return!0;o++}}return l.attributesNum!==o||l.index!==i}(r,x,d,w),b&&function(e,t,n,i){const r={},s=t.attributes;let o=0;const a=n.getAttributes();for(const t in a){if(a[t].location>=0){let n=s[t];void 0===n&&("instanceMatrix"===t&&e.instanceMatrix&&(n=e.instanceMatrix),"instanceColor"===t&&e.instanceColor&&(n=e.instanceColor));const i={};i.attribute=n,n&&n.data&&(i.data=n.data),r[t]=i,o++}}l.attributes=r,l.attributesNum=o,l.index=i}(r,x,d,w)}else{const e=!0===c.wireframe;l.geometry===x.id&&l.program===d.id&&l.wireframe===e||(l.geometry=x.id,l.program=d.id,l.wireframe=e,b=!0)}null!==w&&n.update(w,34963),(b||u)&&(u=!1,function(r,s,o,a){if(!1===i.isWebGL2&&(r.isInstancedMesh||a.isInstancedBufferGeometry)&&null===t.get("ANGLE_instanced_arrays"))return;f();const c=a.attributes,l=o.getAttributes(),u=s.defaultAttributeValues;for(const t in l){const i=l[t];if(i.location>=0){let s=c[t];if(void 0===s&&("instanceMatrix"===t&&r.instanceMatrix&&(s=r.instanceMatrix),"instanceColor"===t&&r.instanceColor&&(s=r.instanceColor)),void 0!==s){const t=s.normalized,o=s.itemSize,c=n.get(s);if(void 0===c)continue;const l=c.buffer,u=c.type,h=c.bytesPerElement;if(s.isInterleavedBufferAttribute){const n=s.data,c=n.stride,d=s.offset;if(n.isInstancedInterleavedBuffer){for(let e=0;e<i.locationSize;e++)g(i.location+e,n.meshPerAttribute);!0!==r.isInstancedMesh&&void 0===a._maxInstanceCount&&(a._maxInstanceCount=n.meshPerAttribute*n.count)}else for(let e=0;e<i.locationSize;e++)m(i.location+e);e.bindBuffer(34962,l);for(let e=0;e<i.locationSize;e++)y(i.location+e,o/i.locationSize,u,t,c*h,(d+o/i.locationSize*e)*h)}else{if(s.isInstancedBufferAttribute){for(let e=0;e<i.locationSize;e++)g(i.location+e,s.meshPerAttribute);!0!==r.isInstancedMesh&&void 0===a._maxInstanceCount&&(a._maxInstanceCount=s.meshPerAttribute*s.count)}else for(let e=0;e<i.locationSize;e++)m(i.location+e);e.bindBuffer(34962,l);for(let e=0;e<i.locationSize;e++)y(i.location+e,o/i.locationSize,u,t,o*h,o/i.locationSize*e*h)}}else if(void 0!==u){const n=u[t];if(void 0!==n)switch(n.length){case 2:e.vertexAttrib2fv(i.location,n);break;case 3:e.vertexAttrib3fv(i.location,n);break;case 4:e.vertexAttrib4fv(i.location,n);break;default:e.vertexAttrib1fv(i.location,n)}}}}v()}(r,c,d,x),null!==w&&e.bindBuffer(34963,n.get(w).buffer))},reset:x,resetDefaultState:w,dispose:function(){x();for(const e in a){const t=a[e];for(const e in t){const n=t[e];for(const e in n)d(n[e].object),delete n[e];delete t[e]}delete a[e]}},releaseStatesOfGeometry:function(e){if(void 0===a[e.id])return;const t=a[e.id];for(const e in t){const n=t[e];for(const e in n)d(n[e].object),delete n[e];delete t[e]}delete a[e.id]},releaseStatesOfProgram:function(e){for(const t in a){const n=a[t];if(void 0===n[e.id])continue;const i=n[e.id];for(const e in i)d(i[e].object),delete i[e];delete n[e.id]}},initAttributes:f,enableAttribute:m,disableUnusedAttributes:v}}function yn(e,t,n,i){const r=i.isWebGL2;let s;this.setMode=function(e){s=e},this.render=function(t,i){e.drawArrays(s,t,i),n.update(i,s,1)},this.renderInstances=function(i,o,a){if(0===a)return;let c,l;if(r)c=e,l="drawArraysInstanced";else if(c=t.get("ANGLE_instanced_arrays"),l="drawArraysInstancedANGLE",null===c)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");c[l](s,i,o,a),n.update(o,s,a)}}function xn(e,t,n){let i;function r(t){if("highp"===t){if(e.getShaderPrecisionFormat(35633,36338).precision>0&&e.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(35633,36337).precision>0&&e.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const s="undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&e instanceof WebGL2ComputeRenderingContext;let o=void 0!==n.precision?n.precision:"highp";const a=r(o);a!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",a,"instead."),o=a);const c=s||t.has("WEBGL_draw_buffers"),l=!0===n.logarithmicDepthBuffer,u=e.getParameter(34930),h=e.getParameter(35660),d=e.getParameter(3379),p=e.getParameter(34076),f=e.getParameter(34921),m=e.getParameter(36347),g=e.getParameter(36348),v=e.getParameter(36349),y=h>0,x=s||t.has("OES_texture_float");return{isWebGL2:s,drawBuffers:c,getMaxAnisotropy:function(){if(void 0!==i)return i;if(!0===t.has("EXT_texture_filter_anisotropic")){const n=t.get("EXT_texture_filter_anisotropic");i=e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i},getMaxPrecision:r,precision:o,logarithmicDepthBuffer:l,maxTextures:u,maxVertexTextures:h,maxTextureSize:d,maxCubemapSize:p,maxAttributes:f,maxVertexUniforms:m,maxVaryings:g,maxFragmentUniforms:v,vertexTextures:y,floatFragmentTextures:x,floatVertexTextures:y&&x,maxSamples:s?e.getParameter(36183):0}}function wn(e){const t=this;let n=null,i=0,r=!1,s=!1;const o=new on,a=new M,c={value:null,needsUpdate:!1};function l(){c.value!==n&&(c.value=n,c.needsUpdate=i>0),t.numPlanes=i,t.numIntersection=0}function u(e,n,i,r){const s=null!==e?e.length:0;let l=null;if(0!==s){if(l=c.value,!0!==r||null===l){const t=i+4*s,r=n.matrixWorldInverse;a.getNormalMatrix(r),(null===l||l.length<t)&&(l=new Float32Array(t));for(let t=0,n=i;t!==s;++t,n+=4)o.copy(e[t]).applyMatrix4(r,a),o.normal.toArray(l,n),l[n+3]=o.constant}c.value=l,c.needsUpdate=!0}return t.numPlanes=s,t.numIntersection=0,l}this.uniform=c,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t,s){const o=0!==e.length||t||0!==i||r;return r=t,n=u(e,s,0),i=e.length,o},this.beginShadows=function(){s=!0,u(null)},this.endShadows=function(){s=!1,l()},this.setState=function(t,o,a){const h=t.clippingPlanes,d=t.clipIntersection,p=t.clipShadows,f=e.get(t);if(!r||null===h||0===h.length||s&&!p)s?u(null):l();else{const e=s?0:i,t=4*e;let r=f.clippingState||null;c.value=r,r=u(h,o,t,a);for(let e=0;e!==t;++e)r[e]=n[e];f.clippingState=r,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=e}}}function bn(e){let t=new WeakMap;function n(e,t){return 303===t?e.mapping=301:304===t&&(e.mapping=302),e}function i(e){const n=e.target;n.removeEventListener("dispose",i);const r=t.get(n);void 0!==r&&(t.delete(n),r.dispose())}return{get:function(r){if(r&&r.isTexture&&!1===r.isRenderTargetTexture){const s=r.mapping;if(303===s||304===s){if(t.has(r)){return n(t.get(r).texture,r.mapping)}{const s=r.image;if(s&&s.height>0){const o=new tn(s.height/2);return o.fromEquirectangularTexture(e,r),t.set(r,o),r.addEventListener("dispose",i),n(o.texture,r.mapping)}return null}}}return r},dispose:function(){t=new WeakMap}}}mn.physical={uniforms:qt([mn.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new _(1,1)},clearcoatNormalMap:{value:null},iridescence:{value:0},iridescenceMap:{value:null},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},sheen:{value:0},sheenColor:{value:new z(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new _},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new z(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new z(1,1,1)},specularColorMap:{value:null}}]),vertexShader:pn.meshphysical_vert,fragmentShader:pn.meshphysical_frag};class An extends Kt{constructor(e=-1,t=1,n=1,i=-1,r=.1,s=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=i,this.near=r,this.far=s,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,n,i,r,s){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let r=n-e,s=n+e,o=i+t,a=i-t;if(null!==this.view&&this.view.enabled){const e=(this.right-this.left)/this.view.fullWidth/this.zoom,t=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=e*this.view.offsetX,s=r+e*this.view.width,o-=t*this.view.offsetY,a=o-t*this.view.height}this.projectionMatrix.makeOrthographic(r,s,o,a,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}const Sn=[.125,.215,.35,.446,.526,.582],_n=new An,Mn=new z;let Tn=null;const En=(1+Math.sqrt(5))/2,Cn=1/En,Rn=[new Y(1,1,1),new Y(-1,1,1),new Y(1,1,-1),new Y(-1,1,-1),new Y(0,En,Cn),new Y(0,En,-Cn),new Y(Cn,0,En),new Y(-Cn,0,En),new Y(En,Cn,0),new Y(-En,Cn,0)];class Pn{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,n=.1,i=100){Tn=this._renderer.getRenderTarget(),this._setSize(256);const r=this._allocateTargets();return r.depthBuffer=!0,this._sceneToCubeUV(e,n,i,r),t>0&&this._blur(r,0,0,t),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=kn(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=In(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(Tn),e.scissorTest=!1,Dn(e,0,0,e.width,e.height)}_fromTexture(e,t){301===e.mapping||302===e.mapping?this._setSize(0===e.image.length?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),Tn=this._renderer.getRenderTarget();const n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,n={magFilter:1006,minFilter:1006,generateMipmaps:!1,type:1016,format:1023,encoding:3e3,depthBuffer:!1},i=Ln(e,t,n);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==e){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=Ln(e,t,n);const{_lodMax:i}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(e){const t=[],n=[],i=[];let r=e;const s=e-4+1+Sn.length;for(let o=0;o<s;o++){const s=Math.pow(2,r);n.push(s);let a=1/s;o>e-4?a=Sn[o-e+4-1]:0===o&&(a=0),i.push(a);const c=1/(s-2),l=-c,u=1+c,h=[l,l,u,l,u,u,l,l,u,u,l,u],d=6,p=6,f=3,m=2,g=1,v=new Float32Array(f*p*d),y=new Float32Array(m*p*d),x=new Float32Array(g*p*d);for(let e=0;e<d;e++){const t=e%3*2/3-1,n=e>2?0:-1,i=[t,n,0,t+2/3,n,0,t+2/3,n+1,0,t,n,0,t+2/3,n+1,0,t,n+1,0];v.set(i,f*p*e),y.set(h,m*p*e);const r=[e,e,e,e,e,e];x.set(r,g*p*e)}const w=new Tt;w.setAttribute("position",new mt(v,f)),w.setAttribute("uv",new mt(y,m)),w.setAttribute("faceIndex",new mt(x,g)),t.push(w),r>4&&r--}return{lodPlanes:t,sizeLods:n,sigmas:i}}(i)),this._blurMaterial=function(e,t,n){const i=new Float32Array(20),r=new Y(0,1,0);return new Yt({name:"SphericalGaussianBlur",defines:{n:20,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/n,CUBEUV_MAX_MIP:e+".0"},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:On(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}(i,e,t)}return i}_compileMaterial(e){const t=new Wt(this._lodPlanes[0],e);this._renderer.compile(t,_n)}_sceneToCubeUV(e,t,n,i){const r=new Qt(90,1,t,n),s=[1,-1,1,1,1,1],o=[1,1,1,-1,-1,-1],a=this._renderer,c=a.autoClear,l=a.toneMapping;a.getClearColor(Mn),a.toneMapping=0,a.autoClear=!1;const u=new dt({name:"PMREM.Background",side:1,depthWrite:!1,depthTest:!1}),h=new Wt(new Jt,u);let d=!1;const p=e.background;p?p.isColor&&(u.color.copy(p),e.background=null,d=!0):(u.color.copy(Mn),d=!0);for(let t=0;t<6;t++){const n=t%3;0===n?(r.up.set(0,s[t],0),r.lookAt(o[t],0,0)):1===n?(r.up.set(0,0,s[t]),r.lookAt(0,o[t],0)):(r.up.set(0,s[t],0),r.lookAt(0,0,o[t]));const c=this._cubeSize;Dn(i,n*c,t>2?c:0,c,c),a.setRenderTarget(i),d&&a.render(h,r),a.render(e,r)}h.geometry.dispose(),h.material.dispose(),a.toneMapping=l,a.autoClear=c,e.background=p}_textureToCubeUV(e,t){const n=this._renderer,i=301===e.mapping||302===e.mapping;i?(null===this._cubemapMaterial&&(this._cubemapMaterial=kn()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===e.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=In());const r=i?this._cubemapMaterial:this._equirectMaterial,s=new Wt(this._lodPlanes[0],r);r.uniforms.envMap.value=e;const o=this._cubeSize;Dn(t,0,0,3*o,2*o),n.setRenderTarget(t),n.render(s,_n)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;for(let t=1;t<this._lodPlanes.length;t++){const n=Math.sqrt(this._sigmas[t]*this._sigmas[t]-this._sigmas[t-1]*this._sigmas[t-1]),i=Rn[(t-1)%Rn.length];this._blur(e,t-1,t,n,i)}t.autoClear=n}_blur(e,t,n,i,r){const s=this._pingPongRenderTarget;this._halfBlur(e,s,t,n,i,"latitudinal",r),this._halfBlur(s,e,n,n,i,"longitudinal",r)}_halfBlur(e,t,n,i,r,s,o){const a=this._renderer,c=this._blurMaterial;"latitudinal"!==s&&"longitudinal"!==s&&console.error("blur direction must be either latitudinal or longitudinal!");const l=new Wt(this._lodPlanes[i],c),u=c.uniforms,h=this._sizeLods[n]-1,d=isFinite(r)?Math.PI/(2*h):2*Math.PI/39,p=r/d,f=isFinite(r)?1+Math.floor(3*p):20;f>20&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${f} samples when the maximum is set to 20`);const m=[];let g=0;for(let e=0;e<20;++e){const t=e/p,n=Math.exp(-t*t/2);m.push(n),0===e?g+=n:e<f&&(g+=2*n)}for(let e=0;e<m.length;e++)m[e]=m[e]/g;u.envMap.value=e.texture,u.samples.value=f,u.weights.value=m,u.latitudinal.value="latitudinal"===s,o&&(u.poleAxis.value=o);const{_lodMax:v}=this;u.dTheta.value=d,u.mipInt.value=v-n;const y=this._sizeLods[i];Dn(t,3*y*(i>v-4?i-v+4:0),4*(this._cubeSize-y),3*y,2*y),a.setRenderTarget(t),a.render(l,_n)}}function Ln(e,t,n){const i=new J(e,t,n);return i.texture.mapping=306,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function Dn(e,t,n,i,r){e.viewport.set(t,n,i,r),e.scissor.set(t,n,i,r)}function In(){return new Yt({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:On(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function kn(){return new Yt({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:On(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function On(){return"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t"}function Bn(e){let t=new WeakMap,n=null;function i(e){const n=e.target;n.removeEventListener("dispose",i);const r=t.get(n);void 0!==r&&(t.delete(n),r.dispose())}return{get:function(r){if(r&&r.isTexture){const s=r.mapping,o=303===s||304===s,a=301===s||302===s;if(o||a){if(r.isRenderTargetTexture&&!0===r.needsPMREMUpdate){r.needsPMREMUpdate=!1;let i=t.get(r);return null===n&&(n=new Pn(e)),i=o?n.fromEquirectangular(r,i):n.fromCubemap(r,i),t.set(r,i),i.texture}if(t.has(r))return t.get(r).texture;{const s=r.image;if(o&&s&&s.height>0||a&&s&&function(e){let t=0;for(let n=0;n<6;n++)void 0!==e[n]&&t++;return 6===t}(s)){null===n&&(n=new Pn(e));const s=o?n.fromEquirectangular(r):n.fromCubemap(r);return t.set(r,s),r.addEventListener("dispose",i),s.texture}return null}}}return r},dispose:function(){t=new WeakMap,null!==n&&(n.dispose(),n=null)}}}function Nn(e){const t={};function n(n){if(void 0!==t[n])return t[n];let i;switch(n){case"WEBGL_depth_texture":i=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=e.getExtension(n)}return t[n]=i,i}return{has:function(e){return null!==n(e)},init:function(e){e.isWebGL2?n("EXT_color_buffer_float"):(n("WEBGL_depth_texture"),n("OES_texture_float"),n("OES_texture_half_float"),n("OES_texture_half_float_linear"),n("OES_standard_derivatives"),n("OES_element_index_uint"),n("OES_vertex_array_object"),n("ANGLE_instanced_arrays")),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float"),n("WEBGL_multisampled_render_to_texture")},get:function(e){const t=n(e);return null===t&&console.warn("THREE.WebGLRenderer: "+e+" extension not supported."),t}}}function zn(e,t,n,i){const r={},s=new WeakMap;function o(e){const a=e.target;null!==a.index&&t.remove(a.index);for(const e in a.attributes)t.remove(a.attributes[e]);a.removeEventListener("dispose",o),delete r[a.id];const c=s.get(a);c&&(t.remove(c),s.delete(a)),i.releaseStatesOfGeometry(a),!0===a.isInstancedBufferGeometry&&delete a._maxInstanceCount,n.memory.geometries--}function a(e){const n=[],i=e.index,r=e.attributes.position;let o=0;if(null!==i){const e=i.array;o=i.version;for(let t=0,i=e.length;t<i;t+=3){const i=e[t+0],r=e[t+1],s=e[t+2];n.push(i,r,r,s,s,i)}}else{const e=r.array;o=r.version;for(let t=0,i=e.length/3-1;t<i;t+=3){const e=t+0,i=t+1,r=t+2;n.push(e,i,i,r,r,e)}}const a=new(T(n)?vt:gt)(n,1);a.version=o;const c=s.get(e);c&&t.remove(c),s.set(e,a)}return{get:function(e,t){return!0===r[t.id]||(t.addEventListener("dispose",o),r[t.id]=!0,n.memory.geometries++),t},update:function(e){const n=e.attributes;for(const e in n)t.update(n[e],34962);const i=e.morphAttributes;for(const e in i){const n=i[e];for(let e=0,i=n.length;e<i;e++)t.update(n[e],34962)}},getWireframeAttribute:function(e){const t=s.get(e);if(t){const n=e.index;null!==n&&t.version<n.version&&a(e)}else a(e);return s.get(e)}}}function Fn(e,t,n,i){const r=i.isWebGL2;let s,o,a;this.setMode=function(e){s=e},this.setIndex=function(e){o=e.type,a=e.bytesPerElement},this.render=function(t,i){e.drawElements(s,i,o,t*a),n.update(i,s,1)},this.renderInstances=function(i,c,l){if(0===l)return;let u,h;if(r)u=e,h="drawElementsInstanced";else if(u=t.get("ANGLE_instanced_arrays"),h="drawElementsInstancedANGLE",null===u)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");u[h](s,c,o,i*a,l),n.update(c,s,l)}}function Un(e){const t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(e,n,i){switch(t.calls++,n){case 4:t.triangles+=i*(e/3);break;case 1:t.lines+=i*(e/2);break;case 3:t.lines+=i*(e-1);break;case 2:t.lines+=i*e;break;case 0:t.points+=i*e;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",n)}}}}function Hn(e,t){return e[0]-t[0]}function Vn(e,t){return Math.abs(t[1])-Math.abs(e[1])}function Gn(e,t){let n=1;const i=t.isInterleavedBufferAttribute?t.data.array:t.array;i instanceof Int8Array?n=127:i instanceof Uint8Array?n=255:i instanceof Uint16Array?n=65535:i instanceof Int16Array?n=32767:i instanceof Int32Array?n=2147483647:console.error("THREE.WebGLMorphtargets: Unsupported morph attribute data type: ",i),e.divideScalar(n)}function Wn(e,t,n){const i={},r=new Float32Array(8),s=new WeakMap,o=new j,a=[];for(let e=0;e<8;e++)a[e]=[e,0];return{update:function(c,l,u,h){const d=c.morphTargetInfluences;if(!0===t.isWebGL2){const i=l.morphAttributes.position||l.morphAttributes.normal||l.morphAttributes.color,r=void 0!==i?i.length:0;let a=s.get(l);if(void 0===a||a.count!==r){void 0!==a&&a.texture.dispose();const e=void 0!==l.morphAttributes.position,n=void 0!==l.morphAttributes.normal,i=void 0!==l.morphAttributes.color,c=l.morphAttributes.position||[],u=l.morphAttributes.normal||[],h=l.morphAttributes.color||[];let d=0;!0===e&&(d=1),!0===n&&(d=2),!0===i&&(d=3);let p=l.attributes.position.count*d,f=1;p>t.maxTextureSize&&(f=Math.ceil(p/t.maxTextureSize),p=t.maxTextureSize);const m=new Float32Array(p*f*4*r),g=new X(m,p,f,r);g.type=1015,g.needsUpdate=!0;const v=4*d;for(let t=0;t<r;t++){const r=c[t],s=u[t],a=h[t],l=p*f*4*t;for(let t=0;t<r.count;t++){const c=t*v;!0===e&&(o.fromBufferAttribute(r,t),!0===r.normalized&&Gn(o,r),m[l+c+0]=o.x,m[l+c+1]=o.y,m[l+c+2]=o.z,m[l+c+3]=0),!0===n&&(o.fromBufferAttribute(s,t),!0===s.normalized&&Gn(o,s),m[l+c+4]=o.x,m[l+c+5]=o.y,m[l+c+6]=o.z,m[l+c+7]=0),!0===i&&(o.fromBufferAttribute(a,t),!0===a.normalized&&Gn(o,a),m[l+c+8]=o.x,m[l+c+9]=o.y,m[l+c+10]=o.z,m[l+c+11]=4===a.itemSize?o.w:1)}}a={count:r,texture:g,size:new _(p,f)},s.set(l,a),l.addEventListener("dispose",(function e(){g.dispose(),s.delete(l),l.removeEventListener("dispose",e)}))}let c=0;for(let e=0;e<d.length;e++)c+=d[e];const u=l.morphTargetsRelative?1:1-c;h.getUniforms().setValue(e,"morphTargetBaseInfluence",u),h.getUniforms().setValue(e,"morphTargetInfluences",d),h.getUniforms().setValue(e,"morphTargetsTexture",a.texture,n),h.getUniforms().setValue(e,"morphTargetsTextureSize",a.size)}else{const t=void 0===d?0:d.length;let n=i[l.id];if(void 0===n||n.length!==t){n=[];for(let e=0;e<t;e++)n[e]=[e,0];i[l.id]=n}for(let e=0;e<t;e++){const t=n[e];t[0]=e,t[1]=d[e]}n.sort(Vn);for(let e=0;e<8;e++)e<t&&n[e][1]?(a[e][0]=n[e][0],a[e][1]=n[e][1]):(a[e][0]=Number.MAX_SAFE_INTEGER,a[e][1]=0);a.sort(Hn);const s=l.morphAttributes.position,o=l.morphAttributes.normal;let c=0;for(let e=0;e<8;e++){const t=a[e],n=t[0],i=t[1];n!==Number.MAX_SAFE_INTEGER&&i?(s&&l.getAttribute("morphTarget"+e)!==s[n]&&l.setAttribute("morphTarget"+e,s[n]),o&&l.getAttribute("morphNormal"+e)!==o[n]&&l.setAttribute("morphNormal"+e,o[n]),r[e]=i,c+=i):(s&&!0===l.hasAttribute("morphTarget"+e)&&l.deleteAttribute("morphTarget"+e),o&&!0===l.hasAttribute("morphNormal"+e)&&l.deleteAttribute("morphNormal"+e),r[e]=0)}const u=l.morphTargetsRelative?1:1-c;h.getUniforms().setValue(e,"morphTargetBaseInfluence",u),h.getUniforms().setValue(e,"morphTargetInfluences",r)}}}}function jn(e,t,n,i){let r=new WeakMap;function s(e){const t=e.target;t.removeEventListener("dispose",s),n.remove(t.instanceMatrix),null!==t.instanceColor&&n.remove(t.instanceColor)}return{update:function(e){const o=i.render.frame,a=e.geometry,c=t.get(e,a);return r.get(c)!==o&&(t.update(c),r.set(c,o)),e.isInstancedMesh&&(!1===e.hasEventListener("dispose",s)&&e.addEventListener("dispose",s),n.update(e.instanceMatrix,34962),null!==e.instanceColor&&n.update(e.instanceColor,34962)),c},dispose:function(){r=new WeakMap}}}const Jn=new W,Xn=new X,qn=new q,Zn=new en,Yn=[],Kn=[],Qn=new Float32Array(16),$n=new Float32Array(9),ei=new Float32Array(4);function ti(e,t,n){const i=e[0];if(i<=0||i>0)return e;const r=t*n;let s=Yn[r];if(void 0===s&&(s=new Float32Array(r),Yn[r]=s),0!==t){i.toArray(s,0);for(let i=1,r=0;i!==t;++i)r+=n,e[i].toArray(s,r)}return s}function ni(e,t){if(e.length!==t.length)return!1;for(let n=0,i=e.length;n<i;n++)if(e[n]!==t[n])return!1;return!0}function ii(e,t){for(let n=0,i=t.length;n<i;n++)e[n]=t[n]}function ri(e,t){let n=Kn[t];void 0===n&&(n=new Int32Array(t),Kn[t]=n);for(let i=0;i!==t;++i)n[i]=e.allocateTextureUnit();return n}function si(e,t){const n=this.cache;n[0]!==t&&(e.uniform1f(this.addr,t),n[0]=t)}function oi(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(ni(n,t))return;e.uniform2fv(this.addr,t),ii(n,t)}}function ai(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else if(void 0!==t.r)n[0]===t.r&&n[1]===t.g&&n[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b);else{if(ni(n,t))return;e.uniform3fv(this.addr,t),ii(n,t)}}function ci(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(ni(n,t))return;e.uniform4fv(this.addr,t),ii(n,t)}}function li(e,t){const n=this.cache,i=t.elements;if(void 0===i){if(ni(n,t))return;e.uniformMatrix2fv(this.addr,!1,t),ii(n,t)}else{if(ni(n,i))return;ei.set(i),e.uniformMatrix2fv(this.addr,!1,ei),ii(n,i)}}function ui(e,t){const n=this.cache,i=t.elements;if(void 0===i){if(ni(n,t))return;e.uniformMatrix3fv(this.addr,!1,t),ii(n,t)}else{if(ni(n,i))return;$n.set(i),e.uniformMatrix3fv(this.addr,!1,$n),ii(n,i)}}function hi(e,t){const n=this.cache,i=t.elements;if(void 0===i){if(ni(n,t))return;e.uniformMatrix4fv(this.addr,!1,t),ii(n,t)}else{if(ni(n,i))return;Qn.set(i),e.uniformMatrix4fv(this.addr,!1,Qn),ii(n,i)}}function di(e,t){const n=this.cache;n[0]!==t&&(e.uniform1i(this.addr,t),n[0]=t)}function pi(e,t){const n=this.cache;ni(n,t)||(e.uniform2iv(this.addr,t),ii(n,t))}function fi(e,t){const n=this.cache;ni(n,t)||(e.uniform3iv(this.addr,t),ii(n,t))}function mi(e,t){const n=this.cache;ni(n,t)||(e.uniform4iv(this.addr,t),ii(n,t))}function gi(e,t){const n=this.cache;n[0]!==t&&(e.uniform1ui(this.addr,t),n[0]=t)}function vi(e,t){const n=this.cache;ni(n,t)||(e.uniform2uiv(this.addr,t),ii(n,t))}function yi(e,t){const n=this.cache;ni(n,t)||(e.uniform3uiv(this.addr,t),ii(n,t))}function xi(e,t){const n=this.cache;ni(n,t)||(e.uniform4uiv(this.addr,t),ii(n,t))}function wi(e,t,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTexture2D(t||Jn,r)}function bi(e,t,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTexture3D(t||qn,r)}function Ai(e,t,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTextureCube(t||Zn,r)}function Si(e,t,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTexture2DArray(t||Xn,r)}function _i(e,t){e.uniform1fv(this.addr,t)}function Mi(e,t){const n=ti(t,this.size,2);e.uniform2fv(this.addr,n)}function Ti(e,t){const n=ti(t,this.size,3);e.uniform3fv(this.addr,n)}function Ei(e,t){const n=ti(t,this.size,4);e.uniform4fv(this.addr,n)}function Ci(e,t){const n=ti(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,n)}function Ri(e,t){const n=ti(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,n)}function Pi(e,t){const n=ti(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,n)}function Li(e,t){e.uniform1iv(this.addr,t)}function Di(e,t){e.uniform2iv(this.addr,t)}function Ii(e,t){e.uniform3iv(this.addr,t)}function ki(e,t){e.uniform4iv(this.addr,t)}function Oi(e,t){e.uniform1uiv(this.addr,t)}function Bi(e,t){e.uniform2uiv(this.addr,t)}function Ni(e,t){e.uniform3uiv(this.addr,t)}function zi(e,t){e.uniform4uiv(this.addr,t)}function Fi(e,t,n){const i=t.length,r=ri(n,i);e.uniform1iv(this.addr,r);for(let e=0;e!==i;++e)n.setTexture2D(t[e]||Jn,r[e])}function Ui(e,t,n){const i=t.length,r=ri(n,i);e.uniform1iv(this.addr,r);for(let e=0;e!==i;++e)n.setTexture3D(t[e]||qn,r[e])}function Hi(e,t,n){const i=t.length,r=ri(n,i);e.uniform1iv(this.addr,r);for(let e=0;e!==i;++e)n.setTextureCube(t[e]||Zn,r[e])}function Vi(e,t,n){const i=t.length,r=ri(n,i);e.uniform1iv(this.addr,r);for(let e=0;e!==i;++e)n.setTexture2DArray(t[e]||Xn,r[e])}class Gi{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.setValue=function(e){switch(e){case 5126:return si;case 35664:return oi;case 35665:return ai;case 35666:return ci;case 35674:return li;case 35675:return ui;case 35676:return hi;case 5124:case 35670:return di;case 35667:case 35671:return pi;case 35668:case 35672:return fi;case 35669:case 35673:return mi;case 5125:return gi;case 36294:return vi;case 36295:return yi;case 36296:return xi;case 35678:case 36198:case 36298:case 36306:case 35682:return wi;case 35679:case 36299:case 36307:return bi;case 35680:case 36300:case 36308:case 36293:return Ai;case 36289:case 36303:case 36311:case 36292:return Si}}(t.type)}}class Wi{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.size=t.size,this.setValue=function(e){switch(e){case 5126:return _i;case 35664:return Mi;case 35665:return Ti;case 35666:return Ei;case 35674:return Ci;case 35675:return Ri;case 35676:return Pi;case 5124:case 35670:return Li;case 35667:case 35671:return Di;case 35668:case 35672:return Ii;case 35669:case 35673:return ki;case 5125:return Oi;case 36294:return Bi;case 36295:return Ni;case 36296:return zi;case 35678:case 36198:case 36298:case 36306:case 35682:return Fi;case 35679:case 36299:case 36307:return Ui;case 35680:case 36300:case 36308:case 36293:return Hi;case 36289:case 36303:case 36311:case 36292:return Vi}}(t.type)}}class ji{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,n){const i=this.seq;for(let r=0,s=i.length;r!==s;++r){const s=i[r];s.setValue(e,t[s.id],n)}}}const Ji=/(\w+)(\])?(\[|\.)?/g;function Xi(e,t){e.seq.push(t),e.map[t.id]=t}function qi(e,t,n){const i=e.name,r=i.length;for(Ji.lastIndex=0;;){const s=Ji.exec(i),o=Ji.lastIndex;let a=s[1];const c="]"===s[2],l=s[3];if(c&&(a|=0),void 0===l||"["===l&&o+2===r){Xi(n,void 0===l?new Gi(a,e,t):new Wi(a,e,t));break}{let e=n.map[a];void 0===e&&(e=new ji(a),Xi(n,e)),n=e}}}class Zi{constructor(e,t){this.seq=[],this.map={};const n=e.getProgramParameter(t,35718);for(let i=0;i<n;++i){const n=e.getActiveUniform(t,i);qi(n,e.getUniformLocation(t,n.name),this)}}setValue(e,t,n,i){const r=this.map[t];void 0!==r&&r.setValue(e,n,i)}setOptional(e,t,n){const i=t[n];void 0!==i&&this.setValue(e,n,i)}static upload(e,t,n,i){for(let r=0,s=t.length;r!==s;++r){const s=t[r],o=n[s.id];!1!==o.needsUpdate&&s.setValue(e,o.value,i)}}static seqWithValue(e,t){const n=[];for(let i=0,r=e.length;i!==r;++i){const r=e[i];r.id in t&&n.push(r)}return n}}function Yi(e,t,n){const i=e.createShader(t);return e.shaderSource(i,n),e.compileShader(i),i}let Ki=0;function Qi(e,t,n){const i=e.getShaderParameter(t,35713),r=e.getShaderInfoLog(t).trim();if(i&&""===r)return"";const s=/ERROR: 0:(\d+)/.exec(r);if(s){const i=parseInt(s[1]);return n.toUpperCase()+"\n\n"+r+"\n\n"+function(e,t){const n=e.split("\n"),i=[],r=Math.max(t-6,0),s=Math.min(t+6,n.length);for(let e=r;e<s;e++){const r=e+1;i.push(`${r===t?">":" "} ${r}: ${n[e]}`)}return i.join("\n")}(e.getShaderSource(t),i)}return r}function $i(e,t){const n=function(e){switch(e){case 3e3:return["Linear","( value )"];case 3001:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",e),["Linear","( value )"]}}(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+n[0]+n[1]+"; }"}function er(e,t){let n;switch(t){case 1:n="Linear";break;case 2:n="Reinhard";break;case 3:n="OptimizedCineon";break;case 4:n="ACESFilmic";break;case 5:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),n="Linear"}return"vec3 "+e+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function tr(e){return""!==e}function nr(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function ir(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const rr=/^[ \t]*#include +<([\w\d./]+)>/gm;function sr(e){return e.replace(rr,or)}function or(e,t){const n=pn[t];if(void 0===n)throw new Error("Can not resolve #include <"+t+">");return sr(n)}const ar=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,cr=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function lr(e){return e.replace(cr,hr).replace(ar,ur)}function ur(e,t,n,i){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),hr(e,t,n,i)}function hr(e,t,n,i){let r="";for(let e=parseInt(t);e<parseInt(n);e++)r+=i.replace(/\[\s*i\s*\]/g,"[ "+e+" ]").replace(/UNROLLED_LOOP_INDEX/g,e);return r}function dr(e){let t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function pr(e,t,n,i){const r=e.getContext(),s=n.defines;let o=n.vertexShader,a=n.fragmentShader;const c=function(e){let t="SHADOWMAP_TYPE_BASIC";return 1===e.shadowMapType?t="SHADOWMAP_TYPE_PCF":2===e.shadowMapType?t="SHADOWMAP_TYPE_PCF_SOFT":3===e.shadowMapType&&(t="SHADOWMAP_TYPE_VSM"),t}(n),l=function(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case 301:case 302:t="ENVMAP_TYPE_CUBE";break;case 306:t="ENVMAP_TYPE_CUBE_UV"}return t}(n),u=function(e){let t="ENVMAP_MODE_REFLECTION";if(e.envMap)switch(e.envMapMode){case 302:t="ENVMAP_MODE_REFRACTION"}return t}(n),h=function(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case 0:t="ENVMAP_BLENDING_MULTIPLY";break;case 1:t="ENVMAP_BLENDING_MIX";break;case 2:t="ENVMAP_BLENDING_ADD"}return t}(n),d=function(e){const t=e.envMapCubeUVHeight;if(null===t)return null;const n=Math.log2(t)-2,i=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,n),112)),texelHeight:i,maxMip:n}}(n),p=n.isWebGL2?"":function(e){return[e.extensionDerivatives||e.envMapCubeUVHeight||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading||"physical"===e.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap||e.transmission)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(tr).join("\n")}(n),f=function(e){const t=[];for(const n in e){const i=e[n];!1!==i&&t.push("#define "+n+" "+i)}return t.join("\n")}(s),m=r.createProgram();let g,v,y=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?(g=[f].filter(tr).join("\n"),g.length>0&&(g+="\n"),v=[p,f].filter(tr).join("\n"),v.length>0&&(v+="\n")):(g=[dr(n),"#define SHADER_NAME "+n.shaderName,f,n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.supportsVertexTextures?"#define VERTEX_TEXTURES":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+u:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.displacementMap&&n.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",n.specularColorMap?"#define USE_SPECULARCOLORMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEENCOLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.morphColors&&n.isWebGL2?"#define USE_MORPHCOLORS":"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+n.morphTextureStride:"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+c:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(tr).join("\n"),v=[p,dr(n),"#define SHADER_NAME "+n.shaderName,f,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+l:"",n.envMap?"#define "+u:"",n.envMap?"#define "+h:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescence?"#define USE_IRIDESCENCE":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",n.specularColorMap?"#define USE_SPECULARCOLORMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEENCOLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+c:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==n.toneMapping?"#define TONE_MAPPING":"",0!==n.toneMapping?pn.tonemapping_pars_fragment:"",0!==n.toneMapping?er("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.opaque?"#define OPAQUE":"",pn.encodings_pars_fragment,$i("linearToOutputTexel",n.outputEncoding),n.useDepthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(tr).join("\n")),o=sr(o),o=nr(o,n),o=ir(o,n),a=sr(a),a=nr(a,n),a=ir(a,n),o=lr(o),a=lr(a),n.isWebGL2&&!0!==n.isRawShaderMaterial&&(y="#version 300 es\n",g=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+g,v=["#define varying in","300 es"===n.glslVersion?"":"layout(location = 0) out highp vec4 pc_fragColor;","300 es"===n.glslVersion?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+v);const x=y+v+a,w=Yi(r,35633,y+g+o),b=Yi(r,35632,x);if(r.attachShader(m,w),r.attachShader(m,b),void 0!==n.index0AttributeName?r.bindAttribLocation(m,0,n.index0AttributeName):!0===n.morphTargets&&r.bindAttribLocation(m,0,"position"),r.linkProgram(m),e.debug.checkShaderErrors){const e=r.getProgramInfoLog(m).trim(),t=r.getShaderInfoLog(w).trim(),n=r.getShaderInfoLog(b).trim();let i=!0,s=!0;if(!1===r.getProgramParameter(m,35714)){i=!1;const t=Qi(r,w,"vertex"),n=Qi(r,b,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(m,35715)+"\n\nProgram Info Log: "+e+"\n"+t+"\n"+n)}else""!==e?console.warn("THREE.WebGLProgram: Program Info Log:",e):""!==t&&""!==n||(s=!1);s&&(this.diagnostics={runnable:i,programLog:e,vertexShader:{log:t,prefix:g},fragmentShader:{log:n,prefix:v}})}let A,S;return r.deleteShader(w),r.deleteShader(b),this.getUniforms=function(){return void 0===A&&(A=new Zi(r,m)),A},this.getAttributes=function(){return void 0===S&&(S=function(e,t){const n={},i=e.getProgramParameter(t,35721);for(let r=0;r<i;r++){const i=e.getActiveAttrib(t,r),s=i.name;let o=1;35674===i.type&&(o=2),35675===i.type&&(o=3),35676===i.type&&(o=4),n[s]={type:i.type,location:e.getAttribLocation(t,s),locationSize:o}}return n}(r,m)),S},this.destroy=function(){i.releaseStatesOfProgram(this),r.deleteProgram(m),this.program=void 0},this.name=n.shaderName,this.id=Ki++,this.cacheKey=t,this.usedTimes=1,this.program=m,this.vertexShader=w,this.fragmentShader=b,this}let fr=0;class mr{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,n=e.fragmentShader,i=this._getShaderStage(t),r=this._getShaderStage(n),s=this._getShaderCacheForMaterial(e);return!1===s.has(i)&&(s.add(i),i.usedTimes++),!1===s.has(r)&&(s.add(r),r.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const e of t)e.usedTimes--,0===e.usedTimes&&this.shaderCache.delete(e.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;return!1===t.has(e)&&t.set(e,new Set),t.get(e)}_getShaderStage(e){const t=this.shaderCache;if(!1===t.has(e)){const n=new gr(e);t.set(e,n)}return t.get(e)}}class gr{constructor(e){this.id=fr++,this.code=e,this.usedTimes=0}}function vr(e,t,n,i,r,s,o){const a=new ze,c=new mr,l=[],u=r.isWebGL2,h=r.logarithmicDepthBuffer,d=r.vertexTextures;let p=r.precision;const f={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};return{getParameters:function(s,a,l,m,g){const v=m.fog,y=g.geometry,x=s.isMeshStandardMaterial?m.environment:null,w=(s.isMeshStandardMaterial?n:t).get(s.envMap||x),b=w&&306===w.mapping?w.image.height:null,A=f[s.type];null!==s.precision&&(p=r.getMaxPrecision(s.precision),p!==s.precision&&console.warn("THREE.WebGLProgram.getParameters:",s.precision,"not supported, using",p,"instead."));const S=y.morphAttributes.position||y.morphAttributes.normal||y.morphAttributes.color,_=void 0!==S?S.length:0;let M,T,E,C,R=0;if(void 0!==y.morphAttributes.position&&(R=1),void 0!==y.morphAttributes.normal&&(R=2),void 0!==y.morphAttributes.color&&(R=3),A){const e=mn[A];M=e.vertexShader,T=e.fragmentShader}else M=s.vertexShader,T=s.fragmentShader,c.update(s),E=c.getVertexShaderID(s),C=c.getFragmentShaderID(s);const P=e.getRenderTarget(),L=s.alphaTest>0,D=s.clearcoat>0,I=s.iridescence>0;return{isWebGL2:u,shaderID:A,shaderName:s.type,vertexShader:M,fragmentShader:T,defines:s.defines,customVertexShaderID:E,customFragmentShaderID:C,isRawShaderMaterial:!0===s.isRawShaderMaterial,glslVersion:s.glslVersion,precision:p,instancing:!0===g.isInstancedMesh,instancingColor:!0===g.isInstancedMesh&&null!==g.instanceColor,supportsVertexTextures:d,outputEncoding:null===P?e.outputEncoding:!0===P.isXRRenderTarget?P.texture.encoding:3e3,map:!!s.map,matcap:!!s.matcap,envMap:!!w,envMapMode:w&&w.mapping,envMapCubeUVHeight:b,lightMap:!!s.lightMap,aoMap:!!s.aoMap,emissiveMap:!!s.emissiveMap,bumpMap:!!s.bumpMap,normalMap:!!s.normalMap,objectSpaceNormalMap:1===s.normalMapType,tangentSpaceNormalMap:0===s.normalMapType,decodeVideoTexture:!!s.map&&!0===s.map.isVideoTexture&&3001===s.map.encoding,clearcoat:D,clearcoatMap:D&&!!s.clearcoatMap,clearcoatRoughnessMap:D&&!!s.clearcoatRoughnessMap,clearcoatNormalMap:D&&!!s.clearcoatNormalMap,iridescence:I,iridescenceMap:I&&!!s.iridescenceMap,iridescenceThicknessMap:I&&!!s.iridescenceThicknessMap,displacementMap:!!s.displacementMap,roughnessMap:!!s.roughnessMap,metalnessMap:!!s.metalnessMap,specularMap:!!s.specularMap,specularIntensityMap:!!s.specularIntensityMap,specularColorMap:!!s.specularColorMap,opaque:!1===s.transparent&&1===s.blending,alphaMap:!!s.alphaMap,alphaTest:L,gradientMap:!!s.gradientMap,sheen:s.sheen>0,sheenColorMap:!!s.sheenColorMap,sheenRoughnessMap:!!s.sheenRoughnessMap,transmission:s.transmission>0,transmissionMap:!!s.transmissionMap,thicknessMap:!!s.thicknessMap,combine:s.combine,vertexTangents:!!s.normalMap&&!!y.attributes.tangent,vertexColors:s.vertexColors,vertexAlphas:!0===s.vertexColors&&!!y.attributes.color&&4===y.attributes.color.itemSize,vertexUvs:!!(s.map||s.bumpMap||s.normalMap||s.specularMap||s.alphaMap||s.emissiveMap||s.roughnessMap||s.metalnessMap||s.clearcoatMap||s.clearcoatRoughnessMap||s.clearcoatNormalMap||s.iridescenceMap||s.iridescenceThicknessMap||s.displacementMap||s.transmissionMap||s.thicknessMap||s.specularIntensityMap||s.specularColorMap||s.sheenColorMap||s.sheenRoughnessMap),uvsVertexOnly:!(s.map||s.bumpMap||s.normalMap||s.specularMap||s.alphaMap||s.emissiveMap||s.roughnessMap||s.metalnessMap||s.clearcoatNormalMap||s.iridescenceMap||s.iridescenceThicknessMap||s.transmission>0||s.transmissionMap||s.thicknessMap||s.specularIntensityMap||s.specularColorMap||s.sheen>0||s.sheenColorMap||s.sheenRoughnessMap||!s.displacementMap),fog:!!v,useFog:!0===s.fog,fogExp2:v&&v.isFogExp2,flatShading:!!s.flatShading,sizeAttenuation:s.sizeAttenuation,logarithmicDepthBuffer:h,skinning:!0===g.isSkinnedMesh,morphTargets:void 0!==y.morphAttributes.position,morphNormals:void 0!==y.morphAttributes.normal,morphColors:void 0!==y.morphAttributes.color,morphTargetsCount:_,morphTextureStride:R,numDirLights:a.directional.length,numPointLights:a.point.length,numSpotLights:a.spot.length,numRectAreaLights:a.rectArea.length,numHemiLights:a.hemi.length,numDirLightShadows:a.directionalShadowMap.length,numPointLightShadows:a.pointShadowMap.length,numSpotLightShadows:a.spotShadowMap.length,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:s.dithering,shadowMapEnabled:e.shadowMap.enabled&&l.length>0,shadowMapType:e.shadowMap.type,toneMapping:s.toneMapped?e.toneMapping:0,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:s.premultipliedAlpha,doubleSided:2===s.side,flipSided:1===s.side,useDepthPacking:!!s.depthPacking,depthPacking:s.depthPacking||0,index0AttributeName:s.index0AttributeName,extensionDerivatives:s.extensions&&s.extensions.derivatives,extensionFragDepth:s.extensions&&s.extensions.fragDepth,extensionDrawBuffers:s.extensions&&s.extensions.drawBuffers,extensionShaderTextureLOD:s.extensions&&s.extensions.shaderTextureLOD,rendererExtensionFragDepth:u||i.has("EXT_frag_depth"),rendererExtensionDrawBuffers:u||i.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:u||i.has("EXT_shader_texture_lod"),customProgramCacheKey:s.customProgramCacheKey()}},getProgramCacheKey:function(t){const n=[];if(t.shaderID?n.push(t.shaderID):(n.push(t.customVertexShaderID),n.push(t.customFragmentShaderID)),void 0!==t.defines)for(const e in t.defines)n.push(e),n.push(t.defines[e]);return!1===t.isRawShaderMaterial&&(!function(e,t){e.push(t.precision),e.push(t.outputEncoding),e.push(t.envMapMode),e.push(t.envMapCubeUVHeight),e.push(t.combine),e.push(t.vertexUvs),e.push(t.fogExp2),e.push(t.sizeAttenuation),e.push(t.morphTargetsCount),e.push(t.morphAttributeCount),e.push(t.numDirLights),e.push(t.numPointLights),e.push(t.numSpotLights),e.push(t.numHemiLights),e.push(t.numRectAreaLights),e.push(t.numDirLightShadows),e.push(t.numPointLightShadows),e.push(t.numSpotLightShadows),e.push(t.shadowMapType),e.push(t.toneMapping),e.push(t.numClippingPlanes),e.push(t.numClipIntersection),e.push(t.depthPacking)}(n,t),function(e,t){a.disableAll(),t.isWebGL2&&a.enable(0);t.supportsVertexTextures&&a.enable(1);t.instancing&&a.enable(2);t.instancingColor&&a.enable(3);t.map&&a.enable(4);t.matcap&&a.enable(5);t.envMap&&a.enable(6);t.lightMap&&a.enable(7);t.aoMap&&a.enable(8);t.emissiveMap&&a.enable(9);t.bumpMap&&a.enable(10);t.normalMap&&a.enable(11);t.objectSpaceNormalMap&&a.enable(12);t.tangentSpaceNormalMap&&a.enable(13);t.clearcoat&&a.enable(14);t.clearcoatMap&&a.enable(15);t.clearcoatRoughnessMap&&a.enable(16);t.clearcoatNormalMap&&a.enable(17);t.iridescence&&a.enable(18);t.iridescenceMap&&a.enable(19);t.iridescenceThicknessMap&&a.enable(20);t.displacementMap&&a.enable(21);t.specularMap&&a.enable(22);t.roughnessMap&&a.enable(23);t.metalnessMap&&a.enable(24);t.gradientMap&&a.enable(25);t.alphaMap&&a.enable(26);t.alphaTest&&a.enable(27);t.vertexColors&&a.enable(28);t.vertexAlphas&&a.enable(29);t.vertexUvs&&a.enable(30);t.vertexTangents&&a.enable(31);t.uvsVertexOnly&&a.enable(32);t.fog&&a.enable(33);e.push(a.mask),a.disableAll(),t.useFog&&a.enable(0);t.flatShading&&a.enable(1);t.logarithmicDepthBuffer&&a.enable(2);t.skinning&&a.enable(3);t.morphTargets&&a.enable(4);t.morphNormals&&a.enable(5);t.morphColors&&a.enable(6);t.premultipliedAlpha&&a.enable(7);t.shadowMapEnabled&&a.enable(8);t.physicallyCorrectLights&&a.enable(9);t.doubleSided&&a.enable(10);t.flipSided&&a.enable(11);t.useDepthPacking&&a.enable(12);t.dithering&&a.enable(13);t.specularIntensityMap&&a.enable(14);t.specularColorMap&&a.enable(15);t.transmission&&a.enable(16);t.transmissionMap&&a.enable(17);t.thicknessMap&&a.enable(18);t.sheen&&a.enable(19);t.sheenColorMap&&a.enable(20);t.sheenRoughnessMap&&a.enable(21);t.decodeVideoTexture&&a.enable(22);t.opaque&&a.enable(23);e.push(a.mask)}(n,t),n.push(e.outputEncoding)),n.push(t.customProgramCacheKey),n.join()},getUniforms:function(e){const t=f[e.type];let n;if(t){const e=mn[t];n=Zt.clone(e.uniforms)}else n=e.uniforms;return n},acquireProgram:function(t,n){let i;for(let e=0,t=l.length;e<t;e++){const t=l[e];if(t.cacheKey===n){i=t,++i.usedTimes;break}}return void 0===i&&(i=new pr(e,n,t,s),l.push(i)),i},releaseProgram:function(e){if(0==--e.usedTimes){const t=l.indexOf(e);l[t]=l[l.length-1],l.pop(),e.destroy()}},releaseShaderCache:function(e){c.remove(e)},programs:l,dispose:function(){c.dispose()}}}function yr(){let e=new WeakMap;return{get:function(t){let n=e.get(t);return void 0===n&&(n={},e.set(t,n)),n},remove:function(t){e.delete(t)},update:function(t,n,i){e.get(t)[n]=i},dispose:function(){e=new WeakMap}}}function xr(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function wr(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function br(){const e=[];let t=0;const n=[],i=[],r=[];function s(n,i,r,s,o,a){let c=e[t];return void 0===c?(c={id:n.id,object:n,geometry:i,material:r,groupOrder:s,renderOrder:n.renderOrder,z:o,group:a},e[t]=c):(c.id=n.id,c.object=n,c.geometry=i,c.material=r,c.groupOrder=s,c.renderOrder=n.renderOrder,c.z=o,c.group=a),t++,c}return{opaque:n,transmissive:i,transparent:r,init:function(){t=0,n.length=0,i.length=0,r.length=0},push:function(e,t,o,a,c,l){const u=s(e,t,o,a,c,l);o.transmission>0?i.push(u):!0===o.transparent?r.push(u):n.push(u)},unshift:function(e,t,o,a,c,l){const u=s(e,t,o,a,c,l);o.transmission>0?i.unshift(u):!0===o.transparent?r.unshift(u):n.unshift(u)},finish:function(){for(let n=t,i=e.length;n<i;n++){const t=e[n];if(null===t.id)break;t.id=null,t.object=null,t.geometry=null,t.material=null,t.group=null}},sort:function(e,t){n.length>1&&n.sort(e||xr),i.length>1&&i.sort(t||wr),r.length>1&&r.sort(t||wr)}}}function Ar(){let e=new WeakMap;return{get:function(t,n){let i;return!1===e.has(t)?(i=new br,e.set(t,[i])):n>=e.get(t).length?(i=new br,e.get(t).push(i)):i=e.get(t)[n],i},dispose:function(){e=new WeakMap}}}function Sr(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":n={direction:new Y,color:new z};break;case"SpotLight":n={position:new Y,direction:new Y,color:new z,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new Y,color:new z,distance:0,decay:0};break;case"HemisphereLight":n={direction:new Y,skyColor:new z,groundColor:new z};break;case"RectAreaLight":n={color:new z,position:new Y,halfWidth:new Y,halfHeight:new Y}}return e[t.id]=n,n}}}let _r=0;function Mr(e,t){return(t.castShadow?1:0)-(e.castShadow?1:0)}function Tr(e,t){const n=new Sr,i=function(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":case"SpotLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new _};break;case"PointLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new _,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=n,n}}}(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let e=0;e<9;e++)r.probe.push(new Y);const s=new Y,o=new Ee,a=new Ee;return{setup:function(s,o){let a=0,c=0,l=0;for(let e=0;e<9;e++)r.probe[e].set(0,0,0);let u=0,h=0,d=0,p=0,f=0,m=0,g=0,v=0;s.sort(Mr);const y=!0!==o?Math.PI:1;for(let e=0,t=s.length;e<t;e++){const t=s[e],o=t.color,x=t.intensity,w=t.distance,b=t.shadow&&t.shadow.map?t.shadow.map.texture:null;if(t.isAmbientLight)a+=o.r*x*y,c+=o.g*x*y,l+=o.b*x*y;else if(t.isLightProbe)for(let e=0;e<9;e++)r.probe[e].addScaledVector(t.sh.coefficients[e],x);else if(t.isDirectionalLight){const e=n.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity*y),t.castShadow){const e=t.shadow,n=i.get(t);n.shadowBias=e.bias,n.shadowNormalBias=e.normalBias,n.shadowRadius=e.radius,n.shadowMapSize=e.mapSize,r.directionalShadow[u]=n,r.directionalShadowMap[u]=b,r.directionalShadowMatrix[u]=t.shadow.matrix,m++}r.directional[u]=e,u++}else if(t.isSpotLight){const e=n.get(t);if(e.position.setFromMatrixPosition(t.matrixWorld),e.color.copy(o).multiplyScalar(x*y),e.distance=w,e.coneCos=Math.cos(t.angle),e.penumbraCos=Math.cos(t.angle*(1-t.penumbra)),e.decay=t.decay,t.castShadow){const e=t.shadow,n=i.get(t);n.shadowBias=e.bias,n.shadowNormalBias=e.normalBias,n.shadowRadius=e.radius,n.shadowMapSize=e.mapSize,r.spotShadow[d]=n,r.spotShadowMap[d]=b,r.spotShadowMatrix[d]=t.shadow.matrix,v++}r.spot[d]=e,d++}else if(t.isRectAreaLight){const e=n.get(t);e.color.copy(o).multiplyScalar(x),e.halfWidth.set(.5*t.width,0,0),e.halfHeight.set(0,.5*t.height,0),r.rectArea[p]=e,p++}else if(t.isPointLight){const e=n.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity*y),e.distance=t.distance,e.decay=t.decay,t.castShadow){const e=t.shadow,n=i.get(t);n.shadowBias=e.bias,n.shadowNormalBias=e.normalBias,n.shadowRadius=e.radius,n.shadowMapSize=e.mapSize,n.shadowCameraNear=e.camera.near,n.shadowCameraFar=e.camera.far,r.pointShadow[h]=n,r.pointShadowMap[h]=b,r.pointShadowMatrix[h]=t.shadow.matrix,g++}r.point[h]=e,h++}else if(t.isHemisphereLight){const e=n.get(t);e.skyColor.copy(t.color).multiplyScalar(x*y),e.groundColor.copy(t.groundColor).multiplyScalar(x*y),r.hemi[f]=e,f++}}p>0&&(t.isWebGL2||!0===e.has("OES_texture_float_linear")?(r.rectAreaLTC1=fn.LTC_FLOAT_1,r.rectAreaLTC2=fn.LTC_FLOAT_2):!0===e.has("OES_texture_half_float_linear")?(r.rectAreaLTC1=fn.LTC_HALF_1,r.rectAreaLTC2=fn.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),r.ambient[0]=a,r.ambient[1]=c,r.ambient[2]=l;const x=r.hash;x.directionalLength===u&&x.pointLength===h&&x.spotLength===d&&x.rectAreaLength===p&&x.hemiLength===f&&x.numDirectionalShadows===m&&x.numPointShadows===g&&x.numSpotShadows===v||(r.directional.length=u,r.spot.length=d,r.rectArea.length=p,r.point.length=h,r.hemi.length=f,r.directionalShadow.length=m,r.directionalShadowMap.length=m,r.pointShadow.length=g,r.pointShadowMap.length=g,r.spotShadow.length=v,r.spotShadowMap.length=v,r.directionalShadowMatrix.length=m,r.pointShadowMatrix.length=g,r.spotShadowMatrix.length=v,x.directionalLength=u,x.pointLength=h,x.spotLength=d,x.rectAreaLength=p,x.hemiLength=f,x.numDirectionalShadows=m,x.numPointShadows=g,x.numSpotShadows=v,r.version=_r++)},setupView:function(e,t){let n=0,i=0,c=0,l=0,u=0;const h=t.matrixWorldInverse;for(let t=0,d=e.length;t<d;t++){const d=e[t];if(d.isDirectionalLight){const e=r.directional[n];e.direction.setFromMatrixPosition(d.matrixWorld),s.setFromMatrixPosition(d.target.matrixWorld),e.direction.sub(s),e.direction.transformDirection(h),n++}else if(d.isSpotLight){const e=r.spot[c];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(h),e.direction.setFromMatrixPosition(d.matrixWorld),s.setFromMatrixPosition(d.target.matrixWorld),e.direction.sub(s),e.direction.transformDirection(h),c++}else if(d.isRectAreaLight){const e=r.rectArea[l];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(h),a.identity(),o.copy(d.matrixWorld),o.premultiply(h),a.extractRotation(o),e.halfWidth.set(.5*d.width,0,0),e.halfHeight.set(0,.5*d.height,0),e.halfWidth.applyMatrix4(a),e.halfHeight.applyMatrix4(a),l++}else if(d.isPointLight){const e=r.point[i];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(h),i++}else if(d.isHemisphereLight){const e=r.hemi[u];e.direction.setFromMatrixPosition(d.matrixWorld),e.direction.transformDirection(h),u++}}},state:r}}function Er(e,t){const n=new Tr(e,t),i=[],r=[];return{init:function(){i.length=0,r.length=0},state:{lightsArray:i,shadowsArray:r,lights:n},setupLights:function(e){n.setup(i,e)},setupLightsView:function(e){n.setupView(i,e)},pushLight:function(e){i.push(e)},pushShadow:function(e){r.push(e)}}}function Cr(e,t){let n=new WeakMap;return{get:function(i,r=0){let s;return!1===n.has(i)?(s=new Er(e,t),n.set(i,[s])):r>=n.get(i).length?(s=new Er(e,t),n.get(i).push(s)):s=n.get(i)[r],s},dispose:function(){n=new WeakMap}}}class Rr extends ht{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class Pr extends ht{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.referencePosition=new Y,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}function Lr(e,t,n){let i=new ln;const r=new _,s=new _,o=new j,a=new Rr({depthPacking:3201}),c=new Pr,l={},u=n.maxTextureSize,h={0:1,1:0,2:2},d=new Yt({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new _},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),p=d.clone();p.defines.HORIZONTAL_PASS=1;const f=new Tt;f.setAttribute("position",new mt(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const m=new Wt(f,d),g=this;function v(n,i){const s=t.update(m);d.defines.VSM_SAMPLES!==n.blurSamples&&(d.defines.VSM_SAMPLES=n.blurSamples,p.defines.VSM_SAMPLES=n.blurSamples,d.needsUpdate=!0,p.needsUpdate=!0),null===n.mapPass&&(n.mapPass=new J(r.x,r.y)),d.uniforms.shadow_pass.value=n.map.texture,d.uniforms.resolution.value=n.mapSize,d.uniforms.radius.value=n.radius,e.setRenderTarget(n.mapPass),e.clear(),e.renderBufferDirect(i,null,s,d,m,null),p.uniforms.shadow_pass.value=n.mapPass.texture,p.uniforms.resolution.value=n.mapSize,p.uniforms.radius.value=n.radius,e.setRenderTarget(n.map),e.clear(),e.renderBufferDirect(i,null,s,p,m,null)}function y(t,n,i,r,s,o){let u=null;const d=!0===i.isPointLight?t.customDistanceMaterial:t.customDepthMaterial;if(u=void 0!==d?d:!0===i.isPointLight?c:a,e.localClippingEnabled&&!0===n.clipShadows&&Array.isArray(n.clippingPlanes)&&0!==n.clippingPlanes.length||n.displacementMap&&0!==n.displacementScale||n.alphaMap&&n.alphaTest>0){const e=u.uuid,t=n.uuid;let i=l[e];void 0===i&&(i={},l[e]=i);let r=i[t];void 0===r&&(r=u.clone(),i[t]=r),u=r}return u.visible=n.visible,u.wireframe=n.wireframe,u.side=3===o?null!==n.shadowSide?n.shadowSide:n.side:null!==n.shadowSide?n.shadowSide:h[n.side],u.alphaMap=n.alphaMap,u.alphaTest=n.alphaTest,u.clipShadows=n.clipShadows,u.clippingPlanes=n.clippingPlanes,u.clipIntersection=n.clipIntersection,u.displacementMap=n.displacementMap,u.displacementScale=n.displacementScale,u.displacementBias=n.displacementBias,u.wireframeLinewidth=n.wireframeLinewidth,u.linewidth=n.linewidth,!0===i.isPointLight&&!0===u.isMeshDistanceMaterial&&(u.referencePosition.setFromMatrixPosition(i.matrixWorld),u.nearDistance=r,u.farDistance=s),u}function x(n,r,s,o,a){if(!1===n.visible)return;if(n.layers.test(r.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&3===a)&&(!n.frustumCulled||i.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(s.matrixWorldInverse,n.matrixWorld);const i=t.update(n),r=n.material;if(Array.isArray(r)){const t=i.groups;for(let c=0,l=t.length;c<l;c++){const l=t[c],u=r[l.materialIndex];if(u&&u.visible){const t=y(n,u,o,s.near,s.far,a);e.renderBufferDirect(s,null,i,t,n,l)}}}else if(r.visible){const t=y(n,r,o,s.near,s.far,a);e.renderBufferDirect(s,null,i,t,n,null)}}const c=n.children;for(let e=0,t=c.length;e<t;e++)x(c[e],r,s,o,a)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1,this.render=function(t,n,a){if(!1===g.enabled)return;if(!1===g.autoUpdate&&!1===g.needsUpdate)return;if(0===t.length)return;const c=e.getRenderTarget(),l=e.getActiveCubeFace(),h=e.getActiveMipmapLevel(),d=e.state;d.setBlending(0),d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);for(let c=0,l=t.length;c<l;c++){const l=t[c],h=l.shadow;if(void 0===h){console.warn("THREE.WebGLShadowMap:",l,"has no shadow.");continue}if(!1===h.autoUpdate&&!1===h.needsUpdate)continue;r.copy(h.mapSize);const p=h.getFrameExtents();if(r.multiply(p),s.copy(h.mapSize),(r.x>u||r.y>u)&&(r.x>u&&(s.x=Math.floor(u/p.x),r.x=s.x*p.x,h.mapSize.x=s.x),r.y>u&&(s.y=Math.floor(u/p.y),r.y=s.y*p.y,h.mapSize.y=s.y)),null===h.map){const e=3!==this.type?{minFilter:1003,magFilter:1003}:{};h.map=new J(r.x,r.y,e),h.map.texture.name=l.name+".shadowMap",h.camera.updateProjectionMatrix()}e.setRenderTarget(h.map),e.clear();const f=h.getViewportCount();for(let e=0;e<f;e++){const t=h.getViewport(e);o.set(s.x*t.x,s.y*t.y,s.x*t.z,s.y*t.w),d.viewport(o),h.updateMatrices(l,e),i=h.getFrustum(),x(n,a,h.camera,l,this.type)}!0!==h.isPointLightShadow&&3===this.type&&v(h,a),h.needsUpdate=!1}g.needsUpdate=!1,e.setRenderTarget(c,l,h)}}function Dr(e,t,n){const i=n.isWebGL2;const r=new function(){let t=!1;const n=new j;let i=null;const r=new j(0,0,0,0);return{setMask:function(n){i===n||t||(e.colorMask(n,n,n,n),i=n)},setLocked:function(e){t=e},setClear:function(t,i,s,o,a){!0===a&&(t*=o,i*=o,s*=o),n.set(t,i,s,o),!1===r.equals(n)&&(e.clearColor(t,i,s,o),r.copy(n))},reset:function(){t=!1,i=null,r.set(-1,0,0,0)}}},s=new function(){let t=!1,n=null,i=null,r=null;return{setTest:function(e){e?z(2929):F(2929)},setMask:function(i){n===i||t||(e.depthMask(i),n=i)},setFunc:function(t){if(i!==t){if(t)switch(t){case 0:e.depthFunc(512);break;case 1:e.depthFunc(519);break;case 2:e.depthFunc(513);break;case 3:e.depthFunc(515);break;case 4:e.depthFunc(514);break;case 5:e.depthFunc(518);break;case 6:e.depthFunc(516);break;case 7:e.depthFunc(517);break;default:e.depthFunc(515)}else e.depthFunc(515);i=t}},setLocked:function(e){t=e},setClear:function(t){r!==t&&(e.clearDepth(t),r=t)},reset:function(){t=!1,n=null,i=null,r=null}}},o=new function(){let t=!1,n=null,i=null,r=null,s=null,o=null,a=null,c=null,l=null;return{setTest:function(e){t||(e?z(2960):F(2960))},setMask:function(i){n===i||t||(e.stencilMask(i),n=i)},setFunc:function(t,n,o){i===t&&r===n&&s===o||(e.stencilFunc(t,n,o),i=t,r=n,s=o)},setOp:function(t,n,i){o===t&&a===n&&c===i||(e.stencilOp(t,n,i),o=t,a=n,c=i)},setLocked:function(e){t=e},setClear:function(t){l!==t&&(e.clearStencil(t),l=t)},reset:function(){t=!1,n=null,i=null,r=null,s=null,o=null,a=null,c=null,l=null}}};let a={},c={},l=new WeakMap,u=[],h=null,d=!1,p=null,f=null,m=null,g=null,v=null,y=null,x=null,w=!1,b=null,A=null,S=null,_=null,M=null;const T=e.getParameter(35661);let E=!1,C=0;const R=e.getParameter(7938);-1!==R.indexOf("WebGL")?(C=parseFloat(/^WebGL (\d)/.exec(R)[1]),E=C>=1):-1!==R.indexOf("OpenGL ES")&&(C=parseFloat(/^OpenGL ES (\d)/.exec(R)[1]),E=C>=2);let P=null,L={};const D=e.getParameter(3088),I=e.getParameter(2978),k=(new j).fromArray(D),O=(new j).fromArray(I);function B(t,n,i){const r=new Uint8Array(4),s=e.createTexture();e.bindTexture(t,s),e.texParameteri(t,10241,9728),e.texParameteri(t,10240,9728);for(let t=0;t<i;t++)e.texImage2D(n+t,0,6408,1,1,0,6408,5121,r);return s}const N={};function z(t){!0!==a[t]&&(e.enable(t),a[t]=!0)}function F(t){!1!==a[t]&&(e.disable(t),a[t]=!1)}N[3553]=B(3553,3553,1),N[34067]=B(34067,34069,6),r.setClear(0,0,0,1),s.setClear(1),o.setClear(0),z(2929),s.setFunc(3),G(!1),W(1),z(2884),V(0);const U={100:32774,101:32778,102:32779};if(i)U[103]=32775,U[104]=32776;else{const e=t.get("EXT_blend_minmax");null!==e&&(U[103]=e.MIN_EXT,U[104]=e.MAX_EXT)}const H={200:0,201:1,202:768,204:770,210:776,208:774,206:772,203:769,205:771,209:775,207:773};function V(t,n,i,r,s,o,a,c){if(0!==t){if(!1===d&&(z(3042),d=!0),5===t)s=s||n,o=o||i,a=a||r,n===f&&s===v||(e.blendEquationSeparate(U[n],U[s]),f=n,v=s),i===m&&r===g&&o===y&&a===x||(e.blendFuncSeparate(H[i],H[r],H[o],H[a]),m=i,g=r,y=o,x=a),p=t,w=null;else if(t!==p||c!==w){if(100===f&&100===v||(e.blendEquation(32774),f=100,v=100),c)switch(t){case 1:e.blendFuncSeparate(1,771,1,771);break;case 2:e.blendFunc(1,1);break;case 3:e.blendFuncSeparate(0,769,0,1);break;case 4:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case 1:e.blendFuncSeparate(770,771,1,771);break;case 2:e.blendFunc(770,1);break;case 3:e.blendFuncSeparate(0,769,0,1);break;case 4:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}m=null,g=null,y=null,x=null,p=t,w=c}}else!0===d&&(F(3042),d=!1)}function G(t){b!==t&&(t?e.frontFace(2304):e.frontFace(2305),b=t)}function W(t){0!==t?(z(2884),t!==A&&(1===t?e.cullFace(1029):2===t?e.cullFace(1028):e.cullFace(1032))):F(2884),A=t}function J(t,n,i){t?(z(32823),_===n&&M===i||(e.polygonOffset(n,i),_=n,M=i)):F(32823)}function X(t){void 0===t&&(t=33984+T-1),P!==t&&(e.activeTexture(t),P=t)}return{buffers:{color:r,depth:s,stencil:o},enable:z,disable:F,bindFramebuffer:function(t,n){return c[t]!==n&&(e.bindFramebuffer(t,n),c[t]=n,i&&(36009===t&&(c[36160]=n),36160===t&&(c[36009]=n)),!0)},drawBuffers:function(i,r){let s=u,o=!1;if(i)if(s=l.get(r),void 0===s&&(s=[],l.set(r,s)),i.isWebGLMultipleRenderTargets){const e=i.texture;if(s.length!==e.length||36064!==s[0]){for(let t=0,n=e.length;t<n;t++)s[t]=36064+t;s.length=e.length,o=!0}}else 36064!==s[0]&&(s[0]=36064,o=!0);else 1029!==s[0]&&(s[0]=1029,o=!0);o&&(n.isWebGL2?e.drawBuffers(s):t.get("WEBGL_draw_buffers").drawBuffersWEBGL(s))},useProgram:function(t){return h!==t&&(e.useProgram(t),h=t,!0)},setBlending:V,setMaterial:function(e,t){2===e.side?F(2884):z(2884);let n=1===e.side;t&&(n=!n),G(n),1===e.blending&&!1===e.transparent?V(0):V(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),s.setFunc(e.depthFunc),s.setTest(e.depthTest),s.setMask(e.depthWrite),r.setMask(e.colorWrite);const i=e.stencilWrite;o.setTest(i),i&&(o.setMask(e.stencilWriteMask),o.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),o.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),J(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),!0===e.alphaToCoverage?z(32926):F(32926)},setFlipSided:G,setCullFace:W,setLineWidth:function(t){t!==S&&(E&&e.lineWidth(t),S=t)},setPolygonOffset:J,setScissorTest:function(e){e?z(3089):F(3089)},activeTexture:X,bindTexture:function(t,n){null===P&&X();let i=L[P];void 0===i&&(i={type:void 0,texture:void 0},L[P]=i),i.type===t&&i.texture===n||(e.bindTexture(t,n||N[t]),i.type=t,i.texture=n)},unbindTexture:function(){const t=L[P];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texStorage2D:function(){try{e.texStorage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texStorage3D:function(){try{e.texStorage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texSubImage2D:function(){try{e.texSubImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texSubImage3D:function(){try{e.texSubImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexSubImage2D:function(){try{e.compressedTexSubImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(t){!1===k.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),k.copy(t))},viewport:function(t){!1===O.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),O.copy(t))},reset:function(){e.disable(3042),e.disable(2884),e.disable(2929),e.disable(32823),e.disable(3089),e.disable(2960),e.disable(32926),e.blendEquation(32774),e.blendFunc(1,0),e.blendFuncSeparate(1,0,1,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(513),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(519,0,4294967295),e.stencilOp(7680,7680,7680),e.clearStencil(0),e.cullFace(1029),e.frontFace(2305),e.polygonOffset(0,0),e.activeTexture(33984),e.bindFramebuffer(36160,null),!0===i&&(e.bindFramebuffer(36009,null),e.bindFramebuffer(36008,null)),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),a={},P=null,L={},c={},l=new WeakMap,u=[],h=null,d=!1,p=null,f=null,m=null,g=null,v=null,y=null,x=null,w=!1,b=null,A=null,S=null,_=null,M=null,k.set(0,0,e.canvas.width,e.canvas.height),O.set(0,0,e.canvas.width,e.canvas.height),r.reset(),s.reset(),o.reset()}}}function Ir(e,t,n,i,r,s,o){const a=r.isWebGL2,c=r.maxTextures,l=r.maxCubemapSize,u=r.maxTextureSize,h=r.maxSamples,d=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,p=/OculusBrowser/g.test(navigator.userAgent),f=new WeakMap;let m;const g=new WeakMap;let v=!1;try{v="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(e){}function y(e,t){return v?new OffscreenCanvas(e,t):E("canvas")}function x(e,t,n,i){let r=1;if((e.width>i||e.height>i)&&(r=i/Math.max(e.width,e.height)),r<1||!0===t){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const i=t?A:Math.floor,s=i(r*e.width),o=i(r*e.height);void 0===m&&(m=y(s,o));const a=n?y(s,o):m;a.width=s,a.height=o;return a.getContext("2d").drawImage(e,0,0,s,o),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+s+"x"+o+")."),a}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}return e}function b(e){return w(e.width)&&w(e.height)}function S(e,t){return e.generateMipmaps&&t&&1003!==e.minFilter&&1006!==e.minFilter}function _(t){e.generateMipmap(t)}function M(n,i,r,s,o=!1){if(!1===a)return i;if(null!==n){if(void 0!==e[n])return e[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}let c=i;return 6403===i&&(5126===r&&(c=33326),5131===r&&(c=33325),5121===r&&(c=33321)),33319===i&&(5126===r&&(c=33328),5131===r&&(c=33327),5121===r&&(c=33323)),6408===i&&(5126===r&&(c=34836),5131===r&&(c=34842),5121===r&&(c=3001===s&&!1===o?35907:32856),32819===r&&(c=32854),32820===r&&(c=32855)),33325!==c&&33326!==c&&33327!==c&&33328!==c&&34842!==c&&34836!==c||t.get("EXT_color_buffer_float"),c}function T(e,t,n){return!0===S(e,n)||e.isFramebufferTexture&&1003!==e.minFilter&&1006!==e.minFilter?Math.log2(Math.max(t.width,t.height))+1:void 0!==e.mipmaps&&e.mipmaps.length>0?e.mipmaps.length:e.isCompressedTexture&&Array.isArray(e.image)?t.mipmaps.length:1}function C(e){return 1003===e||1004===e||1005===e?9728:9729}function R(e){const t=e.target;t.removeEventListener("dispose",R),function(e){const t=i.get(e);if(void 0===t.__webglInit)return;const n=e.source,r=g.get(n);if(r){const i=r[t.__cacheKey];i.usedTimes--,0===i.usedTimes&&L(e),0===Object.keys(r).length&&g.delete(n)}i.remove(e)}(t),t.isVideoTexture&&f.delete(t)}function P(t){const n=t.target;n.removeEventListener("dispose",P),function(t){const n=t.texture,r=i.get(t),s=i.get(n);void 0!==s.__webglTexture&&(e.deleteTexture(s.__webglTexture),o.memory.textures--);t.depthTexture&&t.depthTexture.dispose();if(t.isWebGLCubeRenderTarget)for(let t=0;t<6;t++)e.deleteFramebuffer(r.__webglFramebuffer[t]),r.__webglDepthbuffer&&e.deleteRenderbuffer(r.__webglDepthbuffer[t]);else{if(e.deleteFramebuffer(r.__webglFramebuffer),r.__webglDepthbuffer&&e.deleteRenderbuffer(r.__webglDepthbuffer),r.__webglMultisampledFramebuffer&&e.deleteFramebuffer(r.__webglMultisampledFramebuffer),r.__webglColorRenderbuffer)for(let t=0;t<r.__webglColorRenderbuffer.length;t++)r.__webglColorRenderbuffer[t]&&e.deleteRenderbuffer(r.__webglColorRenderbuffer[t]);r.__webglDepthRenderbuffer&&e.deleteRenderbuffer(r.__webglDepthRenderbuffer)}if(t.isWebGLMultipleRenderTargets)for(let t=0,r=n.length;t<r;t++){const r=i.get(n[t]);r.__webglTexture&&(e.deleteTexture(r.__webglTexture),o.memory.textures--),i.remove(n[t])}i.remove(n),i.remove(t)}(n)}function L(t){const n=i.get(t);e.deleteTexture(n.__webglTexture);const r=t.source;delete g.get(r)[n.__cacheKey],o.memory.textures--}let D=0;function I(e,t){const r=i.get(e);if(e.isVideoTexture&&function(e){const t=o.render.frame;f.get(e)!==t&&(f.set(e,t),e.update())}(e),!1===e.isRenderTargetTexture&&e.version>0&&r.__version!==e.version){const n=e.image;if(null===n)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==n.complete)return void z(r,e,t);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.activeTexture(33984+t),n.bindTexture(3553,r.__webglTexture)}const k={1e3:10497,1001:33071,1002:33648},O={1003:9728,1004:9984,1005:9986,1006:9729,1007:9985,1008:9987};function B(n,s,o){if(o?(e.texParameteri(n,10242,k[s.wrapS]),e.texParameteri(n,10243,k[s.wrapT]),32879!==n&&35866!==n||e.texParameteri(n,32882,k[s.wrapR]),e.texParameteri(n,10240,O[s.magFilter]),e.texParameteri(n,10241,O[s.minFilter])):(e.texParameteri(n,10242,33071),e.texParameteri(n,10243,33071),32879!==n&&35866!==n||e.texParameteri(n,32882,33071),1001===s.wrapS&&1001===s.wrapT||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(n,10240,C(s.magFilter)),e.texParameteri(n,10241,C(s.minFilter)),1003!==s.minFilter&&1006!==s.minFilter&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!0===t.has("EXT_texture_filter_anisotropic")){const o=t.get("EXT_texture_filter_anisotropic");if(1015===s.type&&!1===t.has("OES_texture_float_linear"))return;if(!1===a&&1016===s.type&&!1===t.has("OES_texture_half_float_linear"))return;(s.anisotropy>1||i.get(s).__currentAnisotropy)&&(e.texParameterf(n,o.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(s.anisotropy,r.getMaxAnisotropy())),i.get(s).__currentAnisotropy=s.anisotropy)}}function N(t,n){let i=!1;void 0===t.__webglInit&&(t.__webglInit=!0,n.addEventListener("dispose",R));const r=n.source;let s=g.get(r);void 0===s&&(s={},g.set(r,s));const a=function(e){const t=[];return t.push(e.wrapS),t.push(e.wrapT),t.push(e.magFilter),t.push(e.minFilter),t.push(e.anisotropy),t.push(e.internalFormat),t.push(e.format),t.push(e.type),t.push(e.generateMipmaps),t.push(e.premultiplyAlpha),t.push(e.flipY),t.push(e.unpackAlignment),t.push(e.encoding),t.join()}(n);if(a!==t.__cacheKey){void 0===s[a]&&(s[a]={texture:e.createTexture(),usedTimes:0},o.memory.textures++,i=!0),s[a].usedTimes++;const r=s[t.__cacheKey];void 0!==r&&(s[t.__cacheKey].usedTimes--,0===r.usedTimes&&L(n)),t.__cacheKey=a,t.__webglTexture=s[a].texture}return i}function z(t,i,r){let o=3553;i.isDataArrayTexture&&(o=35866),i.isData3DTexture&&(o=32879);const c=N(t,i),l=i.source;if(n.activeTexture(33984+r),n.bindTexture(o,t.__webglTexture),l.version!==l.__currentVersion||!0===c){e.pixelStorei(37440,i.flipY),e.pixelStorei(37441,i.premultiplyAlpha),e.pixelStorei(3317,i.unpackAlignment),e.pixelStorei(37443,0);const t=function(e){return!a&&(1001!==e.wrapS||1001!==e.wrapT||1003!==e.minFilter&&1006!==e.minFilter)}(i)&&!1===b(i.image);let r=x(i.image,t,!1,u);r=j(i,r);const h=b(r)||a,d=s.convert(i.format,i.encoding);let p,f=s.convert(i.type),m=M(i.internalFormat,d,f,i.encoding,i.isVideoTexture);B(o,i,h);const g=i.mipmaps,v=a&&!0!==i.isVideoTexture,y=void 0===l.__currentVersion||!0===c,w=T(i,r,h);if(i.isDepthTexture)m=6402,a?m=1015===i.type?36012:1014===i.type?33190:1020===i.type?35056:33189:1015===i.type&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),1026===i.format&&6402===m&&1012!==i.type&&1014!==i.type&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),i.type=1014,f=s.convert(i.type)),1027===i.format&&6402===m&&(m=34041,1020!==i.type&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),i.type=1020,f=s.convert(i.type))),y&&(v?n.texStorage2D(3553,1,m,r.width,r.height):n.texImage2D(3553,0,m,r.width,r.height,0,d,f,null));else if(i.isDataTexture)if(g.length>0&&h){v&&y&&n.texStorage2D(3553,w,m,g[0].width,g[0].height);for(let e=0,t=g.length;e<t;e++)p=g[e],v?n.texSubImage2D(3553,e,0,0,p.width,p.height,d,f,p.data):n.texImage2D(3553,e,m,p.width,p.height,0,d,f,p.data);i.generateMipmaps=!1}else v?(y&&n.texStorage2D(3553,w,m,r.width,r.height),n.texSubImage2D(3553,0,0,0,r.width,r.height,d,f,r.data)):n.texImage2D(3553,0,m,r.width,r.height,0,d,f,r.data);else if(i.isCompressedTexture){v&&y&&n.texStorage2D(3553,w,m,g[0].width,g[0].height);for(let e=0,t=g.length;e<t;e++)p=g[e],1023!==i.format?null!==d?v?n.compressedTexSubImage2D(3553,e,0,0,p.width,p.height,d,p.data):n.compressedTexImage2D(3553,e,m,p.width,p.height,0,p.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):v?n.texSubImage2D(3553,e,0,0,p.width,p.height,d,f,p.data):n.texImage2D(3553,e,m,p.width,p.height,0,d,f,p.data)}else if(i.isDataArrayTexture)v?(y&&n.texStorage3D(35866,w,m,r.width,r.height,r.depth),n.texSubImage3D(35866,0,0,0,0,r.width,r.height,r.depth,d,f,r.data)):n.texImage3D(35866,0,m,r.width,r.height,r.depth,0,d,f,r.data);else if(i.isData3DTexture)v?(y&&n.texStorage3D(32879,w,m,r.width,r.height,r.depth),n.texSubImage3D(32879,0,0,0,0,r.width,r.height,r.depth,d,f,r.data)):n.texImage3D(32879,0,m,r.width,r.height,r.depth,0,d,f,r.data);else if(i.isFramebufferTexture){if(y)if(v)n.texStorage2D(3553,w,m,r.width,r.height);else{let e=r.width,t=r.height;for(let i=0;i<w;i++)n.texImage2D(3553,i,m,e,t,0,d,f,null),e>>=1,t>>=1}}else if(g.length>0&&h){v&&y&&n.texStorage2D(3553,w,m,g[0].width,g[0].height);for(let e=0,t=g.length;e<t;e++)p=g[e],v?n.texSubImage2D(3553,e,0,0,d,f,p):n.texImage2D(3553,e,m,d,f,p);i.generateMipmaps=!1}else v?(y&&n.texStorage2D(3553,w,m,r.width,r.height),n.texSubImage2D(3553,0,0,0,d,f,r)):n.texImage2D(3553,0,m,d,f,r);S(i,h)&&_(o),l.__currentVersion=l.version,i.onUpdate&&i.onUpdate(i)}t.__version=i.version}function F(t,r,o,a,c){const l=s.convert(o.format,o.encoding),u=s.convert(o.type),h=M(o.internalFormat,l,u,o.encoding);i.get(r).__hasExternalTextures||(32879===c||35866===c?n.texImage3D(c,0,h,r.width,r.height,r.depth,0,l,u,null):n.texImage2D(c,0,h,r.width,r.height,0,l,u,null)),n.bindFramebuffer(36160,t),W(r)?d.framebufferTexture2DMultisampleEXT(36160,a,c,i.get(o).__webglTexture,0,G(r)):e.framebufferTexture2D(36160,a,c,i.get(o).__webglTexture,0),n.bindFramebuffer(36160,null)}function H(t,n,i){if(e.bindRenderbuffer(36161,t),n.depthBuffer&&!n.stencilBuffer){let r=33189;if(i||W(n)){const t=n.depthTexture;t&&t.isDepthTexture&&(1015===t.type?r=36012:1014===t.type&&(r=33190));const i=G(n);W(n)?d.renderbufferStorageMultisampleEXT(36161,i,r,n.width,n.height):e.renderbufferStorageMultisample(36161,i,r,n.width,n.height)}else e.renderbufferStorage(36161,r,n.width,n.height);e.framebufferRenderbuffer(36160,36096,36161,t)}else if(n.depthBuffer&&n.stencilBuffer){const r=G(n);i&&!1===W(n)?e.renderbufferStorageMultisample(36161,r,35056,n.width,n.height):W(n)?d.renderbufferStorageMultisampleEXT(36161,r,35056,n.width,n.height):e.renderbufferStorage(36161,34041,n.width,n.height),e.framebufferRenderbuffer(36160,33306,36161,t)}else{const t=!0===n.isWebGLMultipleRenderTargets?n.texture:[n.texture];for(let r=0;r<t.length;r++){const o=t[r],a=s.convert(o.format,o.encoding),c=s.convert(o.type),l=M(o.internalFormat,a,c,o.encoding),u=G(n);i&&!1===W(n)?e.renderbufferStorageMultisample(36161,u,l,n.width,n.height):W(n)?d.renderbufferStorageMultisampleEXT(36161,u,l,n.width,n.height):e.renderbufferStorage(36161,l,n.width,n.height)}}e.bindRenderbuffer(36161,null)}function V(t){const r=i.get(t),s=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture&&!r.__autoAllocateDepthBuffer){if(s)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,r){if(r&&r.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(36160,t),!r.depthTexture||!r.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");i.get(r.depthTexture).__webglTexture&&r.depthTexture.image.width===r.width&&r.depthTexture.image.height===r.height||(r.depthTexture.image.width=r.width,r.depthTexture.image.height=r.height,r.depthTexture.needsUpdate=!0),I(r.depthTexture,0);const s=i.get(r.depthTexture).__webglTexture,o=G(r);if(1026===r.depthTexture.format)W(r)?d.framebufferTexture2DMultisampleEXT(36160,36096,3553,s,0,o):e.framebufferTexture2D(36160,36096,3553,s,0);else{if(1027!==r.depthTexture.format)throw new Error("Unknown depthTexture format");W(r)?d.framebufferTexture2DMultisampleEXT(36160,33306,3553,s,0,o):e.framebufferTexture2D(36160,33306,3553,s,0)}}(r.__webglFramebuffer,t)}else if(s){r.__webglDepthbuffer=[];for(let i=0;i<6;i++)n.bindFramebuffer(36160,r.__webglFramebuffer[i]),r.__webglDepthbuffer[i]=e.createRenderbuffer(),H(r.__webglDepthbuffer[i],t,!1)}else n.bindFramebuffer(36160,r.__webglFramebuffer),r.__webglDepthbuffer=e.createRenderbuffer(),H(r.__webglDepthbuffer,t,!1);n.bindFramebuffer(36160,null)}function G(e){return Math.min(h,e.samples)}function W(e){const n=i.get(e);return a&&e.samples>0&&!0===t.has("WEBGL_multisampled_render_to_texture")&&!1!==n.__useRenderToTexture}function j(e,n){const i=e.encoding,r=e.format,s=e.type;return!0===e.isCompressedTexture||!0===e.isVideoTexture||1035===e.format||3e3!==i&&(3001===i?!1===a?!0===t.has("EXT_sRGB")&&1023===r?(e.format=1035,e.minFilter=1006,e.generateMipmaps=!1):n=U.sRGBToLinear(n):1023===r&&1009===s||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",i)),n}this.allocateTextureUnit=function(){const e=D;return e>=c&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+c),D+=1,e},this.resetTextureUnits=function(){D=0},this.setTexture2D=I,this.setTexture2DArray=function(e,t){const r=i.get(e);e.version>0&&r.__version!==e.version?z(r,e,t):(n.activeTexture(33984+t),n.bindTexture(35866,r.__webglTexture))},this.setTexture3D=function(e,t){const r=i.get(e);e.version>0&&r.__version!==e.version?z(r,e,t):(n.activeTexture(33984+t),n.bindTexture(32879,r.__webglTexture))},this.setTextureCube=function(t,r){const o=i.get(t);t.version>0&&o.__version!==t.version?function(t,i,r){if(6!==i.image.length)return;const o=N(t,i),c=i.source;if(n.activeTexture(33984+r),n.bindTexture(34067,t.__webglTexture),c.version!==c.__currentVersion||!0===o){e.pixelStorei(37440,i.flipY),e.pixelStorei(37441,i.premultiplyAlpha),e.pixelStorei(3317,i.unpackAlignment),e.pixelStorei(37443,0);const t=i.isCompressedTexture||i.image[0].isCompressedTexture,r=i.image[0]&&i.image[0].isDataTexture,u=[];for(let e=0;e<6;e++)u[e]=t||r?r?i.image[e].image:i.image[e]:x(i.image[e],!1,!0,l),u[e]=j(i,u[e]);const h=u[0],d=b(h)||a,p=s.convert(i.format,i.encoding),f=s.convert(i.type),m=M(i.internalFormat,p,f,i.encoding),g=a&&!0!==i.isVideoTexture,v=void 0===c.__currentVersion||!0===o;let y,w=T(i,h,d);if(B(34067,i,d),t){g&&v&&n.texStorage2D(34067,w,m,h.width,h.height);for(let e=0;e<6;e++){y=u[e].mipmaps;for(let t=0;t<y.length;t++){const r=y[t];1023!==i.format?null!==p?g?n.compressedTexSubImage2D(34069+e,t,0,0,r.width,r.height,p,r.data):n.compressedTexImage2D(34069+e,t,m,r.width,r.height,0,r.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):g?n.texSubImage2D(34069+e,t,0,0,r.width,r.height,p,f,r.data):n.texImage2D(34069+e,t,m,r.width,r.height,0,p,f,r.data)}}}else{y=i.mipmaps,g&&v&&(y.length>0&&w++,n.texStorage2D(34067,w,m,u[0].width,u[0].height));for(let e=0;e<6;e++)if(r){g?n.texSubImage2D(34069+e,0,0,0,u[e].width,u[e].height,p,f,u[e].data):n.texImage2D(34069+e,0,m,u[e].width,u[e].height,0,p,f,u[e].data);for(let t=0;t<y.length;t++){const i=y[t].image[e].image;g?n.texSubImage2D(34069+e,t+1,0,0,i.width,i.height,p,f,i.data):n.texImage2D(34069+e,t+1,m,i.width,i.height,0,p,f,i.data)}}else{g?n.texSubImage2D(34069+e,0,0,0,p,f,u[e]):n.texImage2D(34069+e,0,m,p,f,u[e]);for(let t=0;t<y.length;t++){const i=y[t];g?n.texSubImage2D(34069+e,t+1,0,0,p,f,i.image[e]):n.texImage2D(34069+e,t+1,m,p,f,i.image[e])}}}S(i,d)&&_(34067),c.__currentVersion=c.version,i.onUpdate&&i.onUpdate(i)}t.__version=i.version}(o,t,r):(n.activeTexture(33984+r),n.bindTexture(34067,o.__webglTexture))},this.rebindTextures=function(e,t,n){const r=i.get(e);void 0!==t&&F(r.__webglFramebuffer,e,e.texture,36064,3553),void 0!==n&&V(e)},this.setupRenderTarget=function(t){const c=t.texture,l=i.get(t),u=i.get(c);t.addEventListener("dispose",P),!0!==t.isWebGLMultipleRenderTargets&&(void 0===u.__webglTexture&&(u.__webglTexture=e.createTexture()),u.__version=c.version,o.memory.textures++);const h=!0===t.isWebGLCubeRenderTarget,d=!0===t.isWebGLMultipleRenderTargets,p=b(t)||a;if(h){l.__webglFramebuffer=[];for(let t=0;t<6;t++)l.__webglFramebuffer[t]=e.createFramebuffer()}else{if(l.__webglFramebuffer=e.createFramebuffer(),d)if(r.drawBuffers){const n=t.texture;for(let t=0,r=n.length;t<r;t++){const r=i.get(n[t]);void 0===r.__webglTexture&&(r.__webglTexture=e.createTexture(),o.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(a&&t.samples>0&&!1===W(t)){const i=d?c:[c];l.__webglMultisampledFramebuffer=e.createFramebuffer(),l.__webglColorRenderbuffer=[],n.bindFramebuffer(36160,l.__webglMultisampledFramebuffer);for(let n=0;n<i.length;n++){const r=i[n];l.__webglColorRenderbuffer[n]=e.createRenderbuffer(),e.bindRenderbuffer(36161,l.__webglColorRenderbuffer[n]);const o=s.convert(r.format,r.encoding),a=s.convert(r.type),c=M(r.internalFormat,o,a,r.encoding),u=G(t);e.renderbufferStorageMultisample(36161,u,c,t.width,t.height),e.framebufferRenderbuffer(36160,36064+n,36161,l.__webglColorRenderbuffer[n])}e.bindRenderbuffer(36161,null),t.depthBuffer&&(l.__webglDepthRenderbuffer=e.createRenderbuffer(),H(l.__webglDepthRenderbuffer,t,!0)),n.bindFramebuffer(36160,null)}}if(h){n.bindTexture(34067,u.__webglTexture),B(34067,c,p);for(let e=0;e<6;e++)F(l.__webglFramebuffer[e],t,c,36064,34069+e);S(c,p)&&_(34067),n.unbindTexture()}else if(d){const e=t.texture;for(let r=0,s=e.length;r<s;r++){const s=e[r],o=i.get(s);n.bindTexture(3553,o.__webglTexture),B(3553,s,p),F(l.__webglFramebuffer,t,s,36064+r,3553),S(s,p)&&_(3553)}n.unbindTexture()}else{let e=3553;(t.isWebGL3DRenderTarget||t.isWebGLArrayRenderTarget)&&(a?e=t.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),n.bindTexture(e,u.__webglTexture),B(e,c,p),F(l.__webglFramebuffer,t,c,36064,e),S(c,p)&&_(e),n.unbindTexture()}t.depthBuffer&&V(t)},this.updateRenderTargetMipmap=function(e){const t=b(e)||a,r=!0===e.isWebGLMultipleRenderTargets?e.texture:[e.texture];for(let s=0,o=r.length;s<o;s++){const o=r[s];if(S(o,t)){const t=e.isWebGLCubeRenderTarget?34067:3553,r=i.get(o).__webglTexture;n.bindTexture(t,r),_(t),n.unbindTexture()}}},this.updateMultisampleRenderTarget=function(t){if(a&&t.samples>0&&!1===W(t)){const r=t.isWebGLMultipleRenderTargets?t.texture:[t.texture],s=t.width,o=t.height;let a=16384;const c=[],l=t.stencilBuffer?33306:36096,u=i.get(t),h=!0===t.isWebGLMultipleRenderTargets;if(h)for(let t=0;t<r.length;t++)n.bindFramebuffer(36160,u.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064+t,36161,null),n.bindFramebuffer(36160,u.__webglFramebuffer),e.framebufferTexture2D(36009,36064+t,3553,null,0);n.bindFramebuffer(36008,u.__webglMultisampledFramebuffer),n.bindFramebuffer(36009,u.__webglFramebuffer);for(let n=0;n<r.length;n++){c.push(36064+n),t.depthBuffer&&c.push(l);const d=void 0!==u.__ignoreDepthValues&&u.__ignoreDepthValues;if(!1===d&&(t.depthBuffer&&(a|=256),t.stencilBuffer&&(a|=1024)),h&&e.framebufferRenderbuffer(36008,36064,36161,u.__webglColorRenderbuffer[n]),!0===d&&(e.invalidateFramebuffer(36008,[l]),e.invalidateFramebuffer(36009,[l])),h){const t=i.get(r[n]).__webglTexture;e.framebufferTexture2D(36009,36064,3553,t,0)}e.blitFramebuffer(0,0,s,o,0,0,s,o,a,9728),p&&e.invalidateFramebuffer(36008,c)}if(n.bindFramebuffer(36008,null),n.bindFramebuffer(36009,null),h)for(let t=0;t<r.length;t++){n.bindFramebuffer(36160,u.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064+t,36161,u.__webglColorRenderbuffer[t]);const s=i.get(r[t]).__webglTexture;n.bindFramebuffer(36160,u.__webglFramebuffer),e.framebufferTexture2D(36009,36064+t,3553,s,0)}n.bindFramebuffer(36009,u.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=V,this.setupFrameBufferTexture=F,this.useMultisampledRTT=W}function kr(e,t,n){const i=n.isWebGL2;return{convert:function(n,r=null){let s;if(1009===n)return 5121;if(1017===n)return 32819;if(1018===n)return 32820;if(1010===n)return 5120;if(1011===n)return 5122;if(1012===n)return 5123;if(1013===n)return 5124;if(1014===n)return 5125;if(1015===n)return 5126;if(1016===n)return i?5131:(s=t.get("OES_texture_half_float"),null!==s?s.HALF_FLOAT_OES:null);if(1021===n)return 6406;if(1023===n)return 6408;if(1024===n)return 6409;if(1025===n)return 6410;if(1026===n)return 6402;if(1027===n)return 34041;if(1028===n)return 6403;if(1022===n)return console.warn("THREE.WebGLRenderer: THREE.RGBFormat has been removed. Use THREE.RGBAFormat instead. https://github.com/mrdoob/three.js/pull/23228"),6408;if(1035===n)return s=t.get("EXT_sRGB"),null!==s?s.SRGB_ALPHA_EXT:null;if(1029===n)return 36244;if(1030===n)return 33319;if(1031===n)return 33320;if(1033===n)return 36249;if(33776===n||33777===n||33778===n||33779===n)if(3001===r){if(s=t.get("WEBGL_compressed_texture_s3tc_srgb"),null===s)return null;if(33776===n)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(33777===n)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(33778===n)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(33779===n)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(s=t.get("WEBGL_compressed_texture_s3tc"),null===s)return null;if(33776===n)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(33777===n)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(33778===n)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(33779===n)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(35840===n||35841===n||35842===n||35843===n){if(s=t.get("WEBGL_compressed_texture_pvrtc"),null===s)return null;if(35840===n)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===n)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===n)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===n)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===n)return s=t.get("WEBGL_compressed_texture_etc1"),null!==s?s.COMPRESSED_RGB_ETC1_WEBGL:null;if(37492===n||37496===n){if(s=t.get("WEBGL_compressed_texture_etc"),null===s)return null;if(37492===n)return 3001===r?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(37496===n)return 3001===r?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC}if(37808===n||37809===n||37810===n||37811===n||37812===n||37813===n||37814===n||37815===n||37816===n||37817===n||37818===n||37819===n||37820===n||37821===n){if(s=t.get("WEBGL_compressed_texture_astc"),null===s)return null;if(37808===n)return 3001===r?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(37809===n)return 3001===r?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(37810===n)return 3001===r?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(37811===n)return 3001===r?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(37812===n)return 3001===r?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(37813===n)return 3001===r?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(37814===n)return 3001===r?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(37815===n)return 3001===r?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(37816===n)return 3001===r?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(37817===n)return 3001===r?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(37818===n)return 3001===r?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(37819===n)return 3001===r?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(37820===n)return 3001===r?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(37821===n)return 3001===r?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR}if(36492===n){if(s=t.get("EXT_texture_compression_bptc"),null===s)return null;if(36492===n)return 3001===r?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT}return 1020===n?i?34042:(s=t.get("WEBGL_depth_texture"),null!==s?s.UNSIGNED_INT_24_8_WEBGL:null):void 0!==e[n]?e[n]:null}}}class Or extends Qt{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class Br extends Qe{constructor(){super(),this.isGroup=!0,this.type="Group"}}const Nr={type:"move"};class zr{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new Br,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new Br,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Y,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Y),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new Br,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Y,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Y),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,n){let i=null,r=null,s=null;const o=this._targetRay,a=this._grip,c=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState){if(c&&e.hand){s=!0;for(const i of e.hand.values()){const e=t.getJointPose(i,n);if(void 0===c.joints[i.jointName]){const e=new Br;e.matrixAutoUpdate=!1,e.visible=!1,c.joints[i.jointName]=e,c.add(e)}const r=c.joints[i.jointName];null!==e&&(r.matrix.fromArray(e.transform.matrix),r.matrix.decompose(r.position,r.rotation,r.scale),r.jointRadius=e.radius),r.visible=null!==e}const i=c.joints["index-finger-tip"],r=c.joints["thumb-tip"],o=i.position.distanceTo(r.position),a=.02,l=.005;c.inputState.pinching&&o>a+l?(c.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!c.inputState.pinching&&o<=a-l&&(c.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==a&&e.gripSpace&&(r=t.getPose(e.gripSpace,n),null!==r&&(a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),r.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(r.linearVelocity)):a.hasLinearVelocity=!1,r.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(r.angularVelocity)):a.hasAngularVelocity=!1));null!==o&&(i=t.getPose(e.targetRaySpace,n),null===i&&null!==r&&(i=r),null!==i&&(o.matrix.fromArray(i.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),i.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(i.linearVelocity)):o.hasLinearVelocity=!1,i.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(i.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(Nr)))}return null!==o&&(o.visible=null!==i),null!==a&&(a.visible=null!==r),null!==c&&(c.visible=null!==s),this}}class Fr extends W{constructor(e,t,n,i,r,s,o,a,c,l){if(1026!==(l=void 0!==l?l:1026)&&1027!==l)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&1026===l&&(n=1014),void 0===n&&1027===l&&(n=1020),super(null,i,r,s,o,a,l,n,c),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=void 0!==o?o:1003,this.minFilter=void 0!==a?a:1003,this.flipY=!1,this.generateMipmaps=!1}}class Ur extends h{constructor(e,t){super();const n=this;let i=null,r=1,s=null,o="local-floor",a=null,c=null,l=null,u=null,h=null,d=null;const p=t.getContextAttributes();let f=null,m=null;const g=[],v=[],y=new Qt;y.layers.enable(1),y.viewport=new j;const x=new Qt;x.layers.enable(2),x.viewport=new j;const w=[y,x],b=new Or;b.layers.enable(1),b.layers.enable(2);let A=null,S=null;function _(e){const t=v.indexOf(e.inputSource);if(-1===t)return;const n=g[t];void 0!==n&&n.dispatchEvent({type:e.type,data:e.inputSource})}function M(){i.removeEventListener("select",_),i.removeEventListener("selectstart",_),i.removeEventListener("selectend",_),i.removeEventListener("squeeze",_),i.removeEventListener("squeezestart",_),i.removeEventListener("squeezeend",_),i.removeEventListener("end",M),i.removeEventListener("inputsourceschange",T);for(let e=0;e<g.length;e++){const t=v[e];null!==t&&(v[e]=null,g[e].disconnect(t))}A=null,S=null,e.setRenderTarget(f),h=null,u=null,l=null,i=null,m=null,L.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}function T(e){for(let t=0;t<e.removed.length;t++){const n=e.removed[t],i=v.indexOf(n);i>=0&&(v[i]=null,g[i].dispatchEvent({type:"disconnected",data:n}))}for(let t=0;t<e.added.length;t++){const n=e.added[t];let i=v.indexOf(n);if(-1===i){for(let e=0;e<g.length;e++){if(e>=v.length){v.push(n),i=e;break}if(null===v[e]){v[e]=n,i=e;break}}if(-1===i)break}const r=g[i];r&&r.dispatchEvent({type:"connected",data:n})}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(e){let t=g[e];return void 0===t&&(t=new zr,g[e]=t),t.getTargetRaySpace()},this.getControllerGrip=function(e){let t=g[e];return void 0===t&&(t=new zr,g[e]=t),t.getGripSpace()},this.getHand=function(e){let t=g[e];return void 0===t&&(t=new zr,g[e]=t),t.getHandSpace()},this.setFramebufferScaleFactor=function(e){r=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(e){o=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return a||s},this.setReferenceSpace=function(e){a=e},this.getBaseLayer=function(){return null!==u?u:h},this.getBinding=function(){return l},this.getFrame=function(){return d},this.getSession=function(){return i},this.setSession=async function(c){if(i=c,null!==i){if(f=e.getRenderTarget(),i.addEventListener("select",_),i.addEventListener("selectstart",_),i.addEventListener("selectend",_),i.addEventListener("squeeze",_),i.addEventListener("squeezestart",_),i.addEventListener("squeezeend",_),i.addEventListener("end",M),i.addEventListener("inputsourceschange",T),!0!==p.xrCompatible&&await t.makeXRCompatible(),void 0===i.renderState.layers||!1===e.capabilities.isWebGL2){const n={antialias:void 0!==i.renderState.layers||p.antialias,alpha:p.alpha,depth:p.depth,stencil:p.stencil,framebufferScaleFactor:r};h=new XRWebGLLayer(i,t,n),i.updateRenderState({baseLayer:h}),m=new J(h.framebufferWidth,h.framebufferHeight,{format:1023,type:1009,encoding:e.outputEncoding})}else{let n=null,s=null,o=null;p.depth&&(o=p.stencil?35056:33190,n=p.stencil?1027:1026,s=p.stencil?1020:1014);const a={colorFormat:32856,depthFormat:o,scaleFactor:r};l=new XRWebGLBinding(i,t),u=l.createProjectionLayer(a),i.updateRenderState({layers:[u]}),m=new J(u.textureWidth,u.textureHeight,{format:1023,type:1009,depthTexture:new Fr(u.textureWidth,u.textureHeight,s,void 0,void 0,void 0,void 0,void 0,void 0,n),stencilBuffer:p.stencil,encoding:e.outputEncoding,samples:p.antialias?4:0});e.properties.get(m).__ignoreDepthValues=u.ignoreDepthValues}m.isXRRenderTarget=!0,this.setFoveation(1),a=null,s=await i.requestReferenceSpace(o),L.setContext(i),L.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}};const E=new Y,C=new Y;function R(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}this.updateCamera=function(e){if(null===i)return;b.near=x.near=y.near=e.near,b.far=x.far=y.far=e.far,A===b.near&&S===b.far||(i.updateRenderState({depthNear:b.near,depthFar:b.far}),A=b.near,S=b.far);const t=e.parent,n=b.cameras;R(b,t);for(let e=0;e<n.length;e++)R(n[e],t);b.matrixWorld.decompose(b.position,b.quaternion,b.scale),e.position.copy(b.position),e.quaternion.copy(b.quaternion),e.scale.copy(b.scale),e.matrix.copy(b.matrix),e.matrixWorld.copy(b.matrixWorld);const r=e.children;for(let e=0,t=r.length;e<t;e++)r[e].updateMatrixWorld(!0);2===n.length?function(e,t,n){E.setFromMatrixPosition(t.matrixWorld),C.setFromMatrixPosition(n.matrixWorld);const i=E.distanceTo(C),r=t.projectionMatrix.elements,s=n.projectionMatrix.elements,o=r[14]/(r[10]-1),a=r[14]/(r[10]+1),c=(r[9]+1)/r[5],l=(r[9]-1)/r[5],u=(r[8]-1)/r[0],h=(s[8]+1)/s[0],d=o*u,p=o*h,f=i/(-u+h),m=f*-u;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(m),e.translateZ(f),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert();const g=o+f,v=a+f,y=d-m,x=p+(i-m),w=c*a/v*g,b=l*a/v*g;e.projectionMatrix.makePerspective(y,x,w,b,g,v)}(b,y,x):b.projectionMatrix.copy(y.projectionMatrix)},this.getCamera=function(){return b},this.getFoveation=function(){return null!==u?u.fixedFoveation:null!==h?h.fixedFoveation:void 0},this.setFoveation=function(e){null!==u&&(u.fixedFoveation=e),null!==h&&void 0!==h.fixedFoveation&&(h.fixedFoveation=e)};let P=null;const L=new un;L.setAnimationLoop((function(t,n){if(c=n.getViewerPose(a||s),d=n,null!==c){const t=c.views;null!==h&&(e.setRenderTargetFramebuffer(m,h.framebuffer),e.setRenderTarget(m));let n=!1;t.length!==b.cameras.length&&(b.cameras.length=0,n=!0);for(let i=0;i<t.length;i++){const r=t[i];let s=null;if(null!==h)s=h.getViewport(r);else{const t=l.getViewSubImage(u,r);s=t.viewport,0===i&&(e.setRenderTargetTextures(m,t.colorTexture,u.ignoreDepthValues?void 0:t.depthStencilTexture),e.setRenderTarget(m))}let o=w[i];void 0===o&&(o=new Qt,o.layers.enable(i),o.viewport=new j,w[i]=o),o.matrix.fromArray(r.transform.matrix),o.projectionMatrix.fromArray(r.projectionMatrix),o.viewport.set(s.x,s.y,s.width,s.height),0===i&&b.matrix.copy(o.matrix),!0===n&&b.cameras.push(o)}}for(let e=0;e<g.length;e++){const t=v[e],i=g[e];null!==t&&void 0!==i&&i.update(t,n,a||s)}P&&P(t,n),d=null})),this.setAnimationLoop=function(e){P=e},this.dispose=function(){}}}function Hr(e,t){function n(n,i){n.opacity.value=i.opacity,i.color&&n.diffuse.value.copy(i.color),i.emissive&&n.emissive.value.copy(i.emissive).multiplyScalar(i.emissiveIntensity),i.map&&(n.map.value=i.map),i.alphaMap&&(n.alphaMap.value=i.alphaMap),i.bumpMap&&(n.bumpMap.value=i.bumpMap,n.bumpScale.value=i.bumpScale,1===i.side&&(n.bumpScale.value*=-1)),i.displacementMap&&(n.displacementMap.value=i.displacementMap,n.displacementScale.value=i.displacementScale,n.displacementBias.value=i.displacementBias),i.emissiveMap&&(n.emissiveMap.value=i.emissiveMap),i.normalMap&&(n.normalMap.value=i.normalMap,n.normalScale.value.copy(i.normalScale),1===i.side&&n.normalScale.value.negate()),i.specularMap&&(n.specularMap.value=i.specularMap),i.alphaTest>0&&(n.alphaTest.value=i.alphaTest);const r=t.get(i).envMap;if(r&&(n.envMap.value=r,n.flipEnvMap.value=r.isCubeTexture&&!1===r.isRenderTargetTexture?-1:1,n.reflectivity.value=i.reflectivity,n.ior.value=i.ior,n.refractionRatio.value=i.refractionRatio),i.lightMap){n.lightMap.value=i.lightMap;const t=!0!==e.physicallyCorrectLights?Math.PI:1;n.lightMapIntensity.value=i.lightMapIntensity*t}let s,o;i.aoMap&&(n.aoMap.value=i.aoMap,n.aoMapIntensity.value=i.aoMapIntensity),i.map?s=i.map:i.specularMap?s=i.specularMap:i.displacementMap?s=i.displacementMap:i.normalMap?s=i.normalMap:i.bumpMap?s=i.bumpMap:i.roughnessMap?s=i.roughnessMap:i.metalnessMap?s=i.metalnessMap:i.alphaMap?s=i.alphaMap:i.emissiveMap?s=i.emissiveMap:i.clearcoatMap?s=i.clearcoatMap:i.clearcoatNormalMap?s=i.clearcoatNormalMap:i.clearcoatRoughnessMap?s=i.clearcoatRoughnessMap:i.iridescenceMap?s=i.iridescenceMap:i.iridescenceThicknessMap?s=i.iridescenceThicknessMap:i.specularIntensityMap?s=i.specularIntensityMap:i.specularColorMap?s=i.specularColorMap:i.transmissionMap?s=i.transmissionMap:i.thicknessMap?s=i.thicknessMap:i.sheenColorMap?s=i.sheenColorMap:i.sheenRoughnessMap&&(s=i.sheenRoughnessMap),void 0!==s&&(s.isWebGLRenderTarget&&(s=s.texture),!0===s.matrixAutoUpdate&&s.updateMatrix(),n.uvTransform.value.copy(s.matrix)),i.aoMap?o=i.aoMap:i.lightMap&&(o=i.lightMap),void 0!==o&&(o.isWebGLRenderTarget&&(o=o.texture),!0===o.matrixAutoUpdate&&o.updateMatrix(),n.uv2Transform.value.copy(o.matrix))}return{refreshFogUniforms:function(e,t){e.fogColor.value.copy(t.color),t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)},refreshMaterialUniforms:function(e,i,r,s,o){i.isMeshBasicMaterial||i.isMeshLambertMaterial?n(e,i):i.isMeshToonMaterial?(n(e,i),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap)}(e,i)):i.isMeshPhongMaterial?(n(e,i),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4)}(e,i)):i.isMeshStandardMaterial?(n(e,i),function(e,n){e.roughness.value=n.roughness,e.metalness.value=n.metalness,n.roughnessMap&&(e.roughnessMap.value=n.roughnessMap);n.metalnessMap&&(e.metalnessMap.value=n.metalnessMap);t.get(n).envMap&&(e.envMapIntensity.value=n.envMapIntensity)}(e,i),i.isMeshPhysicalMaterial&&function(e,t,n){e.ior.value=t.ior,t.sheen>0&&(e.sheenColor.value.copy(t.sheenColor).multiplyScalar(t.sheen),e.sheenRoughness.value=t.sheenRoughness,t.sheenColorMap&&(e.sheenColorMap.value=t.sheenColorMap),t.sheenRoughnessMap&&(e.sheenRoughnessMap.value=t.sheenRoughnessMap));t.clearcoat>0&&(e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap),t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap),t.clearcoatNormalMap&&(e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),e.clearcoatNormalMap.value=t.clearcoatNormalMap,1===t.side&&e.clearcoatNormalScale.value.negate()));t.iridescence>0&&(e.iridescence.value=t.iridescence,e.iridescenceIOR.value=t.iridescenceIOR,e.iridescenceThicknessMinimum.value=t.iridescenceThicknessRange[0],e.iridescenceThicknessMaximum.value=t.iridescenceThicknessRange[1],t.iridescenceMap&&(e.iridescenceMap.value=t.iridescenceMap),t.iridescenceThicknessMap&&(e.iridescenceThicknessMap.value=t.iridescenceThicknessMap));t.transmission>0&&(e.transmission.value=t.transmission,e.transmissionSamplerMap.value=n.texture,e.transmissionSamplerSize.value.set(n.width,n.height),t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap),e.thickness.value=t.thickness,t.thicknessMap&&(e.thicknessMap.value=t.thicknessMap),e.attenuationDistance.value=t.attenuationDistance,e.attenuationColor.value.copy(t.attenuationColor));e.specularIntensity.value=t.specularIntensity,e.specularColor.value.copy(t.specularColor),t.specularIntensityMap&&(e.specularIntensityMap.value=t.specularIntensityMap);t.specularColorMap&&(e.specularColorMap.value=t.specularColorMap)}(e,i,o)):i.isMeshMatcapMaterial?(n(e,i),function(e,t){t.matcap&&(e.matcap.value=t.matcap)}(e,i)):i.isMeshDepthMaterial?n(e,i):i.isMeshDistanceMaterial?(n(e,i),function(e,t){e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance}(e,i)):i.isMeshNormalMaterial?n(e,i):i.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity}(e,i),i.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(e,i)):i.isPointsMaterial?function(e,t,n,i){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*n,e.scale.value=.5*i,t.map&&(e.map.value=t.map);t.alphaMap&&(e.alphaMap.value=t.alphaMap);t.alphaTest>0&&(e.alphaTest.value=t.alphaTest);let r;t.map?r=t.map:t.alphaMap&&(r=t.alphaMap);void 0!==r&&(!0===r.matrixAutoUpdate&&r.updateMatrix(),e.uvTransform.value.copy(r.matrix))}(e,i,r,s):i.isSpriteMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map);t.alphaMap&&(e.alphaMap.value=t.alphaMap);t.alphaTest>0&&(e.alphaTest.value=t.alphaTest);let n;t.map?n=t.map:t.alphaMap&&(n=t.alphaMap);void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),e.uvTransform.value.copy(n.matrix))}(e,i):i.isShadowMaterial?(e.color.value.copy(i.color),e.opacity.value=i.opacity):i.isShaderMaterial&&(i.uniformsNeedUpdate=!1)}}}function Vr(e={}){this.isWebGLRenderer=!0;const t=void 0!==e.canvas?e.canvas:function(){const e=E("canvas");return e.style.display="block",e}(),n=void 0!==e.context?e.context:null,i=void 0===e.depth||e.depth,r=void 0===e.stencil||e.stencil,s=void 0!==e.antialias&&e.antialias,o=void 0===e.premultipliedAlpha||e.premultipliedAlpha,a=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,c=void 0!==e.powerPreference?e.powerPreference:"default",l=void 0!==e.failIfMajorPerformanceCaveat&&e.failIfMajorPerformanceCaveat;let u;u=null!==n?n.getContextAttributes().alpha:void 0!==e.alpha&&e.alpha;let h=null,d=null;const p=[],f=[];this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=3e3,this.physicallyCorrectLights=!1,this.toneMapping=0,this.toneMappingExposure=1,Object.defineProperties(this,{gammaFactor:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaFactor has been removed."),2},set:function(){console.warn("THREE.WebGLRenderer: .gammaFactor has been removed.")}}});const m=this;let g=!1,v=0,y=0,x=null,w=-1,b=null;const S=new j,M=new j;let T=null,C=t.width,R=t.height,P=1,L=null,D=null;const I=new j(0,0,C,R),k=new j(0,0,C,R);let O=!1;const B=new ln;let N=!1,z=!1,F=null;const U=new Ee,H=new _,V=new Y,G={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function W(){return null===x?P:1}let X,q,Z,K,Q,$,ee,te,ne,ie,re,se,oe,ae,ce,le,ue,he,de,pe,fe,me,ge,ve=n;function ye(e,n){for(let i=0;i<e.length;i++){const r=e[i],s=t.getContext(r,n);if(null!==s)return s}return null}try{const e={alpha:!0,depth:i,stencil:r,antialias:s,premultipliedAlpha:o,preserveDrawingBuffer:a,powerPreference:c,failIfMajorPerformanceCaveat:l};if("setAttribute"in t&&t.setAttribute("data-engine","three.js r142"),t.addEventListener("webglcontextlost",be,!1),t.addEventListener("webglcontextrestored",Ae,!1),t.addEventListener("webglcontextcreationerror",Se,!1),null===ve){const t=["webgl2","webgl","experimental-webgl"];if(!0===m.isWebGL1Renderer&&t.shift(),ve=ye(t,e),null===ve)throw ye(t)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===ve.getShaderPrecisionFormat&&(ve.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){throw console.error("THREE.WebGLRenderer: "+e.message),e}function xe(){X=new Nn(ve),q=new xn(ve,X,e),X.init(q),me=new kr(ve,X,q),Z=new Dr(ve,X,q),K=new Un,Q=new yr,$=new Ir(ve,X,Z,Q,q,me,K),ee=new bn(m),te=new Bn(m),ne=new hn(ve,q),ge=new vn(ve,X,ne,q),ie=new zn(ve,ne,K,ge),re=new jn(ve,ie,ne,K),de=new Wn(ve,q,$),le=new wn(Q),se=new vr(m,ee,te,X,q,ge,le),oe=new Hr(m,Q),ae=new Ar,ce=new Cr(X,q),he=new gn(m,ee,Z,re,u,o),ue=new Lr(m,re,q),pe=new yn(ve,X,K,q),fe=new Fn(ve,X,K,q),K.programs=se.programs,m.capabilities=q,m.extensions=X,m.properties=Q,m.renderLists=ae,m.shadowMap=ue,m.state=Z,m.info=K}xe();const we=new Ur(m,ve);function be(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),g=!0}function Ae(){console.log("THREE.WebGLRenderer: Context Restored."),g=!1;const e=K.autoReset,t=ue.enabled,n=ue.autoUpdate,i=ue.needsUpdate,r=ue.type;xe(),K.autoReset=e,ue.enabled=t,ue.autoUpdate=n,ue.needsUpdate=i,ue.type=r}function Se(e){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",e.statusMessage)}function _e(e){const t=e.target;t.removeEventListener("dispose",_e),function(e){(function(e){const t=Q.get(e).programs;void 0!==t&&(t.forEach((function(e){se.releaseProgram(e)})),e.isShaderMaterial&&se.releaseShaderCache(e))})(e),Q.remove(e)}(t)}this.xr=we,this.getContext=function(){return ve},this.getContextAttributes=function(){return ve.getContextAttributes()},this.forceContextLoss=function(){const e=X.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){const e=X.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return P},this.setPixelRatio=function(e){void 0!==e&&(P=e,this.setSize(C,R,!1))},this.getSize=function(e){return e.set(C,R)},this.setSize=function(e,n,i){we.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(C=e,R=n,t.width=Math.floor(e*P),t.height=Math.floor(n*P),!1!==i&&(t.style.width=e+"px",t.style.height=n+"px"),this.setViewport(0,0,e,n))},this.getDrawingBufferSize=function(e){return e.set(C*P,R*P).floor()},this.setDrawingBufferSize=function(e,n,i){C=e,R=n,P=i,t.width=Math.floor(e*i),t.height=Math.floor(n*i),this.setViewport(0,0,e,n)},this.getCurrentViewport=function(e){return e.copy(S)},this.getViewport=function(e){return e.copy(I)},this.setViewport=function(e,t,n,i){e.isVector4?I.set(e.x,e.y,e.z,e.w):I.set(e,t,n,i),Z.viewport(S.copy(I).multiplyScalar(P).floor())},this.getScissor=function(e){return e.copy(k)},this.setScissor=function(e,t,n,i){e.isVector4?k.set(e.x,e.y,e.z,e.w):k.set(e,t,n,i),Z.scissor(M.copy(k).multiplyScalar(P).floor())},this.getScissorTest=function(){return O},this.setScissorTest=function(e){Z.setScissorTest(O=e)},this.setOpaqueSort=function(e){L=e},this.setTransparentSort=function(e){D=e},this.getClearColor=function(e){return e.copy(he.getClearColor())},this.setClearColor=function(){he.setClearColor.apply(he,arguments)},this.getClearAlpha=function(){return he.getClearAlpha()},this.setClearAlpha=function(){he.setClearAlpha.apply(he,arguments)},this.clear=function(e=!0,t=!0,n=!0){let i=0;e&&(i|=16384),t&&(i|=256),n&&(i|=1024),ve.clear(i)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",be,!1),t.removeEventListener("webglcontextrestored",Ae,!1),t.removeEventListener("webglcontextcreationerror",Se,!1),ae.dispose(),ce.dispose(),Q.dispose(),ee.dispose(),te.dispose(),re.dispose(),ge.dispose(),se.dispose(),we.dispose(),we.removeEventListener("sessionstart",Te),we.removeEventListener("sessionend",Ce),F&&(F.dispose(),F=null),Re.stop()},this.renderBufferDirect=function(e,t,n,i,r,s){null===t&&(t=G);const o=r.isMesh&&r.matrixWorld.determinant()<0,a=function(e,t,n,i,r){!0!==t.isScene&&(t=G);$.resetTextureUnits();const s=t.fog,o=i.isMeshStandardMaterial?t.environment:null,a=null===x?m.outputEncoding:!0===x.isXRRenderTarget?x.texture.encoding:3e3,c=(i.isMeshStandardMaterial?te:ee).get(i.envMap||o),l=!0===i.vertexColors&&!!n.attributes.color&&4===n.attributes.color.itemSize,u=!!i.normalMap&&!!n.attributes.tangent,h=!!n.morphAttributes.position,p=!!n.morphAttributes.normal,f=!!n.morphAttributes.color,g=i.toneMapped?m.toneMapping:0,v=n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color,y=void 0!==v?v.length:0,A=Q.get(i),S=d.state.lights;if(!0===N&&(!0===z||e!==b)){const t=e===b&&i.id===w;le.setState(i,e,t)}let _=!1;i.version===A.__version?A.needsLights&&A.lightsStateVersion!==S.state.version||A.outputEncoding!==a||r.isInstancedMesh&&!1===A.instancing?_=!0:r.isInstancedMesh||!0!==A.instancing?r.isSkinnedMesh&&!1===A.skinning?_=!0:r.isSkinnedMesh||!0!==A.skinning?A.envMap!==c||!0===i.fog&&A.fog!==s?_=!0:void 0===A.numClippingPlanes||A.numClippingPlanes===le.numPlanes&&A.numIntersection===le.numIntersection?(A.vertexAlphas!==l||A.vertexTangents!==u||A.morphTargets!==h||A.morphNormals!==p||A.morphColors!==f||A.toneMapping!==g||!0===q.isWebGL2&&A.morphTargetsCount!==y)&&(_=!0):_=!0:_=!0:_=!0:(_=!0,A.__version=i.version);let M=A.currentProgram;!0===_&&(M=Ie(i,t,r));let T=!1,E=!1,C=!1;const L=M.getUniforms(),D=A.uniforms;Z.useProgram(M.program)&&(T=!0,E=!0,C=!0);i.id!==w&&(w=i.id,E=!0);if(T||b!==e){if(L.setValue(ve,"projectionMatrix",e.projectionMatrix),q.logarithmicDepthBuffer&&L.setValue(ve,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),b!==e&&(b=e,E=!0,C=!0),i.isShaderMaterial||i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshStandardMaterial||i.envMap){const t=L.map.cameraPosition;void 0!==t&&t.setValue(ve,V.setFromMatrixPosition(e.matrixWorld))}(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial)&&L.setValue(ve,"isOrthographic",!0===e.isOrthographicCamera),(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial||i.isShadowMaterial||r.isSkinnedMesh)&&L.setValue(ve,"viewMatrix",e.matrixWorldInverse)}if(r.isSkinnedMesh){L.setOptional(ve,r,"bindMatrix"),L.setOptional(ve,r,"bindMatrixInverse");const e=r.skeleton;e&&(q.floatVertexTextures?(null===e.boneTexture&&e.computeBoneTexture(),L.setValue(ve,"boneTexture",e.boneTexture,$),L.setValue(ve,"boneTextureSize",e.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const I=n.morphAttributes;(void 0!==I.position||void 0!==I.normal||void 0!==I.color&&!0===q.isWebGL2)&&de.update(r,n,i,M);(E||A.receiveShadow!==r.receiveShadow)&&(A.receiveShadow=r.receiveShadow,L.setValue(ve,"receiveShadow",r.receiveShadow));E&&(L.setValue(ve,"toneMappingExposure",m.toneMappingExposure),A.needsLights&&(O=C,(k=D).ambientLightColor.needsUpdate=O,k.lightProbe.needsUpdate=O,k.directionalLights.needsUpdate=O,k.directionalLightShadows.needsUpdate=O,k.pointLights.needsUpdate=O,k.pointLightShadows.needsUpdate=O,k.spotLights.needsUpdate=O,k.spotLightShadows.needsUpdate=O,k.rectAreaLights.needsUpdate=O,k.hemisphereLights.needsUpdate=O),s&&!0===i.fog&&oe.refreshFogUniforms(D,s),oe.refreshMaterialUniforms(D,i,P,R,F),Zi.upload(ve,A.uniformsList,D,$));var k,O;i.isShaderMaterial&&!0===i.uniformsNeedUpdate&&(Zi.upload(ve,A.uniformsList,D,$),i.uniformsNeedUpdate=!1);i.isSpriteMaterial&&L.setValue(ve,"center",r.center);return L.setValue(ve,"modelViewMatrix",r.modelViewMatrix),L.setValue(ve,"normalMatrix",r.normalMatrix),L.setValue(ve,"modelMatrix",r.matrixWorld),M}(e,t,n,i,r);Z.setMaterial(i,o);let c=n.index;const l=n.attributes.position;if(null===c){if(void 0===l||0===l.count)return}else if(0===c.count)return;let u,h=1;!0===i.wireframe&&(c=ie.getWireframeAttribute(n),h=2),ge.setup(r,i,a,n,c);let p=pe;null!==c&&(u=ne.get(c),p=fe,p.setIndex(u));const f=null!==c?c.count:l.count,g=n.drawRange.start*h,v=n.drawRange.count*h,y=null!==s?s.start*h:0,A=null!==s?s.count*h:1/0,S=Math.max(g,y),_=Math.min(f,g+v,y+A)-1,M=Math.max(0,_-S+1);if(0!==M){if(r.isMesh)!0===i.wireframe?(Z.setLineWidth(i.wireframeLinewidth*W()),p.setMode(1)):p.setMode(4);else if(r.isLine){let e=i.linewidth;void 0===e&&(e=1),Z.setLineWidth(e*W()),r.isLineSegments?p.setMode(1):r.isLineLoop?p.setMode(2):p.setMode(3)}else r.isPoints?p.setMode(0):r.isSprite&&p.setMode(4);if(r.isInstancedMesh)p.renderInstances(S,M,r.count);else if(n.isInstancedBufferGeometry){const e=Math.min(n.instanceCount,n._maxInstanceCount);p.renderInstances(S,M,e)}else p.render(S,M)}},this.compile=function(e,t){d=ce.get(e),d.init(),f.push(d),e.traverseVisible((function(e){e.isLight&&e.layers.test(t.layers)&&(d.pushLight(e),e.castShadow&&d.pushShadow(e))})),d.setupLights(m.physicallyCorrectLights),e.traverse((function(t){const n=t.material;if(n)if(Array.isArray(n))for(let i=0;i<n.length;i++){Ie(n[i],e,t)}else Ie(n,e,t)})),f.pop(),d=null};let Me=null;function Te(){Re.stop()}function Ce(){Re.start()}const Re=new un;function Pe(e,t,n,i){const r=e.opaque,o=e.transmissive,a=e.transparent;d.setupLightsView(n),o.length>0&&function(e,t,n){const i=q.isWebGL2;null===F&&(F=new J(1,1,{generateMipmaps:!0,type:X.has("EXT_color_buffer_half_float")?1016:1009,minFilter:1008,samples:i&&!0===s?4:0}));m.getDrawingBufferSize(H),i?F.setSize(H.x,H.y):F.setSize(A(H.x),A(H.y));const r=m.getRenderTarget();m.setRenderTarget(F),m.clear();const o=m.toneMapping;m.toneMapping=0,Le(e,t,n),m.toneMapping=o,$.updateMultisampleRenderTarget(F),$.updateRenderTargetMipmap(F),m.setRenderTarget(r)}(r,t,n),i&&Z.viewport(S.copy(i)),r.length>0&&Le(r,t,n),o.length>0&&Le(o,t,n),a.length>0&&Le(a,t,n),Z.buffers.depth.setTest(!0),Z.buffers.depth.setMask(!0),Z.buffers.color.setMask(!0),Z.setPolygonOffset(!1)}function Le(e,t,n){const i=!0===t.isScene?t.overrideMaterial:null;for(let r=0,s=e.length;r<s;r++){const s=e[r],o=s.object,a=s.geometry,c=null===i?s.material:i,l=s.group;o.layers.test(n.layers)&&De(o,t,n,a,c,l)}}function De(e,t,n,i,r,s){e.onBeforeRender(m,t,n,i,r,s),e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),r.onBeforeRender(m,t,n,i,e,s),!0===r.transparent&&2===r.side?(r.side=1,r.needsUpdate=!0,m.renderBufferDirect(n,t,i,r,e,s),r.side=0,r.needsUpdate=!0,m.renderBufferDirect(n,t,i,r,e,s),r.side=2):m.renderBufferDirect(n,t,i,r,e,s),e.onAfterRender(m,t,n,i,r,s)}function Ie(e,t,n){!0!==t.isScene&&(t=G);const i=Q.get(e),r=d.state.lights,s=d.state.shadowsArray,o=r.state.version,a=se.getParameters(e,r.state,s,t,n),c=se.getProgramCacheKey(a);let l=i.programs;i.environment=e.isMeshStandardMaterial?t.environment:null,i.fog=t.fog,i.envMap=(e.isMeshStandardMaterial?te:ee).get(e.envMap||i.environment),void 0===l&&(e.addEventListener("dispose",_e),l=new Map,i.programs=l);let u=l.get(c);if(void 0!==u){if(i.currentProgram===u&&i.lightsStateVersion===o)return ke(e,a),u}else a.uniforms=se.getUniforms(e),e.onBuild(n,a,m),e.onBeforeCompile(a,m),u=se.acquireProgram(a,c),l.set(c,u),i.uniforms=a.uniforms;const h=i.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(h.clippingPlanes=le.uniform),ke(e,a),i.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),i.lightsStateVersion=o,i.needsLights&&(h.ambientLightColor.value=r.state.ambient,h.lightProbe.value=r.state.probe,h.directionalLights.value=r.state.directional,h.directionalLightShadows.value=r.state.directionalShadow,h.spotLights.value=r.state.spot,h.spotLightShadows.value=r.state.spotShadow,h.rectAreaLights.value=r.state.rectArea,h.ltc_1.value=r.state.rectAreaLTC1,h.ltc_2.value=r.state.rectAreaLTC2,h.pointLights.value=r.state.point,h.pointLightShadows.value=r.state.pointShadow,h.hemisphereLights.value=r.state.hemi,h.directionalShadowMap.value=r.state.directionalShadowMap,h.directionalShadowMatrix.value=r.state.directionalShadowMatrix,h.spotShadowMap.value=r.state.spotShadowMap,h.spotShadowMatrix.value=r.state.spotShadowMatrix,h.pointShadowMap.value=r.state.pointShadowMap,h.pointShadowMatrix.value=r.state.pointShadowMatrix);const p=u.getUniforms(),f=Zi.seqWithValue(p.seq,h);return i.currentProgram=u,i.uniformsList=f,u}function ke(e,t){const n=Q.get(e);n.outputEncoding=t.outputEncoding,n.instancing=t.instancing,n.skinning=t.skinning,n.morphTargets=t.morphTargets,n.morphNormals=t.morphNormals,n.morphColors=t.morphColors,n.morphTargetsCount=t.morphTargetsCount,n.numClippingPlanes=t.numClippingPlanes,n.numIntersection=t.numClipIntersection,n.vertexAlphas=t.vertexAlphas,n.vertexTangents=t.vertexTangents,n.toneMapping=t.toneMapping}Re.setAnimationLoop((function(e){Me&&Me(e)})),"undefined"!=typeof self&&Re.setContext(self),this.setAnimationLoop=function(e){Me=e,we.setAnimationLoop(e),null===e?Re.stop():Re.start()},we.addEventListener("sessionstart",Te),we.addEventListener("sessionend",Ce),this.render=function(e,t){if(void 0!==t&&!0!==t.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===g)return;!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),!0===we.enabled&&!0===we.isPresenting&&(!0===we.cameraAutoUpdate&&we.updateCamera(t),t=we.getCamera()),!0===e.isScene&&e.onBeforeRender(m,e,t,x),d=ce.get(e,f.length),d.init(),f.push(d),U.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),B.setFromProjectionMatrix(U),z=this.localClippingEnabled,N=le.init(this.clippingPlanes,z,t),h=ae.get(e,p.length),h.init(),p.push(h),function e(t,n,i,r){if(!1===t.visible)return;if(t.layers.test(n.layers))if(t.isGroup)i=t.renderOrder;else if(t.isLOD)!0===t.autoUpdate&&t.update(n);else if(t.isLight)d.pushLight(t),t.castShadow&&d.pushShadow(t);else if(t.isSprite){if(!t.frustumCulled||B.intersectsSprite(t)){r&&V.setFromMatrixPosition(t.matrixWorld).applyMatrix4(U);const e=re.update(t),n=t.material;n.visible&&h.push(t,e,n,i,V.z,null)}}else if((t.isMesh||t.isLine||t.isPoints)&&(t.isSkinnedMesh&&t.skeleton.frame!==K.render.frame&&(t.skeleton.update(),t.skeleton.frame=K.render.frame),!t.frustumCulled||B.intersectsObject(t))){r&&V.setFromMatrixPosition(t.matrixWorld).applyMatrix4(U);const e=re.update(t),n=t.material;if(Array.isArray(n)){const r=e.groups;for(let s=0,o=r.length;s<o;s++){const o=r[s],a=n[o.materialIndex];a&&a.visible&&h.push(t,e,a,i,V.z,o)}}else n.visible&&h.push(t,e,n,i,V.z,null)}const s=t.children;for(let t=0,o=s.length;t<o;t++)e(s[t],n,i,r)}(e,t,0,m.sortObjects),h.finish(),!0===m.sortObjects&&h.sort(L,D),!0===N&&le.beginShadows();const n=d.state.shadowsArray;if(ue.render(n,e,t),!0===N&&le.endShadows(),!0===this.info.autoReset&&this.info.reset(),he.render(h,e),d.setupLights(m.physicallyCorrectLights),t.isArrayCamera){const n=t.cameras;for(let t=0,i=n.length;t<i;t++){const i=n[t];Pe(h,e,i,i.viewport)}}else Pe(h,e,t);null!==x&&($.updateMultisampleRenderTarget(x),$.updateRenderTargetMipmap(x)),!0===e.isScene&&e.onAfterRender(m,e,t),ge.resetDefaultState(),w=-1,b=null,f.pop(),d=f.length>0?f[f.length-1]:null,p.pop(),h=p.length>0?p[p.length-1]:null},this.getActiveCubeFace=function(){return v},this.getActiveMipmapLevel=function(){return y},this.getRenderTarget=function(){return x},this.setRenderTargetTextures=function(e,t,n){Q.get(e.texture).__webglTexture=t,Q.get(e.depthTexture).__webglTexture=n;const i=Q.get(e);i.__hasExternalTextures=!0,i.__hasExternalTextures&&(i.__autoAllocateDepthBuffer=void 0===n,i.__autoAllocateDepthBuffer||!0===X.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),i.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(e,t){const n=Q.get(e);n.__webglFramebuffer=t,n.__useDefaultFramebuffer=void 0===t},this.setRenderTarget=function(e,t=0,n=0){x=e,v=t,y=n;let i=!0;if(e){const t=Q.get(e);void 0!==t.__useDefaultFramebuffer?(Z.bindFramebuffer(36160,null),i=!1):void 0===t.__webglFramebuffer?$.setupRenderTarget(e):t.__hasExternalTextures&&$.rebindTextures(e,Q.get(e.texture).__webglTexture,Q.get(e.depthTexture).__webglTexture)}let r=null,s=!1,o=!1;if(e){const n=e.texture;(n.isData3DTexture||n.isDataArrayTexture)&&(o=!0);const i=Q.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(r=i[t],s=!0):r=q.isWebGL2&&e.samples>0&&!1===$.useMultisampledRTT(e)?Q.get(e).__webglMultisampledFramebuffer:i,S.copy(e.viewport),M.copy(e.scissor),T=e.scissorTest}else S.copy(I).multiplyScalar(P).floor(),M.copy(k).multiplyScalar(P).floor(),T=O;if(Z.bindFramebuffer(36160,r)&&q.drawBuffers&&i&&Z.drawBuffers(e,r),Z.viewport(S),Z.scissor(M),Z.setScissorTest(T),s){const i=Q.get(e.texture);ve.framebufferTexture2D(36160,36064,34069+t,i.__webglTexture,n)}else if(o){const i=Q.get(e.texture),r=t||0;ve.framebufferTextureLayer(36160,36064,i.__webglTexture,n||0,r)}w=-1},this.readRenderTargetPixels=function(e,t,n,i,r,s,o){if(!e||!e.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let a=Q.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==o&&(a=a[o]),a){Z.bindFramebuffer(36160,a);try{const o=e.texture,a=o.format,c=o.type;if(1023!==a&&me.convert(a)!==ve.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const l=1016===c&&(X.has("EXT_color_buffer_half_float")||q.isWebGL2&&X.has("EXT_color_buffer_float"));if(!(1009===c||me.convert(c)===ve.getParameter(35738)||1015===c&&(q.isWebGL2||X.has("OES_texture_float")||X.has("WEBGL_color_buffer_float"))||l))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");t>=0&&t<=e.width-i&&n>=0&&n<=e.height-r&&ve.readPixels(t,n,i,r,me.convert(a),me.convert(c),s)}finally{const e=null!==x?Q.get(x).__webglFramebuffer:null;Z.bindFramebuffer(36160,e)}}},this.copyFramebufferToTexture=function(e,t,n=0){const i=Math.pow(2,-n),r=Math.floor(t.image.width*i),s=Math.floor(t.image.height*i);$.setTexture2D(t,0),ve.copyTexSubImage2D(3553,n,0,0,e.x,e.y,r,s),Z.unbindTexture()},this.copyTextureToTexture=function(e,t,n,i=0){const r=t.image.width,s=t.image.height,o=me.convert(n.format),a=me.convert(n.type);$.setTexture2D(n,0),ve.pixelStorei(37440,n.flipY),ve.pixelStorei(37441,n.premultiplyAlpha),ve.pixelStorei(3317,n.unpackAlignment),t.isDataTexture?ve.texSubImage2D(3553,i,e.x,e.y,r,s,o,a,t.image.data):t.isCompressedTexture?ve.compressedTexSubImage2D(3553,i,e.x,e.y,t.mipmaps[0].width,t.mipmaps[0].height,o,t.mipmaps[0].data):ve.texSubImage2D(3553,i,e.x,e.y,o,a,t.image),0===i&&n.generateMipmaps&&ve.generateMipmap(3553),Z.unbindTexture()},this.copyTextureToTexture3D=function(e,t,n,i,r=0){if(m.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const s=e.max.x-e.min.x+1,o=e.max.y-e.min.y+1,a=e.max.z-e.min.z+1,c=me.convert(i.format),l=me.convert(i.type);let u;if(i.isData3DTexture)$.setTexture3D(i,0),u=32879;else{if(!i.isDataArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");$.setTexture2DArray(i,0),u=35866}ve.pixelStorei(37440,i.flipY),ve.pixelStorei(37441,i.premultiplyAlpha),ve.pixelStorei(3317,i.unpackAlignment);const h=ve.getParameter(3314),d=ve.getParameter(32878),p=ve.getParameter(3316),f=ve.getParameter(3315),g=ve.getParameter(32877),v=n.isCompressedTexture?n.mipmaps[0]:n.image;ve.pixelStorei(3314,v.width),ve.pixelStorei(32878,v.height),ve.pixelStorei(3316,e.min.x),ve.pixelStorei(3315,e.min.y),ve.pixelStorei(32877,e.min.z),n.isDataTexture||n.isData3DTexture?ve.texSubImage3D(u,r,t.x,t.y,t.z,s,o,a,c,l,v.data):n.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),ve.compressedTexSubImage3D(u,r,t.x,t.y,t.z,s,o,a,c,v.data)):ve.texSubImage3D(u,r,t.x,t.y,t.z,s,o,a,c,l,v),ve.pixelStorei(3314,h),ve.pixelStorei(32878,d),ve.pixelStorei(3316,p),ve.pixelStorei(3315,f),ve.pixelStorei(32877,g),0===r&&i.generateMipmaps&&ve.generateMipmap(u),Z.unbindTexture()},this.initTexture=function(e){e.isCubeTexture?$.setTextureCube(e,0):e.isData3DTexture?$.setTexture3D(e,0):e.isDataArrayTexture?$.setTexture2DArray(e,0):$.setTexture2D(e,0),Z.unbindTexture()},this.resetState=function(){v=0,y=0,x=null,Z.reset(),ge.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}(class extends Vr{}).prototype.isWebGL1Renderer=!0;class Gr{constructor(e,t=1,n=1e3){this.isFog=!0,this.name="",this.color=new z(e),this.near=t,this.far=n}clone(){return new Gr(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}class Wr extends Qe{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),t}}class jr{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=35044,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=g()}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,n){e*=this.stride,n*=t.stride;for(let i=0,r=this.stride;i<r;i++)this.array[e+i]=t.array[n+i];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=g()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(t,this.stride);return n.setUsage(this.usage),n}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=g()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const Jr=new Y;class Xr{constructor(e,t,n,i=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=!0===i}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,n=this.data.count;t<n;t++)Jr.fromBufferAttribute(this,t),Jr.applyMatrix4(e),this.setXYZ(t,Jr.x,Jr.y,Jr.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)Jr.fromBufferAttribute(this,t),Jr.applyNormalMatrix(e),this.setXYZ(t,Jr.x,Jr.y,Jr.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)Jr.fromBufferAttribute(this,t),Jr.transformDirection(e),this.setXYZ(t,Jr.x,Jr.y,Jr.z);return this}setX(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){return this.data.array[e*this.data.stride+this.offset]}getY(e){return this.data.array[e*this.data.stride+this.offset+1]}getZ(e){return this.data.array[e*this.data.stride+this.offset+2]}getW(e){return this.data.array[e*this.data.stride+this.offset+3]}setXY(e,t,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this}setXYZ(e,t,n,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this}setXYZW(e,t,n,i,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this.data.array[e+3]=r,this}clone(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will deinterleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const n=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[n+t])}return new mt(new this.array.constructor(e),this.itemSize,this.normalized)}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new Xr(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will deinterleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const n=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[n+t])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}const qr=new Y,Zr=new j,Yr=new j,Kr=new Y,Qr=new Ee;class $r extends Wt{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Ee,this.bindMatrixInverse=new Ee}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this}bind(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new j,t=this.geometry.attributes.skinWeight;for(let n=0,i=t.count;n<i;n++){e.fromBufferAttribute(t,n);const i=1/e.manhattanLength();i!==1/0?e.multiplyScalar(i):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(e,t){const n=this.skeleton,i=this.geometry;Zr.fromBufferAttribute(i.attributes.skinIndex,e),Yr.fromBufferAttribute(i.attributes.skinWeight,e),qr.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let e=0;e<4;e++){const i=Yr.getComponent(e);if(0!==i){const r=Zr.getComponent(e);Qr.multiplyMatrices(n.bones[r].matrixWorld,n.boneInverses[r]),t.addScaledVector(Kr.copy(qr).applyMatrix4(Qr),i)}}return t.applyMatrix4(this.bindMatrixInverse)}}class es extends Qe{constructor(){super(),this.isBone=!0,this.type="Bone"}}class ts extends W{constructor(e=null,t=1,n=1,i,r,s,o,a,c=1003,l=1003,u,h){super(null,s,o,a,c,l,i,r,u,h),this.isDataTexture=!0,this.image={data:e,width:t,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const ns=new Ee,is=new Ee;class rs{constructor(e=[],t=[]){this.uuid=g(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===t.length)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let e=0,t=this.bones.length;e<t;e++)this.boneInverses.push(new Ee)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const t=new Ee;this.bones[e]&&t.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(t)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&t.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&(t.parent&&t.parent.isBone?(t.matrix.copy(t.parent.matrixWorld).invert(),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))}}update(){const e=this.bones,t=this.boneInverses,n=this.boneMatrices,i=this.boneTexture;for(let i=0,r=e.length;i<r;i++){const r=e[i]?e[i].matrixWorld:is;ns.multiplyMatrices(r,t[i]),ns.toArray(n,16*i)}null!==i&&(i.needsUpdate=!0)}clone(){return new rs(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(4*this.bones.length);e=b(e),e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const n=new ts(t,e,e,1023,1015);return n.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=n,this.boneTextureSize=e,this}getBoneByName(e){for(let t=0,n=this.bones.length;t<n;t++){const n=this.bones[t];if(n.name===e)return n}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let n=0,i=e.bones.length;n<i;n++){const i=e.bones[n];let r=t[i];void 0===r&&(console.warn("THREE.Skeleton: No bone found with UUID:",i),r=new es),this.bones.push(r),this.boneInverses.push((new Ee).fromArray(e.boneInverses[n]))}return this.init(),this}toJSON(){const e={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,n=this.boneInverses;for(let i=0,r=t.length;i<r;i++){const r=t[i];e.bones.push(r.uuid);const s=n[i];e.boneInverses.push(s.toArray())}return e}}class ss extends mt{constructor(e,t,n,i=1){"number"==typeof n&&(i=n,n=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),super(e,t,n),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const os=new Ee,as=new Ee,cs=[],ls=new Wt;class us extends Wt{constructor(e,t,n){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new ss(new Float32Array(16*n),16),this.instanceColor=null,this.count=n,this.frustumCulled=!1}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}getColorAt(e,t){t.fromArray(this.instanceColor.array,3*e)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,16*e)}raycast(e,t){const n=this.matrixWorld,i=this.count;if(ls.geometry=this.geometry,ls.material=this.material,void 0!==ls.material)for(let r=0;r<i;r++){this.getMatrixAt(r,os),as.multiplyMatrices(n,os),ls.matrixWorld=as,ls.raycast(e,cs);for(let e=0,n=cs.length;e<n;e++){const n=cs[e];n.instanceId=r,n.object=this,t.push(n)}cs.length=0}}setColorAt(e,t){null===this.instanceColor&&(this.instanceColor=new ss(new Float32Array(3*this.instanceMatrix.count),3)),t.toArray(this.instanceColor.array,3*e)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,16*e)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}class hs extends ht{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new z(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const ds=new Y,ps=new Y,fs=new Ee,ms=new Te,gs=new ye;class vs extends Qe{constructor(e=new Tt,t=new hs){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,n=[0];for(let e=1,i=t.count;e<i;e++)ds.fromBufferAttribute(t,e-1),ps.fromBufferAttribute(t,e),n[e]=n[e-1],n[e]+=ds.distanceTo(ps);e.setAttribute("lineDistance",new yt(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const n=this.geometry,i=this.matrixWorld,r=e.params.Line.threshold,s=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),gs.copy(n.boundingSphere),gs.applyMatrix4(i),gs.radius+=r,!1===e.ray.intersectsSphere(gs))return;fs.copy(i).invert(),ms.copy(e.ray).applyMatrix4(fs);const o=r/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o,c=new Y,l=new Y,u=new Y,h=new Y,d=this.isLineSegments?2:1,p=n.index,f=n.attributes.position;if(null!==p){for(let n=Math.max(0,s.start),i=Math.min(p.count,s.start+s.count)-1;n<i;n+=d){const i=p.getX(n),r=p.getX(n+1);c.fromBufferAttribute(f,i),l.fromBufferAttribute(f,r);if(ms.distanceSqToSegment(c,l,h,u)>a)continue;h.applyMatrix4(this.matrixWorld);const s=e.ray.origin.distanceTo(h);s<e.near||s>e.far||t.push({distance:s,point:u.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}else{for(let n=Math.max(0,s.start),i=Math.min(f.count,s.start+s.count)-1;n<i;n+=d){c.fromBufferAttribute(f,n),l.fromBufferAttribute(f,n+1);if(ms.distanceSqToSegment(c,l,h,u)>a)continue;h.applyMatrix4(this.matrixWorld);const i=e.ray.origin.distanceTo(h);i<e.near||i>e.far||t.push({distance:i,point:u.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}}const ys=new Y,xs=new Y;class ws extends vs{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,n=[];for(let e=0,i=t.count;e<i;e+=2)ys.fromBufferAttribute(t,e),xs.fromBufferAttribute(t,e+1),n[e]=0===e?0:n[e-1],n[e+1]=n[e]+ys.distanceTo(xs);e.setAttribute("lineDistance",new yt(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class bs extends vs{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class As extends ht{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new z(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const Ss=new Ee,_s=new Te,Ms=new ye,Ts=new Y;class Es extends Qe{constructor(e=new Tt,t=new As){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}raycast(e,t){const n=this.geometry,i=this.matrixWorld,r=e.params.Points.threshold,s=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),Ms.copy(n.boundingSphere),Ms.applyMatrix4(i),Ms.radius+=r,!1===e.ray.intersectsSphere(Ms))return;Ss.copy(i).invert(),_s.copy(e.ray).applyMatrix4(Ss);const o=r/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o,c=n.index,l=n.attributes.position;if(null!==c){for(let n=Math.max(0,s.start),r=Math.min(c.count,s.start+s.count);n<r;n++){const r=c.getX(n);Ts.fromBufferAttribute(l,r),Cs(Ts,r,a,i,e,t,this)}}else{for(let n=Math.max(0,s.start),r=Math.min(l.count,s.start+s.count);n<r;n++)Ts.fromBufferAttribute(l,n),Cs(Ts,n,a,i,e,t,this)}}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}}function Cs(e,t,n,i,r,s,o){const a=_s.distanceSqToPoint(e);if(a<n){const n=new Y;_s.closestPointToPoint(e,n),n.applyMatrix4(i);const c=r.ray.origin.distanceTo(n);if(c<r.near||c>r.far)return;s.push({distance:c,distanceToRay:Math.sqrt(a),point:n,index:t,face:null,object:o})}}class Rs extends W{constructor(e,t,n,i,r,s,o,a,c){super(e,t,n,i,r,s,o,a,c),this.isVideoTexture=!0,this.minFilter=void 0!==s?s:1006,this.magFilter=void 0!==r?r:1006,this.generateMipmaps=!1;const l=this;"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback((function t(){l.needsUpdate=!0,e.requestVideoFrameCallback(t)}))}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;!1==="requestVideoFrameCallback"in e&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class Ps{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const n=this.getUtoTmapping(e);return this.getPoint(n,t)}getPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}getSpacedPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let n,i=this.getPoint(0),r=0;t.push(0);for(let s=1;s<=e;s++)n=this.getPoint(s/e),r+=n.distanceTo(i),t.push(r),i=n;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const n=this.getLengths();let i=0;const r=n.length;let s;s=t||e*n[r-1];let o,a=0,c=r-1;for(;a<=c;)if(i=Math.floor(a+(c-a)/2),o=n[i]-s,o<0)a=i+1;else{if(!(o>0)){c=i;break}c=i-1}if(i=c,n[i]===s)return i/(r-1);const l=n[i];return(i+(s-l)/(n[i+1]-l))/(r-1)}getTangent(e,t){let n=e-1e-4,i=e+1e-4;n<0&&(n=0),i>1&&(i=1);const r=this.getPoint(n),s=this.getPoint(i),o=t||(r.isVector2?new _:new Y);return o.copy(s).sub(r).normalize(),o}getTangentAt(e,t){const n=this.getUtoTmapping(e);return this.getTangent(n,t)}computeFrenetFrames(e,t){const n=new Y,i=[],r=[],s=[],o=new Y,a=new Ee;for(let t=0;t<=e;t++){const n=t/e;i[t]=this.getTangentAt(n,new Y)}r[0]=new Y,s[0]=new Y;let c=Number.MAX_VALUE;const l=Math.abs(i[0].x),u=Math.abs(i[0].y),h=Math.abs(i[0].z);l<=c&&(c=l,n.set(1,0,0)),u<=c&&(c=u,n.set(0,1,0)),h<=c&&n.set(0,0,1),o.crossVectors(i[0],n).normalize(),r[0].crossVectors(i[0],o),s[0].crossVectors(i[0],r[0]);for(let t=1;t<=e;t++){if(r[t]=r[t-1].clone(),s[t]=s[t-1].clone(),o.crossVectors(i[t-1],i[t]),o.length()>Number.EPSILON){o.normalize();const e=Math.acos(v(i[t-1].dot(i[t]),-1,1));r[t].applyMatrix4(a.makeRotationAxis(o,e))}s[t].crossVectors(i[t],r[t])}if(!0===t){let t=Math.acos(v(r[0].dot(r[e]),-1,1));t/=e,i[0].dot(o.crossVectors(r[0],r[e]))>0&&(t=-t);for(let n=1;n<=e;n++)r[n].applyMatrix4(a.makeRotationAxis(i[n],t*n)),s[n].crossVectors(i[n],r[n])}return{tangents:i,normals:r,binormals:s}}clone(){return(new this.constructor).copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class Ls extends Ps{constructor(e=0,t=0,n=1,i=1,r=0,s=2*Math.PI,o=!1,a=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=i,this.aStartAngle=r,this.aEndAngle=s,this.aClockwise=o,this.aRotation=a}getPoint(e,t){const n=t||new _,i=2*Math.PI;let r=this.aEndAngle-this.aStartAngle;const s=Math.abs(r)<Number.EPSILON;for(;r<0;)r+=i;for(;r>i;)r-=i;r<Number.EPSILON&&(r=s?0:i),!0!==this.aClockwise||s||(r===i?r=-i:r-=i);const o=this.aStartAngle+e*r;let a=this.aX+this.xRadius*Math.cos(o),c=this.aY+this.yRadius*Math.sin(o);if(0!==this.aRotation){const e=Math.cos(this.aRotation),t=Math.sin(this.aRotation),n=a-this.aX,i=c-this.aY;a=n*e-i*t+this.aX,c=n*t+i*e+this.aY}return n.set(a,c)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}function Ds(){let e=0,t=0,n=0,i=0;function r(r,s,o,a){e=r,t=o,n=-3*r+3*s-2*o-a,i=2*r-2*s+o+a}return{initCatmullRom:function(e,t,n,i,s){r(t,n,s*(n-e),s*(i-t))},initNonuniformCatmullRom:function(e,t,n,i,s,o,a){let c=(t-e)/s-(n-e)/(s+o)+(n-t)/o,l=(n-t)/o-(i-t)/(o+a)+(i-n)/a;c*=o,l*=o,r(t,n,c,l)},calc:function(r){const s=r*r;return e+t*r+n*s+i*(s*r)}}}const Is=new Y,ks=new Ds,Os=new Ds,Bs=new Ds;function Ns(e,t,n,i,r){const s=.5*(i-t),o=.5*(r-n),a=e*e;return(2*n-2*i+s+o)*(e*a)+(-3*n+3*i-2*s-o)*a+s*e+n}function zs(e,t,n,i){return function(e,t){const n=1-e;return n*n*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,n)+function(e,t){return e*e*t}(e,i)}function Fs(e,t,n,i,r){return function(e,t){const n=1-e;return n*n*n*t}(e,t)+function(e,t){const n=1-e;return 3*n*n*e*t}(e,n)+function(e,t){return 3*(1-e)*e*e*t}(e,i)+function(e,t){return e*e*e*t}(e,r)}class Us extends Ps{constructor(e=new _,t=new _,n=new _,i=new _){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=n,this.v3=i}getPoint(e,t=new _){const n=t,i=this.v0,r=this.v1,s=this.v2,o=this.v3;return n.set(Fs(e,i.x,r.x,s.x,o.x),Fs(e,i.y,r.y,s.y,o.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class Hs extends Ps{constructor(e=new _,t=new _){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new _){const n=t;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t){const n=t||new _;return n.copy(this.v2).sub(this.v1).normalize(),n}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Vs extends Ps{constructor(e=new _,t=new _,n=new _){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new _){const n=t,i=this.v0,r=this.v1,s=this.v2;return n.set(zs(e,i.x,r.x,s.x),zs(e,i.y,r.y,s.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Gs extends Ps{constructor(e=new Y,t=new Y,n=new Y){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new Y){const n=t,i=this.v0,r=this.v1,s=this.v2;return n.set(zs(e,i.x,r.x,s.x),zs(e,i.y,r.y,s.y),zs(e,i.z,r.z,s.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Ws extends Ps{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new _){const n=t,i=this.points,r=(i.length-1)*e,s=Math.floor(r),o=r-s,a=i[0===s?s:s-1],c=i[s],l=i[s>i.length-2?i.length-1:s+1],u=i[s>i.length-3?i.length-1:s+2];return n.set(Ns(o,a.x,c.x,l.x,u.x),Ns(o,a.y,c.y,l.y,u.y)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push(n.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const n=this.points[t];e.points.push(n.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push((new _).fromArray(n))}return this}}var js=Object.freeze({__proto__:null,ArcCurve:class extends Ls{constructor(e,t,n,i,r,s){super(e,t,n,n,i,r,s),this.isArcCurve=!0,this.type="ArcCurve"}},CatmullRomCurve3:class extends Ps{constructor(e=[],t=!1,n="centripetal",i=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=n,this.tension=i}getPoint(e,t=new Y){const n=t,i=this.points,r=i.length,s=(r-(this.closed?0:1))*e;let o,a,c=Math.floor(s),l=s-c;this.closed?c+=c>0?0:(Math.floor(Math.abs(c)/r)+1)*r:0===l&&c===r-1&&(c=r-2,l=1),this.closed||c>0?o=i[(c-1)%r]:(Is.subVectors(i[0],i[1]).add(i[0]),o=Is);const u=i[c%r],h=i[(c+1)%r];if(this.closed||c+2<r?a=i[(c+2)%r]:(Is.subVectors(i[r-1],i[r-2]).add(i[r-1]),a=Is),"centripetal"===this.curveType||"chordal"===this.curveType){const e="chordal"===this.curveType?.5:.25;let t=Math.pow(o.distanceToSquared(u),e),n=Math.pow(u.distanceToSquared(h),e),i=Math.pow(h.distanceToSquared(a),e);n<1e-4&&(n=1),t<1e-4&&(t=n),i<1e-4&&(i=n),ks.initNonuniformCatmullRom(o.x,u.x,h.x,a.x,t,n,i),Os.initNonuniformCatmullRom(o.y,u.y,h.y,a.y,t,n,i),Bs.initNonuniformCatmullRom(o.z,u.z,h.z,a.z,t,n,i)}else"catmullrom"===this.curveType&&(ks.initCatmullRom(o.x,u.x,h.x,a.x,this.tension),Os.initCatmullRom(o.y,u.y,h.y,a.y,this.tension),Bs.initCatmullRom(o.z,u.z,h.z,a.z,this.tension));return n.set(ks.calc(l),Os.calc(l),Bs.calc(l)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push(n.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const n=this.points[t];e.points.push(n.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push((new Y).fromArray(n))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}},CubicBezierCurve:Us,CubicBezierCurve3:class extends Ps{constructor(e=new Y,t=new Y,n=new Y,i=new Y){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=n,this.v3=i}getPoint(e,t=new Y){const n=t,i=this.v0,r=this.v1,s=this.v2,o=this.v3;return n.set(Fs(e,i.x,r.x,s.x,o.x),Fs(e,i.y,r.y,s.y,o.y),Fs(e,i.z,r.z,s.z,o.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}},EllipseCurve:Ls,LineCurve:Hs,LineCurve3:class extends Ps{constructor(e=new Y,t=new Y){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new Y){const n=t;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},QuadraticBezierCurve:Vs,QuadraticBezierCurve3:Gs,SplineCurve:Ws});class Js extends Ps{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new Hs(t,e))}getPoint(e,t){const n=e*this.getLength(),i=this.getCurveLengths();let r=0;for(;r<i.length;){if(i[r]>=n){const e=i[r]-n,s=this.curves[r],o=s.getLength(),a=0===o?0:1-e/o;return s.getPointAt(a,t)}r++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let n=0,i=this.curves.length;n<i;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let n;for(let i=0,r=this.curves;i<r.length;i++){const s=r[i],o=s.isEllipseCurve?2*e:s.isLineCurve||s.isLineCurve3?1:s.isSplineCurve?e*s.points.length:e,a=s.getPoints(o);for(let e=0;e<a.length;e++){const i=a[e];n&&n.equals(i)||(t.push(i),n=i)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const n=e.curves[t];this.curves.push(n.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,n=this.curves.length;t<n;t++){const n=this.curves[t];e.curves.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const n=e.curves[t];this.curves.push((new js[n.type]).fromJSON(n))}return this}}class Xs extends Js{constructor(e){super(),this.type="Path",this.currentPoint=new _,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const n=new Hs(this.currentPoint.clone(),new _(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,n,i){const r=new Vs(this.currentPoint.clone(),new _(e,t),new _(n,i));return this.curves.push(r),this.currentPoint.set(n,i),this}bezierCurveTo(e,t,n,i,r,s){const o=new Us(this.currentPoint.clone(),new _(e,t),new _(n,i),new _(r,s));return this.curves.push(o),this.currentPoint.set(r,s),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),n=new Ws(t);return this.curves.push(n),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,n,i,r,s){const o=this.currentPoint.x,a=this.currentPoint.y;return this.absarc(e+o,t+a,n,i,r,s),this}absarc(e,t,n,i,r,s){return this.absellipse(e,t,n,n,i,r,s),this}ellipse(e,t,n,i,r,s,o,a){const c=this.currentPoint.x,l=this.currentPoint.y;return this.absellipse(e+c,t+l,n,i,r,s,o,a),this}absellipse(e,t,n,i,r,s,o,a){const c=new Ls(e,t,n,i,r,s,o,a);if(this.curves.length>0){const e=c.getPoint(0);e.equals(this.currentPoint)||this.lineTo(e.x,e.y)}this.curves.push(c);const l=c.getPoint(1);return this.currentPoint.copy(l),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class qs extends Tt{constructor(e=1,t=1,n=1,i=8,r=1,s=!1,o=0,a=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:i,heightSegments:r,openEnded:s,thetaStart:o,thetaLength:a};const c=this;i=Math.floor(i),r=Math.floor(r);const l=[],u=[],h=[],d=[];let p=0;const f=[],m=n/2;let g=0;function v(n){const r=p,s=new _,f=new Y;let v=0;const y=!0===n?e:t,x=!0===n?1:-1;for(let e=1;e<=i;e++)u.push(0,m*x,0),h.push(0,x,0),d.push(.5,.5),p++;const w=p;for(let e=0;e<=i;e++){const t=e/i*a+o,n=Math.cos(t),r=Math.sin(t);f.x=y*r,f.y=m*x,f.z=y*n,u.push(f.x,f.y,f.z),h.push(0,x,0),s.x=.5*n+.5,s.y=.5*r*x+.5,d.push(s.x,s.y),p++}for(let e=0;e<i;e++){const t=r+e,i=w+e;!0===n?l.push(i,i+1,t):l.push(i+1,i,t),v+=3}c.addGroup(g,v,!0===n?1:2),g+=v}!function(){const s=new Y,v=new Y;let y=0;const x=(t-e)/n;for(let c=0;c<=r;c++){const l=[],g=c/r,y=g*(t-e)+e;for(let e=0;e<=i;e++){const t=e/i,r=t*a+o,c=Math.sin(r),f=Math.cos(r);v.x=y*c,v.y=-g*n+m,v.z=y*f,u.push(v.x,v.y,v.z),s.set(c,x,f).normalize(),h.push(s.x,s.y,s.z),d.push(t,1-g),l.push(p++)}f.push(l)}for(let e=0;e<i;e++)for(let t=0;t<r;t++){const n=f[t][e],i=f[t+1][e],r=f[t+1][e+1],s=f[t][e+1];l.push(n,i,s),l.push(i,r,s),y+=6}c.addGroup(g,y,0),g+=y}(),!1===s&&(e>0&&v(!0),t>0&&v(!1)),this.setIndex(l),this.setAttribute("position",new yt(u,3)),this.setAttribute("normal",new yt(h,3)),this.setAttribute("uv",new yt(d,2))}static fromJSON(e){return new qs(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Zs extends Tt{constructor(e=[],t=[],n=1,i=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:i};const r=[],s=[];function o(e,t,n,i){const r=i+1,s=[];for(let i=0;i<=r;i++){s[i]=[];const o=e.clone().lerp(n,i/r),a=t.clone().lerp(n,i/r),c=r-i;for(let e=0;e<=c;e++)s[i][e]=0===e&&i===r?o:o.clone().lerp(a,e/c)}for(let e=0;e<r;e++)for(let t=0;t<2*(r-e)-1;t++){const n=Math.floor(t/2);t%2==0?(a(s[e][n+1]),a(s[e+1][n]),a(s[e][n])):(a(s[e][n+1]),a(s[e+1][n+1]),a(s[e+1][n]))}}function a(e){r.push(e.x,e.y,e.z)}function c(t,n){const i=3*t;n.x=e[i+0],n.y=e[i+1],n.z=e[i+2]}function l(e,t,n,i){i<0&&1===e.x&&(s[t]=e.x-1),0===n.x&&0===n.z&&(s[t]=i/2/Math.PI+.5)}function u(e){return Math.atan2(e.z,-e.x)}!function(e){const n=new Y,i=new Y,r=new Y;for(let s=0;s<t.length;s+=3)c(t[s+0],n),c(t[s+1],i),c(t[s+2],r),o(n,i,r,e)}(i),function(e){const t=new Y;for(let n=0;n<r.length;n+=3)t.x=r[n+0],t.y=r[n+1],t.z=r[n+2],t.normalize().multiplyScalar(e),r[n+0]=t.x,r[n+1]=t.y,r[n+2]=t.z}(n),function(){const e=new Y;for(let n=0;n<r.length;n+=3){e.x=r[n+0],e.y=r[n+1],e.z=r[n+2];const i=u(e)/2/Math.PI+.5,o=(t=e,Math.atan2(-t.y,Math.sqrt(t.x*t.x+t.z*t.z))/Math.PI+.5);s.push(i,1-o)}var t;(function(){const e=new Y,t=new Y,n=new Y,i=new Y,o=new _,a=new _,c=new _;for(let h=0,d=0;h<r.length;h+=9,d+=6){e.set(r[h+0],r[h+1],r[h+2]),t.set(r[h+3],r[h+4],r[h+5]),n.set(r[h+6],r[h+7],r[h+8]),o.set(s[d+0],s[d+1]),a.set(s[d+2],s[d+3]),c.set(s[d+4],s[d+5]),i.copy(e).add(t).add(n).divideScalar(3);const p=u(i);l(o,d+0,e,p),l(a,d+2,t,p),l(c,d+4,n,p)}})(),function(){for(let e=0;e<s.length;e+=6){const t=s[e+0],n=s[e+2],i=s[e+4],r=Math.max(t,n,i),o=Math.min(t,n,i);r>.9&&o<.1&&(t<.2&&(s[e+0]+=1),n<.2&&(s[e+2]+=1),i<.2&&(s[e+4]+=1))}}()}(),this.setAttribute("position",new yt(r,3)),this.setAttribute("normal",new yt(r.slice(),3)),this.setAttribute("uv",new yt(s,2)),0===i?this.computeVertexNormals():this.normalizeNormals()}static fromJSON(e){return new Zs(e.vertices,e.indices,e.radius,e.details)}}class Ys extends Xs{constructor(e){super(e),this.uuid=g(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let n=0,i=this.holes.length;n<i;n++)t[n]=this.holes[n].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const n=e.holes[t];this.holes.push(n.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,n=this.holes.length;t<n;t++){const n=this.holes[t];e.holes.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const n=e.holes[t];this.holes.push((new Xs).fromJSON(n))}return this}}const Ks=function(e,t,n=2){const i=t&&t.length,r=i?t[0]*n:e.length;let s=Qs(e,0,r,n,!0);const o=[];if(!s||s.next===s.prev)return o;let a,c,l,u,h,d,p;if(i&&(s=function(e,t,n,i){const r=[];let s,o,a,c,l;for(s=0,o=t.length;s<o;s++)a=t[s]*i,c=s<o-1?t[s+1]*i:e.length,l=Qs(e,a,c,i,!1),l===l.next&&(l.steiner=!0),r.push(lo(l));for(r.sort(so),s=0;s<r.length;s++)oo(r[s],n),n=$s(n,n.next);return n}(e,t,s,n)),e.length>80*n){a=l=e[0],c=u=e[1];for(let t=n;t<r;t+=n)h=e[t],d=e[t+1],h<a&&(a=h),d<c&&(c=d),h>l&&(l=h),d>u&&(u=d);p=Math.max(l-a,u-c),p=0!==p?1/p:0}return eo(s,o,n,a,c,p),o};function Qs(e,t,n,i,r){let s,o;if(r===function(e,t,n,i){let r=0;for(let s=t,o=n-i;s<n;s+=i)r+=(e[o]-e[s])*(e[s+1]+e[o+1]),o=s;return r}(e,t,n,i)>0)for(s=t;s<n;s+=i)o=wo(s,e[s],e[s+1],o);else for(s=n-i;s>=t;s-=i)o=wo(s,e[s],e[s+1],o);return o&&fo(o,o.next)&&(bo(o),o=o.next),o}function $s(e,t){if(!e)return e;t||(t=e);let n,i=e;do{if(n=!1,i.steiner||!fo(i,i.next)&&0!==po(i.prev,i,i.next))i=i.next;else{if(bo(i),i=t=i.prev,i===i.next)break;n=!0}}while(n||i!==t);return t}function eo(e,t,n,i,r,s,o){if(!e)return;!o&&s&&function(e,t,n,i){let r=e;do{null===r.z&&(r.z=co(r.x,r.y,t,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,function(e){let t,n,i,r,s,o,a,c,l=1;do{for(n=e,e=null,s=null,o=0;n;){for(o++,i=n,a=0,t=0;t<l&&(a++,i=i.nextZ,i);t++);for(c=l;a>0||c>0&&i;)0!==a&&(0===c||!i||n.z<=i.z)?(r=n,n=n.nextZ,a--):(r=i,i=i.nextZ,c--),s?s.nextZ=r:e=r,r.prevZ=s,s=r;n=i}s.nextZ=null,l*=2}while(o>1)}(r)}(e,i,r,s);let a,c,l=e;for(;e.prev!==e.next;)if(a=e.prev,c=e.next,s?no(e,i,r,s):to(e))t.push(a.i/n),t.push(e.i/n),t.push(c.i/n),bo(e),e=c.next,l=c.next;else if((e=c)===l){o?1===o?eo(e=io($s(e),t,n),t,n,i,r,s,2):2===o&&ro(e,t,n,i,r,s):eo($s(e),t,n,i,r,s,1);break}}function to(e){const t=e.prev,n=e,i=e.next;if(po(t,n,i)>=0)return!1;let r=e.next.next;for(;r!==e.prev;){if(uo(t.x,t.y,n.x,n.y,i.x,i.y,r.x,r.y)&&po(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function no(e,t,n,i){const r=e.prev,s=e,o=e.next;if(po(r,s,o)>=0)return!1;const a=r.x<s.x?r.x<o.x?r.x:o.x:s.x<o.x?s.x:o.x,c=r.y<s.y?r.y<o.y?r.y:o.y:s.y<o.y?s.y:o.y,l=r.x>s.x?r.x>o.x?r.x:o.x:s.x>o.x?s.x:o.x,u=r.y>s.y?r.y>o.y?r.y:o.y:s.y>o.y?s.y:o.y,h=co(a,c,t,n,i),d=co(l,u,t,n,i);let p=e.prevZ,f=e.nextZ;for(;p&&p.z>=h&&f&&f.z<=d;){if(p!==e.prev&&p!==e.next&&uo(r.x,r.y,s.x,s.y,o.x,o.y,p.x,p.y)&&po(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,f!==e.prev&&f!==e.next&&uo(r.x,r.y,s.x,s.y,o.x,o.y,f.x,f.y)&&po(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(;p&&p.z>=h;){if(p!==e.prev&&p!==e.next&&uo(r.x,r.y,s.x,s.y,o.x,o.y,p.x,p.y)&&po(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;f&&f.z<=d;){if(f!==e.prev&&f!==e.next&&uo(r.x,r.y,s.x,s.y,o.x,o.y,f.x,f.y)&&po(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function io(e,t,n){let i=e;do{const r=i.prev,s=i.next.next;!fo(r,s)&&mo(r,i,i.next,s)&&yo(r,s)&&yo(s,r)&&(t.push(r.i/n),t.push(i.i/n),t.push(s.i/n),bo(i),bo(i.next),i=e=s),i=i.next}while(i!==e);return $s(i)}function ro(e,t,n,i,r,s){let o=e;do{let e=o.next.next;for(;e!==o.prev;){if(o.i!==e.i&&ho(o,e)){let a=xo(o,e);return o=$s(o,o.next),a=$s(a,a.next),eo(o,t,n,i,r,s),void eo(a,t,n,i,r,s)}e=e.next}o=o.next}while(o!==e)}function so(e,t){return e.x-t.x}function oo(e,t){if(t=function(e,t){let n=t;const i=e.x,r=e.y;let s,o=-1/0;do{if(r<=n.y&&r>=n.next.y&&n.next.y!==n.y){const e=n.x+(r-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(e<=i&&e>o){if(o=e,e===i){if(r===n.y)return n;if(r===n.next.y)return n.next}s=n.x<n.next.x?n:n.next}}n=n.next}while(n!==t);if(!s)return null;if(i===o)return s;const a=s,c=s.x,l=s.y;let u,h=1/0;n=s;do{i>=n.x&&n.x>=c&&i!==n.x&&uo(r<l?i:o,r,c,l,r<l?o:i,r,n.x,n.y)&&(u=Math.abs(r-n.y)/(i-n.x),yo(n,e)&&(u<h||u===h&&(n.x>s.x||n.x===s.x&&ao(s,n)))&&(s=n,h=u)),n=n.next}while(n!==a);return s}(e,t)){const n=xo(t,e);$s(t,t.next),$s(n,n.next)}}function ao(e,t){return po(e.prev,e,t.prev)<0&&po(t.next,e,e.next)<0}function co(e,t,n,i,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*r)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*r)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function lo(e){let t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function uo(e,t,n,i,r,s,o,a){return(r-o)*(t-a)-(e-o)*(s-a)>=0&&(e-o)*(i-a)-(n-o)*(t-a)>=0&&(n-o)*(s-a)-(r-o)*(i-a)>=0}function ho(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){let n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&mo(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(yo(e,t)&&yo(t,e)&&function(e,t){let n=e,i=!1;const r=(e.x+t.x)/2,s=(e.y+t.y)/2;do{n.y>s!=n.next.y>s&&n.next.y!==n.y&&r<(n.next.x-n.x)*(s-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==e);return i}(e,t)&&(po(e.prev,e,t.prev)||po(e,t.prev,t))||fo(e,t)&&po(e.prev,e,e.next)>0&&po(t.prev,t,t.next)>0)}function po(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function fo(e,t){return e.x===t.x&&e.y===t.y}function mo(e,t,n,i){const r=vo(po(e,t,n)),s=vo(po(e,t,i)),o=vo(po(n,i,e)),a=vo(po(n,i,t));return r!==s&&o!==a||(!(0!==r||!go(e,n,t))||(!(0!==s||!go(e,i,t))||(!(0!==o||!go(n,e,i))||!(0!==a||!go(n,t,i)))))}function go(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function vo(e){return e>0?1:e<0?-1:0}function yo(e,t){return po(e.prev,e,e.next)<0?po(e,t,e.next)>=0&&po(e,e.prev,t)>=0:po(e,t,e.prev)<0||po(e,e.next,t)<0}function xo(e,t){const n=new Ao(e.i,e.x,e.y),i=new Ao(t.i,t.x,t.y),r=e.next,s=t.prev;return e.next=t,t.prev=e,n.next=r,r.prev=n,i.next=n,n.prev=i,s.next=i,i.prev=s,i}function wo(e,t,n,i){const r=new Ao(e,t,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function bo(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Ao(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}class So{static area(e){const t=e.length;let n=0;for(let i=t-1,r=0;r<t;i=r++)n+=e[i].x*e[r].y-e[r].x*e[i].y;return.5*n}static isClockWise(e){return So.area(e)<0}static triangulateShape(e,t){const n=[],i=[],r=[];_o(e),Mo(n,e);let s=e.length;t.forEach(_o);for(let e=0;e<t.length;e++)i.push(s),s+=t[e].length,Mo(n,t[e]);const o=Ks(n,i);for(let e=0;e<o.length;e+=3)r.push(o.slice(e,e+3));return r}}function _o(e){const t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function Mo(e,t){for(let n=0;n<t.length;n++)e.push(t[n].x),e.push(t[n].y)}class To extends Tt{constructor(e=new Ys([new _(.5,.5),new _(-.5,.5),new _(-.5,-.5),new _(.5,-.5)]),t={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const n=this,i=[],r=[];for(let t=0,n=e.length;t<n;t++){s(e[t])}function s(e){const s=[],o=void 0!==t.curveSegments?t.curveSegments:12,a=void 0!==t.steps?t.steps:1;let c=void 0!==t.depth?t.depth:1,l=void 0===t.bevelEnabled||t.bevelEnabled,u=void 0!==t.bevelThickness?t.bevelThickness:.2,h=void 0!==t.bevelSize?t.bevelSize:u-.1,d=void 0!==t.bevelOffset?t.bevelOffset:0,p=void 0!==t.bevelSegments?t.bevelSegments:3;const f=t.extrudePath,m=void 0!==t.UVGenerator?t.UVGenerator:Eo;void 0!==t.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),c=t.amount);let g,v,y,x,w,b=!1;f&&(g=f.getSpacedPoints(a),b=!0,l=!1,v=f.computeFrenetFrames(a,!1),y=new Y,x=new Y,w=new Y),l||(p=0,u=0,h=0,d=0);const A=e.extractPoints(o);let S=A.shape;const M=A.holes;if(!So.isClockWise(S)){S=S.reverse();for(let e=0,t=M.length;e<t;e++){const t=M[e];So.isClockWise(t)&&(M[e]=t.reverse())}}const T=So.triangulateShape(S,M),E=S;for(let e=0,t=M.length;e<t;e++){const t=M[e];S=S.concat(t)}function C(e,t,n){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(n).add(e)}const R=S.length,P=T.length;function L(e,t,n){let i,r,s;const o=e.x-t.x,a=e.y-t.y,c=n.x-e.x,l=n.y-e.y,u=o*o+a*a,h=o*l-a*c;if(Math.abs(h)>Number.EPSILON){const h=Math.sqrt(u),d=Math.sqrt(c*c+l*l),p=t.x-a/h,f=t.y+o/h,m=((n.x-l/d-p)*l-(n.y+c/d-f)*c)/(o*l-a*c);i=p+o*m-e.x,r=f+a*m-e.y;const g=i*i+r*r;if(g<=2)return new _(i,r);s=Math.sqrt(g/2)}else{let e=!1;o>Number.EPSILON?c>Number.EPSILON&&(e=!0):o<-Number.EPSILON?c<-Number.EPSILON&&(e=!0):Math.sign(a)===Math.sign(l)&&(e=!0),e?(i=-a,r=o,s=Math.sqrt(u)):(i=o,r=a,s=Math.sqrt(u/2))}return new _(i/s,r/s)}const D=[];for(let e=0,t=E.length,n=t-1,i=e+1;e<t;e++,n++,i++)n===t&&(n=0),i===t&&(i=0),D[e]=L(E[e],E[n],E[i]);const I=[];let k,O=D.concat();for(let e=0,t=M.length;e<t;e++){const t=M[e];k=[];for(let e=0,n=t.length,i=n-1,r=e+1;e<n;e++,i++,r++)i===n&&(i=0),r===n&&(r=0),k[e]=L(t[e],t[i],t[r]);I.push(k),O=O.concat(k)}for(let e=0;e<p;e++){const t=e/p,n=u*Math.cos(t*Math.PI/2),i=h*Math.sin(t*Math.PI/2)+d;for(let e=0,t=E.length;e<t;e++){const t=C(E[e],D[e],i);z(t.x,t.y,-n)}for(let e=0,t=M.length;e<t;e++){const t=M[e];k=I[e];for(let e=0,r=t.length;e<r;e++){const r=C(t[e],k[e],i);z(r.x,r.y,-n)}}}const B=h+d;for(let e=0;e<R;e++){const t=l?C(S[e],O[e],B):S[e];b?(x.copy(v.normals[0]).multiplyScalar(t.x),y.copy(v.binormals[0]).multiplyScalar(t.y),w.copy(g[0]).add(x).add(y),z(w.x,w.y,w.z)):z(t.x,t.y,0)}for(let e=1;e<=a;e++)for(let t=0;t<R;t++){const n=l?C(S[t],O[t],B):S[t];b?(x.copy(v.normals[e]).multiplyScalar(n.x),y.copy(v.binormals[e]).multiplyScalar(n.y),w.copy(g[e]).add(x).add(y),z(w.x,w.y,w.z)):z(n.x,n.y,c/a*e)}for(let e=p-1;e>=0;e--){const t=e/p,n=u*Math.cos(t*Math.PI/2),i=h*Math.sin(t*Math.PI/2)+d;for(let e=0,t=E.length;e<t;e++){const t=C(E[e],D[e],i);z(t.x,t.y,c+n)}for(let e=0,t=M.length;e<t;e++){const t=M[e];k=I[e];for(let e=0,r=t.length;e<r;e++){const r=C(t[e],k[e],i);b?z(r.x,r.y+g[a-1].y,g[a-1].x+n):z(r.x,r.y,c+n)}}}function N(e,t){let n=e.length;for(;--n>=0;){const i=n;let r=n-1;r<0&&(r=e.length-1);for(let e=0,n=a+2*p;e<n;e++){const n=R*e,s=R*(e+1);U(t+i+n,t+r+n,t+r+s,t+i+s)}}}function z(e,t,n){s.push(e),s.push(t),s.push(n)}function F(e,t,r){H(e),H(t),H(r);const s=i.length/3,o=m.generateTopUV(n,i,s-3,s-2,s-1);V(o[0]),V(o[1]),V(o[2])}function U(e,t,r,s){H(e),H(t),H(s),H(t),H(r),H(s);const o=i.length/3,a=m.generateSideWallUV(n,i,o-6,o-3,o-2,o-1);V(a[0]),V(a[1]),V(a[3]),V(a[1]),V(a[2]),V(a[3])}function H(e){i.push(s[3*e+0]),i.push(s[3*e+1]),i.push(s[3*e+2])}function V(e){r.push(e.x),r.push(e.y)}!function(){const e=i.length/3;if(l){let e=0,t=R*e;for(let e=0;e<P;e++){const n=T[e];F(n[2]+t,n[1]+t,n[0]+t)}e=a+2*p,t=R*e;for(let e=0;e<P;e++){const n=T[e];F(n[0]+t,n[1]+t,n[2]+t)}}else{for(let e=0;e<P;e++){const t=T[e];F(t[2],t[1],t[0])}for(let e=0;e<P;e++){const t=T[e];F(t[0]+R*a,t[1]+R*a,t[2]+R*a)}}n.addGroup(e,i.length/3-e,0)}(),function(){const e=i.length/3;let t=0;N(E,t),t+=E.length;for(let e=0,n=M.length;e<n;e++){const n=M[e];N(n,t),t+=n.length}n.addGroup(e,i.length/3-e,1)}()}this.setAttribute("position",new yt(i,3)),this.setAttribute("uv",new yt(r,2)),this.computeVertexNormals()}toJSON(){const e=super.toJSON();return function(e,t,n){if(n.shapes=[],Array.isArray(e))for(let t=0,i=e.length;t<i;t++){const i=e[t];n.shapes.push(i.uuid)}else n.shapes.push(e.uuid);n.options=Object.assign({},t),void 0!==t.extrudePath&&(n.options.extrudePath=t.extrudePath.toJSON());return n}(this.parameters.shapes,this.parameters.options,e)}static fromJSON(e,t){const n=[];for(let i=0,r=e.shapes.length;i<r;i++){const r=t[e.shapes[i]];n.push(r)}const i=e.options.extrudePath;return void 0!==i&&(e.options.extrudePath=(new js[i.type]).fromJSON(i)),new To(n,e.options)}}const Eo={generateTopUV:function(e,t,n,i,r){const s=t[3*n],o=t[3*n+1],a=t[3*i],c=t[3*i+1],l=t[3*r],u=t[3*r+1];return[new _(s,o),new _(a,c),new _(l,u)]},generateSideWallUV:function(e,t,n,i,r,s){const o=t[3*n],a=t[3*n+1],c=t[3*n+2],l=t[3*i],u=t[3*i+1],h=t[3*i+2],d=t[3*r],p=t[3*r+1],f=t[3*r+2],m=t[3*s],g=t[3*s+1],v=t[3*s+2];return Math.abs(a-u)<Math.abs(o-l)?[new _(o,1-c),new _(l,1-h),new _(d,1-f),new _(m,1-v)]:[new _(a,1-c),new _(u,1-h),new _(p,1-f),new _(g,1-v)]}};class Co extends Zs{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2;super([-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Co(e.radius,e.detail)}}class Ro extends Tt{constructor(e=1,t=32,n=16,i=0,r=2*Math.PI,s=0,o=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:i,phiLength:r,thetaStart:s,thetaLength:o},t=Math.max(3,Math.floor(t)),n=Math.max(2,Math.floor(n));const a=Math.min(s+o,Math.PI);let c=0;const l=[],u=new Y,h=new Y,d=[],p=[],f=[],m=[];for(let d=0;d<=n;d++){const g=[],v=d/n;let y=0;0==d&&0==s?y=.5/t:d==n&&a==Math.PI&&(y=-.5/t);for(let n=0;n<=t;n++){const a=n/t;u.x=-e*Math.cos(i+a*r)*Math.sin(s+v*o),u.y=e*Math.cos(s+v*o),u.z=e*Math.sin(i+a*r)*Math.sin(s+v*o),p.push(u.x,u.y,u.z),h.copy(u).normalize(),f.push(h.x,h.y,h.z),m.push(a+y,1-v),g.push(c++)}l.push(g)}for(let e=0;e<n;e++)for(let i=0;i<t;i++){const t=l[e][i+1],r=l[e][i],o=l[e+1][i],c=l[e+1][i+1];(0!==e||s>0)&&d.push(t,r,c),(e!==n-1||a<Math.PI)&&d.push(r,o,c)}this.setIndex(d),this.setAttribute("position",new yt(p,3)),this.setAttribute("normal",new yt(f,3)),this.setAttribute("uv",new yt(m,2))}static fromJSON(e){return new Ro(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class Po extends Tt{constructor(e=1,t=.4,n=8,i=6,r=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:i,arc:r},n=Math.floor(n),i=Math.floor(i);const s=[],o=[],a=[],c=[],l=new Y,u=new Y,h=new Y;for(let s=0;s<=n;s++)for(let d=0;d<=i;d++){const p=d/i*r,f=s/n*Math.PI*2;u.x=(e+t*Math.cos(f))*Math.cos(p),u.y=(e+t*Math.cos(f))*Math.sin(p),u.z=t*Math.sin(f),o.push(u.x,u.y,u.z),l.x=e*Math.cos(p),l.y=e*Math.sin(p),h.subVectors(u,l).normalize(),a.push(h.x,h.y,h.z),c.push(d/i),c.push(s/n)}for(let e=1;e<=n;e++)for(let t=1;t<=i;t++){const n=(i+1)*e+t-1,r=(i+1)*(e-1)+t-1,o=(i+1)*(e-1)+t,a=(i+1)*e+t;s.push(n,r,a),s.push(r,o,a)}this.setIndex(s),this.setAttribute("position",new yt(o,3)),this.setAttribute("normal",new yt(a,3)),this.setAttribute("uv",new yt(c,2))}static fromJSON(e){return new Po(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class Lo extends ht{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new z(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new z(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new _(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Do extends Lo{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new _(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return v(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(e){this.ior=(1+.4*e)/(1-.4*e)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new z(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationColor=new z(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new z(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._iridescence=0,this._transmission=0,this.setValues(e)}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class Io extends ht{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new z(16777215),this.specular=new z(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new z(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new _(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class ko extends ht{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new z(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new z(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const Oo={arraySlice:function(e,t,n){return Oo.isTypedArray(e)?new e.constructor(e.subarray(t,void 0!==n?n:e.length)):e.slice(t,n)},convertArray:function(e,t,n){return!e||!n&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(e){const t=e.length,n=new Array(t);for(let e=0;e!==t;++e)n[e]=e;return n.sort((function(t,n){return e[t]-e[n]})),n},sortedArray:function(e,t,n){const i=e.length,r=new e.constructor(i);for(let s=0,o=0;o!==i;++s){const i=n[s]*t;for(let n=0;n!==t;++n)r[o++]=e[i+n]}return r},flattenJSON:function(e,t,n,i){let r=1,s=e[0];for(;void 0!==s&&void 0===s[i];)s=e[r++];if(void 0===s)return;let o=s[i];if(void 0!==o)if(Array.isArray(o))do{o=s[i],void 0!==o&&(t.push(s.time),n.push.apply(n,o)),s=e[r++]}while(void 0!==s);else if(void 0!==o.toArray)do{o=s[i],void 0!==o&&(t.push(s.time),o.toArray(n,n.length)),s=e[r++]}while(void 0!==s);else do{o=s[i],void 0!==o&&(t.push(s.time),n.push(o)),s=e[r++]}while(void 0!==s)},subclip:function(e,t,n,i,r=30){const s=e.clone();s.name=t;const o=[];for(let e=0;e<s.tracks.length;++e){const t=s.tracks[e],a=t.getValueSize(),c=[],l=[];for(let e=0;e<t.times.length;++e){const s=t.times[e]*r;if(!(s<n||s>=i)){c.push(t.times[e]);for(let n=0;n<a;++n)l.push(t.values[e*a+n])}}0!==c.length&&(t.times=Oo.convertArray(c,t.times.constructor),t.values=Oo.convertArray(l,t.values.constructor),o.push(t))}s.tracks=o;let a=1/0;for(let e=0;e<s.tracks.length;++e)a>s.tracks[e].times[0]&&(a=s.tracks[e].times[0]);for(let e=0;e<s.tracks.length;++e)s.tracks[e].shift(-1*a);return s.resetDuration(),s},makeClipAdditive:function(e,t=0,n=e,i=30){i<=0&&(i=30);const r=n.tracks.length,s=t/i;for(let t=0;t<r;++t){const i=n.tracks[t],r=i.ValueTypeName;if("bool"===r||"string"===r)continue;const o=e.tracks.find((function(e){return e.name===i.name&&e.ValueTypeName===r}));if(void 0===o)continue;let a=0;const c=i.getValueSize();i.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(a=c/3);let l=0;const u=o.getValueSize();o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(l=u/3);const h=i.times.length-1;let d;if(s<=i.times[0]){const e=a,t=c-a;d=Oo.arraySlice(i.values,e,t)}else if(s>=i.times[h]){const e=h*c+a,t=e+c-a;d=Oo.arraySlice(i.values,e,t)}else{const e=i.createInterpolant(),t=a,n=c-a;e.evaluate(s),d=Oo.arraySlice(e.resultBuffer,t,n)}if("quaternion"===r){(new Z).fromArray(d).normalize().conjugate().toArray(d)}const p=o.times.length;for(let e=0;e<p;++e){const t=e*u+l;if("quaternion"===r)Z.multiplyQuaternionsFlat(o.values,t,d,0,o.values,t);else{const e=u-2*l;for(let n=0;n<e;++n)o.values[t+n]-=d[n]}}}return e.blendMode=2501,e}};class Bo{constructor(e,t,n,i){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==i?i:new t.constructor(n),this.sampleValues=t,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let n=this._cachedIndex,i=t[n],r=t[n-1];e:{t:{let s;n:{i:if(!(e<i)){for(let s=n+2;;){if(void 0===i){if(e<r)break i;return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===s)break;if(r=i,i=t[++n],e<i)break t}s=t.length;break n}if(e>=r)break e;{const o=t[1];e<o&&(n=2,r=o);for(let s=n-2;;){if(void 0===r)return this._cachedIndex=0,this.copySampleValue_(0);if(n===s)break;if(i=r,r=t[--n-1],e>=r)break t}s=n,n=0}}for(;n<s;){const i=n+s>>>1;e<t[i]?s=i:n=i+1}if(i=t[n],r=t[n-1],void 0===r)return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===i)return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,r,i)}return this.interpolate_(n,r,e,i)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=e*i;for(let e=0;e!==i;++e)t[e]=n[r+e];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class No extends Bo{constructor(e,t,n,i){super(e,t,n,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:2400,endingEnd:2400}}intervalChanged_(e,t,n){const i=this.parameterPositions;let r=e-2,s=e+1,o=i[r],a=i[s];if(void 0===o)switch(this.getSettings_().endingStart){case 2401:r=e,o=2*t-n;break;case 2402:r=i.length-2,o=t+i[r]-i[r+1];break;default:r=e,o=n}if(void 0===a)switch(this.getSettings_().endingEnd){case 2401:s=e,a=2*n-t;break;case 2402:s=1,a=n+i[1]-i[0];break;default:s=e-1,a=t}const c=.5*(n-t),l=this.valueSize;this._weightPrev=c/(t-o),this._weightNext=c/(a-n),this._offsetPrev=r*l,this._offsetNext=s*l}interpolate_(e,t,n,i){const r=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=e*o,c=a-o,l=this._offsetPrev,u=this._offsetNext,h=this._weightPrev,d=this._weightNext,p=(n-t)/(i-t),f=p*p,m=f*p,g=-h*m+2*h*f-h*p,v=(1+h)*m+(-1.5-2*h)*f+(-.5+h)*p+1,y=(-1-d)*m+(1.5+d)*f+.5*p,x=d*m-d*f;for(let e=0;e!==o;++e)r[e]=g*s[l+e]+v*s[c+e]+y*s[a+e]+x*s[u+e];return r}}class zo extends Bo{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e,t,n,i){const r=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=e*o,c=a-o,l=(n-t)/(i-t),u=1-l;for(let e=0;e!==o;++e)r[e]=s[c+e]*u+s[a+e]*l;return r}}class Fo extends Bo{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e){return this.copySampleValue_(e-1)}}class Uo{constructor(e,t,n,i){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Oo.convertArray(t,this.TimeBufferType),this.values=Oo.convertArray(n,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let n;if(t.toJSON!==this.toJSON)n=t.toJSON(e);else{n={name:e.name,times:Oo.convertArray(e.times,Array),values:Oo.convertArray(e.values,Array)};const t=e.getInterpolation();t!==e.DefaultInterpolation&&(n.interpolation=t)}return n.type=e.ValueTypeName,n}InterpolantFactoryMethodDiscrete(e){return new Fo(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new zo(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new No(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case 2300:t=this.InterpolantFactoryMethodDiscrete;break;case 2301:t=this.InterpolantFactoryMethodLinear;break;case 2302:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){const t="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(t);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",t),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){const t=this.times;for(let n=0,i=t.length;n!==i;++n)t[n]+=e}return this}scale(e){if(1!==e){const t=this.times;for(let n=0,i=t.length;n!==i;++n)t[n]*=e}return this}trim(e,t){const n=this.times,i=n.length;let r=0,s=i-1;for(;r!==i&&n[r]<e;)++r;for(;-1!==s&&n[s]>t;)--s;if(++s,0!==r||s!==i){r>=s&&(s=Math.max(s,1),r=s-1);const e=this.getValueSize();this.times=Oo.arraySlice(n,r,s),this.values=Oo.arraySlice(this.values,r*e,s*e)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const n=this.times,i=this.values,r=n.length;0===r&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let s=null;for(let t=0;t!==r;t++){const i=n[t];if("number"==typeof i&&isNaN(i)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,t,i),e=!1;break}if(null!==s&&s>i){console.error("THREE.KeyframeTrack: Out of order keys.",this,t,i,s),e=!1;break}s=i}if(void 0!==i&&Oo.isTypedArray(i))for(let t=0,n=i.length;t!==n;++t){const n=i[t];if(isNaN(n)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,t,n),e=!1;break}}return e}optimize(){const e=Oo.arraySlice(this.times),t=Oo.arraySlice(this.values),n=this.getValueSize(),i=2302===this.getInterpolation(),r=e.length-1;let s=1;for(let o=1;o<r;++o){let r=!1;const a=e[o];if(a!==e[o+1]&&(1!==o||a!==e[0]))if(i)r=!0;else{const e=o*n,i=e-n,s=e+n;for(let o=0;o!==n;++o){const n=t[e+o];if(n!==t[i+o]||n!==t[s+o]){r=!0;break}}}if(r){if(o!==s){e[s]=e[o];const i=o*n,r=s*n;for(let e=0;e!==n;++e)t[r+e]=t[i+e]}++s}}if(r>0){e[s]=e[r];for(let e=r*n,i=s*n,o=0;o!==n;++o)t[i+o]=t[e+o];++s}return s!==e.length?(this.times=Oo.arraySlice(e,0,s),this.values=Oo.arraySlice(t,0,s*n)):(this.times=e,this.values=t),this}clone(){const e=Oo.arraySlice(this.times,0),t=Oo.arraySlice(this.values,0),n=new(0,this.constructor)(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}}Uo.prototype.TimeBufferType=Float32Array,Uo.prototype.ValueBufferType=Float32Array,Uo.prototype.DefaultInterpolation=2301;class Ho extends Uo{}Ho.prototype.ValueTypeName="bool",Ho.prototype.ValueBufferType=Array,Ho.prototype.DefaultInterpolation=2300,Ho.prototype.InterpolantFactoryMethodLinear=void 0,Ho.prototype.InterpolantFactoryMethodSmooth=void 0;class Vo extends Uo{}Vo.prototype.ValueTypeName="color";class Go extends Uo{}Go.prototype.ValueTypeName="number";class Wo extends Bo{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e,t,n,i){const r=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=(n-t)/(i-t);let c=e*o;for(let e=c+o;c!==e;c+=4)Z.slerpFlat(r,0,s,c-o,s,c,a);return r}}class jo extends Uo{InterpolantFactoryMethodLinear(e){return new Wo(this.times,this.values,this.getValueSize(),e)}}jo.prototype.ValueTypeName="quaternion",jo.prototype.DefaultInterpolation=2301,jo.prototype.InterpolantFactoryMethodSmooth=void 0;class Jo extends Uo{}Jo.prototype.ValueTypeName="string",Jo.prototype.ValueBufferType=Array,Jo.prototype.DefaultInterpolation=2300,Jo.prototype.InterpolantFactoryMethodLinear=void 0,Jo.prototype.InterpolantFactoryMethodSmooth=void 0;class Xo extends Uo{}Xo.prototype.ValueTypeName="vector";class qo{constructor(e,t=-1,n,i=2500){this.name=e,this.tracks=n,this.duration=t,this.blendMode=i,this.uuid=g(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],n=e.tracks,i=1/(e.fps||1);for(let e=0,r=n.length;e!==r;++e)t.push(Zo(n[e]).scale(i));const r=new this(e.name,e.duration,t,e.blendMode);return r.uuid=e.uuid,r}static toJSON(e){const t=[],n=e.tracks,i={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let e=0,i=n.length;e!==i;++e)t.push(Uo.toJSON(n[e]));return i}static CreateFromMorphTargetSequence(e,t,n,i){const r=t.length,s=[];for(let e=0;e<r;e++){let o=[],a=[];o.push((e+r-1)%r,e,(e+1)%r),a.push(0,1,0);const c=Oo.getKeyframeOrder(o);o=Oo.sortedArray(o,1,c),a=Oo.sortedArray(a,1,c),i||0!==o[0]||(o.push(r),a.push(a[0])),s.push(new Go(".morphTargetInfluences["+t[e].name+"]",o,a).scale(1/n))}return new this(e,-1,s)}static findByName(e,t){let n=e;if(!Array.isArray(e)){const t=e;n=t.geometry&&t.geometry.animations||t.animations}for(let e=0;e<n.length;e++)if(n[e].name===t)return n[e];return null}static CreateClipsFromMorphTargetSequences(e,t,n){const i={},r=/^([\w-]*?)([\d]+)$/;for(let t=0,n=e.length;t<n;t++){const n=e[t],s=n.name.match(r);if(s&&s.length>1){const e=s[1];let t=i[e];t||(i[e]=t=[]),t.push(n)}}const s=[];for(const e in i)s.push(this.CreateFromMorphTargetSequence(e,i[e],t,n));return s}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(e,t,n,i,r){if(0!==n.length){const s=[],o=[];Oo.flattenJSON(n,s,o,i),0!==s.length&&r.push(new e(t,s,o))}},i=[],r=e.name||"default",s=e.fps||30,o=e.blendMode;let a=e.length||-1;const c=e.hierarchy||[];for(let e=0;e<c.length;e++){const r=c[e].keys;if(r&&0!==r.length)if(r[0].morphTargets){const e={};let t;for(t=0;t<r.length;t++)if(r[t].morphTargets)for(let n=0;n<r[t].morphTargets.length;n++)e[r[t].morphTargets[n]]=-1;for(const n in e){const e=[],s=[];for(let i=0;i!==r[t].morphTargets.length;++i){const i=r[t];e.push(i.time),s.push(i.morphTarget===n?1:0)}i.push(new Go(".morphTargetInfluence["+n+"]",e,s))}a=e.length*s}else{const s=".bones["+t[e].name+"]";n(Xo,s+".position",r,"pos",i),n(jo,s+".quaternion",r,"rot",i),n(Xo,s+".scale",r,"scl",i)}}if(0===i.length)return null;return new this(r,a,i,o)}resetDuration(){let e=0;for(let t=0,n=this.tracks.length;t!==n;++t){const n=this.tracks[t];e=Math.max(e,n.times[n.times.length-1])}return this.duration=e,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function Zo(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Go;case"vector":case"vector2":case"vector3":case"vector4":return Xo;case"color":return Vo;case"quaternion":return jo;case"bool":case"boolean":return Ho;case"string":return Jo}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){const t=[],n=[];Oo.flattenJSON(e.keys,t,n,"value"),e.times=t,e.values=n}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}const Yo={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};class Ko{constructor(e,t,n){const i=this;let r=!1,s=0,o=0,a=void 0;const c=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(e){o++,!1===r&&void 0!==i.onStart&&i.onStart(e,s,o),r=!0},this.itemEnd=function(e){s++,void 0!==i.onProgress&&i.onProgress(e,s,o),s===o&&(r=!1,void 0!==i.onLoad&&i.onLoad())},this.itemError=function(e){void 0!==i.onError&&i.onError(e)},this.resolveURL=function(e){return a?a(e):e},this.setURLModifier=function(e){return a=e,this},this.addHandler=function(e,t){return c.push(e,t),this},this.removeHandler=function(e){const t=c.indexOf(e);return-1!==t&&c.splice(t,2),this},this.getHandler=function(e){for(let t=0,n=c.length;t<n;t+=2){const n=c[t],i=c[t+1];if(n.global&&(n.lastIndex=0),n.test(e))return i}return null}}}const Qo=new Ko;class $o{constructor(e){this.manager=void 0!==e?e:Qo,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const n=this;return new Promise((function(i,r){n.load(e,i,t,r)}))}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}const ea={};class ta extends $o{constructor(e){super(e)}load(e,t,n,i){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const r=Yo.get(e);if(void 0!==r)return this.manager.itemStart(e),setTimeout(()=>{t&&t(r),this.manager.itemEnd(e)},0),r;if(void 0!==ea[e])return void ea[e].push({onLoad:t,onProgress:n,onError:i});ea[e]=[],ea[e].push({onLoad:t,onProgress:n,onError:i});const s=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),o=this.mimeType,a=this.responseType;fetch(s).then(t=>{if(200===t.status||0===t.status){if(0===t.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),"undefined"==typeof ReadableStream||void 0===t.body||void 0===t.body.getReader)return t;const n=ea[e],i=t.body.getReader(),r=t.headers.get("Content-Length"),s=r?parseInt(r):0,o=0!==s;let a=0;const c=new ReadableStream({start(e){!function t(){i.read().then(({done:i,value:r})=>{if(i)e.close();else{a+=r.byteLength;const i=new ProgressEvent("progress",{lengthComputable:o,loaded:a,total:s});for(let e=0,t=n.length;e<t;e++){const t=n[e];t.onProgress&&t.onProgress(i)}e.enqueue(r),t()}})}()}});return new Response(c)}throw Error(`fetch for "${t.url}" responded with ${t.status}: ${t.statusText}`)}).then(e=>{switch(a){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"document":return e.text().then(e=>(new DOMParser).parseFromString(e,o));case"json":return e.json();default:if(void 0===o)return e.text();{const t=/charset="?([^;"\s]*)"?/i.exec(o),n=t&&t[1]?t[1].toLowerCase():void 0,i=new TextDecoder(n);return e.arrayBuffer().then(e=>i.decode(e))}}}).then(t=>{Yo.add(e,t);const n=ea[e];delete ea[e];for(let e=0,i=n.length;e<i;e++){const i=n[e];i.onLoad&&i.onLoad(t)}}).catch(t=>{const n=ea[e];if(void 0===n)throw this.manager.itemError(e),t;delete ea[e];for(let e=0,i=n.length;e<i;e++){const i=n[e];i.onError&&i.onError(t)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class na extends $o{constructor(e){super(e)}load(e,t,n,i){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,s=Yo.get(e);if(void 0!==s)return r.manager.itemStart(e),setTimeout((function(){t&&t(s),r.manager.itemEnd(e)}),0),s;const o=E("img");function a(){l(),Yo.add(e,this),t&&t(this),r.manager.itemEnd(e)}function c(t){l(),i&&i(t),r.manager.itemError(e),r.manager.itemEnd(e)}function l(){o.removeEventListener("load",a,!1),o.removeEventListener("error",c,!1)}return o.addEventListener("load",a,!1),o.addEventListener("error",c,!1),"data:"!==e.slice(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),r.manager.itemStart(e),o.src=e,o}}class ia extends $o{constructor(e){super(e)}load(e,t,n,i){const r=new W,s=new na(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(e,(function(e){r.image=e,r.needsUpdate=!0,void 0!==t&&t(r)}),n,i),r}}class ra extends Qe{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new z(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}class sa extends ra{constructor(e,t,n){super(e,n),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Qe.DefaultUp),this.updateMatrix(),this.groundColor=new z(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}}const oa=new Ee,aa=new Y,ca=new Y;class la{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new _(512,512),this.map=null,this.mapPass=null,this.matrix=new Ee,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new ln,this._frameExtents=new _(1,1),this._viewportCount=1,this._viewports=[new j(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,n=this.matrix;aa.setFromMatrixPosition(e.matrixWorld),t.position.copy(aa),ca.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(ca),t.updateMatrixWorld(),oa.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(oa),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(t.projectionMatrix),n.multiply(t.matrixWorldInverse)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class ua extends la{constructor(){super(new Qt(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const t=this.camera,n=2*m*e.angle*this.focus,i=this.mapSize.width/this.mapSize.height,r=e.distance||t.far;n===t.fov&&i===t.aspect&&r===t.far||(t.fov=n,t.aspect=i,t.far=r,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class ha extends ra{constructor(e,t,n=0,i=Math.PI/3,r=0,s=1){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Qe.DefaultUp),this.updateMatrix(),this.target=new Qe,this.distance=n,this.angle=i,this.penumbra=r,this.decay=s,this.shadow=new ua}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const da=new Ee,pa=new Y,fa=new Y;class ma extends la{constructor(){super(new Qt(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new _(4,2),this._viewportCount=6,this._viewports=[new j(2,1,1,1),new j(0,1,1,1),new j(3,1,1,1),new j(1,1,1,1),new j(3,0,1,1),new j(1,0,1,1)],this._cubeDirections=[new Y(1,0,0),new Y(-1,0,0),new Y(0,0,1),new Y(0,0,-1),new Y(0,1,0),new Y(0,-1,0)],this._cubeUps=[new Y(0,1,0),new Y(0,1,0),new Y(0,1,0),new Y(0,1,0),new Y(0,0,1),new Y(0,0,-1)]}updateMatrices(e,t=0){const n=this.camera,i=this.matrix,r=e.distance||n.far;r!==n.far&&(n.far=r,n.updateProjectionMatrix()),pa.setFromMatrixPosition(e.matrixWorld),n.position.copy(pa),fa.copy(n.position),fa.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(fa),n.updateMatrixWorld(),i.makeTranslation(-pa.x,-pa.y,-pa.z),da.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(da)}}class ga extends ra{constructor(e,t,n=0,i=1){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=n,this.decay=i,this.shadow=new ma}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class va extends la{constructor(){super(new An(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class ya extends ra{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Qe.DefaultUp),this.updateMatrix(),this.target=new Qe,this.shadow=new va}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class xa extends ra{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class wa{static decodeText(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);let t="";for(let n=0,i=e.length;n<i;n++)t+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(t))}catch(e){return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return-1===t?"./":e.slice(0,t+1)}static resolveURL(e,t){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class ba extends $o{constructor(e){super(e),this.isImageBitmapLoader=!0,"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,n,i){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,s=Yo.get(e);if(void 0!==s)return r.manager.itemStart(e),setTimeout((function(){t&&t(s),r.manager.itemEnd(e)}),0),s;const o={};o.credentials="anonymous"===this.crossOrigin?"same-origin":"include",o.headers=this.requestHeader,fetch(e,o).then((function(e){return e.blob()})).then((function(e){return createImageBitmap(e,Object.assign(r.options,{colorSpaceConversion:"none"}))})).then((function(n){Yo.add(e,n),t&&t(n),r.manager.itemEnd(e)})).catch((function(t){i&&i(t),r.manager.itemError(e),r.manager.itemEnd(e)})),r.manager.itemStart(e)}}class Aa{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=Sa(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=Sa();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function Sa(){return("undefined"==typeof performance?Date:performance).now()}class _a{constructor(e,t,n){let i,r,s;switch(this.binding=e,this.valueSize=n,t){case"quaternion":i=this._slerp,r=this._slerpAdditive,s=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*n),this._workIndex=5;break;case"string":case"bool":i=this._select,r=this._select,s=this._setAdditiveIdentityOther,this.buffer=new Array(5*n);break;default:i=this._lerp,r=this._lerpAdditive,s=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*n)}this._mixBufferRegion=i,this._mixBufferRegionAdditive=r,this._setIdentity=s,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const n=this.buffer,i=this.valueSize,r=e*i+i;let s=this.cumulativeWeight;if(0===s){for(let e=0;e!==i;++e)n[r+e]=n[e];s=t}else{s+=t;const e=t/s;this._mixBufferRegion(n,r,0,e,i)}this.cumulativeWeight=s}accumulateAdditive(e){const t=this.buffer,n=this.valueSize,i=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,i,0,e,n),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,n=this.buffer,i=e*t+t,r=this.cumulativeWeight,s=this.cumulativeWeightAdditive,o=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1){const e=t*this._origIndex;this._mixBufferRegion(n,i,e,1-r,t)}s>0&&this._mixBufferRegionAdditive(n,i,this._addIndex*t,1,t);for(let e=t,r=t+t;e!==r;++e)if(n[e]!==n[e+t]){o.setValue(n,i);break}}saveOriginalState(){const e=this.binding,t=this.buffer,n=this.valueSize,i=n*this._origIndex;e.getValue(t,i);for(let e=n,r=i;e!==r;++e)t[e]=t[i+e%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=3*this.valueSize;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let n=e;n<t;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[t+n]=this.buffer[e+n]}_select(e,t,n,i,r){if(i>=.5)for(let i=0;i!==r;++i)e[t+i]=e[n+i]}_slerp(e,t,n,i){Z.slerpFlat(e,t,e,t,e,n,i)}_slerpAdditive(e,t,n,i,r){const s=this._workIndex*r;Z.multiplyQuaternionsFlat(e,s,e,t,e,n),Z.slerpFlat(e,t,e,t,e,s,i)}_lerp(e,t,n,i,r){const s=1-i;for(let o=0;o!==r;++o){const r=t+o;e[r]=e[r]*s+e[n+o]*i}}_lerpAdditive(e,t,n,i,r){for(let s=0;s!==r;++s){const r=t+s;e[r]=e[r]+e[n+s]*i}}}const Ma=new RegExp("[\\[\\]\\.:\\/]","g"),Ta="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",Ea=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC","[^\\[\\]\\.:\\/]")+/(WCOD+)?/.source.replace("WCOD",Ta)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC","[^\\[\\]\\.:\\/]")+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC","[^\\[\\]\\.:\\/]")+"$"),Ca=["material","materials","bones"];class Ra{constructor(e,t,n){this.path=t,this.parsedPath=n||Ra.parseTrackName(t),this.node=Ra.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,n){return e&&e.isAnimationObjectGroup?new Ra.Composite(e,t,n):new Ra(e,t,n)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(Ma,"")}static parseTrackName(e){const t=Ea.exec(e);if(null===t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},i=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==i&&-1!==i){const e=n.nodeName.substring(i+1);-1!==Ca.indexOf(e)&&(n.nodeName=n.nodeName.substring(0,i),n.objectName=e)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}static findNode(e,t){if(void 0===t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){const n=e.skeleton.getBoneByName(t);if(void 0!==n)return n}if(e.children){const n=function(e){for(let i=0;i<e.length;i++){const r=e[i];if(r.name===t||r.uuid===t)return r;const s=n(r.children);if(s)return s}return null},i=n(e.children);if(i)return i}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)e[t++]=n[i]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,n=t.objectName,i=t.propertyName;let r=t.propertyIndex;if(e||(e=Ra.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(n){let i=t.objectIndex;switch(n){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(let t=0;t<e.length;t++)if(e[t].name===i){i=t;break}break;default:if(void 0===e[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[n]}if(void 0!==i){if(void 0===e[i])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[i]}}const s=e[i];if(void 0===s){const n=t.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+n+"."+i+" but it wasn't found.",e)}let o=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?o=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(o=this.Versioning.MatrixWorldNeedsUpdate);let a=this.BindingType.Direct;if(void 0!==r){if("morphTargetInfluences"===i){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==e.morphTargetDictionary[r]&&(r=e.morphTargetDictionary[r])}a=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=r}else void 0!==s.fromArray&&void 0!==s.toArray?(a=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(a=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=i;this.getValue=this.GetterByBindingType[a],this.setValue=this.SetterByBindingTypeAndVersioning[a][o]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Ra.Composite=class{constructor(e,t,n){const i=n||Ra.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,i)}getValue(e,t){this.bind();const n=this._targetGroup.nCachedObjects_,i=this._bindings[n];void 0!==i&&i.getValue(e,t)}setValue(e,t){const n=this._bindings;for(let i=this._targetGroup.nCachedObjects_,r=n.length;i!==r;++i)n[i].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}},Ra.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Ra.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Ra.prototype.GetterByBindingType=[Ra.prototype._getValue_direct,Ra.prototype._getValue_array,Ra.prototype._getValue_arrayElement,Ra.prototype._getValue_toArray],Ra.prototype.SetterByBindingTypeAndVersioning=[[Ra.prototype._setValue_direct,Ra.prototype._setValue_direct_setNeedsUpdate,Ra.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Ra.prototype._setValue_array,Ra.prototype._setValue_array_setNeedsUpdate,Ra.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Ra.prototype._setValue_arrayElement,Ra.prototype._setValue_arrayElement_setNeedsUpdate,Ra.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Ra.prototype._setValue_fromArray,Ra.prototype._setValue_fromArray_setNeedsUpdate,Ra.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class Pa{constructor(e,t,n=null,i=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=n,this.blendMode=i;const r=t.tracks,s=r.length,o=new Array(s),a={endingStart:2400,endingEnd:2400};for(let e=0;e!==s;++e){const t=r[e].createInterpolant(null);o[e]=t,t.settings=a}this._interpolantSettings=a,this._interpolants=o,this._propertyBindings=new Array(s),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,n){if(e.fadeOut(t),this.fadeIn(t),n){const n=this._clip.duration,i=e._clip.duration,r=i/n,s=n/i;e.warp(1,r,t),this.warp(s,1,t)}return this}crossFadeTo(e,t,n){return e.crossFadeFrom(this,t,n)}stopFading(){const e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,n){const i=this._mixer,r=i.time,s=this.timeScale;let o=this._timeScaleInterpolant;null===o&&(o=i._lendControlInterpolant(),this._timeScaleInterpolant=o);const a=o.parameterPositions,c=o.sampleValues;return a[0]=r,a[1]=r+n,c[0]=e/s,c[1]=t/s,this}stopWarping(){const e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,n,i){if(!this.enabled)return void this._updateWeight(e);const r=this._startTime;if(null!==r){const i=(e-r)*n;if(i<0||0===n)return;this._startTime=null,t=n*i}t*=this._updateTimeScale(e);const s=this._updateTime(t),o=this._updateWeight(e);if(o>0){const e=this._interpolants,t=this._propertyBindings;switch(this.blendMode){case 2501:for(let n=0,i=e.length;n!==i;++n)e[n].evaluate(s),t[n].accumulateAdditive(o);break;case 2500:default:for(let n=0,r=e.length;n!==r;++n)e[n].evaluate(s),t[n].accumulate(i,o)}}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const n=this._weightInterpolant;if(null!==n){const i=n.evaluate(e)[0];t*=i,e>n.parameterPositions[1]&&(this.stopFading(),0===i&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const n=this._timeScaleInterpolant;if(null!==n){t*=n.evaluate(e)[0],e>n.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,n=this.loop;let i=this.time+e,r=this._loopCount;const s=2202===n;if(0===e)return-1===r?i:s&&1==(1&r)?t-i:i;if(2200===n){-1===r&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(i>=t)i=t;else{if(!(i<0)){this.time=i;break e}i=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===r&&(e>=0?(r=0,this._setEndings(!0,0===this.repetitions,s)):this._setEndings(0===this.repetitions,!0,s)),i>=t||i<0){const n=Math.floor(i/t);i-=t*n,r+=Math.abs(n);const o=this.repetitions-r;if(o<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,i=e>0?t:0,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===o){const t=e<0;this._setEndings(t,!t,s)}else this._setEndings(!1,!1,s);this._loopCount=r,this.time=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:n})}}else this.time=i;if(s&&1==(1&r))return t-i}return i}_setEndings(e,t,n){const i=this._interpolantSettings;n?(i.endingStart=2401,i.endingEnd=2401):(i.endingStart=e?this.zeroSlopeAtStart?2401:2400:2402,i.endingEnd=t?this.zeroSlopeAtEnd?2401:2400:2402)}_scheduleFading(e,t,n){const i=this._mixer,r=i.time;let s=this._weightInterpolant;null===s&&(s=i._lendControlInterpolant(),this._weightInterpolant=s);const o=s.parameterPositions,a=s.sampleValues;return o[0]=r,a[0]=t,o[1]=r+e,a[1]=n,this}}const La=new Float32Array(1);class Da extends h{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const n=e._localRoot||this._root,i=e._clip.tracks,r=i.length,s=e._propertyBindings,o=e._interpolants,a=n.uuid,c=this._bindingsByRootAndName;let l=c[a];void 0===l&&(l={},c[a]=l);for(let e=0;e!==r;++e){const r=i[e],c=r.name;let u=l[c];if(void 0!==u)++u.referenceCount,s[e]=u;else{if(u=s[e],void 0!==u){null===u._cacheIndex&&(++u.referenceCount,this._addInactiveBinding(u,a,c));continue}const i=t&&t._propertyBindings[e].binding.parsedPath;u=new _a(Ra.create(n,c,i),r.ValueTypeName,r.getValueSize()),++u.referenceCount,this._addInactiveBinding(u,a,c),s[e]=u}o[e].resultBuffer=u.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){const t=(e._localRoot||this._root).uuid,n=e._clip.uuid,i=this._actionsByClip[n];this._bindAction(e,i&&i.knownActions[0]),this._addInactiveAction(e,n,t)}const t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){const n=t[e];0==n.useCount++&&(this._lendBinding(n),n.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){const n=t[e];0==--n.useCount&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return null!==t&&t<this._nActiveActions}_addInactiveAction(e,t,n){const i=this._actions,r=this._actionsByClip;let s=r[t];if(void 0===s)s={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,r[t]=s;else{const t=s.knownActions;e._byClipCacheIndex=t.length,t.push(e)}e._cacheIndex=i.length,i.push(e),s.actionByRoot[n]=e}_removeInactiveAction(e){const t=this._actions,n=t[t.length-1],i=e._cacheIndex;n._cacheIndex=i,t[i]=n,t.pop(),e._cacheIndex=null;const r=e._clip.uuid,s=this._actionsByClip,o=s[r],a=o.knownActions,c=a[a.length-1],l=e._byClipCacheIndex;c._byClipCacheIndex=l,a[l]=c,a.pop(),e._byClipCacheIndex=null;delete o.actionByRoot[(e._localRoot||this._root).uuid],0===a.length&&delete s[r],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){const n=t[e];0==--n.referenceCount&&this._removeInactiveBinding(n)}}_lendAction(e){const t=this._actions,n=e._cacheIndex,i=this._nActiveActions++,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_takeBackAction(e){const t=this._actions,n=e._cacheIndex,i=--this._nActiveActions,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_addInactiveBinding(e,t,n){const i=this._bindingsByRootAndName,r=this._bindings;let s=i[t];void 0===s&&(s={},i[t]=s),s[n]=e,e._cacheIndex=r.length,r.push(e)}_removeInactiveBinding(e){const t=this._bindings,n=e.binding,i=n.rootNode.uuid,r=n.path,s=this._bindingsByRootAndName,o=s[i],a=t[t.length-1],c=e._cacheIndex;a._cacheIndex=c,t[c]=a,t.pop(),delete o[r],0===Object.keys(o).length&&delete s[i]}_lendBinding(e){const t=this._bindings,n=e._cacheIndex,i=this._nActiveBindings++,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_takeBackBinding(e){const t=this._bindings,n=e._cacheIndex,i=--this._nActiveBindings,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let n=e[t];return void 0===n&&(n=new zo(new Float32Array(2),new Float32Array(2),1,La),n.__cacheIndex=t,e[t]=n),n}_takeBackControlInterpolant(e){const t=this._controlInterpolants,n=e.__cacheIndex,i=--this._nActiveControlInterpolants,r=t[i];e.__cacheIndex=i,t[i]=e,r.__cacheIndex=n,t[n]=r}clipAction(e,t,n){const i=t||this._root,r=i.uuid;let s="string"==typeof e?qo.findByName(i,e):e;const o=null!==s?s.uuid:e,a=this._actionsByClip[o];let c=null;if(void 0===n&&(n=null!==s?s.blendMode:2500),void 0!==a){const e=a.actionByRoot[r];if(void 0!==e&&e.blendMode===n)return e;c=a.knownActions[0],null===s&&(s=c._clip)}if(null===s)return null;const l=new Pa(this,s,t,n);return this._bindAction(l,c),this._addInactiveAction(l,o,r),l}existingAction(e,t){const n=t||this._root,i=n.uuid,r="string"==typeof e?qo.findByName(n,e):e,s=r?r.uuid:e,o=this._actionsByClip[s];return void 0!==o&&o.actionByRoot[i]||null}stopAllAction(){const e=this._actions;for(let t=this._nActiveActions-1;t>=0;--t)e[t].stop();return this}update(e){e*=this.timeScale;const t=this._actions,n=this._nActiveActions,i=this.time+=e,r=Math.sign(e),s=this._accuIndex^=1;for(let o=0;o!==n;++o){t[o]._update(i,e,r,s)}const o=this._bindings,a=this._nActiveBindings;for(let e=0;e!==a;++e)o[e].apply(s);return this}setTime(e){this.time=0;for(let e=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,n=e.uuid,i=this._actionsByClip,r=i[n];if(void 0!==r){const e=r.knownActions;for(let n=0,i=e.length;n!==i;++n){const i=e[n];this._deactivateAction(i);const r=i._cacheIndex,s=t[t.length-1];i._cacheIndex=null,i._byClipCacheIndex=null,s._cacheIndex=r,t[r]=s,t.pop(),this._removeInactiveBindingsForAction(i)}delete i[n]}}uncacheRoot(e){const t=e.uuid,n=this._actionsByClip;for(const e in n){const i=n[e].actionByRoot[t];void 0!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}const i=this._bindingsByRootAndName[t];if(void 0!==i)for(const e in i){const t=i[e];t.restoreOriginalState(),this._removeInactiveBinding(t)}}uncacheAction(e,t){const n=this.existingAction(e,t);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}}class Ia{constructor(e,t,n=0,i=1/0){this.ray=new Te(e,t),this.near=n,this.far=i,this.camera=null,this.layers=new ze,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e,t=!0,n=[]){return Oa(e,this,n,t),n.sort(ka),n}intersectObjects(e,t=!0,n=[]){for(let i=0,r=e.length;i<r;i++)Oa(e[i],this,n,t);return n.sort(ka),n}}function ka(e,t){return e.distance-t.distance}function Oa(e,t,n,i){if(e.layers.test(t.layers)&&e.raycast(t,n),!0===i){const i=e.children;for(let e=0,r=i.length;e<r;e++)Oa(i[e],t,n,!0)}}class Ba{constructor(e=1,t=0,n=0){return this.radius=e,this.phi=t,this.theta=n,this}set(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(v(t/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}}const Na=new Y,za=new Y;class Fa{constructor(e=new Y,t=new Y){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){Na.subVectors(e,this.start),za.subVectors(this.end,this.start);const n=za.dot(za);let i=za.dot(Na)/n;return t&&(i=v(i,0,1)),i}closestPointToPoint(e,t,n){const i=this.closestPointToPointParameter(e,t);return this.delta(n).multiplyScalar(i).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}}const Ua=new $;class Ha extends ws{constructor(e,t=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Float32Array(24),r=new Tt;r.setIndex(new mt(n,1)),r.setAttribute("position",new mt(i,3)),super(r,new hs({color:t,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(e){if(void 0!==e&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&Ua.setFromObject(this.object),Ua.isEmpty())return;const t=Ua.min,n=Ua.max,i=this.geometry.attributes.position,r=i.array;r[0]=n.x,r[1]=n.y,r[2]=n.z,r[3]=t.x,r[4]=n.y,r[5]=n.z,r[6]=t.x,r[7]=t.y,r[8]=n.z,r[9]=n.x,r[10]=t.y,r[11]=n.z,r[12]=n.x,r[13]=n.y,r[14]=t.z,r[15]=t.x,r[16]=n.y,r[17]=t.z,r[18]=t.x,r[19]=t.y,r[20]=t.z,r[21]=n.x,r[22]=t.y,r[23]=t.z,i.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e,t){return super.copy(e,t),this.object=e.object,this}}const Va=new Y;let Ga,Wa;class ja extends Qe{constructor(e=new Y(0,0,1),t=new Y(0,0,0),n=1,i=16776960,r=.2*n,s=.2*r){super(),this.type="ArrowHelper",void 0===Ga&&(Ga=new Tt,Ga.setAttribute("position",new yt([0,0,0,0,1,0],3)),Wa=new qs(0,.5,1,5,1),Wa.translate(0,-.5,0)),this.position.copy(t),this.line=new vs(Ga,new hs({color:i,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Wt(Wa,new dt({color:i,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(n,r,s)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{Va.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle(Va,t)}}setLength(e,t=.2*e,n=.2*t){this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(n,t,n),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}}const{floatView:Ja,uint32View:Xa,baseTable:qa,shiftTable:Za,mantissaTable:Ya,exponentTable:Ka,offsetTable:Qa}=$a();function $a(){const e=new ArrayBuffer(4),t=new Float32Array(e),n=new Uint32Array(e),i=new Uint32Array(512),r=new Uint32Array(512);for(let e=0;e<256;++e){const t=e-127;t<-27?(i[e]=0,i[256|e]=32768,r[e]=24,r[256|e]=24):t<-14?(i[e]=1024>>-t-14,i[256|e]=1024>>-t-14|32768,r[e]=-t-1,r[256|e]=-t-1):t<=15?(i[e]=t+15<<10,i[256|e]=t+15<<10|32768,r[e]=13,r[256|e]=13):t<128?(i[e]=31744,i[256|e]=64512,r[e]=24,r[256|e]=24):(i[e]=31744,i[256|e]=64512,r[e]=13,r[256|e]=13)}const s=new Uint32Array(2048),o=new Uint32Array(64),a=new Uint32Array(64);for(let e=1;e<1024;++e){let t=e<<13,n=0;for(;0==(8388608&t);)t<<=1,n-=8388608;t&=-8388609,n+=947912704,s[e]=t|n}for(let e=1024;e<2048;++e)s[e]=939524096+(e-1024<<13);for(let e=1;e<31;++e)o[e]=e<<23;o[31]=1199570944,o[32]=2147483648;for(let e=33;e<63;++e)o[e]=2147483648+(e-32<<23);o[63]=3347054592;for(let e=1;e<64;++e)32!==e&&(a[e]=1024);return{floatView:t,uint32View:n,baseTable:i,shiftTable:r,mantissaTable:s,exponentTable:o,offsetTable:a}}"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"142"}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__="142");var ec=function(){var e=0,t=document.createElement("div");function n(e){return t.appendChild(e.dom),e}function i(n){for(var i=0;i<t.children.length;i++)t.children[i].style.display=i===n?"block":"none";e=n}t.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",t.addEventListener("click",(function(n){n.preventDefault(),i(++e%t.children.length)}),!1);var r=(performance||Date).now(),s=r,o=0,a=n(new ec.Panel("FPS","#0ff","#002")),c=n(new ec.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var l=n(new ec.Panel("MB","#f08","#201"));return i(0),{REVISION:16,dom:t,addPanel:n,showPanel:i,begin:function(){r=(performance||Date).now()},end:function(){o++;var e=(performance||Date).now();if(c.update(e-r,200),e>=s+1e3&&(a.update(1e3*o/(e-s),100),s=e,o=0,l)){var t=performance.memory;l.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){r=this.end()},domElement:t,setMode:i}};ec.Panel=function(e,t,n){var i=1/0,r=0,s=Math.round,o=s(window.devicePixelRatio||1),a=80*o,c=48*o,l=3*o,u=2*o,h=3*o,d=15*o,p=74*o,f=30*o,m=document.createElement("canvas");m.width=a,m.height=c,m.style.cssText="width:80px;height:48px";var g=m.getContext("2d");return g.font="bold "+9*o+"px Helvetica,Arial,sans-serif",g.textBaseline="top",g.fillStyle=n,g.fillRect(0,0,a,c),g.fillStyle=t,g.fillText(e,l,u),g.fillRect(h,d,p,f),g.fillStyle=n,g.globalAlpha=.9,g.fillRect(h,d,p,f),{dom:m,update:function(c,v){i=Math.min(i,c),r=Math.max(r,c),g.fillStyle=n,g.globalAlpha=1,g.fillRect(0,0,a,d),g.fillStyle=t,g.fillText(s(c)+" "+e+" ("+s(i)+"-"+s(r)+")",l,u),g.drawImage(m,h+o,d,p-o,f,h,d,p-o,f),g.fillRect(h+p-o,d,o,f),g.fillStyle=n,g.globalAlpha=.9,g.fillRect(h+p-o,d,o,s((1-c/v)*f))}}};var tc=ec;const nc=new Y(0,-1,0);class ic extends Qe{constructor(e,t){super(),this.box=new $,this.velocity=new Y,this.horizontalVelocity=new Y,this.radius=e,this.size=t,this.onGround=!1,this.canJump=!0,this.gravity=-20,this.segment=new Fa(new Y,new Y(0,-t,0)),this.raycaster=new Ia,this.raycaster.set(this.position,nc),this.arrowHelper=new ja(this.raycaster.ray.direction,this.raycaster.ray.origin,100,65280),this.debugHitBox=new Wt(new Jt(2*e,t+2*e,2*e)),this.debugHitBox.material.wireframe=!0,this.isHelperActive=!1,this.friction=.975}toggleHitbox(){this.isHelperActive?(MAIN_SCENE.remove(this.debugHitBox),MAIN_SCENE.remove(this.arrowHelper)):(MAIN_SCENE.add(this.arrowHelper),MAIN_SCENE.add(this.debugHitBox)),this.isHelperActive=!this.isHelperActive}update(e,t){this.velocity.y+=this.onGround?0:e*this.gravity,this.position.addScaledVector(this.velocity,e),this.position.add(this.horizontalVelocity),this.horizontalVelocity.multiplyScalar(this.friction),this.updateMatrixWorld();const n=new Ee;n.copy(t.matrixWorld).invert();const i=new Fa;i.copy(this.segment),i.start.applyMatrix4(this.matrixWorld).applyMatrix4(n),i.end.applyMatrix4(this.matrixWorld).applyMatrix4(n);const r=new $;r.makeEmpty(),r.expandByPoint(i.start),r.expandByPoint(i.end),r.min.addScalar(-this.radius),r.max.addScalar(this.radius);const s=new Y,o=new Y;t.geometry.boundsTree.shapecast({intersectsBounds:e=>e.intersectsBox(r),intersectsTriangle:e=>{const t=s,n=o,r=e.closestPointToSegment(i,t,n);if(r<this.radius){const e=this.radius-r,s=n.sub(t).normalize();i.start.addScaledVector(s,e),i.end.addScaledVector(s,e)}}});const a=s;a.copy(i.start).applyMatrix4(t.matrixWorld);const c=o;c.subVectors(a,this.position);const l=Math.max(0,c.length()-1e-5);c.normalize().multiplyScalar(l),this.position.add(c),this.onGround=c.y>Math.abs(e*this.velocity.y*.25),this.raycaster.set(i.start,nc),this.raycaster.ray.applyMatrix4(n);const u=t.bvh.raycastFirst(this.raycaster.ray);this.canJump=u&&u.distance<2||this.onGround,this.isHelperActive&&(this.debugHitBox.position.copy(i.start.add(i.end).multiplyScalar(.5)),this.canJump?this.arrowHelper.setColor(65280):this.arrowHelper.setColor(16711680),this.arrowHelper.position.copy(i.start)),this.onGround?this.velocity.set(0,0,0):(c.normalize(),this.velocity.addScaledVector(c,-c.dot(this.velocity)))}}const rc=new Ne(0,0,0,"YXZ"),sc=new Y,oc={type:"change"},ac={type:"lock"},cc={type:"unlock"},lc=Math.PI/2;class uc extends h{constructor(e,t){super(),void 0===t&&(console.warn('THREE.PointerLockControls: The second parameter "domElement" is now mandatory.'),t=document.body),this.domElement=t,this.isLocked=!1,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.sensitivityX=.002,this.sensitivityY=.002;const n=this;function i(t){if(!1===n.isLocked)return;const i=t.movementX||t.mozMovementX||t.webkitMovementX||0,r=t.movementY||t.mozMovementY||t.webkitMovementY||0;rc.setFromQuaternion(e.quaternion),rc.y-=i*n.sensitivityX,rc.x-=r*n.sensitivityY,rc.x=Math.max(lc-n.maxPolarAngle,Math.min(lc-n.minPolarAngle,rc.x)),e.quaternion.setFromEuler(rc),n.dispatchEvent(oc)}function r(){n.domElement.ownerDocument.pointerLockElement===n.domElement?(n.dispatchEvent(ac),n.isLocked=!0):(n.dispatchEvent(cc),n.isLocked=!1)}function s(){console.error("THREE.PointerLockControls: Unable to use Pointer Lock API")}this.connect=function(){n.domElement.ownerDocument.addEventListener("mousemove",i),n.domElement.ownerDocument.addEventListener("pointerlockchange",r),n.domElement.ownerDocument.addEventListener("pointerlockerror",s)},this.disconnect=function(){n.domElement.ownerDocument.removeEventListener("mousemove",i),n.domElement.ownerDocument.removeEventListener("pointerlockchange",r),n.domElement.ownerDocument.removeEventListener("pointerlockerror",s)},this.dispose=function(){this.disconnect()},this.getObject=function(){return e},this.getDirection=function(){const t=new Y(0,0,-1);return function(n){return n.copy(t).applyQuaternion(e.quaternion)}}(),this.moveForward=function(t){sc.setFromMatrixColumn(e.matrix,0),sc.crossVectors(e.up,sc),e.position.addScaledVector(sc,t)},this.moveRight=function(t){sc.setFromMatrixColumn(e.matrix,0),e.position.addScaledVector(sc,t)},this.lock=function(){this.domElement.requestPointerLock()},this.unlock=function(){n.domElement.ownerDocument.exitPointerLock()},this.connect()}}class hc extends $o{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register((function(e){return new vc(e)})),this.register((function(e){return new _c(e)})),this.register((function(e){return new Mc(e)})),this.register((function(e){return new xc(e)})),this.register((function(e){return new wc(e)})),this.register((function(e){return new bc(e)})),this.register((function(e){return new Ac(e)})),this.register((function(e){return new gc(e)})),this.register((function(e){return new Sc(e)})),this.register((function(e){return new yc(e)})),this.register((function(e){return new fc(e)})),this.register((function(e){return new Tc(e)}))}load(e,t,n,i){const r=this;let s;s=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:wa.extractUrlBase(e),this.manager.itemStart(e);const o=function(t){i?i(t):console.error(t),r.manager.itemError(e),r.manager.itemEnd(e)},a=new ta(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,(function(n){try{r.parse(n,s,(function(n){t(n),r.manager.itemEnd(e)}),o)}catch(e){o(e)}}),n,o)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,i){let r;const s={},o={};if("string"==typeof e)r=e;else{if(wa.decodeText(new Uint8Array(e,0,4))===Ec){try{s[pc.KHR_BINARY_GLTF]=new Pc(e)}catch(e){return void(i&&i(e))}r=s[pc.KHR_BINARY_GLTF].content}else r=wa.decodeText(new Uint8Array(e))}const a=JSON.parse(r);if(void 0===a.asset||a.asset.version[0]<2)return void(i&&i(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const c=new cl(a,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});c.fileLoader.setRequestHeader(this.requestHeader);for(let e=0;e<this.pluginCallbacks.length;e++){const t=this.pluginCallbacks[e](c);o[t.name]=t,s[t.name]=!0}if(a.extensionsUsed)for(let e=0;e<a.extensionsUsed.length;++e){const t=a.extensionsUsed[e],n=a.extensionsRequired||[];switch(t){case pc.KHR_MATERIALS_UNLIT:s[t]=new mc;break;case pc.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:s[t]=new kc;break;case pc.KHR_DRACO_MESH_COMPRESSION:s[t]=new Lc(a,this.dracoLoader);break;case pc.KHR_TEXTURE_TRANSFORM:s[t]=new Dc;break;case pc.KHR_MESH_QUANTIZATION:s[t]=new Oc;break;default:n.indexOf(t)>=0&&void 0===o[t]&&console.warn('THREE.GLTFLoader: Unknown extension "'+t+'".')}}c.setExtensions(s),c.setPlugins(o),c.parse(n,i)}parseAsync(e,t){const n=this;return new Promise((function(i,r){n.parse(e,t,i,r)}))}}function dc(){let e={};return{get:function(t){return e[t]},add:function(t,n){e[t]=n},remove:function(t){delete e[t]},removeAll:function(){e={}}}}const pc={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"};class fc{constructor(e){this.parser=e,this.name=pc.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let n=0,i=t.length;n<i;n++){const i=t[n];i.extensions&&i.extensions[this.name]&&void 0!==i.extensions[this.name].light&&e._addNodeRef(this.cache,i.extensions[this.name].light)}}_loadLight(e){const t=this.parser,n="light:"+e;let i=t.cache.get(n);if(i)return i;const r=t.json,s=((r.extensions&&r.extensions[this.name]||{}).lights||[])[e];let o;const a=new z(16777215);void 0!==s.color&&a.fromArray(s.color);const c=void 0!==s.range?s.range:0;switch(s.type){case"directional":o=new ya(a),o.target.position.set(0,0,-1),o.add(o.target);break;case"point":o=new ga(a),o.distance=c;break;case"spot":o=new ha(a),o.distance=c,s.spot=s.spot||{},s.spot.innerConeAngle=void 0!==s.spot.innerConeAngle?s.spot.innerConeAngle:0,s.spot.outerConeAngle=void 0!==s.spot.outerConeAngle?s.spot.outerConeAngle:Math.PI/4,o.angle=s.spot.outerConeAngle,o.penumbra=1-s.spot.innerConeAngle/s.spot.outerConeAngle,o.target.position.set(0,0,-1),o.add(o.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+s.type)}return o.position.set(0,0,0),o.decay=2,void 0!==s.intensity&&(o.intensity=s.intensity),o.name=t.createUniqueName(s.name||"light_"+e),i=Promise.resolve(o),t.cache.add(n,i),i}createNodeAttachment(e){const t=this,n=this.parser,i=n.json.nodes[e],r=(i.extensions&&i.extensions[this.name]||{}).light;return void 0===r?null:this._loadLight(r).then((function(e){return n._getNodeRef(t.cache,r,e)}))}}class mc{constructor(){this.name=pc.KHR_MATERIALS_UNLIT}getMaterialType(){return dt}extendParams(e,t,n){const i=[];e.color=new z(1,1,1),e.opacity=1;const r=t.pbrMetallicRoughness;if(r){if(Array.isArray(r.baseColorFactor)){const t=r.baseColorFactor;e.color.fromArray(t),e.opacity=t[3]}void 0!==r.baseColorTexture&&i.push(n.assignTexture(e,"map",r.baseColorTexture,3001))}return Promise.all(i)}}class gc{constructor(e){this.parser=e,this.name=pc.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name].emissiveStrength;return void 0!==i&&(t.emissiveIntensity=i),Promise.resolve()}}class vc{constructor(e){this.parser=e,this.name=pc.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?Do:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],s=i.extensions[this.name];if(void 0!==s.clearcoatFactor&&(t.clearcoat=s.clearcoatFactor),void 0!==s.clearcoatTexture&&r.push(n.assignTexture(t,"clearcoatMap",s.clearcoatTexture)),void 0!==s.clearcoatRoughnessFactor&&(t.clearcoatRoughness=s.clearcoatRoughnessFactor),void 0!==s.clearcoatRoughnessTexture&&r.push(n.assignTexture(t,"clearcoatRoughnessMap",s.clearcoatRoughnessTexture)),void 0!==s.clearcoatNormalTexture&&(r.push(n.assignTexture(t,"clearcoatNormalMap",s.clearcoatNormalTexture)),void 0!==s.clearcoatNormalTexture.scale)){const e=s.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new _(e,e)}return Promise.all(r)}}class yc{constructor(e){this.parser=e,this.name=pc.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?Do:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],s=i.extensions[this.name];return void 0!==s.iridescenceFactor&&(t.iridescence=s.iridescenceFactor),void 0!==s.iridescenceTexture&&r.push(n.assignTexture(t,"iridescenceMap",s.iridescenceTexture)),void 0!==s.iridescenceIor&&(t.iridescenceIOR=s.iridescenceIor),void 0===t.iridescenceThicknessRange&&(t.iridescenceThicknessRange=[100,400]),void 0!==s.iridescenceThicknessMinimum&&(t.iridescenceThicknessRange[0]=s.iridescenceThicknessMinimum),void 0!==s.iridescenceThicknessMaximum&&(t.iridescenceThicknessRange[1]=s.iridescenceThicknessMaximum),void 0!==s.iridescenceThicknessTexture&&r.push(n.assignTexture(t,"iridescenceThicknessMap",s.iridescenceThicknessTexture)),Promise.all(r)}}class xc{constructor(e){this.parser=e,this.name=pc.KHR_MATERIALS_SHEEN}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?Do:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[];t.sheenColor=new z(0,0,0),t.sheenRoughness=0,t.sheen=1;const s=i.extensions[this.name];return void 0!==s.sheenColorFactor&&t.sheenColor.fromArray(s.sheenColorFactor),void 0!==s.sheenRoughnessFactor&&(t.sheenRoughness=s.sheenRoughnessFactor),void 0!==s.sheenColorTexture&&r.push(n.assignTexture(t,"sheenColorMap",s.sheenColorTexture,3001)),void 0!==s.sheenRoughnessTexture&&r.push(n.assignTexture(t,"sheenRoughnessMap",s.sheenRoughnessTexture)),Promise.all(r)}}class wc{constructor(e){this.parser=e,this.name=pc.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?Do:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],s=i.extensions[this.name];return void 0!==s.transmissionFactor&&(t.transmission=s.transmissionFactor),void 0!==s.transmissionTexture&&r.push(n.assignTexture(t,"transmissionMap",s.transmissionTexture)),Promise.all(r)}}class bc{constructor(e){this.parser=e,this.name=pc.KHR_MATERIALS_VOLUME}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?Do:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],s=i.extensions[this.name];t.thickness=void 0!==s.thicknessFactor?s.thicknessFactor:0,void 0!==s.thicknessTexture&&r.push(n.assignTexture(t,"thicknessMap",s.thicknessTexture)),t.attenuationDistance=s.attenuationDistance||0;const o=s.attenuationColor||[1,1,1];return t.attenuationColor=new z(o[0],o[1],o[2]),Promise.all(r)}}class Ac{constructor(e){this.parser=e,this.name=pc.KHR_MATERIALS_IOR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?Do:null}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name];return t.ior=void 0!==i.ior?i.ior:1.5,Promise.resolve()}}class Sc{constructor(e){this.parser=e,this.name=pc.KHR_MATERIALS_SPECULAR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?Do:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],s=i.extensions[this.name];t.specularIntensity=void 0!==s.specularFactor?s.specularFactor:1,void 0!==s.specularTexture&&r.push(n.assignTexture(t,"specularIntensityMap",s.specularTexture));const o=s.specularColorFactor||[1,1,1];return t.specularColor=new z(o[0],o[1],o[2]),void 0!==s.specularColorTexture&&r.push(n.assignTexture(t,"specularColorMap",s.specularColorTexture,3001)),Promise.all(r)}}class _c{constructor(e){this.parser=e,this.name=pc.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,n=t.json,i=n.textures[e];if(!i.extensions||!i.extensions[this.name])return null;const r=i.extensions[this.name],s=t.options.ktx2Loader;if(!s){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,r.source,s)}}class Mc{constructor(e){this.parser=e,this.name=pc.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,i=n.json,r=i.textures[e];if(!r.extensions||!r.extensions[t])return null;const s=r.extensions[t],o=i.images[s.source];let a=n.textureLoader;if(o.uri){const e=n.options.manager.getHandler(o.uri);null!==e&&(a=e)}return this.detectSupport().then((function(r){if(r)return n.loadTextureImage(e,s.source,a);if(i.extensionsRequired&&i.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}}))),this.isSupported}}class Tc{constructor(e){this.name=pc.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){const e=n.extensions[this.name],i=this.parser.getDependency("buffer",e.buffer),r=this.parser.options.meshoptDecoder;if(!r||!r.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([i,r.ready]).then((function(t){const n=e.byteOffset||0,i=e.byteLength||0,s=e.count,o=e.byteStride,a=new ArrayBuffer(s*o),c=new Uint8Array(t[0],n,i);return r.decodeGltfBuffer(new Uint8Array(a),s,o,c,e.mode,e.filter),a}))}return null}}const Ec="glTF",Cc=1313821514,Rc=5130562;class Pc{constructor(e){this.name=pc.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,12);if(this.header={magic:wa.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==Ec)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const n=this.header.length-12,i=new DataView(e,12);let r=0;for(;r<n;){const t=i.getUint32(r,!0);r+=4;const n=i.getUint32(r,!0);if(r+=4,n===Cc){const n=new Uint8Array(e,12+r,t);this.content=wa.decodeText(n)}else if(n===Rc){const n=12+r;this.body=e.slice(n,n+t)}r+=t}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class Lc{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=pc.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const n=this.json,i=this.dracoLoader,r=e.extensions[this.name].bufferView,s=e.extensions[this.name].attributes,o={},a={},c={};for(const e in s){const t=Yc[e]||e.toLowerCase();o[t]=s[e]}for(const t in e.attributes){const i=Yc[t]||t.toLowerCase();if(void 0!==s[t]){const r=n.accessors[e.attributes[t]],s=Jc[r.componentType];c[i]=s,a[i]=!0===r.normalized}}return t.getDependency("bufferView",r).then((function(e){return new Promise((function(t){i.decodeDracoFile(e,(function(e){for(const t in e.attributes){const n=e.attributes[t],i=a[t];void 0!==i&&(n.normalized=i)}t(e)}),o,c)}))}))}}class Dc{constructor(){this.name=pc.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return void 0!==t.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),void 0===t.offset&&void 0===t.rotation&&void 0===t.scale||(e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class Ic extends Lo{constructor(e){super(),this.isGLTFSpecularGlossinessMaterial=!0;const t=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),n=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),i=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),r=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),s=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.specularColor = specularFactor;"].join("\n"),o={specular:{value:(new z).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=o,this.onBeforeCompile=function(e){for(const t in o)e.uniforms[t]=o[t];e.fragmentShader=e.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",t).replace("#include <metalnessmap_pars_fragment>",n).replace("#include <roughnessmap_fragment>",i).replace("#include <metalnessmap_fragment>",r).replace("#include <lights_physical_fragment>",s)},Object.defineProperties(this,{specular:{get:function(){return o.specular.value},set:function(e){o.specular.value=e}},specularMap:{get:function(){return o.specularMap.value},set:function(e){o.specularMap.value=e,e?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return o.glossiness.value},set:function(e){o.glossiness.value=e}},glossinessMap:{get:function(){return o.glossinessMap.value},set:function(e){o.glossinessMap.value=e,e?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}copy(e){return super.copy(e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}class kc{constructor(){this.name=pc.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity"]}getMaterialType(){return Ic}extendParams(e,t,n){const i=t.extensions[this.name];e.color=new z(1,1,1),e.opacity=1;const r=[];if(Array.isArray(i.diffuseFactor)){const t=i.diffuseFactor;e.color.fromArray(t),e.opacity=t[3]}if(void 0!==i.diffuseTexture&&r.push(n.assignTexture(e,"map",i.diffuseTexture,3001)),e.emissive=new z(0,0,0),e.glossiness=void 0!==i.glossinessFactor?i.glossinessFactor:1,e.specular=new z(1,1,1),Array.isArray(i.specularFactor)&&e.specular.fromArray(i.specularFactor),void 0!==i.specularGlossinessTexture){const t=i.specularGlossinessTexture;r.push(n.assignTexture(e,"glossinessMap",t)),r.push(n.assignTexture(e,"specularMap",t,3001))}return Promise.all(r)}createMaterial(e){const t=new Ic(e);return t.fog=!0,t.color=e.color,t.map=void 0===e.map?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=void 0===e.aoMap?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=void 0===e.emissiveIntensity?1:e.emissiveIntensity,t.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,t.bumpMap=void 0===e.bumpMap?null:e.bumpMap,t.bumpScale=1,t.normalMap=void 0===e.normalMap?null:e.normalMap,t.normalMapType=0,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=void 0===e.specularMap?null:e.specularMap,t.specular=e.specular,t.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=void 0===e.envMap?null:e.envMap,t.envMapIntensity=1,t}}class Oc{constructor(){this.name=pc.KHR_MESH_QUANTIZATION}}class Bc extends Bo{constructor(e,t,n,i){super(e,t,n,i)}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=e*i*3+i;for(let e=0;e!==i;e++)t[e]=n[r+e];return t}interpolate_(e,t,n,i){const r=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=2*o,c=3*o,l=i-t,u=(n-t)/l,h=u*u,d=h*u,p=e*c,f=p-c,m=-2*d+3*h,g=d-h,v=1-m,y=g-h+u;for(let e=0;e!==o;e++){const t=s[f+e+o],n=s[f+e+a]*l,i=s[p+e+o],c=s[p+e]*l;r[e]=v*t+y*n+m*i+g*c}return r}}const Nc=new Z;class zc extends Bc{interpolate_(e,t,n,i){const r=super.interpolate_(e,t,n,i);return Nc.fromArray(r).normalize().toArray(r),r}}const Fc=0,Uc=1,Hc=2,Vc=3,Gc=4,Wc=5,jc=6,Jc={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Xc={9728:1003,9729:1006,9984:1004,9985:1007,9986:1005,9987:1008},qc={33071:1001,33648:1002,10497:1e3},Zc={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Yc={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Kc={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Qc={CUBICSPLINE:void 0,LINEAR:2301,STEP:2300},$c="OPAQUE",el="MASK",tl="BLEND";function nl(e,t,n){for(const i in n.extensions)void 0===e[i]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[i]=n.extensions[i])}function il(e,t){void 0!==t.extras&&("object"==typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function rl(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(let n=0,i=t.weights.length;n<i;n++)e.morphTargetInfluences[n]=t.weights[n];if(t.extras&&Array.isArray(t.extras.targetNames)){const n=t.extras.targetNames;if(e.morphTargetInfluences.length===n.length){e.morphTargetDictionary={};for(let t=0,i=n.length;t<i;t++)e.morphTargetDictionary[n[t]]=t}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function sl(e){const t=e.extensions&&e.extensions[pc.KHR_DRACO_MESH_COMPRESSION];let n;return n=t?"draco:"+t.bufferView+":"+t.indices+":"+ol(t.attributes):e.indices+":"+ol(e.attributes)+":"+e.mode,n}function ol(e){let t="";const n=Object.keys(e).sort();for(let i=0,r=n.length;i<r;i++)t+=n[i]+":"+e[n[i]]+";";return t}function al(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}class cl{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new dc,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};const n=!0===/^((?!chrome|android).)*safari/i.test(navigator.userAgent),i=navigator.userAgent.indexOf("Firefox")>-1,r=i?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1;"undefined"==typeof createImageBitmap||n||i&&r<98?this.textureLoader=new ia(this.options.manager):this.textureLoader=new ba(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new ta(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const n=this,i=this.json,r=this.extensions;this.cache.removeAll(),this._invokeAll((function(e){return e._markDefs&&e._markDefs()})),Promise.all(this._invokeAll((function(e){return e.beforeRoot&&e.beforeRoot()}))).then((function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])})).then((function(t){const s={scene:t[0][i.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:i.asset,parser:n,userData:{}};nl(r,s,i),il(s,i),Promise.all(n._invokeAll((function(e){return e.afterRoot&&e.afterRoot(s)}))).then((function(){e(s)}))})).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[];for(let n=0,i=t.length;n<i;n++){const i=t[n].joints;for(let t=0,n=i.length;t<n;t++)e[i[t]].isBone=!0}for(let t=0,i=e.length;t<i;t++){const i=e[t];void 0!==i.mesh&&(this._addNodeRef(this.meshCache,i.mesh),void 0!==i.skin&&(n[i.mesh].isSkinnedMesh=!0)),void 0!==i.camera&&this._addNodeRef(this.cameraCache,i.camera)}}_addNodeRef(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,n){if(e.refs[t]<=1)return n;const i=n.clone(),r=(e,t)=>{const n=this.associations.get(e);null!=n&&this.associations.set(t,n);for(const[n,i]of e.children.entries())r(i,t.children[n])};return r(n,i),i.name+="_instance_"+e.uses[t]++,i}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let n=0;n<t.length;n++){const i=e(t[n]);if(i)return i}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const n=[];for(let i=0;i<t.length;i++){const r=e(t[i]);r&&n.push(r)}return n}getDependency(e,t){const n=e+":"+t;let i=this.cache.get(n);if(!i){switch(e){case"scene":i=this.loadScene(t);break;case"node":i=this.loadNode(t);break;case"mesh":i=this._invokeOne((function(e){return e.loadMesh&&e.loadMesh(t)}));break;case"accessor":i=this.loadAccessor(t);break;case"bufferView":i=this._invokeOne((function(e){return e.loadBufferView&&e.loadBufferView(t)}));break;case"buffer":i=this.loadBuffer(t);break;case"material":i=this._invokeOne((function(e){return e.loadMaterial&&e.loadMaterial(t)}));break;case"texture":i=this._invokeOne((function(e){return e.loadTexture&&e.loadTexture(t)}));break;case"skin":i=this.loadSkin(t);break;case"animation":i=this._invokeOne((function(e){return e.loadAnimation&&e.loadAnimation(t)}));break;case"camera":i=this.loadCamera(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(n,i)}return i}getDependencies(e){let t=this.cache.get(e);if(!t){const n=this,i=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(i.map((function(t,i){return n.getDependency(e,i)}))),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],n=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[pc.KHR_BINARY_GLTF].body);const i=this.options;return new Promise((function(e,r){n.load(wa.resolveURL(t.uri,i.path),e,void 0,(function(){r(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))}))}))}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then((function(e){const n=t.byteLength||0,i=t.byteOffset||0;return e.slice(i,i+n)}))}loadAccessor(e){const t=this,n=this.json,i=this.json.accessors[e];if(void 0===i.bufferView&&void 0===i.sparse)return Promise.resolve(null);const r=[];return void 0!==i.bufferView?r.push(this.getDependency("bufferView",i.bufferView)):r.push(null),void 0!==i.sparse&&(r.push(this.getDependency("bufferView",i.sparse.indices.bufferView)),r.push(this.getDependency("bufferView",i.sparse.values.bufferView))),Promise.all(r).then((function(e){const r=e[0],s=Zc[i.type],o=Jc[i.componentType],a=o.BYTES_PER_ELEMENT,c=a*s,l=i.byteOffset||0,u=void 0!==i.bufferView?n.bufferViews[i.bufferView].byteStride:void 0,h=!0===i.normalized;let d,p;if(u&&u!==c){const e=Math.floor(l/u),n="InterleavedBuffer:"+i.bufferView+":"+i.componentType+":"+e+":"+i.count;let c=t.cache.get(n);c||(d=new o(r,e*u,i.count*u/a),c=new jr(d,u/a),t.cache.add(n,c)),p=new Xr(c,s,l%u/a,h)}else d=null===r?new o(i.count*s):new o(r,l,i.count*s),p=new mt(d,s,h);if(void 0!==i.sparse){const t=Zc.SCALAR,n=Jc[i.sparse.indices.componentType],a=i.sparse.indices.byteOffset||0,c=i.sparse.values.byteOffset||0,l=new n(e[1],a,i.sparse.count*t),u=new o(e[2],c,i.sparse.count*s);null!==r&&(p=new mt(p.array.slice(),p.itemSize,p.normalized));for(let e=0,t=l.length;e<t;e++){const t=l[e];if(p.setX(t,u[e*s]),s>=2&&p.setY(t,u[e*s+1]),s>=3&&p.setZ(t,u[e*s+2]),s>=4&&p.setW(t,u[e*s+3]),s>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return p}))}loadTexture(e){const t=this.json,n=this.options,i=t.textures[e].source,r=t.images[i];let s=this.textureLoader;if(r.uri){const e=n.manager.getHandler(r.uri);null!==e&&(s=e)}return this.loadTextureImage(e,i,s)}loadTextureImage(e,t,n){const i=this,r=this.json,s=r.textures[e],o=r.images[t],a=(o.uri||o.bufferView)+":"+s.sampler;if(this.textureCache[a])return this.textureCache[a];const c=this.loadImageSource(t,n).then((function(t){t.flipY=!1,s.name&&(t.name=s.name);const n=(r.samplers||{})[s.sampler]||{};return t.magFilter=Xc[n.magFilter]||1006,t.minFilter=Xc[n.minFilter]||1008,t.wrapS=qc[n.wrapS]||1e3,t.wrapT=qc[n.wrapT]||1e3,i.associations.set(t,{textures:e}),t})).catch((function(){return null}));return this.textureCache[a]=c,c}loadImageSource(e,t){const n=this,i=this.json,r=this.options;if(void 0!==this.sourceCache[e])return this.sourceCache[e].then(e=>e.clone());const s=i.images[e],o=self.URL||self.webkitURL;let a=s.uri||"",c=!1;if(void 0!==s.bufferView)a=n.getDependency("bufferView",s.bufferView).then((function(e){c=!0;const t=new Blob([e],{type:s.mimeType});return a=o.createObjectURL(t),a}));else if(void 0===s.uri)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const l=Promise.resolve(a).then((function(e){return new Promise((function(n,i){let s=n;!0===t.isImageBitmapLoader&&(s=function(e){const t=new W(e);t.needsUpdate=!0,n(t)}),t.load(wa.resolveURL(e,r.path),s,void 0,i)}))})).then((function(e){var t;return!0===c&&o.revokeObjectURL(a),e.userData.mimeType=s.mimeType||((t=s.uri).search(/\.jpe?g($|\?)/i)>0||0===t.search(/^data\:image\/jpeg/)?"image/jpeg":t.search(/\.webp($|\?)/i)>0||0===t.search(/^data\:image\/webp/)?"image/webp":"image/png"),e})).catch((function(e){throw console.error("THREE.GLTFLoader: Couldn't load texture",a),e}));return this.sourceCache[e]=l,l}assignTexture(e,t,n,i){const r=this;return this.getDependency("texture",n.index).then((function(s){if(void 0===n.texCoord||0==n.texCoord||"aoMap"===t&&1==n.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+n.texCoord+" for texture "+t+" not yet supported."),r.extensions[pc.KHR_TEXTURE_TRANSFORM]){const e=void 0!==n.extensions?n.extensions[pc.KHR_TEXTURE_TRANSFORM]:void 0;if(e){const t=r.associations.get(s);s=r.extensions[pc.KHR_TEXTURE_TRANSFORM].extendTexture(s,e),r.associations.set(s,t)}}return void 0!==i&&(s.encoding=i),e[t]=s,s}))}assignFinalMaterial(e){const t=e.geometry;let n=e.material;const i=void 0===t.attributes.tangent,r=void 0!==t.attributes.color,s=void 0===t.attributes.normal;if(e.isPoints){const e="PointsMaterial:"+n.uuid;let t=this.cache.get(e);t||(t=new As,ht.prototype.copy.call(t,n),t.color.copy(n.color),t.map=n.map,t.sizeAttenuation=!1,this.cache.add(e,t)),n=t}else if(e.isLine){const e="LineBasicMaterial:"+n.uuid;let t=this.cache.get(e);t||(t=new hs,ht.prototype.copy.call(t,n),t.color.copy(n.color),this.cache.add(e,t)),n=t}if(i||r||s){let e="ClonedMaterial:"+n.uuid+":";n.isGLTFSpecularGlossinessMaterial&&(e+="specular-glossiness:"),i&&(e+="derivative-tangents:"),r&&(e+="vertex-colors:"),s&&(e+="flat-shading:");let t=this.cache.get(e);t||(t=n.clone(),r&&(t.vertexColors=!0),s&&(t.flatShading=!0),i&&(t.normalScale&&(t.normalScale.y*=-1),t.clearcoatNormalScale&&(t.clearcoatNormalScale.y*=-1)),this.cache.add(e,t),this.associations.set(t,this.associations.get(n))),n=t}n.aoMap&&void 0===t.attributes.uv2&&void 0!==t.attributes.uv&&t.setAttribute("uv2",t.attributes.uv),e.material=n}getMaterialType(){return Lo}loadMaterial(e){const t=this,n=this.json,i=this.extensions,r=n.materials[e];let s;const o={},a=r.extensions||{},c=[];if(a[pc.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){const e=i[pc.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];s=e.getMaterialType(),c.push(e.extendParams(o,r,t))}else if(a[pc.KHR_MATERIALS_UNLIT]){const e=i[pc.KHR_MATERIALS_UNLIT];s=e.getMaterialType(),c.push(e.extendParams(o,r,t))}else{const n=r.pbrMetallicRoughness||{};if(o.color=new z(1,1,1),o.opacity=1,Array.isArray(n.baseColorFactor)){const e=n.baseColorFactor;o.color.fromArray(e),o.opacity=e[3]}void 0!==n.baseColorTexture&&c.push(t.assignTexture(o,"map",n.baseColorTexture,3001)),o.metalness=void 0!==n.metallicFactor?n.metallicFactor:1,o.roughness=void 0!==n.roughnessFactor?n.roughnessFactor:1,void 0!==n.metallicRoughnessTexture&&(c.push(t.assignTexture(o,"metalnessMap",n.metallicRoughnessTexture)),c.push(t.assignTexture(o,"roughnessMap",n.metallicRoughnessTexture))),s=this._invokeOne((function(t){return t.getMaterialType&&t.getMaterialType(e)})),c.push(Promise.all(this._invokeAll((function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,o)}))))}!0===r.doubleSided&&(o.side=2);const l=r.alphaMode||$c;if(l===tl?(o.transparent=!0,o.depthWrite=!1):(o.transparent=!1,l===el&&(o.alphaTest=void 0!==r.alphaCutoff?r.alphaCutoff:.5)),void 0!==r.normalTexture&&s!==dt&&(c.push(t.assignTexture(o,"normalMap",r.normalTexture)),o.normalScale=new _(1,1),void 0!==r.normalTexture.scale)){const e=r.normalTexture.scale;o.normalScale.set(e,e)}return void 0!==r.occlusionTexture&&s!==dt&&(c.push(t.assignTexture(o,"aoMap",r.occlusionTexture)),void 0!==r.occlusionTexture.strength&&(o.aoMapIntensity=r.occlusionTexture.strength)),void 0!==r.emissiveFactor&&s!==dt&&(o.emissive=(new z).fromArray(r.emissiveFactor)),void 0!==r.emissiveTexture&&s!==dt&&c.push(t.assignTexture(o,"emissiveMap",r.emissiveTexture,3001)),Promise.all(c).then((function(){let n;return n=s===Ic?i[pc.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(o):new s(o),r.name&&(n.name=r.name),il(n,r),t.associations.set(n,{materials:e}),r.extensions&&nl(i,n,r),n}))}createUniqueName(e){const t=Ra.sanitizeNodeName(e||"");let n=t;for(let e=1;this.nodeNamesUsed[n];++e)n=t+"_"+e;return this.nodeNamesUsed[n]=!0,n}loadGeometries(e){const t=this,n=this.extensions,i=this.primitiveCache;function r(e){return n[pc.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then((function(n){return ul(n,e,t)}))}const s=[];for(let n=0,o=e.length;n<o;n++){const o=e[n],a=sl(o),c=i[a];if(c)s.push(c.promise);else{let e;e=o.extensions&&o.extensions[pc.KHR_DRACO_MESH_COMPRESSION]?r(o):ul(new Tt,o,t),i[a]={primitive:o,promise:e},s.push(e)}}return Promise.all(s)}loadMesh(e){const t=this,n=this.json,i=this.extensions,r=n.meshes[e],s=r.primitives,o=[];for(let e=0,t=s.length;e<t;e++){const t=void 0===s[e].material?(void 0===(a=this.cache).DefaultMaterial&&(a.DefaultMaterial=new Lo({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:0})),a.DefaultMaterial):this.getDependency("material",s[e].material);o.push(t)}var a;return o.push(t.loadGeometries(s)),Promise.all(o).then((function(n){const o=n.slice(0,n.length-1),a=n[n.length-1],c=[];for(let n=0,l=a.length;n<l;n++){const l=a[n],u=s[n];let h;const d=o[n];if(u.mode===Gc||u.mode===Wc||u.mode===jc||void 0===u.mode)h=!0===r.isSkinnedMesh?new $r(l,d):new Wt(l,d),!0!==h.isSkinnedMesh||h.geometry.attributes.skinWeight.normalized||h.normalizeSkinWeights(),u.mode===Wc?h.geometry=hl(h.geometry,1):u.mode===jc&&(h.geometry=hl(h.geometry,2));else if(u.mode===Uc)h=new ws(l,d);else if(u.mode===Vc)h=new vs(l,d);else if(u.mode===Hc)h=new bs(l,d);else{if(u.mode!==Fc)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+u.mode);h=new Es(l,d)}Object.keys(h.geometry.morphAttributes).length>0&&rl(h,r),h.name=t.createUniqueName(r.name||"mesh_"+e),il(h,r),u.extensions&&nl(i,h,u),t.assignFinalMaterial(h),c.push(h)}for(let n=0,i=c.length;n<i;n++)t.associations.set(c[n],{meshes:e,primitives:n});if(1===c.length)return c[0];const l=new Br;t.associations.set(l,{meshes:e});for(let e=0,t=c.length;e<t;e++)l.add(c[e]);return l}))}loadCamera(e){let t;const n=this.json.cameras[e],i=n[n.type];if(i)return"perspective"===n.type?t=new Qt(S.radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6):"orthographic"===n.type&&(t=new An(-i.xmag,i.xmag,i.ymag,-i.ymag,i.znear,i.zfar)),n.name&&(t.name=this.createUniqueName(n.name)),il(t,n),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(e){const t=this.json.skins[e],n={joints:t.joints};return void 0===t.inverseBindMatrices?Promise.resolve(n):this.getDependency("accessor",t.inverseBindMatrices).then((function(e){return n.inverseBindMatrices=e,n}))}loadAnimation(e){const t=this.json.animations[e],n=[],i=[],r=[],s=[],o=[];for(let e=0,a=t.channels.length;e<a;e++){const a=t.channels[e],c=t.samplers[a.sampler],l=a.target,u=void 0!==l.node?l.node:l.id,h=void 0!==t.parameters?t.parameters[c.input]:c.input,d=void 0!==t.parameters?t.parameters[c.output]:c.output;n.push(this.getDependency("node",u)),i.push(this.getDependency("accessor",h)),r.push(this.getDependency("accessor",d)),s.push(c),o.push(l)}return Promise.all([Promise.all(n),Promise.all(i),Promise.all(r),Promise.all(s),Promise.all(o)]).then((function(n){const i=n[0],r=n[1],s=n[2],o=n[3],a=n[4],c=[];for(let e=0,t=i.length;e<t;e++){const t=i[e],n=r[e],l=s[e],u=o[e],h=a[e];if(void 0===t)continue;let d;switch(t.updateMatrix(),t.matrixAutoUpdate=!0,Kc[h.path]){case Kc.weights:d=Go;break;case Kc.rotation:d=jo;break;case Kc.position:case Kc.scale:default:d=Xo}const p=t.name?t.name:t.uuid,f=void 0!==u.interpolation?Qc[u.interpolation]:2301,m=[];Kc[h.path]===Kc.weights?t.traverse((function(e){e.morphTargetInfluences&&m.push(e.name?e.name:e.uuid)})):m.push(p);let g=l.array;if(l.normalized){const e=al(g.constructor),t=new Float32Array(g.length);for(let n=0,i=g.length;n<i;n++)t[n]=g[n]*e;g=t}for(let e=0,t=m.length;e<t;e++){const t=new d(m[e]+"."+Kc[h.path],n.array,g,f);"CUBICSPLINE"===u.interpolation&&(t.createInterpolant=function(e){return new(this instanceof jo?zc:Bc)(this.times,this.values,this.getValueSize()/3,e)},t.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),c.push(t)}}const l=t.name?t.name:"animation_"+e;return new qo(l,void 0,c)}))}createNodeMesh(e){const t=this.json,n=this,i=t.nodes[e];return void 0===i.mesh?null:n.getDependency("mesh",i.mesh).then((function(e){const t=n._getNodeRef(n.meshCache,i.mesh,e);return void 0!==i.weights&&t.traverse((function(e){if(e.isMesh)for(let t=0,n=i.weights.length;t<n;t++)e.morphTargetInfluences[t]=i.weights[t]})),t}))}loadNode(e){const t=this.json,n=this.extensions,i=this,r=t.nodes[e],s=r.name?i.createUniqueName(r.name):"";return function(){const t=[],n=i._invokeOne((function(t){return t.createNodeMesh&&t.createNodeMesh(e)}));return n&&t.push(n),void 0!==r.camera&&t.push(i.getDependency("camera",r.camera).then((function(e){return i._getNodeRef(i.cameraCache,r.camera,e)}))),i._invokeAll((function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)})).forEach((function(e){t.push(e)})),Promise.all(t)}().then((function(t){let o;if(o=!0===r.isBone?new es:t.length>1?new Br:1===t.length?t[0]:new Qe,o!==t[0])for(let e=0,n=t.length;e<n;e++)o.add(t[e]);if(r.name&&(o.userData.name=r.name,o.name=s),il(o,r),r.extensions&&nl(n,o,r),void 0!==r.matrix){const e=new Ee;e.fromArray(r.matrix),o.applyMatrix4(e)}else void 0!==r.translation&&o.position.fromArray(r.translation),void 0!==r.rotation&&o.quaternion.fromArray(r.rotation),void 0!==r.scale&&o.scale.fromArray(r.scale);return i.associations.has(o)||i.associations.set(o,{}),i.associations.get(o).nodes=e,o}))}loadScene(e){const t=this.json,n=this.extensions,i=this.json.scenes[e],r=this,s=new Br;i.name&&(s.name=r.createUniqueName(i.name)),il(s,i),i.extensions&&nl(n,s,i);const o=i.nodes||[],a=[];for(let e=0,n=o.length;e<n;e++)a.push(ll(o[e],s,t,r));return Promise.all(a).then((function(){return r.associations=(e=>{const t=new Map;for(const[e,n]of r.associations)(e instanceof ht||e instanceof W)&&t.set(e,n);return e.traverse(e=>{const n=r.associations.get(e);null!=n&&t.set(e,n)}),t})(s),s}))}}function ll(e,t,n,i){const r=n.nodes[e];return i.getDependency("node",e).then((function(e){if(void 0===r.skin)return e;let t;return i.getDependency("skin",r.skin).then((function(e){t=e;const n=[];for(let e=0,r=t.joints.length;e<r;e++)n.push(i.getDependency("node",t.joints[e]));return Promise.all(n)})).then((function(n){return e.traverse((function(e){if(!e.isMesh)return;const i=[],r=[];for(let e=0,s=n.length;e<s;e++){const s=n[e];if(s){i.push(s);const n=new Ee;void 0!==t.inverseBindMatrices&&n.fromArray(t.inverseBindMatrices.array,16*e),r.push(n)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[e])}e.bind(new rs(i,r),e.matrixWorld)})),e}))})).then((function(e){t.add(e);const s=[];if(r.children){const t=r.children;for(let r=0,o=t.length;r<o;r++){const o=t[r];s.push(ll(o,e,n,i))}}return Promise.all(s)}))}function ul(e,t,n){const i=t.attributes,r=[];function s(t,i){return n.getDependency("accessor",t).then((function(t){e.setAttribute(i,t)}))}for(const t in i){const n=Yc[t]||t.toLowerCase();n in e.attributes||r.push(s(i[t],n))}if(void 0!==t.indices&&!e.index){const i=n.getDependency("accessor",t.indices).then((function(t){e.setIndex(t)}));r.push(i)}return il(e,t),function(e,t,n){const i=t.attributes,r=new $;if(void 0===i.POSITION)return;{const e=n.json.accessors[i.POSITION],t=e.min,s=e.max;if(void 0===t||void 0===s)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(r.set(new Y(t[0],t[1],t[2]),new Y(s[0],s[1],s[2])),e.normalized){const t=al(Jc[e.componentType]);r.min.multiplyScalar(t),r.max.multiplyScalar(t)}}const s=t.targets;if(void 0!==s){const e=new Y,t=new Y;for(let i=0,r=s.length;i<r;i++){const r=s[i];if(void 0!==r.POSITION){const i=n.json.accessors[r.POSITION],s=i.min,o=i.max;if(void 0!==s&&void 0!==o){if(t.setX(Math.max(Math.abs(s[0]),Math.abs(o[0]))),t.setY(Math.max(Math.abs(s[1]),Math.abs(o[1]))),t.setZ(Math.max(Math.abs(s[2]),Math.abs(o[2]))),i.normalized){const e=al(Jc[i.componentType]);t.multiplyScalar(e)}e.max(t)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}r.expandByVector(e)}e.boundingBox=r;const o=new ye;r.getCenter(o.center),o.radius=r.min.distanceTo(r.max)/2,e.boundingSphere=o}(e,t,n),Promise.all(r).then((function(){return void 0!==t.targets?function(e,t,n){let i=!1,r=!1,s=!1;for(let e=0,n=t.length;e<n;e++){const n=t[e];if(void 0!==n.POSITION&&(i=!0),void 0!==n.NORMAL&&(r=!0),void 0!==n.COLOR_0&&(s=!0),i&&r&&s)break}if(!i&&!r&&!s)return Promise.resolve(e);const o=[],a=[],c=[];for(let l=0,u=t.length;l<u;l++){const u=t[l];if(i){const t=void 0!==u.POSITION?n.getDependency("accessor",u.POSITION):e.attributes.position;o.push(t)}if(r){const t=void 0!==u.NORMAL?n.getDependency("accessor",u.NORMAL):e.attributes.normal;a.push(t)}if(s){const t=void 0!==u.COLOR_0?n.getDependency("accessor",u.COLOR_0):e.attributes.color;c.push(t)}}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(c)]).then((function(t){const n=t[0],o=t[1],a=t[2];return i&&(e.morphAttributes.position=n),r&&(e.morphAttributes.normal=o),s&&(e.morphAttributes.color=a),e.morphTargetsRelative=!0,e}))}(e,t.targets,n):e}))}function hl(e,t){let n=e.getIndex();if(null===n){const t=[],i=e.getAttribute("position");if(void 0===i)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(let e=0;e<i.count;e++)t.push(e);e.setIndex(t),n=e.getIndex()}const i=n.count-2,r=[];if(2===t)for(let e=1;e<=i;e++)r.push(n.getX(0)),r.push(n.getX(e)),r.push(n.getX(e+1));else for(let e=0;e<i;e++)e%2==0?(r.push(n.getX(e)),r.push(n.getX(e+1)),r.push(n.getX(e+2))):(r.push(n.getX(e+2)),r.push(n.getX(e+1)),r.push(n.getX(e)));r.length/3!==i&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const s=e.clone();return s.setIndex(r),s}const dl=function(e){const t=document.getElementById("progress-bar"),n=document.querySelector(".progress-bar-container");n.style.display="flex",e.onProgress=function(e,n,i){t.value=n/i*100},e.onLoad=function(){n.style.display="none"}},pl={walk:1,idle:2,run:3,jump:4,fall:4};class fl extends Qe{constructor(e){super(),this.isVisible=!0,this.loader=new hc(e),this.manager=e,this.animations={},this.quaternion90deg=new Z,this.quaternion90deg.setFromAxisAngle(new Y(-1,0,0),-Math.PI/2)}spawnAvatar(e){e.avatarPath=void 0===e.avatarPath?"https://elegant-truffle-070d6b.netlify.app/vanguard.glb":e.avatarPath,e.animationPath=void 0===e.animationPath?"https://elegant-truffle-070d6b.netlify.app/defaultAnimations.glb":e.animationPath,e.animationMapping=void 0===e.animationMapping?pl:e.animationMapping,this.loadAvatar(e.avatarPath,()=>this.loadAnimations(e.animationPath,e.animationMapping))}play(e,t=.5){e!==this.current&&performance.now()-this.lastChange>=250&&(this.lastChange=performance.now(),"none"!==this.current&&void 0!==this.animations[this.current]&&this.animations[this.current].fadeOut(t),this.current=e,void 0!==this.animations[this.current]&&(this.animations[this.current].enabled=!0,this.animations[this.current].reset(),this.animations[this.current].fadeIn(t),this.animations[this.current].play()))}update(e,t,n,i,r=.5){this.mixer&&(this.position.copy(t),this.isVisible&&(this.updateFacingDirection(n),this.play(i,r),this.mixer.update(e)))}setTransparency(e){e?window.MAIN_SCENE.remove(this.model):window.MAIN_SCENE.add(this.model),this.isVisible=!e}changeAvatar(e,t,n){dl(this.manager),this.loadAvatar(e,()=>this.loadAnimations(t,n))}loadAvatar(e,t){this.loader.load(e,e=>{MAIN_SCENE.remove(this.model),this.radius=.25,this.size=1.5,this.model=e.scene,this.model.scale.set(.01,.01,.01),this.model.traverse(e=>{e.isMesh&&(e.castShadow=!0,e.receiveShadow=!0,e.frustumCulled=!1)}),MAIN_SCENE.add(this.model),t()})}removeAvatar(){MAIN_SCENE.remove(this.model)}loadAnimations(e,t){this.loader.load(e,e=>{void 0!==this.model&&(this.current="none",this.animations={walk:e.animations[t.walk],idle:e.animations[t.idle],run:e.animations[t.run],jump:e.animations[t.jump],fall:e.animations[t.fall]},this.mixer=new Da(this.model),Object.entries(this.animations).forEach(([e,t])=>{this.animations[e]=this.mixer.clipAction(t)}),this.lastChange=performance.now()-250,this.delta=0,this.play("idle",0))})}updateFacingDirection(e){e.length()>.001&&(this.lookAt(this.position.x+e.x,this.position.y+this.size/2+this.radius,this.position.z+e.z),this.quaternion.multiply(this.quaternion90deg)),this.model.position.copy(this.position),this.model.position.y-=this.size/2,this.model.quaternion.copy(this.quaternion)}}class ml extends ic{constructor(e,t,n){super(.25,1.5),this.spawnPoint=void 0===e.spawn?{x:0,y:0,z:0}:e.spawn,this.position.x=this.spawnPoint.x,this.position.y=this.spawnPoint.y,this.position.z=this.spawnPoint.z,this.camera=t,this.fpsControls=new j(.01,Math.PI-.01,.01,1),this.thirdPersonControls=new j(Math.PI/3,Math.PI/2-.01,5,.2),this.controlVector=this.thirdPersonControls.clone(),this.targetControlVector=this.thirdPersonControls,this.horizontalVelocity=new Y,this.playerDirection=new Y,this.positionChange=new Y,this.keys={},this.visible=!1,this.isRunning=!1,this.avatarController=new fl(n),this.avatarController.spawnAvatar(e),this.setupControls(this.camera)}setupControls(){this.controls=new uc(this.camera,document.body),this.controls.sensitivityY=-.002,this.controls.minPolarAngle=.01,this.controls.maxPolarAngle=Math.PI-.25,MAIN_SCENE.add(this.controls.getObject()),document.addEventListener("keyup",e=>{delete this.keys[e.key.toLowerCase()]}),document.addEventListener("keydown",e=>{this.controls.isLocked&&("v"===e.key&&(this.targetControlVector===this.thirdPersonControls?(this.targetControlVector=this.fpsControls,this.avatarController.setTransparency(!0)):(this.targetControlVector=this.thirdPersonControls,this.avatarController.setTransparency(!1))),"r"===e.key&&(this.position.set(this.spawnPoint.x,this.spawnPoint.y,this.spawnPoint.z),this.velocity=new Y),32===e.keyCode&&e.target===document.body&&e.preventDefault(),this.keys[e.key.toLowerCase()]=!0)}),this.controls.addEventListener("unlock",()=>{VIRTUAL_ENVIRONMENT.UI_CONTROLLER.handleControlsUnlock()})}getForwardVector(){return this.camera.getWorldDirection(this.playerDirection),this.playerDirection.y=0,this.playerDirection.normalize(),this.playerDirection.multiplyScalar(-1),this.playerDirection}getSideVector(){return this.camera.getWorldDirection(this.playerDirection),this.playerDirection.y=0,this.playerDirection.normalize(),this.playerDirection.cross(this.camera.up),this.playerDirection.multiplyScalar(-1),this.playerDirection}update(e,t){Object.keys(this.keys).length>0?(this.keys.shift&&(this.isRunning=!0),this.speedFactor=this.isRunning?.15:.05,this.keys.w&&this.horizontalVelocity.add(this.getForwardVector(this.camera).multiplyScalar(this.speedFactor*e)),this.keys.s&&this.horizontalVelocity.add(this.getForwardVector(this.camera).multiplyScalar(-this.speedFactor*e)),this.keys.a&&this.horizontalVelocity.add(this.getSideVector(this.camera).multiplyScalar(-this.speedFactor*e)),this.keys.d&&this.horizontalVelocity.add(this.getSideVector(this.camera).multiplyScalar(this.speedFactor*e)),this.keys[" "]&&this.canJump&&(this.velocity.y=10,this.setAnimationParameters("jump",0))):(this.isRunning=!1,this.horizontalVelocity.multiplyScalar(0));for(let n=0;n<5;n++)super.update(e/5,t);this.position.y<-20&&(this.position.set(this.spawnPoint.x,this.spawnPoint.y,this.spawnPoint.z),this.velocity=new Y),this.updateCurrentAnimation(),void 0!==this.avatarController&&this.avatarController.update(e,this.position,this.horizontalVelocity,this.currentAnimation,this.currentAnimationTime),this.controlVector.lerp(this.targetControlVector,.1)}updateCurrentAnimation(){this.lastPosition&&(this.positionChange.multiplyScalar(.8),this.positionChange.addScaledVector(this.position.clone().sub(this.lastPosition),.2)),this.lastPosition=this.position.clone(),this.onGround?this.keys.w||this.keys.s||this.keys.a||this.keys.d?this.isRunning?this.setAnimationParameters("run"):this.setAnimationParameters("walk"):this.setAnimationParameters("idle"):this.positionChange.y<-3&&this.setAnimationParameters("fall",.25)}setAnimationParameters(e,t=.5){this.currentAnimation=e,this.currentAnimationTime=t}}
/*!
fflate - fast JavaScript compression/decompression
<https://101arrowz.github.io/fflate>
Licensed under MIT. https://github.com/101arrowz/fflate/blob/master/LICENSE
version 0.6.9
*/var gl={},vl=function(e){return URL.createObjectURL(new Blob([e],{type:"text/javascript"}))},yl=function(e){return new Worker(e)};try{URL.revokeObjectURL(vl(""))}catch(e){vl=function(e){return"data:application/javascript;charset=UTF-8,"+encodeURI(e)},yl=function(e){return new Worker(e,{type:"module"})}}var xl=Uint8Array,wl=Uint16Array,bl=Uint32Array,Al=new xl([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Sl=new xl([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),_l=new xl([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Ml=function(e,t){for(var n=new wl(31),i=0;i<31;++i)n[i]=t+=1<<e[i-1];var r=new bl(n[30]);for(i=1;i<30;++i)for(var s=n[i];s<n[i+1];++s)r[s]=s-n[i]<<5|i;return[n,r]},Tl=Ml(Al,2),El=Tl[0],Cl=Tl[1];El[28]=258,Cl[258]=28;for(var Rl=Ml(Sl,0),Pl=Rl[0],Ll=Rl[1],Dl=new wl(32768),Il=0;Il<32768;++Il){var kl=(43690&Il)>>>1|(21845&Il)<<1;kl=(61680&(kl=(52428&kl)>>>2|(13107&kl)<<2))>>>4|(3855&kl)<<4,Dl[Il]=((65280&kl)>>>8|(255&kl)<<8)>>>1}var Ol=function(e,t,n){for(var i=e.length,r=0,s=new wl(t);r<i;++r)++s[e[r]-1];var o,a=new wl(t);for(r=0;r<t;++r)a[r]=a[r-1]+s[r-1]<<1;if(n){o=new wl(1<<t);var c=15-t;for(r=0;r<i;++r)if(e[r])for(var l=r<<4|e[r],u=t-e[r],h=a[e[r]-1]++<<u,d=h|(1<<u)-1;h<=d;++h)o[Dl[h]>>>c]=l}else for(o=new wl(i),r=0;r<i;++r)e[r]&&(o[r]=Dl[a[e[r]-1]++]>>>15-e[r]);return o},Bl=new xl(288);for(Il=0;Il<144;++Il)Bl[Il]=8;for(Il=144;Il<256;++Il)Bl[Il]=9;for(Il=256;Il<280;++Il)Bl[Il]=7;for(Il=280;Il<288;++Il)Bl[Il]=8;var Nl=new xl(32);for(Il=0;Il<32;++Il)Nl[Il]=5;var zl=Ol(Bl,9,0),Fl=Ol(Bl,9,1),Ul=Ol(Nl,5,0),Hl=Ol(Nl,5,1),Vl=function(e){for(var t=e[0],n=1;n<e.length;++n)e[n]>t&&(t=e[n]);return t},Gl=function(e,t,n){var i=t/8|0;return(e[i]|e[i+1]<<8)>>(7&t)&n},Wl=function(e,t){var n=t/8|0;return(e[n]|e[n+1]<<8|e[n+2]<<16)>>(7&t)},jl=function(e){return(e/8|0)+(7&e&&1)},Jl=function(e,t,n){(null==t||t<0)&&(t=0),(null==n||n>e.length)&&(n=e.length);var i=new(e instanceof wl?wl:e instanceof bl?bl:xl)(n-t);return i.set(e.subarray(t,n)),i},Xl=function(e,t,n){var i=e.length;if(!i||n&&!n.l&&i<5)return t||new xl(0);var r=!t||n,s=!n||n.i;n||(n={}),t||(t=new xl(3*i));var o=function(e){var n=t.length;if(e>n){var i=new xl(Math.max(2*n,e));i.set(t),t=i}},a=n.f||0,c=n.p||0,l=n.b||0,u=n.l,h=n.d,d=n.m,p=n.n,f=8*i;do{if(!u){n.f=a=Gl(e,c,1);var m=Gl(e,c+1,3);if(c+=3,!m){var g=e[(E=jl(c)+4)-4]|e[E-3]<<8,v=E+g;if(v>i){if(s)throw"unexpected EOF";break}r&&o(l+g),t.set(e.subarray(E,v),l),n.b=l+=g,n.p=c=8*v;continue}if(1==m)u=Fl,h=Hl,d=9,p=5;else{if(2!=m)throw"invalid block type";var y=Gl(e,c,31)+257,x=Gl(e,c+10,15)+4,w=y+Gl(e,c+5,31)+1;c+=14;for(var b=new xl(w),A=new xl(19),S=0;S<x;++S)A[_l[S]]=Gl(e,c+3*S,7);c+=3*x;var _=Vl(A),M=(1<<_)-1,T=Ol(A,_,1);for(S=0;S<w;){var E,C=T[Gl(e,c,M)];if(c+=15&C,(E=C>>>4)<16)b[S++]=E;else{var R=0,P=0;for(16==E?(P=3+Gl(e,c,3),c+=2,R=b[S-1]):17==E?(P=3+Gl(e,c,7),c+=3):18==E&&(P=11+Gl(e,c,127),c+=7);P--;)b[S++]=R}}var L=b.subarray(0,y),D=b.subarray(y);d=Vl(L),p=Vl(D),u=Ol(L,d,1),h=Ol(D,p,1)}if(c>f){if(s)throw"unexpected EOF";break}}r&&o(l+131072);for(var I=(1<<d)-1,k=(1<<p)-1,O=c;;O=c){var B=(R=u[Wl(e,c)&I])>>>4;if((c+=15&R)>f){if(s)throw"unexpected EOF";break}if(!R)throw"invalid length/literal";if(B<256)t[l++]=B;else{if(256==B){O=c,u=null;break}var N=B-254;if(B>264){var z=Al[S=B-257];N=Gl(e,c,(1<<z)-1)+El[S],c+=z}var F=h[Wl(e,c)&k],U=F>>>4;if(!F)throw"invalid distance";c+=15&F;D=Pl[U];if(U>3){z=Sl[U];D+=Wl(e,c)&(1<<z)-1,c+=z}if(c>f){if(s)throw"unexpected EOF";break}r&&o(l+131072);for(var H=l+N;l<H;l+=4)t[l]=t[l-D],t[l+1]=t[l+1-D],t[l+2]=t[l+2-D],t[l+3]=t[l+3-D];l=H}}n.l=u,n.p=O,n.b=l,u&&(a=1,n.m=d,n.d=h,n.n=p)}while(!a);return l==t.length?t:Jl(t,0,l)},ql=function(e,t,n){n<<=7&t;var i=t/8|0;e[i]|=n,e[i+1]|=n>>>8},Zl=function(e,t,n){n<<=7&t;var i=t/8|0;e[i]|=n,e[i+1]|=n>>>8,e[i+2]|=n>>>16},Yl=function(e,t){for(var n=[],i=0;i<e.length;++i)e[i]&&n.push({s:i,f:e[i]});var r=n.length,s=n.slice();if(!r)return[iu,0];if(1==r){var o=new xl(n[0].s+1);return o[n[0].s]=1,[o,1]}n.sort((function(e,t){return e.f-t.f})),n.push({s:-1,f:25001});var a=n[0],c=n[1],l=0,u=1,h=2;for(n[0]={s:-1,f:a.f+c.f,l:a,r:c};u!=r-1;)a=n[n[l].f<n[h].f?l++:h++],c=n[l!=u&&n[l].f<n[h].f?l++:h++],n[u++]={s:-1,f:a.f+c.f,l:a,r:c};var d=s[0].s;for(i=1;i<r;++i)s[i].s>d&&(d=s[i].s);var p=new wl(d+1),f=Kl(n[u-1],p,0);if(f>t){i=0;var m=0,g=f-t,v=1<<g;for(s.sort((function(e,t){return p[t.s]-p[e.s]||e.f-t.f}));i<r;++i){var y=s[i].s;if(!(p[y]>t))break;m+=v-(1<<f-p[y]),p[y]=t}for(m>>>=g;m>0;){var x=s[i].s;p[x]<t?m-=1<<t-p[x]++-1:++i}for(;i>=0&&m;--i){var w=s[i].s;p[w]==t&&(--p[w],++m)}f=t}return[new xl(p),f]},Kl=function(e,t,n){return-1==e.s?Math.max(Kl(e.l,t,n+1),Kl(e.r,t,n+1)):t[e.s]=n},Ql=function(e){for(var t=e.length;t&&!e[--t];);for(var n=new wl(++t),i=0,r=e[0],s=1,o=function(e){n[i++]=e},a=1;a<=t;++a)if(e[a]==r&&a!=t)++s;else{if(!r&&s>2){for(;s>138;s-=138)o(32754);s>2&&(o(s>10?s-11<<5|28690:s-3<<5|12305),s=0)}else if(s>3){for(o(r),--s;s>6;s-=6)o(8304);s>2&&(o(s-3<<5|8208),s=0)}for(;s--;)o(r);s=1,r=e[a]}return[n.subarray(0,i),t]},$l=function(e,t){for(var n=0,i=0;i<t.length;++i)n+=e[i]*t[i];return n},eu=function(e,t,n){var i=n.length,r=jl(t+2);e[r]=255&i,e[r+1]=i>>>8,e[r+2]=255^e[r],e[r+3]=255^e[r+1];for(var s=0;s<i;++s)e[r+s+4]=n[s];return 8*(r+4+i)},tu=function(e,t,n,i,r,s,o,a,c,l,u){ql(t,u++,n),++r[256];for(var h=Yl(r,15),d=h[0],p=h[1],f=Yl(s,15),m=f[0],g=f[1],v=Ql(d),y=v[0],x=v[1],w=Ql(m),b=w[0],A=w[1],S=new wl(19),_=0;_<y.length;++_)S[31&y[_]]++;for(_=0;_<b.length;++_)S[31&b[_]]++;for(var M=Yl(S,7),T=M[0],E=M[1],C=19;C>4&&!T[_l[C-1]];--C);var R,P,L,D,I=l+5<<3,k=$l(r,Bl)+$l(s,Nl)+o,O=$l(r,d)+$l(s,m)+o+14+3*C+$l(S,T)+(2*S[16]+3*S[17]+7*S[18]);if(I<=k&&I<=O)return eu(t,u,e.subarray(c,c+l));if(ql(t,u,1+(O<k)),u+=2,O<k){R=Ol(d,p,0),P=d,L=Ol(m,g,0),D=m;var B=Ol(T,E,0);ql(t,u,x-257),ql(t,u+5,A-1),ql(t,u+10,C-4),u+=14;for(_=0;_<C;++_)ql(t,u+3*_,T[_l[_]]);u+=3*C;for(var N=[y,b],z=0;z<2;++z){var F=N[z];for(_=0;_<F.length;++_){var U=31&F[_];ql(t,u,B[U]),u+=T[U],U>15&&(ql(t,u,F[_]>>>5&127),u+=F[_]>>>12)}}}else R=zl,P=Bl,L=Ul,D=Nl;for(_=0;_<a;++_)if(i[_]>255){U=i[_]>>>18&31;Zl(t,u,R[U+257]),u+=P[U+257],U>7&&(ql(t,u,i[_]>>>23&31),u+=Al[U]);var H=31&i[_];Zl(t,u,L[H]),u+=D[H],H>3&&(Zl(t,u,i[_]>>>5&8191),u+=Sl[H])}else Zl(t,u,R[i[_]]),u+=P[i[_]];return Zl(t,u,R[256]),u+P[256]},nu=new bl([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),iu=new xl(0),ru=function(e,t,n,i,r,s){var o=e.length,a=new xl(i+o+5*(1+Math.ceil(o/7e3))+r),c=a.subarray(i,a.length-r),l=0;if(!t||o<8)for(var u=0;u<=o;u+=65535){var h=u+65535;h<o?l=eu(c,l,e.subarray(u,h)):(c[u]=s,l=eu(c,l,e.subarray(u,o)))}else{for(var d=nu[t-1],p=d>>>13,f=8191&d,m=(1<<n)-1,g=new wl(32768),v=new wl(m+1),y=Math.ceil(n/3),x=2*y,w=function(t){return(e[t]^e[t+1]<<y^e[t+2]<<x)&m},b=new bl(25e3),A=new wl(288),S=new wl(32),_=0,M=0,T=(u=0,0),E=0,C=0;u<o;++u){var R=w(u),P=32767&u,L=v[R];if(g[P]=L,v[R]=P,E<=u){var D=o-u;if((_>7e3||T>24576)&&D>423){l=tu(e,c,0,b,A,S,M,T,C,u-C,l),T=_=M=0,C=u;for(var I=0;I<286;++I)A[I]=0;for(I=0;I<30;++I)S[I]=0}var k=2,O=0,B=f,N=P-L&32767;if(D>2&&R==w(u-N))for(var z=Math.min(p,D)-1,F=Math.min(32767,u),U=Math.min(258,D);N<=F&&--B&&P!=L;){if(e[u+k]==e[u+k-N]){for(var H=0;H<U&&e[u+H]==e[u+H-N];++H);if(H>k){if(k=H,O=N,H>z)break;var V=Math.min(N,H-2),G=0;for(I=0;I<V;++I){var W=u-N+I+32768&32767,j=W-g[W]+32768&32767;j>G&&(G=j,L=W)}}}N+=(P=L)-(L=g[P])+32768&32767}if(O){b[T++]=268435456|Cl[k]<<18|Ll[O];var J=31&Cl[k],X=31&Ll[O];M+=Al[J]+Sl[X],++A[257+J],++S[X],E=u+k,++_}else b[T++]=e[u],++A[e[u]]}}l=tu(e,c,s,b,A,S,M,T,C,u-C,l),!s&&7&l&&(l=eu(c,l+1,iu))}return Jl(a,0,i+jl(l)+r)},su=function(){for(var e=new bl(256),t=0;t<256;++t){for(var n=t,i=9;--i;)n=(1&n&&3988292384)^n>>>1;e[t]=n}return e}(),ou=function(){var e=-1;return{p:function(t){for(var n=e,i=0;i<t.length;++i)n=su[255&n^t[i]]^n>>>8;e=n},d:function(){return~e}}},au=function(){var e=1,t=0;return{p:function(n){for(var i=e,r=t,s=n.length,o=0;o!=s;){for(var a=Math.min(o+2655,s);o<a;++o)r+=i+=n[o];i=(65535&i)+15*(i>>16),r=(65535&r)+15*(r>>16)}e=i,t=r},d:function(){return(255&(e%=65521))<<24|e>>>8<<16|(255&(t%=65521))<<8|t>>>8}}},cu=function(e,t,n,i,r){return ru(e,null==t.level?6:t.level,null==t.mem?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(e.length)))):12+t.mem,n,i,!r)},lu=function(e,t){var n={};for(var i in e)n[i]=e[i];for(var i in t)n[i]=t[i];return n},uu=function(e,t,n){for(var i=e(),r=e.toString(),s=r.slice(r.indexOf("[")+1,r.lastIndexOf("]")).replace(/ /g,"").split(","),o=0;o<i.length;++o){var a=i[o],c=s[o];if("function"==typeof a){t+=";"+c+"=";var l=a.toString();if(a.prototype)if(-1!=l.indexOf("[native code]")){var u=l.indexOf(" ",8)+1;t+=l.slice(u,l.indexOf("(",u))}else for(var h in t+=l,a.prototype)t+=";"+c+".prototype."+h+"="+a.prototype[h].toString();else t+=l}else n[c]=a}return[t,n]},hu=[],du=function(e,t,n,i){var r;if(!hu[n]){for(var s="",o={},a=e.length-1,c=0;c<a;++c)s=(r=uu(e[c],s,o))[0],o=r[1];hu[n]=uu(e[a],s,o)}var l=lu({},hu[n][1]);return function(e,t,n,i,r){var s=yl(gl[t]||(gl[t]=vl(e)));return s.onerror=function(e){return r(e.error,null)},s.onmessage=function(e){return r(null,e.data)},s.postMessage(n,i),s}(hu[n][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+t.toString()+"}",n,l,function(e){var t=[];for(var n in e)(e[n]instanceof xl||e[n]instanceof wl||e[n]instanceof bl)&&t.push((e[n]=new e[n].constructor(e[n])).buffer);return t}(l),i)},pu=function(){return[xl,wl,bl,Al,Sl,_l,El,Pl,Fl,Hl,Dl,Ol,Vl,Gl,Wl,jl,Jl,Xl,Vu,xu,wu]},fu=function(){return[xl,wl,bl,Al,Sl,_l,Cl,Ll,zl,Bl,Ul,Nl,Dl,nu,iu,Ol,ql,Zl,Yl,Kl,Ql,$l,eu,tu,jl,Jl,ru,cu,zu,xu]},mu=function(){return[Cu,Lu,Eu,ou,su]},gu=function(){return[Ru,Pu]},vu=function(){return[Du,Eu,au]},yu=function(){return[Iu]},xu=function(e){return postMessage(e,[e.buffer])},wu=function(e){return e&&e.size&&new xl(e.size)},bu=function(e,t,n,i,r,s){var o=du(n,i,r,(function(e,t){o.terminate(),s(e,t)}));return o.postMessage([e,t],t.consume?[e.buffer]:[]),function(){o.terminate()}},Au=function(e){return e.ondata=function(e,t){return postMessage([e,t],[e.buffer])},function(t){return e.push(t.data[0],t.data[1])}},Su=function(e,t,n,i,r){var s,o=du(e,i,r,(function(e,n){e?(o.terminate(),t.ondata.call(t,e)):(n[1]&&o.terminate(),t.ondata.call(t,e,n[0],n[1]))}));o.postMessage(n),t.push=function(e,n){if(s)throw"stream finished";if(!t.ondata)throw"no stream handler";o.postMessage([e,s=n],[e.buffer])},t.terminate=function(){o.terminate()}},_u=function(e,t){return e[t]|e[t+1]<<8},Mu=function(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0},Tu=function(e,t){return Mu(e,t)+4294967296*Mu(e,t+4)},Eu=function(e,t,n){for(;n;++t)e[t]=n,n>>>=8},Cu=function(e,t){var n=t.filename;if(e[0]=31,e[1]=139,e[2]=8,e[8]=t.level<2?4:9==t.level?2:0,e[9]=3,0!=t.mtime&&Eu(e,4,Math.floor(new Date(t.mtime||Date.now())/1e3)),n){e[3]=8;for(var i=0;i<=n.length;++i)e[i+10]=n.charCodeAt(i)}},Ru=function(e){if(31!=e[0]||139!=e[1]||8!=e[2])throw"invalid gzip data";var t=e[3],n=10;4&t&&(n+=e[10]|2+(e[11]<<8));for(var i=(t>>3&1)+(t>>4&1);i>0;i-=!e[n++]);return n+(2&t)},Pu=function(e){var t=e.length;return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0},Lu=function(e){return 10+(e.filename&&e.filename.length+1||0)},Du=function(e,t){var n=t.level,i=0==n?0:n<6?1:9==n?3:2;e[0]=120,e[1]=i<<6|(i?32-2*i:1)},Iu=function(e){if(8!=(15&e[0])||e[0]>>>4>7||(e[0]<<8|e[1])%31)throw"invalid zlib data";if(32&e[1])throw"invalid zlib data: preset dictionaries not supported"};function ku(e,t){return t||"function"!=typeof e||(t=e,e={}),this.ondata=t,e}var Ou=function(){function e(e,t){t||"function"!=typeof e||(t=e,e={}),this.ondata=t,this.o=e||{}}return e.prototype.p=function(e,t){this.ondata(cu(e,this.o,0,0,!t),t)},e.prototype.push=function(e,t){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";this.d=t,this.p(e,t||!1)},e}(),Bu=function(){return function(e,t){Su([fu,function(){return[Au,Ou]}],this,ku.call(this,e,t),(function(e){var t=new Ou(e.data);onmessage=Au(t)}),6)}}();function Nu(e,t,n){if(n||(n=t,t={}),"function"!=typeof n)throw"no callback";return bu(e,t,[fu],(function(e){return xu(zu(e.data[0],e.data[1]))}),0,n)}function zu(e,t){return cu(e,t||{},0,0)}var Fu=function(){function e(e){this.s={},this.p=new xl(0),this.ondata=e}return e.prototype.e=function(e){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";var t=this.p.length,n=new xl(t+e.length);n.set(this.p),n.set(e,t),this.p=n},e.prototype.c=function(e){this.d=this.s.i=e||!1;var t=this.s.b,n=Xl(this.p,this.o,this.s);this.ondata(Jl(n,t,this.s.b),this.d),this.o=Jl(n,this.s.b-32768),this.s.b=this.o.length,this.p=Jl(this.p,this.s.p/8|0),this.s.p&=7},e.prototype.push=function(e,t){this.e(e),this.c(t)},e}(),Uu=function(){return function(e){this.ondata=e,Su([pu,function(){return[Au,Fu]}],this,0,(function(){var e=new Fu;onmessage=Au(e)}),7)}}();function Hu(e,t,n){if(n||(n=t,t={}),"function"!=typeof n)throw"no callback";return bu(e,t,[pu],(function(e){return xu(Vu(e.data[0],wu(e.data[1])))}),1,n)}function Vu(e,t){return Xl(e,t)}var Gu=function(){function e(e,t){this.c=ou(),this.l=0,this.v=1,Ou.call(this,e,t)}return e.prototype.push=function(e,t){Ou.prototype.push.call(this,e,t)},e.prototype.p=function(e,t){this.c.p(e),this.l+=e.length;var n=cu(e,this.o,this.v&&Lu(this.o),t&&8,!t);this.v&&(Cu(n,this.o),this.v=0),t&&(Eu(n,n.length-8,this.c.d()),Eu(n,n.length-4,this.l)),this.ondata(n,t)},e}(),Wu=function(){return function(e,t){Su([fu,mu,function(){return[Au,Ou,Gu]}],this,ku.call(this,e,t),(function(e){var t=new Gu(e.data);onmessage=Au(t)}),8)}}();function ju(e,t,n){if(n||(n=t,t={}),"function"!=typeof n)throw"no callback";return bu(e,t,[fu,mu,function(){return[Ju]}],(function(e){return xu(Ju(e.data[0],e.data[1]))}),2,n)}function Ju(e,t){t||(t={});var n=ou(),i=e.length;n.p(e);var r=cu(e,t,Lu(t),8),s=r.length;return Cu(r,t),Eu(r,s-8,n.d()),Eu(r,s-4,i),r}var Xu=function(){function e(e){this.v=1,Fu.call(this,e)}return e.prototype.push=function(e,t){if(Fu.prototype.e.call(this,e),this.v){var n=this.p.length>3?Ru(this.p):4;if(n>=this.p.length&&!t)return;this.p=this.p.subarray(n),this.v=0}if(t){if(this.p.length<8)throw"invalid gzip stream";this.p=this.p.subarray(0,-8)}Fu.prototype.c.call(this,t)},e}(),qu=function(){return function(e){this.ondata=e,Su([pu,gu,function(){return[Au,Fu,Xu]}],this,0,(function(){var e=new Xu;onmessage=Au(e)}),9)}}();function Zu(e,t,n){if(n||(n=t,t={}),"function"!=typeof n)throw"no callback";return bu(e,t,[pu,gu,function(){return[Yu]}],(function(e){return xu(Yu(e.data[0]))}),3,n)}function Yu(e,t){return Xl(e.subarray(Ru(e),-8),t||new xl(Pu(e)))}var Ku=function(){function e(e,t){this.c=au(),this.v=1,Ou.call(this,e,t)}return e.prototype.push=function(e,t){Ou.prototype.push.call(this,e,t)},e.prototype.p=function(e,t){this.c.p(e);var n=cu(e,this.o,this.v&&2,t&&4,!t);this.v&&(Du(n,this.o),this.v=0),t&&Eu(n,n.length-4,this.c.d()),this.ondata(n,t)},e}(),Qu=function(){return function(e,t){Su([fu,vu,function(){return[Au,Ou,Ku]}],this,ku.call(this,e,t),(function(e){var t=new Ku(e.data);onmessage=Au(t)}),10)}}();function $u(e,t,n){if(n||(n=t,t={}),"function"!=typeof n)throw"no callback";return bu(e,t,[fu,vu,function(){return[eh]}],(function(e){return xu(eh(e.data[0],e.data[1]))}),4,n)}function eh(e,t){t||(t={});var n=au();n.p(e);var i=cu(e,t,2,4);return Du(i,t),Eu(i,i.length-4,n.d()),i}var th=function(){function e(e){this.v=1,Fu.call(this,e)}return e.prototype.push=function(e,t){if(Fu.prototype.e.call(this,e),this.v){if(this.p.length<2&&!t)return;this.p=this.p.subarray(2),this.v=0}if(t){if(this.p.length<4)throw"invalid zlib stream";this.p=this.p.subarray(0,-4)}Fu.prototype.c.call(this,t)},e}(),nh=function(){return function(e){this.ondata=e,Su([pu,yu,function(){return[Au,Fu,th]}],this,0,(function(){var e=new th;onmessage=Au(e)}),11)}}();function ih(e,t,n){if(n||(n=t,t={}),"function"!=typeof n)throw"no callback";return bu(e,t,[pu,yu,function(){return[rh]}],(function(e){return xu(rh(e.data[0],wu(e.data[1])))}),5,n)}function rh(e,t){return Xl((Iu(e),e.subarray(2,-4)),t)}var sh=function(){function e(e){this.G=Xu,this.I=Fu,this.Z=th,this.ondata=e}return e.prototype.push=function(e,t){if(!this.ondata)throw"no stream handler";if(this.s)this.s.push(e,t);else{if(this.p&&this.p.length){var n=new xl(this.p.length+e.length);n.set(this.p),n.set(e,this.p.length)}else this.p=e;if(this.p.length>2){var i=this,r=function(){i.ondata.apply(i,arguments)};this.s=31==this.p[0]&&139==this.p[1]&&8==this.p[2]?new this.G(r):8!=(15&this.p[0])||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(r):new this.Z(r),this.s.push(this.p,t),this.p=null}}},e}(),oh=function(){function e(e){this.G=qu,this.I=Uu,this.Z=nh,this.ondata=e}return e.prototype.push=function(e,t){sh.prototype.push.call(this,e,t)},e}();function ah(e,t,n){if(n||(n=t,t={}),"function"!=typeof n)throw"no callback";return 31==e[0]&&139==e[1]&&8==e[2]?Zu(e,t,n):8!=(15&e[0])||e[0]>>4>7||(e[0]<<8|e[1])%31?Hu(e,t,n):ih(e,t,n)}function ch(e,t){return 31==e[0]&&139==e[1]&&8==e[2]?Yu(e,t):8!=(15&e[0])||e[0]>>4>7||(e[0]<<8|e[1])%31?Vu(e,t):rh(e,t)}var lh=function(e,t,n,i){for(var r in e){var s=e[r],o=t+r;s instanceof xl?n[o]=[s,i]:Array.isArray(s)?n[o]=[s[0],lu(i,s[1])]:lh(s,o+"/",n,i)}},uh="undefined"!=typeof TextEncoder&&new TextEncoder,hh="undefined"!=typeof TextDecoder&&new TextDecoder,dh=0;try{hh.decode(iu,{stream:!0}),dh=1}catch(e){}var ph=function(e){for(var t="",n=0;;){var i=e[n++],r=(i>127)+(i>223)+(i>239);if(n+r>e.length)return[t,Jl(e,n-1)];r?3==r?(i=((15&i)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536,t+=String.fromCharCode(55296|i>>10,56320|1023&i)):t+=1&r?String.fromCharCode((31&i)<<6|63&e[n++]):String.fromCharCode((15&i)<<12|(63&e[n++])<<6|63&e[n++]):t+=String.fromCharCode(i)}},fh=function(){function e(e){this.ondata=e,dh?this.t=new TextDecoder:this.p=iu}return e.prototype.push=function(e,t){if(!this.ondata)throw"no callback";if(t=!!t,this.t){if(this.ondata(this.t.decode(e,{stream:!0}),t),t){if(this.t.decode().length)throw"invalid utf-8 data";this.t=null}}else{if(!this.p)throw"stream finished";var n=new xl(this.p.length+e.length);n.set(this.p),n.set(e,this.p.length);var i=ph(n),r=i[0],s=i[1];if(t){if(s.length)throw"invalid utf-8 data";this.p=null}else this.p=s;this.ondata(r,t)}},e}(),mh=function(){function e(e){this.ondata=e}return e.prototype.push=function(e,t){if(!this.ondata)throw"no callback";if(this.d)throw"stream finished";this.ondata(gh(e),this.d=t||!1)},e}();function gh(e,t){if(t){for(var n=new xl(e.length),i=0;i<e.length;++i)n[i]=e.charCodeAt(i);return n}if(uh)return uh.encode(e);var r=e.length,s=new xl(e.length+(e.length>>1)),o=0,a=function(e){s[o++]=e};for(i=0;i<r;++i){if(o+5>s.length){var c=new xl(o+8+(r-i<<1));c.set(s),s=c}var l=e.charCodeAt(i);l<128||t?a(l):l<2048?(a(192|l>>6),a(128|63&l)):l>55295&&l<57344?(a(240|(l=65536+(1047552&l)|1023&e.charCodeAt(++i))>>18),a(128|l>>12&63),a(128|l>>6&63),a(128|63&l)):(a(224|l>>12),a(128|l>>6&63),a(128|63&l))}return Jl(s,0,o)}function vh(e,t){if(t){for(var n="",i=0;i<e.length;i+=16384)n+=String.fromCharCode.apply(null,e.subarray(i,i+16384));return n}if(hh)return hh.decode(e);var r=ph(e),s=r[0];if(r[1].length)throw"invalid utf-8 data";return s}var yh=function(e){return 1==e?3:e<6?2:9==e?1:0},xh=function(e,t){return t+30+_u(e,t+26)+_u(e,t+28)},wh=function(e,t,n){var i=_u(e,t+28),r=vh(e.subarray(t+46,t+46+i),!(2048&_u(e,t+8))),s=t+46+i,o=Mu(e,t+20),a=n&&4294967295==o?bh(e,s):[o,Mu(e,t+24),Mu(e,t+42)],c=a[0],l=a[1],u=a[2];return[_u(e,t+10),c,l,r,s+_u(e,t+30)+_u(e,t+32),u]},bh=function(e,t){for(;1!=_u(e,t);t+=4+_u(e,t+2));return[Tu(e,t+12),Tu(e,t+4),Tu(e,t+20)]},Ah=function(e){var t=0;if(e)for(var n in e){var i=e[n].length;if(i>65535)throw"extra field too long";t+=i+4}return t},Sh=function(e,t,n,i,r,s,o,a){var c=i.length,l=n.extra,u=a&&a.length,h=Ah(l);Eu(e,t,null!=o?33639248:67324752),t+=4,null!=o&&(e[t++]=20,e[t++]=n.os),e[t]=20,t+=2,e[t++]=n.flag<<1|(null==s&&8),e[t++]=r&&8,e[t++]=255&n.compression,e[t++]=n.compression>>8;var d=new Date(null==n.mtime?Date.now():n.mtime),p=d.getFullYear()-1980;if(p<0||p>119)throw"date not in range 1980-2099";if(Eu(e,t,p<<25|d.getMonth()+1<<21|d.getDate()<<16|d.getHours()<<11|d.getMinutes()<<5|d.getSeconds()>>>1),t+=4,null!=s&&(Eu(e,t,n.crc),Eu(e,t+4,s),Eu(e,t+8,n.size)),Eu(e,t+12,c),Eu(e,t+14,h),t+=16,null!=o&&(Eu(e,t,u),Eu(e,t+6,n.attrs),Eu(e,t+10,o),t+=14),e.set(i,t),t+=c,h)for(var f in l){var m=l[f],g=m.length;Eu(e,t,+f),Eu(e,t+2,g),e.set(m,t+4),t+=4+g}return u&&(e.set(a,t),t+=u),t},_h=function(e,t,n,i,r){Eu(e,t,101010256),Eu(e,t+8,n),Eu(e,t+10,n),Eu(e,t+12,i),Eu(e,t+16,r)},Mh=function(){function e(e){this.filename=e,this.c=ou(),this.size=0,this.compression=0}return e.prototype.process=function(e,t){this.ondata(null,e,t)},e.prototype.push=function(e,t){if(!this.ondata)throw"no callback - add to ZIP archive before pushing";this.c.p(e),this.size+=e.length,t&&(this.crc=this.c.d()),this.process(e,t||!1)},e}(),Th=function(){function e(e,t){var n=this;t||(t={}),Mh.call(this,e),this.d=new Ou(t,(function(e,t){n.ondata(null,e,t)})),this.compression=8,this.flag=yh(t.level)}return e.prototype.process=function(e,t){try{this.d.push(e,t)}catch(e){this.ondata(e,null,t)}},e.prototype.push=function(e,t){Mh.prototype.push.call(this,e,t)},e}(),Eh=function(){function e(e,t){var n=this;t||(t={}),Mh.call(this,e),this.d=new Bu(t,(function(e,t,i){n.ondata(e,t,i)})),this.compression=8,this.flag=yh(t.level),this.terminate=this.d.terminate}return e.prototype.process=function(e,t){this.d.push(e,t)},e.prototype.push=function(e,t){Mh.prototype.push.call(this,e,t)},e}(),Ch=function(){function e(e){this.ondata=e,this.u=[],this.d=1}return e.prototype.add=function(e){var t=this;if(2&this.d)throw"stream finished";var n=gh(e.filename),i=n.length,r=e.comment,s=r&&gh(r),o=i!=e.filename.length||s&&r.length!=s.length,a=i+Ah(e.extra)+30;if(i>65535)throw"filename too long";var c=new xl(a);Sh(c,0,e,n,o);var l=[c],u=function(){for(var e=0,n=l;e<n.length;e++){var i=n[e];t.ondata(null,i,!1)}l=[]},h=this.d;this.d=0;var d=this.u.length,p=lu(e,{f:n,u:o,o:s,t:function(){e.terminate&&e.terminate()},r:function(){if(u(),h){var e=t.u[d+1];e?e.r():t.d=1}h=1}}),f=0;e.ondata=function(n,i,r){if(n)t.ondata(n,i,r),t.terminate();else if(f+=i.length,l.push(i),r){var s=new xl(16);Eu(s,0,134695760),Eu(s,4,e.crc),Eu(s,8,f),Eu(s,12,e.size),l.push(s),p.c=f,p.b=a+f+16,p.crc=e.crc,p.size=e.size,h&&p.r(),h=1}else h&&u()},this.u.push(p)},e.prototype.end=function(){var e=this;if(2&this.d){if(1&this.d)throw"stream finishing";throw"stream finished"}this.d?this.e():this.u.push({r:function(){1&e.d&&(e.u.splice(-1,1),e.e())},t:function(){}}),this.d=3},e.prototype.e=function(){for(var e=0,t=0,n=0,i=0,r=this.u;i<r.length;i++){n+=46+(c=r[i]).f.length+Ah(c.extra)+(c.o?c.o.length:0)}for(var s=new xl(n+22),o=0,a=this.u;o<a.length;o++){var c=a[o];Sh(s,e,c,c.f,c.u,c.c,t,c.o),e+=46+c.f.length+Ah(c.extra)+(c.o?c.o.length:0),t+=c.b}_h(s,e,this.u.length,n,t),this.ondata(null,s,!0),this.d=2},e.prototype.terminate=function(){for(var e=0,t=this.u;e<t.length;e++){t[e].t()}this.d=2},e}();function Rh(e,t,n){if(n||(n=t,t={}),"function"!=typeof n)throw"no callback";var i={};lh(e,"",i,t);var r=Object.keys(i),s=r.length,o=0,a=0,c=s,l=new Array(s),u=[],h=function(){for(var e=0;e<u.length;++e)u[e]()},d=function(){var e=new xl(a+22),t=o,i=a-o;a=0;for(var r=0;r<c;++r){var s=l[r];try{var u=s.c.length;Sh(e,a,s,s.f,s.u,u);var h=30+s.f.length+Ah(s.extra),d=a+h;e.set(s.c,d),Sh(e,o,s,s.f,s.u,u,a,s.m),o+=16+h+(s.m?s.m.length:0),a=d+u}catch(e){return n(e,null)}}_h(e,o,l.length,i,t),n(null,e)};s||d();for(var p=function(e){var t=r[e],c=i[t],p=c[0],f=c[1],m=ou(),g=p.length;m.p(p);var v=gh(t),y=v.length,x=f.comment,w=x&&gh(x),b=w&&w.length,A=Ah(f.extra),S=0==f.level?0:8,_=function(i,r){if(i)h(),n(i,null);else{var c=r.length;l[e]=lu(f,{size:g,crc:m.d(),c:r,f:v,m:w,u:y!=t.length||w&&x.length!=b,compression:S}),o+=30+y+A+c,a+=76+2*(y+A)+(b||0)+c,--s||d()}};if(y>65535&&_("filename too long",null),S)if(g<16e4)try{_(null,zu(p,f))}catch(e){_(e,null)}else u.push(Nu(p,f,_));else _(null,p)},f=0;f<c;++f)p(f);return h}function Ph(e,t){t||(t={});var n={},i=[];lh(e,"",n,t);var r=0,s=0;for(var o in n){var a=n[o],c=a[0],l=a[1],u=0==l.level?0:8,h=(S=gh(o)).length,d=l.comment,p=d&&gh(d),f=p&&p.length,m=Ah(l.extra);if(h>65535)throw"filename too long";var g=u?zu(c,l):c,v=g.length,y=ou();y.p(c),i.push(lu(l,{size:c.length,crc:y.d(),c:g,f:S,m:p,u:h!=o.length||p&&d.length!=f,o:r,compression:u})),r+=30+h+m+v,s+=76+2*(h+m)+(f||0)+v}for(var x=new xl(s+22),w=r,b=s-r,A=0;A<i.length;++A){var S=i[A];Sh(x,S.o,S,S.f,S.u,S.c.length);var _=30+S.f.length+Ah(S.extra);x.set(S.c,S.o+_),Sh(x,r,S,S.f,S.u,S.c.length,S.o,S.m),r+=16+_+(S.m?S.m.length:0)}return _h(x,r,i.length,b,w),x}var Lh=function(){function e(){}return e.prototype.push=function(e,t){this.ondata(null,e,t)},e.compression=0,e}(),Dh=function(){function e(){var e=this;this.i=new Fu((function(t,n){e.ondata(null,t,n)}))}return e.prototype.push=function(e,t){try{this.i.push(e,t)}catch(n){this.ondata(n,e,t)}},e.compression=8,e}(),Ih=function(){function e(e,t){var n=this;t<32e4?this.i=new Fu((function(e,t){n.ondata(null,e,t)})):(this.i=new Uu((function(e,t,i){n.ondata(e,t,i)})),this.terminate=this.i.terminate)}return e.prototype.push=function(e,t){this.i.terminate&&(e=Jl(e,0)),this.i.push(e,t)},e.compression=8,e}(),kh=function(){function e(e){this.onfile=e,this.k=[],this.o={0:Lh},this.p=iu}return e.prototype.push=function(e,t){var n=this;if(!this.onfile)throw"no callback";if(!this.p)throw"stream finished";if(this.c>0){var i=Math.min(this.c,e.length),r=e.subarray(0,i);if(this.c-=i,this.d?this.d.push(r,!this.c):this.k[0].push(r),(e=e.subarray(i)).length)return this.push(e,t)}else{var s=0,o=0,a=void 0,c=void 0;this.p.length?e.length?((c=new xl(this.p.length+e.length)).set(this.p),c.set(e,this.p.length)):c=this.p:c=e;for(var l=c.length,u=this.c,h=u&&this.d,d=function(){var e,t=Mu(c,o);if(67324752==t){s=1,a=o,p.d=null,p.c=0;var i=_u(c,o+6),r=_u(c,o+8),h=2048&i,d=8&i,f=_u(c,o+26),m=_u(c,o+28);if(l>o+30+f+m){var g=[];p.k.unshift(g),s=2;var v,y=Mu(c,o+18),x=Mu(c,o+22),w=vh(c.subarray(o+30,o+=30+f),!h);4294967295==y?(e=d?[-2]:bh(c,o),y=e[0],x=e[1]):d&&(y=-1),o+=m,p.c=y;var b={name:w,compression:r,start:function(){if(!b.ondata)throw"no callback";if(y){var e=n.o[r];if(!e)throw"unknown compression type "+r;(v=y<0?new e(w):new e(w,y,x)).ondata=function(e,t,n){b.ondata(e,t,n)};for(var t=0,i=g;t<i.length;t++){var s=i[t];v.push(s,!1)}n.k[0]==g&&n.c?n.d=v:v.push(iu,!0)}else b.ondata(null,iu,!0)},terminate:function(){v&&v.terminate&&v.terminate()}};y>=0&&(b.size=y,b.originalSize=x),p.onfile(b)}return"break"}if(u){if(134695760==t)return a=o+=12+(-2==u&&8),s=3,p.c=0,"break";if(33639248==t)return a=o-=4,s=3,p.c=0,"break"}},p=this;o<l-4;++o){if("break"===d())break}if(this.p=iu,u<0){var f=s?c.subarray(0,a-12-(-2==u&&8)-(134695760==Mu(c,a-16)&&4)):c.subarray(0,o);h?h.push(f,!!s):this.k[+(2==s)].push(f)}if(2&s)return this.push(c.subarray(o),t);this.p=c.subarray(o)}if(t){if(this.c)throw"invalid zip file";this.p=null}},e.prototype.register=function(e){this.o[e.compression]=e},e}();function Oh(e,t){if("function"!=typeof t)throw"no callback";for(var n=[],i=function(){for(var e=0;e<n.length;++e)n[e]()},r={},s=e.length-22;101010256!=Mu(e,s);--s)if(!s||e.length-s>65558)return void t("invalid zip file",null);var o=_u(e,s+8);o||t(null,{});var a=o,c=Mu(e,s+16),l=4294967295==c;if(l){if(s=Mu(e,s-12),101075792!=Mu(e,s))return void t("invalid zip file",null);a=o=Mu(e,s+32),c=Mu(e,s+48)}for(var u=function(s){var a=wh(e,c,l),u=a[0],h=a[1],d=a[2],p=a[3],f=a[4],m=a[5],g=xh(e,m);c=f;var v=function(e,n){e?(i(),t(e,null)):(r[p]=n,--o||t(null,r))};if(u)if(8==u){var y=e.subarray(g,g+h);if(h<32e4)try{v(null,Vu(y,new xl(d)))}catch(e){v(e,null)}else n.push(Hu(y,{size:d},v))}else v("unknown compression type "+u,null);else v(null,Jl(e,g,g+h))},h=0;h<a;++h)u();return i}function Bh(e){for(var t={},n=e.length-22;101010256!=Mu(e,n);--n)if(!n||e.length-n>65558)throw"invalid zip file";var i=_u(e,n+8);if(!i)return{};var r=Mu(e,n+16),s=4294967295==r;if(s){if(n=Mu(e,n-12),101075792!=Mu(e,n))throw"invalid zip file";i=Mu(e,n+32),r=Mu(e,n+48)}for(var o=0;o<i;++o){var a=wh(e,r,s),c=a[0],l=a[1],u=a[2],h=a[3],d=a[4],p=a[5],f=xh(e,p);if(r=d,c){if(8!=c)throw"unknown compression type "+c;t[h]=Vu(e.subarray(f,f+l),new xl(u))}else t[h]=Jl(e,f,f+l)}return t}function Nh(e,t,n){const i=n.length-e-1;if(t>=n[i])return i-1;if(t<=n[e])return e;let r=e,s=i,o=Math.floor((r+s)/2);for(;t<n[o]||t>=n[o+1];)t<n[o]?s=o:r=o,o=Math.floor((r+s)/2);return o}function zh(e,t,n,i){const r=[],s=[],o=[];r[0]=1;for(let a=1;a<=n;++a){s[a]=t-i[e+1-a],o[a]=i[e+a]-t;let n=0;for(let e=0;e<a;++e){const t=o[e+1],i=s[a-e],c=r[e]/(t+i);r[e]=n+t*c,n=i*c}r[a]=n}return r}function Fh(e,t){let n=1;for(let t=2;t<=e;++t)n*=t;let i=1;for(let e=2;e<=t;++e)i*=e;for(let n=2;n<=e-t;++n)i*=n;return n/i}function Uh(e,t,n,i,r){return function(e){const t=e.length,n=[],i=[];for(let r=0;r<t;++r){const t=e[r];n[r]=new Y(t.x,t.y,t.z),i[r]=t.w}const r=[];for(let e=0;e<t;++e){const t=n[e].clone();for(let n=1;n<=e;++n)t.sub(r[e-n].clone().multiplyScalar(Fh(e,n)*i[n]));r[e]=t.divideScalar(i[0])}return r}(function(e,t,n,i,r){const s=r<e?r:e,o=[],a=Nh(e,i,t),c=function(e,t,n,i,r){const s=[];for(let e=0;e<=n;++e)s[e]=0;const o=[];for(let e=0;e<=i;++e)o[e]=s.slice(0);const a=[];for(let e=0;e<=n;++e)a[e]=s.slice(0);a[0][0]=1;const c=s.slice(0),l=s.slice(0);for(let i=1;i<=n;++i){c[i]=t-r[e+1-i],l[i]=r[e+i]-t;let n=0;for(let e=0;e<i;++e){const t=l[e+1],r=c[i-e];a[i][e]=t+r;const s=a[e][i-1]/a[i][e];a[e][i]=n+t*s,n=r*s}a[i][i]=n}for(let e=0;e<=n;++e)o[0][e]=a[e][n];for(let e=0;e<=n;++e){let t=0,r=1;const c=[];for(let e=0;e<=n;++e)c[e]=s.slice(0);c[0][0]=1;for(let s=1;s<=i;++s){let i=0;const l=e-s,u=n-s;e>=s&&(c[r][0]=c[t][0]/a[u+1][l],i=c[r][0]*a[l][u]);const h=e-1<=u?s-1:n-e;for(let e=l>=-1?1:-l;e<=h;++e)c[r][e]=(c[t][e]-c[t][e-1])/a[u+1][l+e],i+=c[r][e]*a[l+e][u];e<=u&&(c[r][s]=-c[t][s-1]/a[u+1][e],i+=c[r][s]*a[e][u]),o[s][e]=i;const d=t;t=r,r=d}}let u=n;for(let e=1;e<=i;++e){for(let t=0;t<=n;++t)o[e][t]*=u;u*=n-e}return o}(a,i,e,s,t),l=[];for(let e=0;e<n.length;++e){const t=n[e].clone(),i=t.w;t.x*=i,t.y*=i,t.z*=i,l[e]=t}for(let t=0;t<=s;++t){const n=l[a-e].clone().multiplyScalar(c[t][0]);for(let i=1;i<=e;++i)n.add(l[a-e+i].clone().multiplyScalar(c[t][i]));o[t]=n}for(let e=s+1;e<=r+1;++e)o[e]=new j(0,0,0);return o}(e,t,n,i,r))}class Hh extends Ps{constructor(e,t,n,i,r){super(),this.degree=e,this.knots=t,this.controlPoints=[],this.startKnot=i||0,this.endKnot=r||this.knots.length-1;for(let e=0;e<n.length;++e){const t=n[e];this.controlPoints[e]=new j(t.x,t.y,t.z,t.w)}}getPoint(e,t=new Y){const n=t,i=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),r=function(e,t,n,i){const r=Nh(e,i,t),s=zh(r,i,e,t),o=new j(0,0,0,0);for(let t=0;t<=e;++t){const i=n[r-e+t],a=s[t],c=i.w*a;o.x+=i.x*c,o.y+=i.y*c,o.z+=i.z*c,o.w+=i.w*a}return o}(this.degree,this.knots,this.controlPoints,i);return 1!==r.w&&r.divideScalar(r.w),n.set(r.x,r.y,r.z)}getTangent(e,t=new Y){const n=t,i=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),r=Uh(this.degree,this.knots,this.controlPoints,i,1);return n.copy(r[1]).normalize(),n}}let Vh,Gh,Wh;class jh extends $o{constructor(e){super(e)}load(e,t,n,i){const r=this,s=""===r.path?wa.extractUrlBase(e):r.path,o=new ta(this.manager);o.setPath(r.path),o.setResponseType("arraybuffer"),o.setRequestHeader(r.requestHeader),o.setWithCredentials(r.withCredentials),o.load(e,(function(n){try{t(r.parse(n,s))}catch(t){i?i(t):console.error(t),r.manager.itemError(e)}}),n,i)}parse(e,t){if(function(e){const t="Kaydara FBX Binary  \0";return e.byteLength>=t.length&&t===cd(e,0,t.length)}(e))Vh=(new Yh).parse(e);else{const t=cd(e);if(!function(e){const t=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let n=0;function i(t){const i=e[t-1];return e=e.slice(n+t),n++,i}for(let e=0;e<t.length;++e){if(i(1)===t[e])return!1}return!0}(t))throw new Error("THREE.FBXLoader: Unknown format.");if($h(t)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+$h(t));Vh=(new Zh).parse(t)}const n=new ia(this.manager).setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin);return new Jh(n,this.manager).parse(Vh)}}class Jh{constructor(e,t){this.textureLoader=e,this.manager=t}parse(){Gh=this.parseConnections();const e=this.parseImages(),t=this.parseTextures(e),n=this.parseMaterials(t),i=this.parseDeformers(),r=(new Xh).parse(i);return this.parseScene(i,r,n),Wh}parseConnections(){const e=new Map;if("Connections"in Vh){Vh.Connections.connections.forEach((function(t){const n=t[0],i=t[1],r=t[2];e.has(n)||e.set(n,{parents:[],children:[]});const s={ID:i,relationship:r};e.get(n).parents.push(s),e.has(i)||e.set(i,{parents:[],children:[]});const o={ID:n,relationship:r};e.get(i).children.push(o)}))}return e}parseImages(){const e={},t={};if("Video"in Vh.Objects){const n=Vh.Objects.Video;for(const i in n){const r=n[i];if(e[parseInt(i)]=r.RelativeFilename||r.Filename,"Content"in r){const e=r.Content instanceof ArrayBuffer&&r.Content.byteLength>0,s="string"==typeof r.Content&&""!==r.Content;if(e||s){const e=this.parseImage(n[i]);t[r.RelativeFilename||r.Filename]=e}}}}for(const n in e){const i=e[n];void 0!==t[i]?e[n]=t[i]:e[n]=e[n].split("\\").pop()}return e}parseImage(e){const t=e.Content,n=e.RelativeFilename||e.Filename,i=n.slice(n.lastIndexOf(".")+1).toLowerCase();let r;switch(i){case"bmp":r="image/bmp";break;case"jpg":case"jpeg":r="image/jpeg";break;case"png":r="image/png";break;case"tif":r="image/tiff";break;case"tga":null===this.manager.getHandler(".tga")&&console.warn("FBXLoader: TGA loader not found, skipping ",n),r="image/tga";break;default:return void console.warn('FBXLoader: Image type "'+i+'" is not supported.')}if("string"==typeof t)return"data:"+r+";base64,"+t;{const e=new Uint8Array(t);return window.URL.createObjectURL(new Blob([e],{type:r}))}}parseTextures(e){const t=new Map;if("Texture"in Vh.Objects){const n=Vh.Objects.Texture;for(const i in n){const r=this.parseTexture(n[i],e);t.set(parseInt(i),r)}}return t}parseTexture(e,t){const n=this.loadTexture(e,t);n.ID=e.id,n.name=e.attrName;const i=e.WrapModeU,r=e.WrapModeV,s=void 0!==i?i.value:0,o=void 0!==r?r.value:0;if(n.wrapS=0===s?1e3:1001,n.wrapT=0===o?1e3:1001,"Scaling"in e){const t=e.Scaling.value;n.repeat.x=t[0],n.repeat.y=t[1]}if("Translation"in e){const t=e.Translation.value;n.offset.x=t[0],n.offset.y=t[1]}return n}loadTexture(e,t){let n;const i=this.textureLoader.path,r=Gh.get(e.id).children;let s;void 0!==r&&r.length>0&&void 0!==t[r[0].ID]&&(n=t[r[0].ID],0!==n.indexOf("blob:")&&0!==n.indexOf("data:")||this.textureLoader.setPath(void 0));const o=e.FileName.slice(-3).toLowerCase();if("tga"===o){const t=this.manager.getHandler(".tga");null===t?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",e.RelativeFilename),s=new W):(t.setPath(this.textureLoader.path),s=t.load(n))}else"psd"===o?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",e.RelativeFilename),s=new W):s=this.textureLoader.load(n);return this.textureLoader.setPath(i),s}parseMaterials(e){const t=new Map;if("Material"in Vh.Objects){const n=Vh.Objects.Material;for(const i in n){const r=this.parseMaterial(n[i],e);null!==r&&t.set(parseInt(i),r)}}return t}parseMaterial(e,t){const n=e.id,i=e.attrName;let r=e.ShadingModel;if("object"==typeof r&&(r=r.value),!Gh.has(n))return null;const s=this.parseParameters(e,t,n);let o;switch(r.toLowerCase()){case"phong":o=new Io;break;case"lambert":o=new ko;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',r),o=new Io}return o.setValues(s),o.name=i,o}parseParameters(e,t,n){const i={};e.BumpFactor&&(i.bumpScale=e.BumpFactor.value),e.Diffuse?i.color=(new z).fromArray(e.Diffuse.value):!e.DiffuseColor||"Color"!==e.DiffuseColor.type&&"ColorRGB"!==e.DiffuseColor.type||(i.color=(new z).fromArray(e.DiffuseColor.value)),e.DisplacementFactor&&(i.displacementScale=e.DisplacementFactor.value),e.Emissive?i.emissive=(new z).fromArray(e.Emissive.value):!e.EmissiveColor||"Color"!==e.EmissiveColor.type&&"ColorRGB"!==e.EmissiveColor.type||(i.emissive=(new z).fromArray(e.EmissiveColor.value)),e.EmissiveFactor&&(i.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(i.opacity=parseFloat(e.Opacity.value)),i.opacity<1&&(i.transparent=!0),e.ReflectionFactor&&(i.reflectivity=e.ReflectionFactor.value),e.Shininess&&(i.shininess=e.Shininess.value),e.Specular?i.specular=(new z).fromArray(e.Specular.value):e.SpecularColor&&"Color"===e.SpecularColor.type&&(i.specular=(new z).fromArray(e.SpecularColor.value));const r=this;return Gh.get(n).children.forEach((function(e){const n=e.relationship;switch(n){case"Bump":i.bumpMap=r.getTexture(t,e.ID);break;case"Maya|TEX_ao_map":i.aoMap=r.getTexture(t,e.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":i.map=r.getTexture(t,e.ID),void 0!==i.map&&(i.map.encoding=3001);break;case"DisplacementColor":i.displacementMap=r.getTexture(t,e.ID);break;case"EmissiveColor":i.emissiveMap=r.getTexture(t,e.ID),void 0!==i.emissiveMap&&(i.emissiveMap.encoding=3001);break;case"NormalMap":case"Maya|TEX_normal_map":i.normalMap=r.getTexture(t,e.ID);break;case"ReflectionColor":i.envMap=r.getTexture(t,e.ID),void 0!==i.envMap&&(i.envMap.mapping=303,i.envMap.encoding=3001);break;case"SpecularColor":i.specularMap=r.getTexture(t,e.ID),void 0!==i.specularMap&&(i.specularMap.encoding=3001);break;case"TransparentColor":case"TransparencyFactor":i.alphaMap=r.getTexture(t,e.ID),i.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",n)}})),i}getTexture(e,t){return"LayeredTexture"in Vh.Objects&&t in Vh.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),t=Gh.get(t).children[0].ID),e.get(t)}parseDeformers(){const e={},t={};if("Deformer"in Vh.Objects){const n=Vh.Objects.Deformer;for(const i in n){const r=n[i],s=Gh.get(parseInt(i));if("Skin"===r.attrType){const t=this.parseSkeleton(s,n);t.ID=i,s.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),t.geometryID=s.parents[0].ID,e[i]=t}else if("BlendShape"===r.attrType){const e={id:i};e.rawTargets=this.parseMorphTargets(s,n),e.id=i,s.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),t[i]=e}}}return{skeletons:e,morphTargets:t}}parseSkeleton(e,t){const n=[];return e.children.forEach((function(e){const i=t[e.ID];if("Cluster"!==i.attrType)return;const r={ID:e.ID,indices:[],weights:[],transformLink:(new Ee).fromArray(i.TransformLink.a)};"Indexes"in i&&(r.indices=i.Indexes.a,r.weights=i.Weights.a),n.push(r)})),{rawBones:n,bones:[]}}parseMorphTargets(e,t){const n=[];for(let i=0;i<e.children.length;i++){const r=e.children[i],s=t[r.ID],o={name:s.attrName,initialWeight:s.DeformPercent,id:s.id,fullWeights:s.FullWeights.a};if("BlendShapeChannel"!==s.attrType)return;o.geoID=Gh.get(parseInt(r.ID)).children.filter((function(e){return void 0===e.relationship}))[0].ID,n.push(o)}return n}parseScene(e,t,n){Wh=new Br;const i=this.parseModels(e.skeletons,t,n),r=Vh.Objects.Model,s=this;i.forEach((function(e){const t=r[e.ID];s.setLookAtProperties(e,t);Gh.get(e.ID).parents.forEach((function(t){const n=i.get(t.ID);void 0!==n&&n.add(e)})),null===e.parent&&Wh.add(e)})),this.bindSkeleton(e.skeletons,t,i),this.createAmbientLight(),Wh.traverse((function(e){if(e.userData.transformData){e.parent&&(e.userData.transformData.parentMatrix=e.parent.matrix,e.userData.transformData.parentMatrixWorld=e.parent.matrixWorld);const t=sd(e.userData.transformData);e.applyMatrix4(t),e.updateWorldMatrix()}}));const o=(new qh).parse();1===Wh.children.length&&Wh.children[0].isGroup&&(Wh.children[0].animations=o,Wh=Wh.children[0]),Wh.animations=o}parseModels(e,t,n){const i=new Map,r=Vh.Objects.Model;for(const s in r){const o=parseInt(s),a=r[s],c=Gh.get(o);let l=this.buildSkeleton(c,e,o,a.attrName);if(!l){switch(a.attrType){case"Camera":l=this.createCamera(c);break;case"Light":l=this.createLight(c);break;case"Mesh":l=this.createMesh(c,t,n);break;case"NurbsCurve":l=this.createCurve(c,t);break;case"LimbNode":case"Root":l=new es;break;case"Null":default:l=new Br}l.name=a.attrName?Ra.sanitizeNodeName(a.attrName):"",l.ID=o}this.getTransformData(l,a),i.set(o,l)}return i}buildSkeleton(e,t,n,i){let r=null;return e.parents.forEach((function(e){for(const s in t){const o=t[s];o.rawBones.forEach((function(t,s){if(t.ID===e.ID){const e=r;r=new es,r.matrixWorld.copy(t.transformLink),r.name=i?Ra.sanitizeNodeName(i):"",r.ID=n,o.bones[s]=r,null!==e&&r.add(e)}}))}})),r}createCamera(e){let t,n;if(e.children.forEach((function(e){const t=Vh.Objects.NodeAttribute[e.ID];void 0!==t&&(n=t)})),void 0===n)t=new Qe;else{let e=0;void 0!==n.CameraProjectionType&&1===n.CameraProjectionType.value&&(e=1);let i=1;void 0!==n.NearPlane&&(i=n.NearPlane.value/1e3);let r=1e3;void 0!==n.FarPlane&&(r=n.FarPlane.value/1e3);let s=window.innerWidth,o=window.innerHeight;void 0!==n.AspectWidth&&void 0!==n.AspectHeight&&(s=n.AspectWidth.value,o=n.AspectHeight.value);const a=s/o;let c=45;void 0!==n.FieldOfView&&(c=n.FieldOfView.value);const l=n.FocalLength?n.FocalLength.value:null;switch(e){case 0:t=new Qt(c,a,i,r),null!==l&&t.setFocalLength(l);break;case 1:t=new An(-s/2,s/2,o/2,-o/2,i,r);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+e+"."),t=new Qe}}return t}createLight(e){let t,n;if(e.children.forEach((function(e){const t=Vh.Objects.NodeAttribute[e.ID];void 0!==t&&(n=t)})),void 0===n)t=new Qe;else{let e;e=void 0===n.LightType?0:n.LightType.value;let i=16777215;void 0!==n.Color&&(i=(new z).fromArray(n.Color.value));let r=void 0===n.Intensity?1:n.Intensity.value/100;void 0!==n.CastLightOnObject&&0===n.CastLightOnObject.value&&(r=0);let s=0;void 0!==n.FarAttenuationEnd&&(s=void 0!==n.EnableFarAttenuation&&0===n.EnableFarAttenuation.value?0:n.FarAttenuationEnd.value);const o=1;switch(e){case 0:t=new ga(i,r,s,o);break;case 1:t=new ya(i,r);break;case 2:let e=Math.PI/3;void 0!==n.InnerAngle&&(e=S.degToRad(n.InnerAngle.value));let a=0;void 0!==n.OuterAngle&&(a=S.degToRad(n.OuterAngle.value),a=Math.max(a,1)),t=new ha(i,r,s,e,a,o);break;default:console.warn("THREE.FBXLoader: Unknown light type "+n.LightType.value+", defaulting to a PointLight."),t=new ga(i,r)}void 0!==n.CastShadows&&1===n.CastShadows.value&&(t.castShadow=!0)}return t}createMesh(e,t,n){let i,r=null,s=null;const o=[];return e.children.forEach((function(e){t.has(e.ID)&&(r=t.get(e.ID)),n.has(e.ID)&&o.push(n.get(e.ID))})),o.length>1?s=o:o.length>0?s=o[0]:(s=new Io({color:13421772}),o.push(s)),"color"in r.attributes&&o.forEach((function(e){e.vertexColors=!0})),r.FBX_Deformer?(i=new $r(r,s),i.normalizeSkinWeights()):i=new Wt(r,s),i}createCurve(e,t){const n=e.children.reduce((function(e,n){return t.has(n.ID)&&(e=t.get(n.ID)),e}),null),i=new hs({color:3342591,linewidth:1});return new vs(n,i)}getTransformData(e,t){const n={};"InheritType"in t&&(n.inheritType=parseInt(t.InheritType.value)),n.eulerOrder="RotationOrder"in t?od(t.RotationOrder.value):"ZYX","Lcl_Translation"in t&&(n.translation=t.Lcl_Translation.value),"PreRotation"in t&&(n.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(n.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(n.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(n.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(n.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(n.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(n.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(n.rotationPivot=t.RotationPivot.value),e.userData.transformData=n}setLookAtProperties(e,t){if("LookAtProperty"in t){Gh.get(e.ID).children.forEach((function(t){if("LookAtProperty"===t.relationship){const n=Vh.Objects.Model[t.ID];if("Lcl_Translation"in n){const t=n.Lcl_Translation.value;void 0!==e.target?(e.target.position.fromArray(t),Wh.add(e.target)):e.lookAt((new Y).fromArray(t))}}}))}}bindSkeleton(e,t,n){const i=this.parsePoseNodes();for(const r in e){const s=e[r];Gh.get(parseInt(s.ID)).parents.forEach((function(e){if(t.has(e.ID)){const t=e.ID;Gh.get(t).parents.forEach((function(e){if(n.has(e.ID)){n.get(e.ID).bind(new rs(s.bones),i[e.ID])}}))}}))}}parsePoseNodes(){const e={};if("Pose"in Vh.Objects){const t=Vh.Objects.Pose;for(const n in t)if("BindPose"===t[n].attrType&&t[n].NbPoseNodes>0){const i=t[n].PoseNode;Array.isArray(i)?i.forEach((function(t){e[t.Node]=(new Ee).fromArray(t.Matrix.a)})):e[i.Node]=(new Ee).fromArray(i.Matrix.a)}}return e}createAmbientLight(){if("GlobalSettings"in Vh&&"AmbientColor"in Vh.GlobalSettings){const e=Vh.GlobalSettings.AmbientColor.value,t=e[0],n=e[1],i=e[2];if(0!==t||0!==n||0!==i){const e=new z(t,n,i);Wh.add(new xa(e,1))}}}}class Xh{parse(e){const t=new Map;if("Geometry"in Vh.Objects){const n=Vh.Objects.Geometry;for(const i in n){const r=Gh.get(parseInt(i)),s=this.parseGeometry(r,n[i],e);t.set(parseInt(i),s)}}return t}parseGeometry(e,t,n){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,n);case"NurbsCurve":return this.parseNurbsGeometry(t)}}parseMeshGeometry(e,t,n){const i=n.skeletons,r=[],s=e.parents.map((function(e){return Vh.Objects.Model[e.ID]}));if(0===s.length)return;const o=e.children.reduce((function(e,t){return void 0!==i[t.ID]&&(e=i[t.ID]),e}),null);e.children.forEach((function(e){void 0!==n.morphTargets[e.ID]&&r.push(n.morphTargets[e.ID])}));const a=s[0],c={};"RotationOrder"in a&&(c.eulerOrder=od(a.RotationOrder.value)),"InheritType"in a&&(c.inheritType=parseInt(a.InheritType.value)),"GeometricTranslation"in a&&(c.translation=a.GeometricTranslation.value),"GeometricRotation"in a&&(c.rotation=a.GeometricRotation.value),"GeometricScaling"in a&&(c.scale=a.GeometricScaling.value);const l=sd(c);return this.genGeometry(t,o,r,l)}genGeometry(e,t,n,i){const r=new Tt;e.attrName&&(r.name=e.attrName);const s=this.parseGeoNode(e,t),o=this.genBuffers(s),a=new yt(o.vertex,3);if(a.applyMatrix4(i),r.setAttribute("position",a),o.colors.length>0&&r.setAttribute("color",new yt(o.colors,3)),t&&(r.setAttribute("skinIndex",new gt(o.weightsIndices,4)),r.setAttribute("skinWeight",new yt(o.vertexWeights,4)),r.FBX_Deformer=t),o.normal.length>0){const e=(new M).getNormalMatrix(i),t=new yt(o.normal,3);t.applyNormalMatrix(e),r.setAttribute("normal",t)}if(o.uvs.forEach((function(e,t){let n="uv"+(t+1).toString();0===t&&(n="uv"),r.setAttribute(n,new yt(o.uvs[t],2))})),s.material&&"AllSame"!==s.material.mappingType){let e=o.materialIndex[0],t=0;if(o.materialIndex.forEach((function(n,i){n!==e&&(r.addGroup(t,i-t,e),e=n,t=i)})),r.groups.length>0){const t=r.groups[r.groups.length-1],n=t.start+t.count;n!==o.materialIndex.length&&r.addGroup(n,o.materialIndex.length-n,e)}0===r.groups.length&&r.addGroup(0,o.materialIndex.length,o.materialIndex[0])}return this.addMorphTargets(r,e,n,i),r}parseGeoNode(e,t){const n={};if(n.vertexPositions=void 0!==e.Vertices?e.Vertices.a:[],n.vertexIndices=void 0!==e.PolygonVertexIndex?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(n.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(n.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(n.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){n.uv=[];let t=0;for(;e.LayerElementUV[t];)e.LayerElementUV[t].UV&&n.uv.push(this.parseUVs(e.LayerElementUV[t])),t++}return n.weightTable={},null!==t&&(n.skeleton=t,t.rawBones.forEach((function(e,t){e.indices.forEach((function(i,r){void 0===n.weightTable[i]&&(n.weightTable[i]=[]),n.weightTable[i].push({id:t,weight:e.weights[r]})}))}))),n}genBuffers(e){const t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let n=0,i=0,r=!1,s=[],o=[],a=[],c=[],l=[],u=[];const h=this;return e.vertexIndices.forEach((function(d,p){let f,m=!1;d<0&&(d^=-1,m=!0);let g=[],v=[];if(s.push(3*d,3*d+1,3*d+2),e.color){const t=nd(p,n,d,e.color);a.push(t[0],t[1],t[2])}if(e.skeleton){if(void 0!==e.weightTable[d]&&e.weightTable[d].forEach((function(e){v.push(e.weight),g.push(e.id)})),v.length>4){r||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),r=!0);const e=[0,0,0,0],t=[0,0,0,0];v.forEach((function(n,i){let r=n,s=g[i];t.forEach((function(t,n,i){if(r>t){i[n]=r,r=t;const o=e[n];e[n]=s,s=o}}))})),g=e,v=t}for(;v.length<4;)v.push(0),g.push(0);for(let e=0;e<4;++e)l.push(v[e]),u.push(g[e])}if(e.normal){const t=nd(p,n,d,e.normal);o.push(t[0],t[1],t[2])}e.material&&"AllSame"!==e.material.mappingType&&(f=nd(p,n,d,e.material)[0]),e.uv&&e.uv.forEach((function(e,t){const i=nd(p,n,d,e);void 0===c[t]&&(c[t]=[]),c[t].push(i[0]),c[t].push(i[1])})),i++,m&&(h.genFace(t,e,s,f,o,a,c,l,u,i),n++,i=0,s=[],o=[],a=[],c=[],l=[],u=[])})),t}genFace(e,t,n,i,r,s,o,a,c,l){for(let u=2;u<l;u++)e.vertex.push(t.vertexPositions[n[0]]),e.vertex.push(t.vertexPositions[n[1]]),e.vertex.push(t.vertexPositions[n[2]]),e.vertex.push(t.vertexPositions[n[3*(u-1)]]),e.vertex.push(t.vertexPositions[n[3*(u-1)+1]]),e.vertex.push(t.vertexPositions[n[3*(u-1)+2]]),e.vertex.push(t.vertexPositions[n[3*u]]),e.vertex.push(t.vertexPositions[n[3*u+1]]),e.vertex.push(t.vertexPositions[n[3*u+2]]),t.skeleton&&(e.vertexWeights.push(a[0]),e.vertexWeights.push(a[1]),e.vertexWeights.push(a[2]),e.vertexWeights.push(a[3]),e.vertexWeights.push(a[4*(u-1)]),e.vertexWeights.push(a[4*(u-1)+1]),e.vertexWeights.push(a[4*(u-1)+2]),e.vertexWeights.push(a[4*(u-1)+3]),e.vertexWeights.push(a[4*u]),e.vertexWeights.push(a[4*u+1]),e.vertexWeights.push(a[4*u+2]),e.vertexWeights.push(a[4*u+3]),e.weightsIndices.push(c[0]),e.weightsIndices.push(c[1]),e.weightsIndices.push(c[2]),e.weightsIndices.push(c[3]),e.weightsIndices.push(c[4*(u-1)]),e.weightsIndices.push(c[4*(u-1)+1]),e.weightsIndices.push(c[4*(u-1)+2]),e.weightsIndices.push(c[4*(u-1)+3]),e.weightsIndices.push(c[4*u]),e.weightsIndices.push(c[4*u+1]),e.weightsIndices.push(c[4*u+2]),e.weightsIndices.push(c[4*u+3])),t.color&&(e.colors.push(s[0]),e.colors.push(s[1]),e.colors.push(s[2]),e.colors.push(s[3*(u-1)]),e.colors.push(s[3*(u-1)+1]),e.colors.push(s[3*(u-1)+2]),e.colors.push(s[3*u]),e.colors.push(s[3*u+1]),e.colors.push(s[3*u+2])),t.material&&"AllSame"!==t.material.mappingType&&(e.materialIndex.push(i),e.materialIndex.push(i),e.materialIndex.push(i)),t.normal&&(e.normal.push(r[0]),e.normal.push(r[1]),e.normal.push(r[2]),e.normal.push(r[3*(u-1)]),e.normal.push(r[3*(u-1)+1]),e.normal.push(r[3*(u-1)+2]),e.normal.push(r[3*u]),e.normal.push(r[3*u+1]),e.normal.push(r[3*u+2])),t.uv&&t.uv.forEach((function(t,n){void 0===e.uvs[n]&&(e.uvs[n]=[]),e.uvs[n].push(o[n][0]),e.uvs[n].push(o[n][1]),e.uvs[n].push(o[n][2*(u-1)]),e.uvs[n].push(o[n][2*(u-1)+1]),e.uvs[n].push(o[n][2*u]),e.uvs[n].push(o[n][2*u+1])}))}addMorphTargets(e,t,n,i){if(0===n.length)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];const r=this;n.forEach((function(n){n.rawTargets.forEach((function(n){const s=Vh.Objects.Geometry[n.geoID];void 0!==s&&r.genMorphGeometry(e,t,s,i,n.name)}))}))}genMorphGeometry(e,t,n,i,r){const s=void 0!==t.PolygonVertexIndex?t.PolygonVertexIndex.a:[],o=void 0!==n.Vertices?n.Vertices.a:[],a=void 0!==n.Indexes?n.Indexes.a:[],c=3*e.attributes.position.count,l=new Float32Array(c);for(let e=0;e<a.length;e++){const t=3*a[e];l[t]=o[3*e],l[t+1]=o[3*e+1],l[t+2]=o[3*e+2]}const u={vertexIndices:s,vertexPositions:l},h=this.genBuffers(u),d=new yt(h.vertex,3);d.name=r||n.attrName,d.applyMatrix4(i),e.morphAttributes.position.push(d)}parseNormals(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,i=e.Normals.a;let r=[];return"IndexToDirect"===n&&("NormalIndex"in e?r=e.NormalIndex.a:"NormalsIndex"in e&&(r=e.NormalsIndex.a)),{dataSize:3,buffer:i,indices:r,mappingType:t,referenceType:n}}parseUVs(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,i=e.UV.a;let r=[];return"IndexToDirect"===n&&(r=e.UVIndex.a),{dataSize:2,buffer:i,indices:r,mappingType:t,referenceType:n}}parseVertexColors(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,i=e.Colors.a;let r=[];return"IndexToDirect"===n&&(r=e.ColorIndex.a),{dataSize:4,buffer:i,indices:r,mappingType:t,referenceType:n}}parseMaterialIndices(e){const t=e.MappingInformationType,n=e.ReferenceInformationType;if("NoMappingInformation"===t)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:n};const i=e.Materials.a,r=[];for(let e=0;e<i.length;++e)r.push(e);return{dataSize:1,buffer:i,indices:r,mappingType:t,referenceType:n}}parseNurbsGeometry(e){if(void 0===Hh)return console.error("THREE.FBXLoader: The loader relies on NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new Tt;const t=parseInt(e.Order);if(isNaN(t))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new Tt;const n=t-1,i=e.KnotVector.a,r=[],s=e.Points.a;for(let e=0,t=s.length;e<t;e+=4)r.push((new j).fromArray(s,e));let o,a;if("Closed"===e.Form)r.push(r[0]);else if("Periodic"===e.Form){o=n,a=i.length-1-o;for(let e=0;e<n;++e)r.push(r[e])}const c=new Hh(n,i,r,o,a).getPoints(12*r.length);return(new Tt).setFromPoints(c)}}class qh{parse(){const e=[],t=this.parseClips();if(void 0!==t)for(const n in t){const i=t[n],r=this.addClip(i);e.push(r)}return e}parseClips(){if(void 0===Vh.Objects.AnimationCurve)return;const e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);const t=this.parseAnimationLayers(e);return this.parseAnimStacks(t)}parseAnimationCurveNodes(){const e=Vh.Objects.AnimationCurveNode,t=new Map;for(const n in e){const i=e[n];if(null!==i.attrName.match(/S|R|T|DeformPercent/)){const e={id:i.id,attr:i.attrName,curves:{}};t.set(e.id,e)}}return t}parseAnimationCurves(e){const t=Vh.Objects.AnimationCurve;for(const n in t){const i={id:t[n].id,times:t[n].KeyTime.a.map(ed),values:t[n].KeyValueFloat.a},r=Gh.get(i.id);if(void 0!==r){const t=r.parents[0].ID,n=r.parents[0].relationship;n.match(/X/)?e.get(t).curves.x=i:n.match(/Y/)?e.get(t).curves.y=i:n.match(/Z/)?e.get(t).curves.z=i:n.match(/d|DeformPercent/)&&e.has(t)&&(e.get(t).curves.morph=i)}}}parseAnimationLayers(e){const t=Vh.Objects.AnimationLayer,n=new Map;for(const i in t){const t=[],r=Gh.get(parseInt(i));if(void 0!==r){r.children.forEach((function(n,i){if(e.has(n.ID)){const r=e.get(n.ID);if(void 0!==r.curves.x||void 0!==r.curves.y||void 0!==r.curves.z){if(void 0===t[i]){const e=Gh.get(n.ID).parents.filter((function(e){return void 0!==e.relationship}))[0].ID;if(void 0!==e){const r=Vh.Objects.Model[e.toString()];if(void 0===r)return void console.warn("THREE.FBXLoader: Encountered a unused curve.",n);const s={modelName:r.attrName?Ra.sanitizeNodeName(r.attrName):"",ID:r.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};Wh.traverse((function(e){e.ID===r.id&&(s.transform=e.matrix,e.userData.transformData&&(s.eulerOrder=e.userData.transformData.eulerOrder))})),s.transform||(s.transform=new Ee),"PreRotation"in r&&(s.preRotation=r.PreRotation.value),"PostRotation"in r&&(s.postRotation=r.PostRotation.value),t[i]=s}}t[i]&&(t[i][r.attr]=r)}else if(void 0!==r.curves.morph){if(void 0===t[i]){const e=Gh.get(n.ID).parents.filter((function(e){return void 0!==e.relationship}))[0].ID,r=Gh.get(e).parents[0].ID,s=Gh.get(r).parents[0].ID,o=Gh.get(s).parents[0].ID,a=Vh.Objects.Model[o],c={modelName:a.attrName?Ra.sanitizeNodeName(a.attrName):"",morphName:Vh.Objects.Deformer[e].attrName};t[i]=c}t[i][r.attr]=r}}})),n.set(parseInt(i),t)}}return n}parseAnimStacks(e){const t=Vh.Objects.AnimationStack,n={};for(const i in t){const r=Gh.get(parseInt(i)).children;r.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const s=e.get(r[0].ID);n[i]={name:t[i].attrName,layer:s}}return n}addClip(e){let t=[];const n=this;return e.layer.forEach((function(e){t=t.concat(n.generateTracks(e))})),new qo(e.name,-1,t)}generateTracks(e){const t=[];let n=new Y,i=new Z,r=new Y;if(e.transform&&e.transform.decompose(n,i,r),n=n.toArray(),i=(new Ne).setFromQuaternion(i,e.eulerOrder).toArray(),r=r.toArray(),void 0!==e.T&&Object.keys(e.T.curves).length>0){const i=this.generateVectorTrack(e.modelName,e.T.curves,n,"position");void 0!==i&&t.push(i)}if(void 0!==e.R&&Object.keys(e.R.curves).length>0){const n=this.generateRotationTrack(e.modelName,e.R.curves,i,e.preRotation,e.postRotation,e.eulerOrder);void 0!==n&&t.push(n)}if(void 0!==e.S&&Object.keys(e.S.curves).length>0){const n=this.generateVectorTrack(e.modelName,e.S.curves,r,"scale");void 0!==n&&t.push(n)}if(void 0!==e.DeformPercent){const n=this.generateMorphTrack(e);void 0!==n&&t.push(n)}return t}generateVectorTrack(e,t,n,i){const r=this.getTimesForAllAxes(t),s=this.getKeyframeTrackValues(r,t,n);return new Xo(e+"."+i,r,s)}generateRotationTrack(e,t,n,i,r,s){void 0!==t.x&&(this.interpolateRotations(t.x),t.x.values=t.x.values.map(S.degToRad)),void 0!==t.y&&(this.interpolateRotations(t.y),t.y.values=t.y.values.map(S.degToRad)),void 0!==t.z&&(this.interpolateRotations(t.z),t.z.values=t.z.values.map(S.degToRad));const o=this.getTimesForAllAxes(t),a=this.getKeyframeTrackValues(o,t,n);void 0!==i&&((i=i.map(S.degToRad)).push(s),i=(new Ne).fromArray(i),i=(new Z).setFromEuler(i)),void 0!==r&&((r=r.map(S.degToRad)).push(s),r=(new Ne).fromArray(r),r=(new Z).setFromEuler(r).invert());const c=new Z,l=new Ne,u=[];for(let e=0;e<a.length;e+=3)l.set(a[e],a[e+1],a[e+2],s),c.setFromEuler(l),void 0!==i&&c.premultiply(i),void 0!==r&&c.multiply(r),c.toArray(u,e/3*4);return new jo(e+".quaternion",o,u)}generateMorphTrack(e){const t=e.DeformPercent.curves.morph,n=t.values.map((function(e){return e/100})),i=Wh.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new Go(e.modelName+".morphTargetInfluences["+i+"]",t.times,n)}getTimesForAllAxes(e){let t=[];if(void 0!==e.x&&(t=t.concat(e.x.times)),void 0!==e.y&&(t=t.concat(e.y.times)),void 0!==e.z&&(t=t.concat(e.z.times)),t=t.sort((function(e,t){return e-t})),t.length>1){let e=1,n=t[0];for(let i=1;i<t.length;i++){const r=t[i];r!==n&&(t[e]=r,n=r,e++)}t=t.slice(0,e)}return t}getKeyframeTrackValues(e,t,n){const i=n,r=[];let s=-1,o=-1,a=-1;return e.forEach((function(e){if(t.x&&(s=t.x.times.indexOf(e)),t.y&&(o=t.y.times.indexOf(e)),t.z&&(a=t.z.times.indexOf(e)),-1!==s){const e=t.x.values[s];r.push(e),i[0]=e}else r.push(i[0]);if(-1!==o){const e=t.y.values[o];r.push(e),i[1]=e}else r.push(i[1]);if(-1!==a){const e=t.z.values[a];r.push(e),i[2]=e}else r.push(i[2])})),r}interpolateRotations(e){for(let t=1;t<e.values.length;t++){const n=e.values[t-1],i=e.values[t]-n,r=Math.abs(i);if(r>=180){const s=r/180,o=i/s;let a=n+o;const c=e.times[t-1],l=(e.times[t]-c)/s;let u=c+l;const h=[],d=[];for(;u<e.times[t];)h.push(u),u+=l,d.push(a),a+=o;e.times=ld(e.times,t,h),e.values=ld(e.values,t,d)}}}}class Zh{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,t){this.currentProp=e,this.currentPropName=t}parse(e){this.currentIndent=0,this.allNodes=new Qh,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const t=this,n=e.split(/[\r\n]+/);return n.forEach((function(e,i){const r=e.match(/^[\s\t]*;/),s=e.match(/^[\s\t]*$/);if(r||s)return;const o=e.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),a=e.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),c=e.match("^\\t{"+(t.currentIndent-1)+"}}");o?t.parseNodeBegin(e,o):a?t.parseNodeProperty(e,a,n[++i]):c?t.popStack():e.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(e)})),this.allNodes}parseNodeBegin(e,t){const n=t[1].trim().replace(/^"/,"").replace(/"$/,""),i=t[2].split(",").map((function(e){return e.trim().replace(/^"/,"").replace(/"$/,"")})),r={name:n},s=this.parseNodeAttr(i),o=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(n,r):n in o?("PoseNode"===n?o.PoseNode.push(r):void 0!==o[n].id&&(o[n]={},o[n][o[n].id]=o[n]),""!==s.id&&(o[n][s.id]=r)):"number"==typeof s.id?(o[n]={},o[n][s.id]=r):"Properties70"!==n&&(o[n]="PoseNode"===n?[r]:r),"number"==typeof s.id&&(r.id=s.id),""!==s.name&&(r.attrName=s.name),""!==s.type&&(r.attrType=s.type),this.pushStack(r)}parseNodeAttr(e){let t=e[0];""!==e[0]&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));let n="",i="";return e.length>1&&(n=e[1].replace(/^(\w+)::/,""),i=e[2]),{id:t,name:n,type:i}}parseNodeProperty(e,t,n){let i=t[1].replace(/^"/,"").replace(/"$/,"").trim(),r=t[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===i&&","===r&&(r=n.replace(/"/g,"").replace(/,$/,"").trim());const s=this.getCurrentNode();if("Properties70"!==s.name){if("C"===i){const e=r.split(",").slice(1),t=parseInt(e[0]),n=parseInt(e[1]);let o=r.split(",").slice(3);o=o.map((function(e){return e.trim().replace(/^"/,"")})),i="connections",r=[t,n],function(e,t){for(let n=0,i=e.length,r=t.length;n<r;n++,i++)e[i]=t[n]}(r,o),void 0===s[i]&&(s[i]=[])}"Node"===i&&(s.id=r),i in s&&Array.isArray(s[i])?s[i].push(r):"a"!==i?s[i]=r:s.a=r,this.setCurrentProp(s,i),"a"===i&&","!==r.slice(-1)&&(s.a=ad(r))}else this.parseNodeSpecialProperty(e,i,r)}parseNodePropertyContinued(e){const t=this.getCurrentNode();t.a+=e,","!==e.slice(-1)&&(t.a=ad(t.a))}parseNodeSpecialProperty(e,t,n){const i=n.split('",').map((function(e){return e.trim().replace(/^\"/,"").replace(/\s/,"_")})),r=i[0],s=i[1],o=i[2],a=i[3];let c=i[4];switch(s){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":c=parseFloat(c);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":c=ad(c)}this.getPrevNode()[r]={type:s,type2:o,flag:a,value:c},this.setCurrentProp(this.getPrevNode(),r)}}class Yh{parse(e){const t=new Kh(e);t.skip(23);const n=t.getUint32();if(n<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+n);const i=new Qh;for(;!this.endOfContent(t);){const e=this.parseNode(t,n);null!==e&&i.add(e.name,e)}return i}endOfContent(e){return e.size()%16==0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,t){const n={},i=t>=7500?e.getUint64():e.getUint32(),r=t>=7500?e.getUint64():e.getUint32();t>=7500?e.getUint64():e.getUint32();const s=e.getUint8(),o=e.getString(s);if(0===i)return null;const a=[];for(let t=0;t<r;t++)a.push(this.parseProperty(e));const c=a.length>0?a[0]:"",l=a.length>1?a[1]:"",u=a.length>2?a[2]:"";for(n.singleProperty=1===r&&e.getOffset()===i;i>e.getOffset();){const i=this.parseNode(e,t);null!==i&&this.parseSubNode(o,n,i)}return n.propertyList=a,"number"==typeof c&&(n.id=c),""!==l&&(n.attrName=l),""!==u&&(n.attrType=u),""!==o&&(n.name=o),n}parseSubNode(e,t,n){if(!0===n.singleProperty){const e=n.propertyList[0];Array.isArray(e)?(t[n.name]=n,n.a=e):t[n.name]=e}else if("Connections"===e&&"C"===n.name){const e=[];n.propertyList.forEach((function(t,n){0!==n&&e.push(t)})),void 0===t.connections&&(t.connections=[]),t.connections.push(e)}else if("Properties70"===n.name){Object.keys(n).forEach((function(e){t[e]=n[e]}))}else if("Properties70"===e&&"P"===n.name){let e=n.propertyList[0],i=n.propertyList[1];const r=n.propertyList[2],s=n.propertyList[3];let o;0===e.indexOf("Lcl ")&&(e=e.replace("Lcl ","Lcl_")),0===i.indexOf("Lcl ")&&(i=i.replace("Lcl ","Lcl_")),o="Color"===i||"ColorRGB"===i||"Vector"===i||"Vector3D"===i||0===i.indexOf("Lcl_")?[n.propertyList[4],n.propertyList[5],n.propertyList[6]]:n.propertyList[4],t[e]={type:i,type2:r,flag:s,value:o}}else void 0===t[n.name]?"number"==typeof n.id?(t[n.name]={},t[n.name][n.id]=n):t[n.name]=n:"PoseNode"===n.name?(Array.isArray(t[n.name])||(t[n.name]=[t[n.name]]),t[n.name].push(n)):void 0===t[n.name][n.id]&&(t[n.name][n.id]=n)}parseProperty(e){const t=e.getString(1);let n;switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return n=e.getUint32(),e.getArrayBuffer(n);case"S":return n=e.getUint32(),e.getString(n);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const r=e.getUint32(),s=e.getUint32(),o=e.getUint32();if(0===s)switch(t){case"b":case"c":return e.getBooleanArray(r);case"d":return e.getFloat64Array(r);case"f":return e.getFloat32Array(r);case"i":return e.getInt32Array(r);case"l":return e.getInt64Array(r)}void 0===i&&console.error("THREE.FBXLoader: External library fflate.min.js required.");const a=rh(new Uint8Array(e.getArrayBuffer(o))),c=new Kh(a.buffer);switch(t){case"b":case"c":return c.getBooleanArray(r);case"d":return c.getFloat64Array(r);case"f":return c.getFloat32Array(r);case"i":return c.getInt32Array(r);case"l":return c.getInt64Array(r)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}}class Kh{constructor(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=void 0===t||t}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return 1==(1&this.getUint8())}getBooleanArray(e){const t=[];for(let n=0;n<e;n++)t.push(this.getBoolean());return t}getUint8(){const e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){const e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){const e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getInt32());return t}getUint32(){const e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),2147483648&t?(t=4294967295&~t,e=4294967295&~e,4294967295===e&&(t=t+1&4294967295),e=e+1&4294967295,-(4294967296*t+e)):4294967296*t+e}getInt64Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getInt64());return t}getUint64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),4294967296*t+e}getFloat32(){const e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getFloat32());return t}getFloat64(){const e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getFloat64());return t}getArrayBuffer(e){const t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}getString(e){let t=[];for(let n=0;n<e;n++)t[n]=this.getUint8();const n=t.indexOf(0);return n>=0&&(t=t.slice(0,n)),wa.decodeText(new Uint8Array(t))}}class Qh{add(e,t){this[e]=t}}function $h(e){const t=e.match(/FBXVersion: (\d+)/);if(t){return parseInt(t[1])}throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function ed(e){return e/46186158e3}const td=[];function nd(e,t,n,i){let r;switch(i.mappingType){case"ByPolygonVertex":r=e;break;case"ByPolygon":r=t;break;case"ByVertice":r=n;break;case"AllSame":r=i.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+i.mappingType)}"IndexToDirect"===i.referenceType&&(r=i.indices[r]);const s=r*i.dataSize,o=s+i.dataSize;return function(e,t,n,i){for(let r=n,s=0;r<i;r++,s++)e[s]=t[r];return e}(td,i.buffer,s,o)}const id=new Ne,rd=new Y;function sd(e){const t=new Ee,n=new Ee,i=new Ee,r=new Ee,s=new Ee,o=new Ee,a=new Ee,c=new Ee,l=new Ee,u=new Ee,h=new Ee,d=new Ee,p=e.inheritType?e.inheritType:0;if(e.translation&&t.setPosition(rd.fromArray(e.translation)),e.preRotation){const t=e.preRotation.map(S.degToRad);t.push(e.eulerOrder),n.makeRotationFromEuler(id.fromArray(t))}if(e.rotation){const t=e.rotation.map(S.degToRad);t.push(e.eulerOrder),i.makeRotationFromEuler(id.fromArray(t))}if(e.postRotation){const t=e.postRotation.map(S.degToRad);t.push(e.eulerOrder),r.makeRotationFromEuler(id.fromArray(t)),r.invert()}e.scale&&s.scale(rd.fromArray(e.scale)),e.scalingOffset&&a.setPosition(rd.fromArray(e.scalingOffset)),e.scalingPivot&&o.setPosition(rd.fromArray(e.scalingPivot)),e.rotationOffset&&c.setPosition(rd.fromArray(e.rotationOffset)),e.rotationPivot&&l.setPosition(rd.fromArray(e.rotationPivot)),e.parentMatrixWorld&&(h.copy(e.parentMatrix),u.copy(e.parentMatrixWorld));const f=n.clone().multiply(i).multiply(r),m=new Ee;m.extractRotation(u);const g=new Ee;g.copyPosition(u);const v=g.clone().invert().multiply(u),y=m.clone().invert().multiply(v),x=s,w=new Ee;if(0===p)w.copy(m).multiply(f).multiply(y).multiply(x);else if(1===p)w.copy(m).multiply(y).multiply(f).multiply(x);else{const e=(new Ee).scale((new Y).setFromMatrixScale(h)).clone().invert(),t=y.clone().multiply(e);w.copy(m).multiply(f).multiply(t).multiply(x)}const b=l.clone().invert(),A=o.clone().invert();let _=t.clone().multiply(c).multiply(l).multiply(n).multiply(i).multiply(r).multiply(b).multiply(a).multiply(o).multiply(s).multiply(A);const M=(new Ee).copyPosition(_),T=u.clone().multiply(M);return d.copyPosition(T),_=d.clone().multiply(w),_.premultiply(u.invert()),_}function od(e){const t=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return 6===(e=e||0)?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),t[0]):t[e]}function ad(e){return e.split(",").map((function(e){return parseFloat(e)}))}function cd(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=e.byteLength),wa.decodeText(new Uint8Array(e,t,n))}function ld(e,t,n){return e.slice(0,t).concat(n).concat(e.slice(t))}function ud(e){let t,n,i,r=0;for(let s=0;s<e.length;++s){const o=e[s];if(o.isInterleavedBufferAttribute)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. InterleavedBufferAttributes are not supported."),null;if(void 0===t&&(t=o.array.constructor),t!==o.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(void 0===n&&(n=o.itemSize),n!==o.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(void 0===i&&(i=o.normalized),i!==o.normalized)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;r+=o.array.length}const s=new t(r);let o=0;for(let t=0;t<e.length;++t)s.set(e[t].array,o),o+=e[t].array.length;return new mt(s,n,i)}const hd=Math.pow(2,-24);class dd{constructor(){}}function pd(e,t,n){return n.min.x=t[e],n.min.y=t[e+1],n.min.z=t[e+2],n.max.x=t[e+3],n.max.y=t[e+4],n.max.z=t[e+5],n}function fd(e){let t=-1,n=-1/0;for(let i=0;i<3;i++){const r=e[i+3]-e[i];r>n&&(n=r,t=i)}return t}function md(e,t){t.set(e)}function gd(e,t,n){let i,r;for(let s=0;s<3;s++){const o=s+3;i=e[s],r=t[s],n[s]=i<r?i:r,i=e[o],r=t[o],n[o]=i>r?i:r}}function vd(e,t,n){for(let i=0;i<3;i++){const r=t[e+2*i],s=t[e+2*i+1],o=r-s,a=r+s;o<n[i]&&(n[i]=o),a>n[i+3]&&(n[i+3]=a)}}function yd(e){const t=e[3]-e[0],n=e[4]-e[1],i=e[5]-e[2];return 2*(t*n+n*i+i*t)}function xd(e,t,n,i,r=null){let s=1/0,o=1/0,a=1/0,c=-1/0,l=-1/0,u=-1/0,h=1/0,d=1/0,p=1/0,f=-1/0,m=-1/0,g=-1/0;const v=null!==r;for(let i=6*t,r=6*(t+n);i<r;i+=6){const t=e[i+0],n=e[i+1],r=t-n,y=t+n;r<s&&(s=r),y>c&&(c=y),v&&t<h&&(h=t),v&&t>f&&(f=t);const x=e[i+2],w=e[i+3],b=x-w,A=x+w;b<o&&(o=b),A>l&&(l=A),v&&x<d&&(d=x),v&&x>m&&(m=x);const S=e[i+4],_=e[i+5],M=S-_,T=S+_;M<a&&(a=M),T>u&&(u=T),v&&S<p&&(p=S),v&&S>g&&(g=S)}i[0]=s,i[1]=o,i[2]=a,i[3]=c,i[4]=l,i[5]=u,v&&(r[0]=h,r[1]=d,r[2]=p,r[3]=f,r[4]=m,r[5]=g)}const wd=(e,t)=>e.candidate-t.candidate,bd=new Array(32).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),Ad=new Float32Array(6);function Sd(e,t){function n(e){d&&d(e/p)}function i(t,r,d,p=null,m=0){if(!f&&m>=c&&(f=!0,l&&(console.warn(`MeshBVH: Max depth of ${c} reached when generating BVH. Consider increasing maxDepth.`),console.warn(e))),d<=u||m>=c)return n(r),t.offset=r,t.count=d,t;const g=function(e,t,n,i,r,s){let o=-1,a=0;if(0===s)o=fd(t),-1!==o&&(a=(t[o]+t[o+3])/2);else if(1===s)o=fd(e),-1!==o&&(a=function(e,t,n,i){let r=0;for(let s=t,o=t+n;s<o;s++)r+=e[6*s+2*i];return r/n}(n,i,r,o));else if(2===s){const s=yd(e);let c=1.25*r;const l=6*i,u=6*(i+r);for(let e=0;e<3;e++){const i=t[e],h=(t[e+3]-i)/32;if(r<8){const t=[...bd];t.length=r;let i=0;for(let r=l;r<u;r+=6,i++){const s=t[i];s.candidate=n[r+2*e],s.count=0;const{bounds:o,leftCacheBounds:a,rightCacheBounds:c}=s;for(let e=0;e<3;e++)c[e]=1/0,c[e+3]=-1/0,a[e]=1/0,a[e+3]=-1/0,o[e]=1/0,o[e+3]=-1/0;vd(r,n,o)}t.sort(wd);let h=r;for(let e=0;e<h;e++){const n=t[e];for(;e+1<h&&t[e+1].candidate===n.candidate;)t.splice(e+1,1),h--}for(let i=l;i<u;i+=6){const r=n[i+2*e];for(let e=0;e<h;e++){const s=t[e];r>=s.candidate?vd(i,n,s.rightCacheBounds):(vd(i,n,s.leftCacheBounds),s.count++)}}for(let n=0;n<h;n++){const i=t[n],l=i.count,u=r-i.count,h=i.leftCacheBounds,d=i.rightCacheBounds;let p=0;0!==l&&(p=yd(h)/s);let f=0;0!==u&&(f=yd(d)/s);const m=1+1.25*(p*l+f*u);m<c&&(o=e,c=m,a=i.candidate)}}else{for(let e=0;e<32;e++){const t=bd[e];t.count=0,t.candidate=i+h+e*h;const n=t.bounds;for(let e=0;e<3;e++)n[e]=1/0,n[e+3]=-1/0}for(let t=l;t<u;t+=6){let r=~~((n[t+2*e]-i)/h);r>=32&&(r=31);const s=bd[r];s.count++,vd(t,n,s.bounds)}const t=bd[31];md(t.bounds,t.rightCacheBounds);for(let e=30;e>=0;e--){const t=bd[e],n=bd[e+1];gd(t.bounds,n.rightCacheBounds,t.rightCacheBounds)}let d=0;for(let t=0;t<31;t++){const n=bd[t],i=n.count,l=n.bounds,u=bd[t+1].rightCacheBounds;0!==i&&(0===d?md(l,Ad):gd(l,Ad,Ad)),d+=i;let h=0,p=0;0!==d&&(h=yd(Ad)/s);const f=r-d;0!==f&&(p=yd(u)/s);const m=1+1.25*(h*d+p*f);m<c&&(o=e,c=m,a=n.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${s} used.`);return{axis:o,pos:a}}(t.boundingData,p,o,r,d,h);if(-1===g.axis)return n(r),t.offset=r,t.count=d,t;const v=function(e,t,n,i,r){let s=n,o=n+i-1;const a=r.pos,c=2*r.axis;for(;;){for(;s<=o&&t[6*s+c]<a;)s++;for(;s<=o&&t[6*o+c]>=a;)o--;if(!(s<o))return s;for(let n=0;n<3;n++){let i=e[3*s+n];e[3*s+n]=e[3*o+n],e[3*o+n]=i;let r=t[6*s+2*n+0];t[6*s+2*n+0]=t[6*o+2*n+0],t[6*o+2*n+0]=r;let a=t[6*s+2*n+1];t[6*s+2*n+1]=t[6*o+2*n+1],t[6*o+2*n+1]=a}s++,o--}}(a,o,r,d,g);if(v===r||v===r+d)n(r),t.offset=r,t.count=d;else{t.splitAxis=g.axis;const e=new dd,n=r,a=v-r;t.left=e,e.boundingData=new Float32Array(6),xd(o,n,a,e.boundingData,s),i(e,n,a,s,m+1);const c=new dd,l=v,u=d-a;t.right=c,c.boundingData=new Float32Array(6),xd(o,l,u,c.boundingData,s),i(c,l,u,s,m+1)}return t}!function(e,t){if(!e.index){const n=e.attributes.position.count,i=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;let r;r=n>65535?new Uint32Array(new i(4*n)):new Uint16Array(new i(2*n)),e.setIndex(new mt(r,1));for(let e=0;e<n;e++)r[e]=e}}(e,t);const r=new Float32Array(6),s=new Float32Array(6),o=function(e,t){const n=e.attributes.position,i=n.array,r=e.index.array,s=r.length/3,o=new Float32Array(6*s),a=n.offset||0;let c=3;n.isInterleavedBufferAttribute&&(c=n.data.stride);for(let e=0;e<s;e++){const n=3*e,s=6*e,l=r[n+0]*c+a,u=r[n+1]*c+a,h=r[n+2]*c+a;for(let e=0;e<3;e++){const n=i[l+e],r=i[u+e],a=i[h+e];let c=n;r<c&&(c=r),a<c&&(c=a);let d=n;r>d&&(d=r),a>d&&(d=a);const p=(d-c)/2,f=2*e;o[s+f+0]=c+p,o[s+f+1]=p+(Math.abs(c)+p)*hd,c<t[e]&&(t[e]=c),d>t[e+3]&&(t[e+3]=d)}}return o}(e,r),a=e.index.array,c=t.maxDepth,l=t.verbose,u=t.maxLeafTris,h=t.strategy,d=t.onProgress,p=e.index.count/3;let f=!1;const m=[],g=function(e){if(!e.groups||!e.groups.length)return[{offset:0,count:e.index.count/3}];const t=[],n=new Set;for(const t of e.groups)n.add(t.start),n.add(t.start+t.count);const i=Array.from(n.values()).sort((e,t)=>e-t);for(let e=0;e<i.length-1;e++){const n=i[e],r=i[e+1];t.push({offset:n/3,count:(r-n)/3})}return t}(e);if(1===g.length){const e=g[0],t=new dd;t.boundingData=r,function(e,t,n,i){let r=1/0,s=1/0,o=1/0,a=-1/0,c=-1/0,l=-1/0;for(let i=6*t,u=6*(t+n);i<u;i+=6){const t=e[i+0];t<r&&(r=t),t>a&&(a=t);const n=e[i+2];n<s&&(s=n),n>c&&(c=n);const u=e[i+4];u<o&&(o=u),u>l&&(l=u)}i[0]=r,i[1]=s,i[2]=o,i[3]=a,i[4]=c,i[5]=l}(o,e.offset,e.count,s),i(t,e.offset,e.count,s),m.push(t)}else for(let e of g){const t=new dd;t.boundingData=new Float32Array(6),xd(o,e.offset,e.count,t.boundingData,s),i(t,e.offset,e.count,s),m.push(t)}return m}class _d{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(e,t){let n=1/0,i=-1/0;for(let r=0,s=e.length;r<s;r++){const s=e[r][t];n=s<n?s:n,i=s>i?s:i}this.min=n,this.max=i}setFromPoints(e,t){let n=1/0,i=-1/0;for(let r=0,s=t.length;r<s;r++){const s=t[r],o=e.dot(s);n=o<n?o:n,i=o>i?o:i}this.min=n,this.max=i}isSeparated(e){return this.min>e.max||e.min>this.max}}_d.prototype.setFromBox=function(){const e=new Y;return function(t,n){const i=n.min,r=n.max;let s=1/0,o=-1/0;for(let n=0;n<=1;n++)for(let a=0;a<=1;a++)for(let c=0;c<=1;c++){e.x=i.x*n+r.x*(1-n),e.y=i.y*a+r.y*(1-a),e.z=i.z*c+r.z*(1-c);const l=t.dot(e);s=Math.min(l,s),o=Math.max(l,o)}this.min=s,this.max=o}}();!function(){const e=new _d}();const Md=function(){const e=new Y,t=new Y,n=new Y;return function(i,r,s){const o=i.start,a=e,c=r.start,l=t;n.subVectors(o,c),e.subVectors(i.end,r.start),t.subVectors(r.end,r.start);const u=n.dot(l),h=l.dot(a),d=l.dot(l),p=n.dot(a),f=a.dot(a)*d-h*h;let m,g;m=0!==f?(u*h-p*d)/f:0,g=(u+m*h)/d,s.x=m,s.y=g}}(),Td=function(){const e=new _,t=new Y,n=new Y;return function(i,r,s,o){Md(i,r,e);let a=e.x,c=e.y;if(a>=0&&a<=1&&c>=0&&c<=1)return i.at(a,s),void r.at(c,o);if(a>=0&&a<=1)return c<0?r.at(0,o):r.at(1,o),void i.closestPointToPoint(o,!0,s);if(c>=0&&c<=1)return a<0?i.at(0,s):i.at(1,s),void r.closestPointToPoint(s,!0,o);{let e,l;e=a<0?i.start:i.end,l=c<0?r.start:r.end;const u=t,h=n;return i.closestPointToPoint(l,!0,t),r.closestPointToPoint(e,!0,n),u.distanceToSquared(l)<=h.distanceToSquared(e)?(s.copy(u),void o.copy(l)):(s.copy(e),void o.copy(h))}}}(),Ed=function(){const e=new Y,t=new Y,n=new on,i=new Fa;return function(r,s){const{radius:o,center:a}=r,{a:c,b:l,c:u}=s;i.start=c,i.end=l;if(i.closestPointToPoint(a,!0,e).distanceTo(a)<=o)return!0;i.start=c,i.end=u;if(i.closestPointToPoint(a,!0,e).distanceTo(a)<=o)return!0;i.start=l,i.end=u;if(i.closestPointToPoint(a,!0,e).distanceTo(a)<=o)return!0;const h=s.getPlane(n);if(Math.abs(h.distanceToPoint(a))<=o){const e=h.projectPoint(a,t);if(s.containsPoint(e))return!0}return!1}}();class Cd extends lt{constructor(...e){super(...e),this.isSeparatingAxisTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new Y),this.satBounds=new Array(4).fill().map(()=>new _d),this.points=[this.a,this.b,this.c],this.sphere=new ye,this.plane=new on,this.needsUpdate=!1}intersectsSphere(e){return Ed(e,this)}update(){const e=this.a,t=this.b,n=this.c,i=this.points,r=this.satAxes,s=this.satBounds,o=r[0],a=s[0];this.getNormal(o),a.setFromPoints(o,i);const c=r[1],l=s[1];c.subVectors(e,t),l.setFromPoints(c,i);const u=r[2],h=s[2];u.subVectors(t,n),h.setFromPoints(u,i);const d=r[3],p=s[3];d.subVectors(n,e),p.setFromPoints(d,i),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(o,e),this.needsUpdate=!1}}Cd.prototype.closestPointToSegment=function(){const e=new Y,t=new Y,n=new Fa;return function(i,r=null,s=null){const{start:o,end:a}=i,c=this.points;let l,u=1/0;for(let o=0;o<3;o++){const a=(o+1)%3;n.start.copy(c[o]),n.end.copy(c[a]),Td(n,i,e,t),l=e.distanceToSquared(t),l<u&&(u=l,r&&r.copy(e),s&&s.copy(t))}return this.closestPointToPoint(o,e),l=o.distanceToSquared(e),l<u&&(u=l,r&&r.copy(e),s&&s.copy(o)),this.closestPointToPoint(a,e),l=a.distanceToSquared(e),l<u&&(u=l,r&&r.copy(e),s&&s.copy(a)),Math.sqrt(u)}}(),Cd.prototype.intersectsTriangle=function(){const e=new Cd,t=new Array(3),n=new Array(3),i=new _d,r=new _d,s=new Y,o=new Y,a=new Y,c=new Y,l=new Fa,u=new Fa,h=new Fa;return function(d,p=null){this.needsUpdate&&this.update(),d.isSeparatingAxisTriangle?d.needsUpdate&&d.update():(e.copy(d),e.update(),d=e);const f=this.satBounds,m=this.satAxes;n[0]=d.a,n[1]=d.b,n[2]=d.c;for(let e=0;e<4;e++){const t=f[e],r=m[e];if(i.setFromPoints(r,n),t.isSeparated(i))return!1}const g=d.satBounds,v=d.satAxes;t[0]=this.a,t[1]=this.b,t[2]=this.c;for(let e=0;e<4;e++){const n=g[e],r=v[e];if(i.setFromPoints(r,t),n.isSeparated(i))return!1}for(let e=0;e<4;e++){const o=m[e];for(let e=0;e<4;e++){const a=v[e];if(s.crossVectors(o,a),i.setFromPoints(s,t),r.setFromPoints(s,n),i.isSeparated(r))return!1}}if(p){const e=this.plane,t=d.plane;if(Math.abs(e.normal.dot(t.normal))>1-1e-10)console.warn("SeparatingAxisTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),p.start.set(0,0,0),p.end.set(0,0,0);else{const n=this.points;let i=!1;for(let e=0;e<3;e++){const r=n[e],s=n[(e+1)%3];if(l.start.copy(r),l.end.copy(s),t.intersectLine(l,i?u.start:u.end)){if(i)break;i=!0}}const r=d.points;let s=!1;for(let t=0;t<3;t++){const n=r[t],i=r[(t+1)%3];if(l.start.copy(n),l.end.copy(i),e.intersectLine(l,s?h.start:h.end)){if(s)break;s=!0}}if(u.delta(o),h.delta(a),o.dot(a)<0){let e=h.start;h.start=h.end,h.end=e}c.subVectors(u.start,h.start),c.dot(o)>0?p.start.copy(u.start):p.start.copy(h.start),c.subVectors(u.end,h.end),c.dot(o)<0?p.end.copy(u.end):p.end.copy(h.end)}}return!0}}(),Cd.prototype.distanceToPoint=function(){const e=new Y;return function(t){return this.closestPointToPoint(t,e),t.distanceTo(e)}}(),Cd.prototype.distanceToTriangle=function(){const e=new Y,t=new Y,n=["a","b","c"],i=new Fa,r=new Fa;return function(s,o=null,a=null){const c=o||a?i:null;if(this.intersectsTriangle(s,c))return(o||a)&&(o&&c.getCenter(o),a&&c.getCenter(a)),0;let l=1/0;for(let t=0;t<3;t++){let i;const r=n[t],c=s[r];this.closestPointToPoint(c,e),i=c.distanceToSquared(e),i<l&&(l=i,o&&o.copy(e),a&&a.copy(c));const u=this[r];s.closestPointToPoint(u,e),i=u.distanceToSquared(e),i<l&&(l=i,o&&o.copy(u),a&&a.copy(e))}for(let c=0;c<3;c++){const u=n[c],h=n[(c+1)%3];i.set(this[u],this[h]);for(let c=0;c<3;c++){const u=n[c],h=n[(c+1)%3];r.set(s[u],s[h]),Td(i,r,e,t);const d=e.distanceToSquared(t);d<l&&(l=d,o&&o.copy(e),a&&a.copy(t))}}return Math.sqrt(l)}}();class Rd extends ${constructor(...e){super(...e),this.isOrientedBox=!0,this.matrix=new Ee,this.invMatrix=new Ee,this.points=new Array(8).fill().map(()=>new Y),this.satAxes=new Array(3).fill().map(()=>new Y),this.satBounds=new Array(3).fill().map(()=>new _d),this.alignedSatBounds=new Array(3).fill().map(()=>new _d),this.needsUpdate=!1}set(e,t,n){super.set(e,t),this.matrix=n,this.needsUpdate=!0}copy(e){super.copy(e),this.matrix.copy(e.matrix),this.needsUpdate=!0}}Rd.prototype.update=function(){const e=this.matrix,t=this.min,n=this.max,i=this.points;for(let r=0;r<=1;r++)for(let s=0;s<=1;s++)for(let o=0;o<=1;o++){const a=i[1*r|2*s|4*o];a.x=r?n.x:t.x,a.y=s?n.y:t.y,a.z=o?n.z:t.z,a.applyMatrix4(e)}const r=this.satBounds,s=this.satAxes,o=i[0];for(let e=0;e<3;e++){const t=s[e],n=r[e],a=i[1<<e];t.subVectors(o,a),n.setFromPoints(t,i)}const a=this.alignedSatBounds;a[0].setFromPointsField(i,"x"),a[1].setFromPointsField(i,"y"),a[2].setFromPointsField(i,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1},Rd.prototype.intersectsBox=function(){const e=new _d;return function(t){this.needsUpdate&&this.update();const n=t.min,i=t.max,r=this.satBounds,s=this.satAxes,o=this.alignedSatBounds;if(e.min=n.x,e.max=i.x,o[0].isSeparated(e))return!1;if(e.min=n.y,e.max=i.y,o[1].isSeparated(e))return!1;if(e.min=n.z,e.max=i.z,o[2].isSeparated(e))return!1;for(let n=0;n<3;n++){const i=s[n],o=r[n];if(e.setFromBox(i,t),o.isSeparated(e))return!1}return!0}}(),Rd.prototype.intersectsTriangle=function(){const e=new Cd,t=new Array(3),n=new _d,i=new _d,r=new Y;return function(s){this.needsUpdate&&this.update(),s.isSeparatingAxisTriangle?s.needsUpdate&&s.update():(e.copy(s),e.update(),s=e);const o=this.satBounds,a=this.satAxes;t[0]=s.a,t[1]=s.b,t[2]=s.c;for(let e=0;e<3;e++){const i=o[e],r=a[e];if(n.setFromPoints(r,t),i.isSeparated(n))return!1}const c=s.satBounds,l=s.satAxes,u=this.points;for(let e=0;e<3;e++){const t=c[e],i=l[e];if(n.setFromPoints(i,u),t.isSeparated(n))return!1}for(let e=0;e<3;e++){const s=a[e];for(let e=0;e<4;e++){const o=l[e];if(r.crossVectors(s,o),n.setFromPoints(r,t),i.setFromPoints(r,u),n.isSeparated(i))return!1}}return!0}}(),Rd.prototype.closestPointToPoint=function(e,t){return this.needsUpdate&&this.update(),t.copy(e).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),t},Rd.prototype.distanceToPoint=function(){const e=new Y;return function(t){return this.closestPointToPoint(t,e),t.distanceTo(e)}}(),Rd.prototype.distanceToBox=function(){const e=["x","y","z"],t=new Array(12).fill().map(()=>new Fa),n=new Array(12).fill().map(()=>new Fa),i=new Y,r=new Y;return function(s,o=0,a=null,c=null){if(this.needsUpdate&&this.update(),this.intersectsBox(s))return(a||c)&&(s.getCenter(r),this.closestPointToPoint(r,i),s.closestPointToPoint(i,r),a&&a.copy(i),c&&c.copy(r)),0;const l=o*o,u=s.min,h=s.max,d=this.points;let p=1/0;for(let e=0;e<8;e++){const t=d[e];r.copy(t).clamp(u,h);const n=t.distanceToSquared(r);if(n<p&&(p=n,a&&a.copy(t),c&&c.copy(r),n<l))return Math.sqrt(n)}let f=0;for(let i=0;i<3;i++)for(let r=0;r<=1;r++)for(let s=0;s<=1;s++){const o=(i+1)%3,a=(i+2)%3,c=1<<i|r<<o|s<<a,l=d[r<<o|s<<a],p=d[c];t[f].set(l,p);const m=e[i],g=e[o],v=e[a],y=n[f],x=y.start,w=y.end;x[m]=u[m],x[g]=r?u[g]:h[g],x[v]=s?u[v]:h[g],w[m]=h[m],w[g]=r?u[g]:h[g],w[v]=s?u[v]:h[g],f++}for(let e=0;e<=1;e++)for(let t=0;t<=1;t++)for(let n=0;n<=1;n++){r.x=e?h.x:u.x,r.y=t?h.y:u.y,r.z=n?h.z:u.z,this.closestPointToPoint(r,i);const s=r.distanceToSquared(i);if(s<p&&(p=s,a&&a.copy(i),c&&c.copy(r),s<l))return Math.sqrt(s)}for(let e=0;e<12;e++){const s=t[e];for(let e=0;e<12;e++){const t=n[e];Td(s,t,i,r);const o=i.distanceToSquared(r);if(o<p&&(p=o,a&&a.copy(i),c&&c.copy(r),o<l))return Math.sqrt(o)}}return Math.sqrt(p)}}();const Pd=new Y,Ld=new Y,Dd=new Y,Id=new _,kd=new _,Od=new _,Bd=new Y;function Nd(e,t,n,i,r){const s=3*i,o=e.index.getX(s),a=e.index.getX(s+1),c=e.index.getX(s+2),l=function(e,t,n,i,r,s,o){Pd.fromBufferAttribute(t,i),Ld.fromBufferAttribute(t,r),Dd.fromBufferAttribute(t,s);const a=function(e,t,n,i,r,s){let o;return o=1===s?e.intersectTriangle(i,n,t,!0,r):e.intersectTriangle(t,n,i,2!==s,r),null===o?null:{distance:e.origin.distanceTo(r),point:r.clone()}}(e,Pd,Ld,Dd,Bd,o);if(a){n&&(Id.fromBufferAttribute(n,i),kd.fromBufferAttribute(n,r),Od.fromBufferAttribute(n,s),a.uv=lt.getUV(Bd,Pd,Ld,Dd,Id,kd,Od,new _));const e={a:i,b:r,c:s,normal:new Y,materialIndex:0};lt.getNormal(Pd,Ld,Dd,e.normal),a.face=e,a.faceIndex=i}return a}(n,e.attributes.position,e.attributes.uv,o,a,c,t);return l?(l.faceIndex=i,r&&r.push(l),l):null}function zd(e,t,n){return null===e?null:(e.point.applyMatrix4(t.matrixWorld),e.distance=e.point.distanceTo(n.ray.origin),e.object=t,e.distance<n.near||e.distance>n.far?null:e)}function Fd(e,t,n,i){const r=e.a,s=e.b,o=e.c;let a=t,c=t+1,l=t+2;n&&(a=n.getX(t),c=n.getX(t+1),l=n.getX(t+2)),r.x=i.getX(a),r.y=i.getY(a),r.z=i.getZ(a),s.x=i.getX(c),s.y=i.getY(c),s.z=i.getZ(c),o.x=i.getX(l),o.y=i.getY(l),o.z=i.getZ(l)}function Ud(e,t,n,i,r,s,o){const a=n.index,c=n.attributes.position;for(let n=e,l=t+e;n<l;n++)if(Fd(o,3*n,a,c),o.needsUpdate=!0,i(o,n,r,s))return!0;return!1}class Hd{constructor(e){this._getNewPrimitive=e,this._primitives=[]}getPrimitive(){const e=this._primitives;return 0===e.length?this._getNewPrimitive():e.pop()}releasePrimitive(e){this._primitives.push(e)}}function Vd(e,t){return 65535===t[e+15]}function Gd(e,t){return t[e+6]}function Wd(e,t){return t[e+14]}function jd(e){return e+8}function Jd(e,t){return t[e+6]}function Xd(e,t){return t[e+7]}const qd=new $,Zd=new Y,Yd=["x","y","z"];function Kd(e,t,n,i,r){let s=2*e,o=rp,a=sp,c=op;if(Vd(s,a)){!function(e,t,n,i,r,s){for(let o=i,a=i+r;o<a;o++)Nd(e,t,n,o,s)}(t,n,i,Gd(e,c),Wd(s,a),r)}else{const s=jd(e);tp(s,o,i,Zd)&&Kd(s,t,n,i,r);const a=Jd(e,c);tp(a,o,i,Zd)&&Kd(a,t,n,i,r)}}function Qd(e,t,n,i){let r=2*e,s=rp,o=sp,a=op;if(Vd(r,o)){return function(e,t,n,i,r){let s=1/0,o=null;for(let a=i,c=i+r;a<c;a++){const i=Nd(e,t,n,a);i&&i.distance<s&&(o=i,s=i.distance)}return o}(t,n,i,Gd(e,a),Wd(r,o))}{const r=Xd(e,a),o=Yd[r],c=i.direction[o]>=0;let l,u;c?(l=jd(e),u=Jd(e,a)):(l=Jd(e,a),u=jd(e));const h=tp(l,s,i,Zd)?Qd(l,t,n,i):null;if(h){const e=h.point[o];if(c?e<=s[u+r]:e>=s[u+r+3])return h}const d=tp(u,s,i,Zd)?Qd(u,t,n,i):null;return h&&d?h.distance<=d.distance?h:d:h||d||null}}const $d=function(){let e,t;const n=[],i=new Hd(()=>new $);return function(...r){e=i.getPrimitive(),t=i.getPrimitive(),n.push(e,t);const s=function n(i,r,s,o,a=null,c=0,l=0){function u(e){let t=2*e,n=sp,i=op;for(;!Vd(t,n);)t=2*(e=jd(e));return Gd(e,i)}function h(e){let t=2*e,n=sp,i=op;for(;!Vd(t,n);)t=2*(e=Jd(e,i));return Gd(e,i)+Wd(t,n)}let d=2*i,p=rp,f=sp,m=op;if(Vd(d,f)){const t=Gd(i,m),n=Wd(d,f);return pd(i,p,e),o(t,n,!1,l,c+i,e)}{const d=jd(i),g=Jd(i,m);let v,y,x,w,b=d,A=g;if(a&&(x=e,w=t,pd(b,p,x),pd(A,p,w),v=a(x),y=a(w),y<v)){b=g,A=d;const e=v;v=y,y=e,x=w}x||(x=e,pd(b,p,x));const S=Vd(2*b,f),_=s(x,S,v,l+1,c+b);let M;if(2===_){const e=u(b),t=h(b);M=o(e,t-e,!0,l+1,c+b,x)}else M=_&&n(b,r,s,o,a,c,l+1);if(M)return!0;w=t,pd(A,p,w);const T=Vd(2*A,f),E=s(w,T,y,l+1,c+A);let C;if(2===E){const e=u(A),t=h(A);C=o(e,t-e,!0,l+1,c+A,w)}else C=E&&n(A,r,s,o,a,c,l+1);return!!C}}(...r);i.releasePrimitive(e),i.releasePrimitive(t),n.pop(),n.pop();const o=n.length;return o>0&&(t=n[o-1],e=n[o-2]),s}}(),ep=function(){const e=new Cd,t=new Cd,n=new Ee,i=new Rd,r=new Rd;return function s(o,a,c,l,u=null){let h=2*o,d=rp,p=sp,f=op;null===u&&(c.boundingBox||c.computeBoundingBox(),i.set(c.boundingBox.min,c.boundingBox.max,l),u=i);if(!Vd(h,p)){const e=o+8,t=f[o+6];pd(e,d,qd);if(u.intersectsBox(qd)&&s(e,a,c,l,u))return!0;pd(t,d,qd);return!!(u.intersectsBox(qd)&&s(t,a,c,l,u))}{const i=a,s=i.index,u=i.attributes.position,m=c.index,g=c.attributes.position,v=Gd(o,f),y=Wd(h,p);if(n.copy(l).invert(),c.boundsTree){pd(o,d,r),r.matrix.copy(n),r.needsUpdate=!0;return c.boundsTree.shapecast({intersectsBounds:e=>r.intersectsBox(e),intersectsTriangle:e=>{e.a.applyMatrix4(l),e.b.applyMatrix4(l),e.c.applyMatrix4(l),e.needsUpdate=!0;for(let n=3*v,i=3*(y+v);n<i;n+=3)if(Fd(t,n,s,u),t.needsUpdate=!0,e.intersectsTriangle(t))return!0;return!1}})}for(let i=3*v,r=y+3*v;i<r;i+=3){Fd(e,i,s,u),e.a.applyMatrix4(n),e.b.applyMatrix4(n),e.c.applyMatrix4(n),e.needsUpdate=!0;for(let n=0,i=m.count;n<i;n+=3)if(Fd(t,n,m,g),t.needsUpdate=!0,e.intersectsTriangle(t))return!0}}}}();function tp(e,t,n,i){return pd(e,t,qd),n.intersectBox(qd,i)}const np=[];let ip,rp,sp,op;function ap(e){ip&&np.push(ip),ip=e,rp=new Float32Array(e),sp=new Uint16Array(e),op=new Uint32Array(e)}function cp(){ip=null,rp=null,sp=null,op=null,np.length&&ap(np.pop())}const lp=Symbol("skip tree generation"),up=new $,hp=new $,dp=new Ee,pp=new Rd,fp=new Rd,mp=new Y,gp=new Y,vp=new Y,yp=new Y,xp=new Y,wp=new $,bp=new Hd(()=>new Cd);class Ap{static serialize(e,t={}){if(t.isBufferGeometry)return console.warn("MeshBVH.serialize: The arguments for the function have changed. See documentation for new signature."),Ap.serialize(arguments[0],{cloneBuffers:void 0===arguments[2]||arguments[2]});t={cloneBuffers:!0,...t};const n=e.geometry,i=e._roots,r=n.getIndex();let s;return s=t.cloneBuffers?{roots:i.map(e=>e.slice()),index:r.array.slice()}:{roots:i,index:r.array},s}static deserialize(e,t,n={}){if("boolean"==typeof n)return console.warn("MeshBVH.deserialize: The arguments for the function have changed. See documentation for new signature."),Ap.deserialize(arguments[0],arguments[1],{setIndex:void 0===arguments[2]||arguments[2]});n={setIndex:!0,...n};const{index:i,roots:r}=e,s=new Ap(t,{...n,[lp]:!0});if(s._roots=r,n.setIndex){const n=t.getIndex();if(null===n){const n=new mt(e.index,1,!1);t.setIndex(n)}else n.array!==i&&(n.array.set(i),n.needsUpdate=!0)}return s}constructor(e,t={}){if(!e.isBufferGeometry)throw new Error("MeshBVH: Only BufferGeometries are supported.");if(e.index&&e.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.");if((t=Object.assign({strategy:0,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,[lp]:!1},t)).useSharedArrayBuffer&&"undefined"==typeof SharedArrayBuffer)throw new Error("MeshBVH: SharedArrayBuffer is not available.");this._roots=null,t[lp]||(this._roots=function(e,t){const n=Sd(e,t);let i,r,s;const o=[],a=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;for(let e=0;e<n.length;e++){const t=n[e];const u=new a(32*c(t));i=new Float32Array(u),r=new Uint32Array(u),s=new Uint16Array(u),l(0,t),o.push(u)}return o;function c(e){return e.count?1:1+c(e.left)+c(e.right)}function l(e,t){const n=e/4,o=e/2,a=!!t.count,c=t.boundingData;for(let e=0;e<6;e++)i[n+e]=c[e];if(a){const i=t.offset,a=t.count;return r[n+6]=i,s[o+14]=a,s[o+15]=65535,e+32}{const i=t.left,s=t.right,o=t.splitAxis;let a;if(a=l(e+32,i),a/4>Math.pow(2,32))throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return r[n+6]=a/4,a=l(a,s),r[n+7]=o,a}}}(e,t),!e.boundingBox&&t.setBoundingBox&&(e.boundingBox=this.getBoundingBox(new $))),this.geometry=e}refit(e=null){e&&Array.isArray(e)&&(e=new Set(e));const t=this.geometry,n=t.index.array,i=t.attributes.position,r=i.array,s=i.offset||0;let o,a,c,l,u=3;i.isInterleavedBufferAttribute&&(u=i.data.stride);let h=0;const d=this._roots;for(let e=0,t=d.length;e<t;e++)o=d[e],a=new Uint32Array(o),c=new Uint16Array(o),l=new Float32Array(o),p(0,h),h+=o.byteLength;function p(t,i,o=!1){const h=2*t;if(65535===c[h+15]){const e=a[t+6];let i=1/0,o=1/0,d=1/0,p=-1/0,f=-1/0,m=-1/0;for(let t=3*e,a=3*(e+c[h+14]);t<a;t++){const e=n[t]*u+s,a=r[e+0],c=r[e+1],l=r[e+2];a<i&&(i=a),a>p&&(p=a),c<o&&(o=c),c>f&&(f=c),l<d&&(d=l),l>m&&(m=l)}return(l[t+0]!==i||l[t+1]!==o||l[t+2]!==d||l[t+3]!==p||l[t+4]!==f||l[t+5]!==m)&&(l[t+0]=i,l[t+1]=o,l[t+2]=d,l[t+3]=p,l[t+4]=f,l[t+5]=m,!0)}{const n=t+8,r=a[t+6],s=n+i,c=r+i;let u=o,h=!1,d=!1;e?u||(h=e.has(s),d=e.has(c),u=!h&&!d):(h=!0,d=!0);const f=u||d;let m=!1;(u||h)&&(m=p(n,i,u));let g=!1;f&&(g=p(r,i,u));const v=m||g;if(v)for(let e=0;e<3;e++){const i=n+e,s=r+e,o=l[i],a=l[i+3],c=l[s],u=l[s+3];l[t+e]=o<c?o:c,l[t+e+3]=a>u?a:u}return v}}}traverse(e,t=0){const n=this._roots[t],i=new Uint32Array(n),r=new Uint16Array(n);!function t(s,o=0){const a=2*s,c=65535===r[a+15];if(c){const t=i[s+6],l=r[a+14];e(o,c,new Float32Array(n,4*s,6),t,l)}else{const r=s+8,a=i[s+6],l=i[s+7];e(o,c,new Float32Array(n,4*s,6),l)||(t(r,o+1),t(a,o+1))}}(0)}raycast(e,t=0){const n=this._roots,i=this.geometry,r=[],s=t.isMaterial,o=Array.isArray(t),a=i.groups,c=s?t.side:t;for(let s=0,l=n.length;s<l;s++){const l=o?t[a[s].materialIndex].side:c,u=r.length;if(ap(n[s]),Kd(0,i,l,e,r),cp(),o){const e=a[s].materialIndex;for(let t=u,n=r.length;t<n;t++)r[t].face.materialIndex=e}}return r}raycastFirst(e,t=0){const n=this._roots,i=this.geometry,r=t.isMaterial,s=Array.isArray(t);let o=null;const a=i.groups,c=r?t.side:t;for(let r=0,l=n.length;r<l;r++){const l=s?t[a[r].materialIndex].side:c;ap(n[r]);const u=Qd(0,i,l,e);cp(),null!=u&&(null==o||u.distance<o.distance)&&(o=u,s&&(u.face.materialIndex=a[r].materialIndex))}return o}intersectsGeometry(e,t){const n=this.geometry;let i=!1;for(const r of this._roots)if(ap(r),i=ep(0,n,e,t),cp(),i)break;return i}shapecast(e,t,n){const i=this.geometry;if(e instanceof Function){if(t){const e=t;t=(t,n,i,r)=>{const s=3*n;return e(t,s,s+1,s+2,i,r)}}e={boundsTraverseOrder:n,intersectsBounds:e,intersectsTriangle:t,intersectsRange:null},console.warn("MeshBVH: Shapecast function signature has changed and now takes an object of callbacks as a second argument. See docs for new signature.")}const r=bp.getPrimitive();let{boundsTraverseOrder:s,intersectsBounds:o,intersectsRange:a,intersectsTriangle:c}=e;if(a&&c){const e=a;a=(t,n,s,o,a)=>!!e(t,n,s,o,a)||Ud(t,n,i,c,s,o,r)}else a||(a=c?(e,t,n,s)=>Ud(e,t,i,c,n,s,r):(e,t,n)=>n);let l=!1,u=0;for(const e of this._roots){if(ap(e),l=$d(0,i,o,a,s,u),cp(),l)break;u+=e.byteLength}return bp.releasePrimitive(r),l}bvhcast(e,t,n){let{intersectsRanges:i,intersectsTriangles:r}=n;const s=this.geometry.index,o=this.geometry.attributes.position,a=e.geometry.index,c=e.geometry.attributes.position;dp.copy(t).invert();const l=bp.getPrimitive(),u=bp.getPrimitive();if(r){function h(e,n,i,h,d,p,f,m){for(let g=i,v=i+h;g<v;g++){Fd(u,3*g,a,c),u.a.applyMatrix4(t),u.b.applyMatrix4(t),u.c.applyMatrix4(t),u.needsUpdate=!0;for(let t=e,i=e+n;t<i;t++)if(Fd(l,3*t,s,o),l.needsUpdate=!0,r(l,u,t,g,d,p,f,m))return!0}return!1}if(i){const e=i;i=function(t,n,i,r,s,o,a,c){return!!e(t,n,i,r,s,o,a,c)||h(t,n,i,r,s,o,a,c)}}else i=h}this.getBoundingBox(hp),hp.applyMatrix4(t);const d=this.shapecast({intersectsBounds:e=>hp.intersectsBox(e),intersectsRange:(t,n,r,s,o,a)=>(up.copy(a),up.applyMatrix4(dp),e.shapecast({intersectsBounds:e=>up.intersectsBox(e),intersectsRange:(e,r,a,c,l)=>i(t,n,e,r,s,o,c,l)}))});return bp.releasePrimitive(l),bp.releasePrimitive(u),d}intersectsBox(e,t){return pp.set(e.min,e.max,t),pp.needsUpdate=!0,this.shapecast({intersectsBounds:e=>pp.intersectsBox(e),intersectsTriangle:e=>pp.intersectsTriangle(e)})}intersectsSphere(e){return this.shapecast({intersectsBounds:t=>e.intersectsBox(t),intersectsTriangle:t=>t.intersectsSphere(e)})}closestPointToGeometry(e,t,n={},i={},r=0,s=1/0){e.boundingBox||e.computeBoundingBox(),pp.set(e.boundingBox.min,e.boundingBox.max,t),pp.needsUpdate=!0;const o=this.geometry,a=o.attributes.position,c=o.index,l=e.attributes.position,u=e.index,h=bp.getPrimitive(),d=bp.getPrimitive();let p=gp,f=vp,m=null,g=null;i&&(m=yp,g=xp);let v=1/0,y=null,x=null;return dp.copy(t).invert(),fp.matrix.copy(dp),this.shapecast({boundsTraverseOrder:e=>pp.distanceToBox(e,Math.min(v,s)),intersectsBounds:(e,t,n)=>n<v&&n<s&&(t&&(fp.min.copy(e.min),fp.max.copy(e.max),fp.needsUpdate=!0),!0),intersectsRange:(n,i)=>{if(e.boundsTree)return e.boundsTree.shapecast({boundsTraverseOrder:e=>fp.distanceToBox(e,Math.min(v,s)),intersectsBounds:(e,t,n)=>n<v&&n<s,intersectsRange:(e,s)=>{for(let o=3*e,w=3*(e+s);o<w;o+=3){Fd(d,o,u,l),d.a.applyMatrix4(t),d.b.applyMatrix4(t),d.c.applyMatrix4(t),d.needsUpdate=!0;for(let e=3*n,t=3*(n+i);e<t;e+=3){Fd(h,e,c,a),h.needsUpdate=!0;const t=h.distanceToTriangle(d,p,m);if(t<v&&(f.copy(p),g&&g.copy(m),v=t,y=e/3,x=o/3),t<r)return!0}}}});for(let e=0,s=u?u.count:l.count;e<s;e+=3){Fd(d,e,u,l),d.a.applyMatrix4(t),d.b.applyMatrix4(t),d.c.applyMatrix4(t),d.needsUpdate=!0;for(let t=3*n,s=3*(n+i);t<s;t+=3){Fd(h,t,c,a),h.needsUpdate=!0;const n=h.distanceToTriangle(d,p,m);if(n<v&&(f.copy(p),g&&g.copy(m),v=n,y=t/3,x=e/3),n<r)return!0}}}}),bp.releasePrimitive(h),bp.releasePrimitive(d),v===1/0?null:(n.point?n.point.copy(f):n.point=f.clone(),n.distance=v,n.faceIndex=y,i&&(i.point?i.point.copy(g):i.point=g.clone(),i.point.applyMatrix4(dp),f.applyMatrix4(dp),i.distance=f.sub(i.point).length(),i.faceIndex=x),n)}closestPointToPoint(e,t={},n=0,i=1/0){const r=n*n,s=i*i;let o=1/0,a=null;if(this.shapecast({boundsTraverseOrder:t=>(mp.copy(e).clamp(t.min,t.max),mp.distanceToSquared(e)),intersectsBounds:(e,t,n)=>n<o&&n<s,intersectsTriangle:(t,n)=>{t.closestPointToPoint(e,mp);const i=e.distanceToSquared(mp);return i<o&&(gp.copy(mp),o=i,a=n),i<r}}),o===1/0)return null;const c=Math.sqrt(o);return t.point?t.point.copy(gp):t.point=gp.clone(),t.distance=c,t.faceIndex=a,t}getBoundingBox(e){e.makeEmpty();return this._roots.forEach(t=>{pd(0,new Float32Array(t),wp),e.union(wp)}),e}}const Sp=Ap.prototype.raycast;Ap.prototype.raycast=function(...e){if(e[0].isMesh){console.warn('MeshBVH: The function signature and results frame for "raycast" has changed. See docs for new signature.');const[t,n,i,r]=e;return Sp.call(this,i,t.material).forEach(e=>{(e=zd(e,t,n))&&r.push(e)}),r}return Sp.apply(this,e)};const _p=Ap.prototype.raycastFirst;Ap.prototype.raycastFirst=function(...e){if(e[0].isMesh){console.warn('MeshBVH: The function signature and results frame for "raycastFirst" has changed. See docs for new signature.');const[t,n,i]=e;return zd(_p.call(this,i,t.material),t,n)}return _p.apply(this,e)};const Mp=Ap.prototype.closestPointToPoint;Ap.prototype.closestPointToPoint=function(...e){if(e[0].isMesh){console.warn('MeshBVH: The function signature and results frame for "closestPointToPoint" has changed. See docs for new signature.'),e.unshift();const t=e[1],n={};return e[1]=n,Mp.apply(this,e),t&&t.copy(n.point),n.distance}return Mp.apply(this,e)};const Tp=Ap.prototype.closestPointToGeometry;Ap.prototype.closestPointToGeometry=function(...e){const t=e[2],n=e[3];if(t&&t.isVector3||n&&n.isVector3){console.warn('MeshBVH: The function signature and results frame for "closestPointToGeometry" has changed. See docs for new signature.');const i={},r={},s=e[1];return e[2]=i,e[3]=r,Tp.apply(this,e),t&&t.copy(i.point),n&&n.copy(r.point).applyMatrix4(s),i.distance}return Tp.apply(this,e)};const Ep=Ap.prototype.refit;Ap.prototype.refit=function(...e){const t=e[0],n=e[1];if(n&&(n instanceof Set||Array.isArray(n))){console.warn('MeshBVH: The function signature for "refit" has changed. See docs for new signature.');const e=new Set;n.forEach(t=>e.add(t)),t&&t.forEach(t=>e.add(t)),Ep.call(this,e)}else Ep.apply(this,e)},["intersectsGeometry","shapecast","intersectsBox","intersectsSphere"].forEach(e=>{const t=Ap.prototype[e];Ap.prototype[e]=function(...n){return(null===n[0]||n[0].isMesh)&&(n.shift(),console.warn(`MeshBVH: The function signature for "${e}" has changed and no longer takes Mesh. See docs for new signature.`)),t.apply(this,n)}});Wt.prototype.raycast;const Cp=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180];for(let e=0;e<256;e++)Cp[256+e]=Cp[e];const Rp=function(e){var t=1e4*Math.sin(e++);return t-Math.floor(t)};class Pp{constructor(e){this.worldSeed=e}generateTerrain(){const e=new ia;e.load("./assets/textures/sand.jpg",t=>{t.wrapS=t.wrapT=1e3,e.load("./assets/textures/grass.jpg",n=>{e.load("./assets/textures/stone.jpg",i=>{e.load("./assets/textures/snow.jpg",e=>{const r=this.generateBlendedMaterial([{texture:t},{texture:n,levels:[0,10,200,225]},{texture:i,levels:[200,225,275,300]},{texture:e,levels:[275,300,500,500]},{texture:i,glsl:"slope > 0.6 ? 0.0 : 1.0 - smoothstep(0.3, 0.6, slope) + 0.2"}]),s=this.terrain({material:r,seed:this.worldSeed});VIRTUAL_ENVIRONMENT.terrainController.terrain=s,MAIN_SCENE.add(s),VIRTUAL_ENVIRONMENT.terrainController.generateCollider(MAIN_SCENE)})})})})}terrain(e){const t={after:null,easing:function(e){return e},heightmap:this.diamondSquare,material:null,maxHeight:350,minHeight:-400,optimization:0,frequency:2.5,steps:8,stretch:!0,turbulent:!1,useBufferGeometry:!1,xSegments:127,xSize:4096,ySegments:127,ySize:4096,_mesh:null,seed:100};for(let n in t)e[n]=void 0===e[n]?t[n]:e[n];e.material=e.material||new dt({color:15623731});const n=new dn(e.xSize,e.ySize,e.xSegments,e.ySegments);n.rotateX(-Math.PI/2);var i=new Wt(n,e.material);return i.castShadow=!0,i.receiveShadow=!0,"function"==typeof e.heightmap?e.heightmap(i.geometry.attributes.position.array,e):console.warn("An invalid value was passed for `options.heightmap`: "+e.heightmap),this.normalize(i,e),i}diamondSquare(e,t){var n,i,r=Math.pow(2,Math.ceil(Math.log(Math.max(t.xSegments,t.ySegments)+1)/Math.log(2))),s=r+1,o=[],a=1e3,c=t.xSegments+1,l=t.ySegments+1;for(n=0;n<=r;n++)o[n]=new Float64Array(r+1);for(var u=r;u>=2;u/=2){var h,d,p,f,m=Math.round(.5*u),g=Math.round(u);for(a/=2,h=0;h<r;h+=g)for(d=0;d<r;d+=g)f=Rp(t.seed+h+d)*a*2-a,p=o[h][d]+o[h+g][d]+o[h][d+g]+o[h+g][d+g],p*=.25,o[h+m][d+m]=p+f;for(h=0;h<r;h+=m)for(d=(h+m)%u;d<r;d+=u)f=Rp(t.seed+h+100*d)*a*2-a,p=o[(h-m+s)%s][d]+o[(h+m)%s][d]+o[h][(d+m)%s]+o[h][(d-m+s)%s],p*=.25,p+=f,o[h][d]=p,0===h&&(o[r][d]=p),0===d&&(o[h][r]=p)}let v=1;for(n=0;n<c;n++)for(i=0;i<l;i++)e[v]+=o[n][i],v+=3}toArray2D(e,t){var n,i,r=new Array(t.xSegments+1),s=t.xSegments+1,o=t.ySegments+1;for(n=0;n<s;n++)for(r[n]=new Float64Array(t.ySegments+1),i=0;i<o;i++)r[n][i]=e[i*s+n].z;return r}fromHeightmap(e,t){var n=document.createElement("canvas"),i=n.getContext("2d"),r=t.ySegments+1,s=t.xSegments+1,o=t.maxHeight-t.minHeight;n.width=s,n.height=r,i.drawImage(t.heightmap,0,0,n.width,n.height);for(var a=i.getImageData(0,0,n.width,n.height).data,c=0;c<r;c++)for(var l=0;l<s;l++){var u=c*s+l,h=4*u;e[u].z=(a[h]+a[h+1]+a[h+2])/765*o+t.minHeight}}fromArray1D(e,t){for(var n=0,i=Math.min(e.length,t.length);n<i;n++)e[n].z=t[n]}normalize(e,t){t.steps>1&&(this.step(e.geometry.attributes.position.array,t.steps),this.smooth(e.geometry.attributes.position.array,t,3)),this.clamp(e.geometry.attributes.position.array,t),e.geometry.verticesNeedUpdate=!0,e.geometry.normalsNeedUpdate=!0,e.geometry.computeBoundingSphere(),e.geometry.computeVertexNormals()}clamp(e,t){for(var n=1/0,i=e.length/3,r=0;r<i;r++)e[3*r+1]<n&&(n=e[3*r+1]),e[3*r+1]>50&&(e[3*r+1]=50);if(n<0){n=Math.abs(n);for(r=0;r<i;r++)e[3*r+1]+=n}}step(e,t){for(var n=e.length/3,i=Math.floor(n/t),r=new Array(n),s=new Array(t),o=0;o<n;o++)r[o]=e[3*o+1];r.sort((function(e,t){return e-t}));for(o=0;o<t;o++){for(var a=r.slice(o*i,(o+1)*i),c=0,l=a.length,u=0;u<l;u++)c+=a[u];s[o]={min:a[0],max:a[a.length-1],avg:c/l}}for(o=0;o<n;o++){var h=e[3*o+1];for(u=0;u<t;u++)if(h>=s[u].min&&h<=s[u].max){e[3*o+1]=s[u].avg;break}}}smooth(e,t,n){for(var i=new Float64Array(e.length),r=0,s=t.xSegments+1,o=t.ySegments+1;r<s;r++)for(var a=0;a<o;a++){for(var c=0,l=0,u=-1;u<=1;u++)for(var h=-1;h<=1;h++){var d=(a+u)*s+r+h;void 0!==e[d]&&r+h>=0&&a+u>=0&&r+h<s&&a+u<o&&(c+=e[3*d+1],l++)}i[a*s+r]=c/l}for(var p=1/(1+(n=n||0)),f=0,m=e.length;f<m;f++)e[3*f+1]=(i[f]+e[3*f+1]*n)*p}generateBlendedMaterial(e,t){function n(e){return e===(0|e)?e+".0":e+""}for(var i="",r="",s=e[0].texture.repeat,o=e[0].texture.offset,a=0,c=e.length;a<c;a++)if(e[a].texture.wrapS=e[a].wrapT=1e3,e[a].texture.needsUpdate=!0,i+="uniform sampler2D texture_"+a+";\n",0!==a){var l=e[a].levels,u=e[a].glsl,h=void 0!==l,d=e[a].texture.repeat,p=e[a].texture.offset;if(h){l[1]-l[0]<1&&(l[0]-=1),l[3]-l[2]<1&&(l[3]+=1);for(var f=0;f<l.length;f++)l[f]=n(l[f])}var m=h?"1.0 - smoothstep("+l[0]+", "+l[1]+", vPosition.y) + smoothstep("+l[2]+", "+l[3]+",vPosition.y )":u;r+="        color = mix( texture2D( texture_"+a+", MyvUv * vec2( "+n(d.x)+", "+n(d.y)+" ) + vec2( "+n(p.x)+", "+n(p.y)+" ) ), color, max(min("+m+", 1.0), 0.0));\n"}var g="float slope = acos(max(min(dot(myNormal, vec3(0.0, 1.0, 0.0)), 1.0), -1.0));\n    diffuseColor = vec4( diffuse, opacity );\n    vec4 color = texture2D( texture_0, MyvUv * vec2( "+n(s.x)+", "+n(s.y)+" ) + vec2( "+n(o.x)+", "+n(o.y)+" ) ); // base\n"+r+"    diffuseColor = color;\n",v=i+"\nvarying vec2 MyvUv;\nvarying vec3 vPosition;\nvarying vec3 myNormal;\n",y=t||new ko;return y.onBeforeCompile=function(t){t.vertexShader=t.vertexShader.replace("#include <common>","varying vec2 MyvUv;\nvarying vec3 vPosition;\nvarying vec3 myNormal;\n#include <common>"),t.vertexShader=t.vertexShader.replace("#include <uv_vertex>","MyvUv = uv;\nvPosition = position;\nmyNormal = normal;\n#include <uv_vertex>"),t.fragmentShader=t.fragmentShader.replace("#include <common>",v+"\n#include <common>"),t.fragmentShader=t.fragmentShader.replace("#include <map_fragment>",g);for(var n=0,i=e.length;n<i;n++)t.uniforms["texture_"+n]={type:"t",value:e[n].texture}},y}}class Lp{constructor(e){this.FBXLoader=new jh(e),this.GLTFLoader=new hc(e),this.terrain=new Qe,this.collider,this.bloomScene=new Wr,this.geometries=[]}generateTerrain(e){this.terrainGenerator=new Pp(e),this.terrain=this.terrainGenerator.generateTerrain()}loadTerrain(e,t,n,i,r,s,o){switch(s){case"fbx":this.FBXLoader.load(e,e=>{this.handleLoadedTerrain(e,t,n,i,r,o)});break;case"glb":this.GLTFLoader.load(e,e=>{this.handleLoadedTerrain(e.scene,t,n,i,r,o)})}}handleLoadedTerrain(e,t,n,i,r,s){this.terrain=e,this.terrain.position.set(n,i,r),this.terrain.scale.set(s,s,s),this.terrain.traverse(e=>{if(e.isMesh){e.castShadow=!0,e.receiveShadow=!0,e.material.roughness=1,e.material.map&&(e.material.map.anisotropy=16,e.material.map.needsUpdate=!0);const t=new Wt(e.geometry,e.material);e.getWorldPosition(t.position),e.material.emissive&&(e.material.emissive.r>0||e.material.emissive.g>0||e.material.color.b>0)&&this.bloomScene.attach(t)}e.isLight&&e.parent.remove(e)}),t.add(this.terrain),this.generateCollider(t),MAIN_SCENE.buildInteractives()}generateCollider(e){this.terrain.traverse(e=>{if(e.geometry&&e.visible){const t=e.geometry.clone();t.applyMatrix4(e.matrixWorld);for(const e in t.attributes)"position"!==e&&t.deleteAttribute(e);this.geometries.push(t)}});const t=function(e,t=!1){const n=null!==e[0].index,i=new Set(Object.keys(e[0].attributes)),r=new Set(Object.keys(e[0].morphAttributes)),s={},o={},a=e[0].morphTargetsRelative,c=new Tt;let l=0;for(let u=0;u<e.length;++u){const h=e[u];let d=0;if(n!==(null!==h.index))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(const e in h.attributes){if(!i.has(e))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+'. All geometries must have compatible attributes; make sure "'+e+'" attribute exists among all geometries, or in none of them.'),null;void 0===s[e]&&(s[e]=[]),s[e].push(h.attributes[e]),d++}if(d!==i.size)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+". Make sure all geometries have the same number of attributes."),null;if(a!==h.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(const e in h.morphAttributes){if(!r.has(e))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+".  .morphAttributes must be consistent throughout all geometries."),null;void 0===o[e]&&(o[e]=[]),o[e].push(h.morphAttributes[e])}if(c.userData.mergedUserData=c.userData.mergedUserData||[],c.userData.mergedUserData.push(h.userData),t){let e;if(n)e=h.index.count;else{if(void 0===h.attributes.position)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+". The geometry must have either an index or a position attribute"),null;e=h.attributes.position.count}c.addGroup(l,e,u),l+=e}}if(n){let t=0;const n=[];for(let i=0;i<e.length;++i){const r=e[i].index;for(let e=0;e<r.count;++e)n.push(r.getX(e)+t);t+=e[i].attributes.position.count}c.setIndex(n)}for(const e in s){const t=ud(s[e]);if(!t)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+e+" attribute."),null;c.setAttribute(e,t)}for(const e in o){const t=o[e][0].length;if(0===t)break;c.morphAttributes=c.morphAttributes||{},c.morphAttributes[e]=[];for(let n=0;n<t;++n){const t=[];for(let i=0;i<o[e].length;++i)t.push(o[e][i][n]);const i=ud(t);if(!i)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+e+" morphAttribute."),null;c.morphAttributes[e].push(i)}}return c}(this.geometries,!1);t.boundsTree=new Ap(t,{lazyGeneration:!1}),this.collider=new Wt(t),this.collider.bvh=t.boundsTree,this.collider.material.wireframe=!0,this.collider.material.opacity=.5,this.collider.material.transparent=!0,this.collider.visible=!1,e.add(this.collider)}toggleViewCollider(){this.collider.visible=!this.collider.visible}newSolidGeometriesFromSource(e,t,n,i,r,s){this.GLTFLoader.load(t,t=>{setTimeout(()=>{t.scene.scale.set(s,s,s),t.scene.position.set(n,i,r),e.add(t.scene),t.scene.traverse(e=>{if(e.geometry&&e.visible&&e.position){const t=e.geometry.clone();t.scale(s,s,s),t.translate(n,i,r),e.updateMatrixWorld(),t.applyMatrix4(e.matrixWorld);for(const e in t.attributes)"position"!==e&&t.deleteAttribute(e);this.geometries.push(t)}}),this.generateCollider(e)},2e3)})}}var Dp=n(4),Ip=n(5);function kp(e,t,n,i){Object.defineProperty(e,t,{get:n,set:i,enumerable:!0,configurable:!0})}var Op=Ip.default||Ip,Bp=new(function(){function e(){this.isIOS=["iPad","iPhone","iPod"].includes(navigator.platform),this.supportedBrowsers=["firefox","chrome","safari"],this.minFirefoxVersion=59,this.minChromeVersion=72,this.minSafariVersion=605}return e.prototype.isWebRTCSupported=function(){return"undefined"!=typeof RTCPeerConnection},e.prototype.isBrowserSupported=function(){var e=this.getBrowser(),t=this.getVersion();return!!this.supportedBrowsers.includes(e)&&("chrome"===e?t>=this.minChromeVersion:"firefox"===e?t>=this.minFirefoxVersion:"safari"===e&&(!this.isIOS&&t>=this.minSafariVersion))},e.prototype.getBrowser=function(){return Op.browserDetails.browser},e.prototype.getVersion=function(){return Op.browserDetails.version||0},e.prototype.isUnifiedPlanSupported=function(){var e,t=this.getBrowser(),n=Op.browserDetails.version||0;if("chrome"===t&&n<this.minChromeVersion)return!1;if("firefox"===t&&n>=this.minFirefoxVersion)return!0;if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;var i=!1;try{(e=new RTCPeerConnection).addTransceiver("audio"),i=!0}catch(e){}finally{e&&e.close()}return i},e.prototype.toString=function(){return"Supports:\n    browser:".concat(this.getBrowser(),"\n    version:").concat(this.getVersion(),"\n    isIOS:").concat(this.isIOS,"\n    isWebRTCSupported:").concat(this.isWebRTCSupported(),"\n    isBrowserSupported:").concat(this.isBrowserSupported(),"\n    isUnifiedPlanSupported:").concat(this.isUnifiedPlanSupported())},e}()),Np={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:["turn:eu-0.turn.peerjs.com:3478","turn:us-0.turn.peerjs.com:3478"],username:"peerjs",credential:"peerjsp"}],sdpSemantics:"unified-plan"},zp=new(function(){function e(){this.CLOUD_HOST="0.peerjs.com",this.CLOUD_PORT=443,this.chunkedBrowsers={Chrome:1,chrome:1},this.chunkedMTU=16300,this.defaultConfig=Np,this.browser=Bp.getBrowser(),this.browserVersion=Bp.getVersion(),this.supports=function(){var e,t={browser:Bp.isBrowserSupported(),webRTC:Bp.isWebRTCSupported(),audioVideo:!1,data:!1,binaryBlob:!1,reliable:!1};if(!t.webRTC)return t;try{e=new RTCPeerConnection(Np),t.audioVideo=!0;var n=void 0;try{n=e.createDataChannel("_PEERJSTEST",{ordered:!0}),t.data=!0,t.reliable=!!n.ordered;try{n.binaryType="blob",t.binaryBlob=!Bp.isIOS}catch(e){}}catch(e){}finally{n&&n.close()}}catch(e){}finally{e&&e.close()}return t}(),this.pack=Dp.pack,this.unpack=Dp.unpack,this._dataCount=1}return e.prototype.noop=function(){},e.prototype.validateId=function(e){return!e||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(e)},e.prototype.chunk=function(e){for(var t=[],n=e.size,i=Math.ceil(n/zp.chunkedMTU),r=0,s=0;s<n;){var o=Math.min(n,s+zp.chunkedMTU),a=e.slice(s,o),c={__peerData:this._dataCount,n:r,data:a,total:i};t.push(c),s=o,r++}return this._dataCount++,t},e.prototype.blobToArrayBuffer=function(e,t){var n=new FileReader;return n.onload=function(e){e.target&&t(e.target.result)},n.readAsArrayBuffer(e),n},e.prototype.binaryStringToArrayBuffer=function(e){for(var t=new Uint8Array(e.length),n=0;n<e.length;n++)t[n]=255&e.charCodeAt(n);return t.buffer},e.prototype.randomToken=function(){return Math.random().toString(36).slice(2)},e.prototype.isSecure=function(){return"https:"===location.protocol},e}()),Fp={};kp(Fp,"Peer",()=>Hf,e=>Hf=e);var Up,Hp=Object.prototype.hasOwnProperty,Vp="~";function Gp(){}function Wp(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function jp(e,t,n,i,r){if("function"!=typeof n)throw new TypeError("The listener must be a function");var s=new Wp(n,i||e,r),o=Vp?Vp+t:t;return e._events[o]?e._events[o].fn?e._events[o]=[e._events[o],s]:e._events[o].push(s):(e._events[o]=s,e._eventsCount++),e}function Jp(e,t){0==--e._eventsCount?e._events=new Gp:delete e._events[t]}function Xp(){this._events=new Gp,this._eventsCount=0}Object.create&&(Gp.prototype=Object.create(null),(new Gp).__proto__||(Vp=!1)),Xp.prototype.eventNames=function(){var e,t,n=[];if(0===this._eventsCount)return n;for(t in e=this._events)Hp.call(e,t)&&n.push(Vp?t.slice(1):t);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},Xp.prototype.listeners=function(e){var t=Vp?Vp+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var i=0,r=n.length,s=new Array(r);i<r;i++)s[i]=n[i].fn;return s},Xp.prototype.listenerCount=function(e){var t=Vp?Vp+e:e,n=this._events[t];return n?n.fn?1:n.length:0},Xp.prototype.emit=function(e,t,n,i,r,s){var o=Vp?Vp+e:e;if(!this._events[o])return!1;var a,c,l=this._events[o],u=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),u){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,n),!0;case 4:return l.fn.call(l.context,t,n,i),!0;case 5:return l.fn.call(l.context,t,n,i,r),!0;case 6:return l.fn.call(l.context,t,n,i,r,s),!0}for(c=1,a=new Array(u-1);c<u;c++)a[c-1]=arguments[c];l.fn.apply(l.context,a)}else{var h,d=l.length;for(c=0;c<d;c++)switch(l[c].once&&this.removeListener(e,l[c].fn,void 0,!0),u){case 1:l[c].fn.call(l[c].context);break;case 2:l[c].fn.call(l[c].context,t);break;case 3:l[c].fn.call(l[c].context,t,n);break;case 4:l[c].fn.call(l[c].context,t,n,i);break;default:if(!a)for(h=1,a=new Array(u-1);h<u;h++)a[h-1]=arguments[h];l[c].fn.apply(l[c].context,a)}}return!0},Xp.prototype.on=function(e,t,n){return jp(this,e,t,n,!1)},Xp.prototype.once=function(e,t,n){return jp(this,e,t,n,!0)},Xp.prototype.removeListener=function(e,t,n,i){var r=Vp?Vp+e:e;if(!this._events[r])return this;if(!t)return Jp(this,r),this;var s=this._events[r];if(s.fn)s.fn!==t||i&&!s.once||n&&s.context!==n||Jp(this,r);else{for(var o=0,a=[],c=s.length;o<c;o++)(s[o].fn!==t||i&&!s[o].once||n&&s[o].context!==n)&&a.push(s[o]);a.length?this._events[r]=1===a.length?a[0]:a:Jp(this,r)}return this},Xp.prototype.removeAllListeners=function(e){var t;return e?(t=Vp?Vp+e:e,this._events[t]&&Jp(this,t)):(this._events=new Gp,this._eventsCount=0),this},Xp.prototype.off=Xp.prototype.removeListener,Xp.prototype.addListener=Xp.prototype.on,Xp.prefixed=Vp,Xp.EventEmitter=Xp,Up=Xp;var qp={};kp(qp,"LogLevel",()=>Zp,e=>Zp=e),kp(qp,"default",()=>rf,e=>rf=e);var Zp,Yp=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,r,s=n.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(i=s.next()).done;)o.push(i.value)}catch(e){r={error:e}}finally{try{i&&!i.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}return o},Kp=function(e,t,n){if(n||2===arguments.length)for(var i,r=0,s=t.length;r<s;r++)!i&&r in t||(i||(i=Array.prototype.slice.call(t,0,r)),i[r]=t[r]);return e.concat(i||Array.prototype.slice.call(t))};!function(e){e[e.Disabled=0]="Disabled",e[e.Errors=1]="Errors",e[e.Warnings=2]="Warnings",e[e.All=3]="All"}(Zp||(Zp={}));var Qp,$p,ef,tf,nf,rf=new(function(){function e(){this._logLevel=Zp.Disabled}return Object.defineProperty(e.prototype,"logLevel",{get:function(){return this._logLevel},set:function(e){this._logLevel=e},enumerable:!1,configurable:!0}),e.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._logLevel>=Zp.All&&this._print.apply(this,Kp([Zp.All],Yp(e),!1))},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._logLevel>=Zp.Warnings&&this._print.apply(this,Kp([Zp.Warnings],Yp(e),!1))},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._logLevel>=Zp.Errors&&this._print.apply(this,Kp([Zp.Errors],Yp(e),!1))},e.prototype.setLogFunction=function(e){this._print=e},e.prototype._print=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var i=Kp(["PeerJS: "],Yp(t),!1);for(var r in i)i[r]instanceof Error&&(i[r]="("+i[r].name+") "+i[r].message);e>=Zp.All?console.log.apply(console,Kp([],Yp(i),!1)):e>=Zp.Warnings?console.warn.apply(console,Kp(["WARNING"],Yp(i),!1)):e>=Zp.Errors&&console.error.apply(console,Kp(["ERROR"],Yp(i),!1))},e}()),sf={};kp(sf,"Socket",()=>df,e=>df=e),function(e){e.Data="data",e.Media="media"}(Qp||(Qp={})),function(e){e.BrowserIncompatible="browser-incompatible",e.Disconnected="disconnected",e.InvalidID="invalid-id",e.InvalidKey="invalid-key",e.Network="network",e.PeerUnavailable="peer-unavailable",e.SslUnavailable="ssl-unavailable",e.ServerError="server-error",e.SocketError="socket-error",e.SocketClosed="socket-closed",e.UnavailableID="unavailable-id",e.WebRTC="webrtc"}($p||($p={})),function(e){e.Binary="binary",e.BinaryUTF8="binary-utf8",e.JSON="json"}(ef||(ef={})),function(e){e.Message="message",e.Disconnected="disconnected",e.Error="error",e.Close="close"}(tf||(tf={})),function(e){e.Heartbeat="HEARTBEAT",e.Candidate="CANDIDATE",e.Offer="OFFER",e.Answer="ANSWER",e.Open="OPEN",e.Error="ERROR",e.IdTaken="ID-TAKEN",e.InvalidKey="INVALID-KEY",e.Leave="LEAVE",e.Expire="EXPIRE"}(nf||(nf={}));var of;of=JSON.parse('{"name":"peerjs","version":"1.4.6","keywords":["peerjs","webrtc","p2p","rtc"],"description":"PeerJS client","homepage":"https://peerjs.com","bugs":{"url":"https://github.com/peers/peerjs/issues"},"repository":{"type":"git","url":"https://github.com/peers/peerjs"},"license":"MIT","contributors":["Michelle Bu <michelle@michellebu.com>","afrokick <devbyru@gmail.com>","ericz <really.ez@gmail.com>","Jairo <kidandcat@gmail.com>","Jonas Gloning <34194370+jonasgloning@users.noreply.github.com>","Jairo Caro-Accino Viciana <jairo@galax.be>","Carlos Caballero <carlos.caballero.gonzalez@gmail.com>","hc <hheennrryy@gmail.com>","Muhammad Asif <capripio@gmail.com>","PrashoonB <prashoonbhattacharjee@gmail.com>","Harsh Bardhan Mishra <47351025+HarshCasper@users.noreply.github.com>","akotynski <aleksanderkotbury@gmail.com>","lmb <i@lmb.io>","Jairooo <jairocaro@msn.com>","Moritz Stückler <moritz.stueckler@gmail.com>","Simon <crydotsnakegithub@gmail.com>","Denis Lukov <denismassters@gmail.com>","Philipp Hancke <fippo@andyet.net>","Hans Oksendahl <hansoksendahl@gmail.com>","Jess <jessachandler@gmail.com>","khankuan <khankuan@gmail.com>","DUODVK <kurmanov.work@gmail.com>","XiZhao <kwang1imsa@gmail.com>","Matthias Lohr <matthias@lohr.me>","=frank tree <=frnktrb@googlemail.com>","Andre Eckardt <aeckardt@outlook.com>","Chris Cowan <agentme49@gmail.com>","Alex Chuev <alex@chuev.com>","alxnull <alxnull@e.mail.de>","Yemel Jardi <angel.jardi@gmail.com>","Ben Parnell <benjaminparnell.94@gmail.com>","Benny Lichtner <bennlich@gmail.com>","fresheneesz <bitetrudpublic@gmail.com>","bob.barstead@exaptive.com <bob.barstead@exaptive.com>","chandika <chandika@gmail.com>","emersion <contact@emersion.fr>","Christopher Van <cvan@users.noreply.github.com>","eddieherm <edhermoso@gmail.com>","Eduardo Pinho <enet4mikeenet@gmail.com>","Evandro Zanatta <ezanatta@tray.net.br>","Gardner Bickford <gardner@users.noreply.github.com>","Gian Luca <gianluca.cecchi@cynny.com>","PatrickJS <github@gdi2290.com>","jonnyf <github@jonathanfoss.co.uk>","Hizkia Felix <hizkifw@gmail.com>","Hristo Oskov <hristo.oskov@gmail.com>","Isaac Madwed <i.madwed@gmail.com>","Ilya Konanykhin <ilya.konanykhin@gmail.com>","jasonbarry <jasbarry@me.com>","Jonathan Burke <jonathan.burke.1311@googlemail.com>","Josh Hamit <josh.hamit@gmail.com>","Jordan Austin <jrax86@gmail.com>","Joel Wetzell <jwetzell@yahoo.com>","xizhao <kevin.wang@cloudera.com>","Alberto Torres <kungfoobar@gmail.com>","Jonathan Mayol <mayoljonathan@gmail.com>","Jefferson Felix <me@jsfelix.dev>","Rolf Erik Lekang <me@rolflekang.com>","Kevin Mai-Husan Chia <mhchia@users.noreply.github.com>","Pepijn de Vos <pepijndevos@gmail.com>","JooYoung <qkdlql@naver.com>","Tobias Speicher <rootcommander@gmail.com>","Steve Blaurock <sblaurock@gmail.com>","Kyrylo Shegeda <shegeda@ualberta.ca>","Diwank Singh Tomer <singh@diwank.name>","Sören Balko <Soeren.Balko@gmail.com>","Arpit Solanki <solankiarpit1997@gmail.com>","Yuki Ito <yuki@gnnk.net>","Artur Zayats <zag2art@gmail.com>"],"funding":{"type":"opencollective","url":"https://opencollective.com/peer"},"collective":{"type":"opencollective","url":"https://opencollective.com/peer"},"files":["dist/*"],"type":"module","sideEffects":["lib/global.ts","lib/supports.ts"],"main":"dist/bundler.cjs","module":"dist/bundler.mjs","browser-minified":"dist/peerjs.min.cjs","browser-unminified":"dist/peerjs.cjs","types":"dist/types.d.ts","engines":{"node":">= 10"},"targets":{"types":{"source":"lib/exports.ts"},"main":{"source":"lib/exports.ts","sourceMap":{"inlineSources":true}},"module":{"source":"lib/exports.ts","includeNodeModules":["eventemitter3"],"sourceMap":{"inlineSources":true}},"browser-minified":{"includeNodeModules":true,"context":"browser","optimize":true,"engines":{"browsers":"cover 99%, not dead"},"source":"lib/global.ts"},"browser-unminified":{"includeNodeModules":true,"context":"browser","optimize":false,"engines":{"browsers":"cover 99%, not dead"},"source":"lib/global.ts"}},"scripts":{"contributors":"git-authors-cli --print=false && prettier --write package.json && git add package.json package-lock.json && git commit -m \\"chore(contributors): update and sort contributors list\\"","check":"tsc --noEmit","watch":"parcel watch","build":"rm -rf dist && parcel build && cp dist/peerjs.cjs dist/peerjs.js && cp dist/peerjs.min.cjs dist/peerjs.min.js","prepublishOnly":"npm run build","test":"mocha -r ts-node/register -r jsdom-global/register test/**/*.ts","format":"prettier --write .","semantic-release":"semantic-release"},"devDependencies":{"@parcel/config-default":"^2.5.0","@parcel/packager-ts":"^2.5.0","@parcel/transformer-typescript-tsc":"^2.5.0","@parcel/transformer-typescript-types":"^2.5.0","@semantic-release/changelog":"^6.0.1","@semantic-release/git":"^10.0.1","@types/chai":"^4.3.0","@types/mocha":"^9.1.0","@types/node":"^17.0.18","chai":"^4.3.6","git-authors-cli":"^1.0.40","jsdom":"^19.0.0","jsdom-global":"^3.0.2","mocha":"^9.2.0","mock-socket":"8.0.5","parcel":"^2.5.0","parcel-transformer-tsc-sourcemaps":"^1.0.2","prettier":"^2.6.2","semantic-release":"^19.0.2","standard":"^16.0.4","ts-node":"^10.5.0","typescript":"^4.5.5"},"dependencies":{"@swc/helpers":"^0.3.13","eventemitter3":"^4.0.7","peerjs-js-binarypack":"1.0.1","webrtc-adapter":"^7.7.1"}}');var af,cf=(af=function(e,t){return(af=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}af(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),lf=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,r,s=n.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(i=s.next()).done;)o.push(i.value)}catch(e){r={error:e}}finally{try{i&&!i.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}return o},uf=function(e,t,n){if(n||2===arguments.length)for(var i,r=0,s=t.length;r<s;r++)!i&&r in t||(i||(i=Array.prototype.slice.call(t,0,r)),i[r]=t[r]);return e.concat(i||Array.prototype.slice.call(t))},hf=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},df=function(e){function t(t,n,i,r,s,o){void 0===o&&(o=5e3);var a=e.call(this)||this;a.pingInterval=o,a._disconnected=!0,a._messagesQueue=[];var c=t?"wss://":"ws://";return a._baseUrl=c+n+":"+i+r+"peerjs?key="+s,a}return cf(t,e),t.prototype.start=function(e,t){var n=this;this._id=e;var i="".concat(this._baseUrl,"&id=").concat(e,"&token=").concat(t);!this._socket&&this._disconnected&&(this._socket=new WebSocket(i+"&version="+of.version),this._disconnected=!1,this._socket.onmessage=function(e){var t;try{t=JSON.parse(e.data),qp.default.log("Server message received:",t)}catch(t){return void qp.default.log("Invalid server message",e.data)}n.emit(tf.Message,t)},this._socket.onclose=function(e){n._disconnected||(qp.default.log("Socket closed.",e),n._cleanup(),n._disconnected=!0,n.emit(tf.Disconnected))},this._socket.onopen=function(){n._disconnected||(n._sendQueuedMessages(),qp.default.log("Socket open"),n._scheduleHeartbeat())})},t.prototype._scheduleHeartbeat=function(){var e=this;this._wsPingTimer=setTimeout((function(){e._sendHeartbeat()}),this.pingInterval)},t.prototype._sendHeartbeat=function(){if(this._wsOpen()){var e=JSON.stringify({type:nf.Heartbeat});this._socket.send(e),this._scheduleHeartbeat()}else qp.default.log("Cannot send heartbeat, because socket closed")},t.prototype._wsOpen=function(){return!!this._socket&&1===this._socket.readyState},t.prototype._sendQueuedMessages=function(){var e,t,n=uf([],lf(this._messagesQueue),!1);this._messagesQueue=[];try{for(var i=hf(n),r=i.next();!r.done;r=i.next()){var s=r.value;this.send(s)}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}},t.prototype.send=function(e){if(!this._disconnected)if(this._id)if(e.type){if(this._wsOpen()){var t=JSON.stringify(e);this._socket.send(t)}}else this.emit(tf.Error,"Invalid message");else this._messagesQueue.push(e)},t.prototype.close=function(){this._disconnected||(this._cleanup(),this._disconnected=!0)},t.prototype._cleanup=function(){this._socket&&(this._socket.onopen=this._socket.onmessage=this._socket.onclose=null,this._socket.close(),this._socket=void 0),clearTimeout(this._wsPingTimer)},t}(Up.EventEmitter),pf={};kp(pf,"MediaConnection",()=>Mf,e=>Mf=e);var ff={};kp(ff,"Negotiator",()=>yf,e=>yf=e);var mf=function(){return(mf=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},gf=function(e,t,n,i){return new(n||(n=Promise))((function(r,s){function o(e){try{c(i.next(e))}catch(e){s(e)}}function a(e){try{c(i.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((i=i.apply(e,t||[])).next())}))},vf=function(e,t){var n,i,r,s,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,i&&(r=2&s[0]?i.return:s[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,s[1])).done)return r;switch(i=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,i=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(r=o.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){o.label=s[1];break}if(6===s[0]&&o.label<r[1]){o.label=r[1],r=s;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(s);break}r[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],i=0}finally{n=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}},yf=function(){function e(e){this.connection=e}return e.prototype.startConnection=function(e){var t=this._startPeerConnection();if(this.connection.peerConnection=t,this.connection.type===Qp.Media&&e._stream&&this._addTracksToConnection(e._stream,t),e.originator){if(this.connection.type===Qp.Data){var n=this.connection,i={ordered:!!e.reliable},r=t.createDataChannel(n.label,i);n.initialize(r)}this._makeOffer()}else this.handleSDP("OFFER",e.sdp)},e.prototype._startPeerConnection=function(){qp.default.log("Creating RTCPeerConnection.");var e=new RTCPeerConnection(this.connection.provider.options.config);return this._setupListeners(e),e},e.prototype._setupListeners=function(e){var t=this,n=this.connection.peer,i=this.connection.connectionId,r=this.connection.type,s=this.connection.provider;qp.default.log("Listening for ICE candidates."),e.onicecandidate=function(e){e.candidate&&e.candidate.candidate&&(qp.default.log("Received ICE candidates for ".concat(n,":"),e.candidate),s.socket.send({type:nf.Candidate,payload:{candidate:e.candidate,type:r,connectionId:i},dst:n}))},e.oniceconnectionstatechange=function(){switch(e.iceConnectionState){case"failed":qp.default.log("iceConnectionState is failed, closing connections to "+n),t.connection.emit("error",new Error("Negotiation of connection to "+n+" failed.")),t.connection.close();break;case"closed":qp.default.log("iceConnectionState is closed, closing connections to "+n),t.connection.emit("error",new Error("Connection to "+n+" closed.")),t.connection.close();break;case"disconnected":qp.default.log("iceConnectionState changed to disconnected on the connection with "+n);break;case"completed":e.onicecandidate=zp.noop}t.connection.emit("iceStateChanged",e.iceConnectionState)},qp.default.log("Listening for data channel"),e.ondatachannel=function(e){qp.default.log("Received data channel");var t=e.channel;s.getConnection(n,i).initialize(t)},qp.default.log("Listening for remote stream"),e.ontrack=function(e){qp.default.log("Received remote stream");var r=e.streams[0],o=s.getConnection(n,i);if(o.type===Qp.Media){var a=o;t._addStreamToMediaConnection(r,a)}}},e.prototype.cleanup=function(){qp.default.log("Cleaning up PeerConnection to "+this.connection.peer);var e=this.connection.peerConnection;if(e){this.connection.peerConnection=null,e.onicecandidate=e.oniceconnectionstatechange=e.ondatachannel=e.ontrack=function(){};var t="closed"!==e.signalingState,n=!1;if(this.connection.type===Qp.Data){var i=this.connection.dataChannel;i&&(n=!!i.readyState&&"closed"!==i.readyState)}(t||n)&&e.close()}},e.prototype._makeOffer=function(){return gf(this,void 0,Promise,(function(){var e,t,n,i,r,s,o;return vf(this,(function(a){switch(a.label){case 0:e=this.connection.peerConnection,t=this.connection.provider,a.label=1;case 1:return a.trys.push([1,7,,8]),[4,e.createOffer(this.connection.options.constraints)];case 2:n=a.sent(),qp.default.log("Created offer."),this.connection.options.sdpTransform&&"function"==typeof this.connection.options.sdpTransform&&(n.sdp=this.connection.options.sdpTransform(n.sdp)||n.sdp),a.label=3;case 3:return a.trys.push([3,5,,6]),[4,e.setLocalDescription(n)];case 4:return a.sent(),qp.default.log("Set localDescription:",n,"for:".concat(this.connection.peer)),i={sdp:n,type:this.connection.type,connectionId:this.connection.connectionId,metadata:this.connection.metadata,browser:zp.browser},this.connection.type===Qp.Data&&(r=this.connection,i=mf(mf({},i),{label:r.label,reliable:r.reliable,serialization:r.serialization})),t.socket.send({type:nf.Offer,payload:i,dst:this.connection.peer}),[3,6];case 5:return"OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer"!=(s=a.sent())&&(t.emitError($p.WebRTC,s),qp.default.log("Failed to setLocalDescription, ",s)),[3,6];case 6:return[3,8];case 7:return o=a.sent(),t.emitError($p.WebRTC,o),qp.default.log("Failed to createOffer, ",o),[3,8];case 8:return[2]}}))}))},e.prototype._makeAnswer=function(){return gf(this,void 0,Promise,(function(){var e,t,n,i,r;return vf(this,(function(s){switch(s.label){case 0:e=this.connection.peerConnection,t=this.connection.provider,s.label=1;case 1:return s.trys.push([1,7,,8]),[4,e.createAnswer()];case 2:n=s.sent(),qp.default.log("Created answer."),this.connection.options.sdpTransform&&"function"==typeof this.connection.options.sdpTransform&&(n.sdp=this.connection.options.sdpTransform(n.sdp)||n.sdp),s.label=3;case 3:return s.trys.push([3,5,,6]),[4,e.setLocalDescription(n)];case 4:return s.sent(),qp.default.log("Set localDescription:",n,"for:".concat(this.connection.peer)),t.socket.send({type:nf.Answer,payload:{sdp:n,type:this.connection.type,connectionId:this.connection.connectionId,browser:zp.browser},dst:this.connection.peer}),[3,6];case 5:return i=s.sent(),t.emitError($p.WebRTC,i),qp.default.log("Failed to setLocalDescription, ",i),[3,6];case 6:return[3,8];case 7:return r=s.sent(),t.emitError($p.WebRTC,r),qp.default.log("Failed to create answer, ",r),[3,8];case 8:return[2]}}))}))},e.prototype.handleSDP=function(e,t){return gf(this,void 0,Promise,(function(){var n,i,r,s;return vf(this,(function(o){switch(o.label){case 0:t=new RTCSessionDescription(t),n=this.connection.peerConnection,i=this.connection.provider,qp.default.log("Setting remote description",t),r=this,o.label=1;case 1:return o.trys.push([1,5,,6]),[4,n.setRemoteDescription(t)];case 2:return o.sent(),qp.default.log("Set remoteDescription:".concat(e," for:").concat(this.connection.peer)),"OFFER"!==e?[3,4]:[4,r._makeAnswer()];case 3:o.sent(),o.label=4;case 4:return[3,6];case 5:return s=o.sent(),i.emitError($p.WebRTC,s),qp.default.log("Failed to setRemoteDescription, ",s),[3,6];case 6:return[2]}}))}))},e.prototype.handleCandidate=function(e){return gf(this,void 0,Promise,(function(){var t,n,i,r,s,o;return vf(this,(function(a){switch(a.label){case 0:qp.default.log("handleCandidate:",e),t=e.candidate,n=e.sdpMLineIndex,i=e.sdpMid,r=this.connection.peerConnection,s=this.connection.provider,a.label=1;case 1:return a.trys.push([1,3,,4]),[4,r.addIceCandidate(new RTCIceCandidate({sdpMid:i,sdpMLineIndex:n,candidate:t}))];case 2:return a.sent(),qp.default.log("Added ICE candidate for:".concat(this.connection.peer)),[3,4];case 3:return o=a.sent(),s.emitError($p.WebRTC,o),qp.default.log("Failed to handleCandidate, ",o),[3,4];case 4:return[2]}}))}))},e.prototype._addTracksToConnection=function(e,t){if(qp.default.log("add tracks from stream ".concat(e.id," to peer connection")),!t.addTrack)return qp.default.error("Your browser does't support RTCPeerConnection#addTrack. Ignored.");e.getTracks().forEach((function(n){t.addTrack(n,e)}))},e.prototype._addStreamToMediaConnection=function(e,t){qp.default.log("add stream ".concat(e.id," to media connection ").concat(t.connectionId)),t.addStream(e)},e}(),xf={};kp(xf,"BaseConnection",()=>bf,e=>bf=e);var wf=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),bf=function(e){function t(t,n,i){var r=e.call(this)||this;return r.peer=t,r.provider=n,r.options=i,r._open=!1,r.metadata=i.metadata,r}return wf(t,e),Object.defineProperty(t.prototype,"open",{get:function(){return this._open},enumerable:!1,configurable:!0}),t}(Up.EventEmitter),Af=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),Sf=function(){return(Sf=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},_f=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Mf=function(e){function t(n,i,r){var s=e.call(this,n,i,r)||this;return s._localStream=s.options._stream,s.connectionId=s.options.connectionId||t.ID_PREFIX+zp.randomToken(),s._negotiator=new ff.Negotiator(s),s._localStream&&s._negotiator.startConnection({_stream:s._localStream,originator:!0}),s}return Af(t,e),Object.defineProperty(t.prototype,"type",{get:function(){return Qp.Media},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"localStream",{get:function(){return this._localStream},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"remoteStream",{get:function(){return this._remoteStream},enumerable:!1,configurable:!0}),t.prototype.addStream=function(t){qp.default.log("Receiving stream",t),this._remoteStream=t,e.prototype.emit.call(this,"stream",t)},t.prototype.handleMessage=function(e){var t=e.type,n=e.payload;switch(e.type){case nf.Answer:this._negotiator.handleSDP(t,n.sdp),this._open=!0;break;case nf.Candidate:this._negotiator.handleCandidate(n.candidate);break;default:qp.default.warn("Unrecognized message type:".concat(t," from peer:").concat(this.peer))}},t.prototype.answer=function(e,t){var n,i;if(void 0===t&&(t={}),this._localStream)qp.default.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");else{this._localStream=e,t&&t.sdpTransform&&(this.options.sdpTransform=t.sdpTransform),this._negotiator.startConnection(Sf(Sf({},this.options._payload),{_stream:e}));var r=this.provider._getMessages(this.connectionId);try{for(var s=_f(r),o=s.next();!o.done;o=s.next()){var a=o.value;this.handleMessage(a)}}catch(e){n={error:e}}finally{try{o&&!o.done&&(i=s.return)&&i.call(s)}finally{if(n)throw n.error}}this._open=!0}},t.prototype.close=function(){this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this._localStream=null,this._remoteStream=null,this.provider&&(this.provider._removeConnection(this),this.provider=null),this.options&&this.options._stream&&(this.options._stream=null),this.open&&(this._open=!1,e.prototype.emit.call(this,"close"))},t.ID_PREFIX="mc_",t}(xf.BaseConnection),Tf={};kp(Tf,"DataConnection",()=>Df,e=>Df=e);var Ef={};kp(Ef,"EncodingQueue",()=>Rf,e=>Rf=e);var Cf=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),Rf=function(e){function t(){var t=e.call(this)||this;return t.fileReader=new FileReader,t._queue=[],t._processing=!1,t.fileReader.onload=function(e){t._processing=!1,e.target&&t.emit("done",e.target.result),t.doNextTask()},t.fileReader.onerror=function(e){qp.default.error("EncodingQueue error:",e),t._processing=!1,t.destroy(),t.emit("error",e)},t}return Cf(t,e),Object.defineProperty(t.prototype,"queue",{get:function(){return this._queue},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this.queue.length},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"processing",{get:function(){return this._processing},enumerable:!1,configurable:!0}),t.prototype.enque=function(e){this.queue.push(e),this.processing||this.doNextTask()},t.prototype.destroy=function(){this.fileReader.abort(),this._queue=[]},t.prototype.doNextTask=function(){0!==this.size&&(this.processing||(this._processing=!0,this.fileReader.readAsArrayBuffer(this.queue.shift())))},t}(Up.EventEmitter),Pf=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),Lf=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Df=function(e){function t(n,i,r){var s=e.call(this,n,i,r)||this;return s.stringify=JSON.stringify,s.parse=JSON.parse,s._buffer=[],s._bufferSize=0,s._buffering=!1,s._chunkedData={},s._encodingQueue=new Ef.EncodingQueue,s.connectionId=s.options.connectionId||t.ID_PREFIX+zp.randomToken(),s.label=s.options.label||s.connectionId,s.serialization=s.options.serialization||ef.Binary,s.reliable=!!s.options.reliable,s._encodingQueue.on("done",(function(e){s._bufferedSend(e)})),s._encodingQueue.on("error",(function(){qp.default.error("DC#".concat(s.connectionId,": Error occured in encoding from blob to arraybuffer, close DC")),s.close()})),s._negotiator=new ff.Negotiator(s),s._negotiator.startConnection(s.options._payload||{originator:!0}),s}return Pf(t,e),Object.defineProperty(t.prototype,"type",{get:function(){return Qp.Data},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dataChannel",{get:function(){return this._dc},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bufferSize",{get:function(){return this._bufferSize},enumerable:!1,configurable:!0}),t.prototype.initialize=function(e){this._dc=e,this._configureDataChannel()},t.prototype._configureDataChannel=function(){var e=this;zp.supports.binaryBlob&&!zp.supports.reliable||(this.dataChannel.binaryType="arraybuffer"),this.dataChannel.onopen=function(){qp.default.log("DC#".concat(e.connectionId," dc connection success")),e._open=!0,e.emit("open")},this.dataChannel.onmessage=function(t){qp.default.log("DC#".concat(e.connectionId," dc onmessage:"),t.data),e._handleDataMessage(t)},this.dataChannel.onclose=function(){qp.default.log("DC#".concat(e.connectionId," dc closed for:"),e.peer),e.close()}},t.prototype._handleDataMessage=function(t){var n=this,i=t.data,r=i.constructor,s=i;if(this.serialization===ef.Binary||this.serialization===ef.BinaryUTF8){if(r===Blob)return void zp.blobToArrayBuffer(i,(function(e){var t=zp.unpack(e);n.emit("data",t)}));if(r===ArrayBuffer)s=zp.unpack(i);else if(r===String){var o=zp.binaryStringToArrayBuffer(i);s=zp.unpack(o)}}else this.serialization===ef.JSON&&(s=this.parse(i));s.__peerData?this._handleChunk(s):e.prototype.emit.call(this,"data",s)},t.prototype._handleChunk=function(e){var t=e.__peerData,n=this._chunkedData[t]||{data:[],count:0,total:e.total};if(n.data[e.n]=e.data,n.count++,this._chunkedData[t]=n,n.total===n.count){delete this._chunkedData[t];var i=new Blob(n.data);this._handleDataMessage({data:i})}},t.prototype.close=function(){this._buffer=[],this._bufferSize=0,this._chunkedData={},this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this.provider&&(this.provider._removeConnection(this),this.provider=null),this.dataChannel&&(this.dataChannel.onopen=null,this.dataChannel.onmessage=null,this.dataChannel.onclose=null,this._dc=null),this._encodingQueue&&(this._encodingQueue.destroy(),this._encodingQueue.removeAllListeners(),this._encodingQueue=null),this.open&&(this._open=!1,e.prototype.emit.call(this,"close"))},t.prototype.send=function(t,n){if(this.open)if(this.serialization===ef.JSON)this._bufferedSend(this.stringify(t));else if(this.serialization===ef.Binary||this.serialization===ef.BinaryUTF8){var i=zp.pack(t);if(!n&&i.size>zp.chunkedMTU)return void this._sendChunks(i);zp.supports.binaryBlob?this._bufferedSend(i):this._encodingQueue.enque(i)}else this._bufferedSend(t);else e.prototype.emit.call(this,"error",new Error("Connection is not open. You should listen for the `open` event before sending messages."))},t.prototype._bufferedSend=function(e){!this._buffering&&this._trySend(e)||(this._buffer.push(e),this._bufferSize=this._buffer.length)},t.prototype._trySend=function(e){var n=this;if(!this.open)return!1;if(this.dataChannel.bufferedAmount>t.MAX_BUFFERED_AMOUNT)return this._buffering=!0,setTimeout((function(){n._buffering=!1,n._tryBuffer()}),50),!1;try{this.dataChannel.send(e)}catch(e){return qp.default.error("DC#:".concat(this.connectionId," Error when sending:"),e),this._buffering=!0,this.close(),!1}return!0},t.prototype._tryBuffer=function(){if(this.open&&0!==this._buffer.length){var e=this._buffer[0];this._trySend(e)&&(this._buffer.shift(),this._bufferSize=this._buffer.length,this._tryBuffer())}},t.prototype._sendChunks=function(e){var t,n,i=zp.chunk(e);qp.default.log("DC#".concat(this.connectionId," Try to send ").concat(i.length," chunks..."));try{for(var r=Lf(i),s=r.next();!s.done;s=r.next()){var o=s.value;this.send(o,!0)}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}},t.prototype.handleMessage=function(e){var t=e.payload;switch(e.type){case nf.Answer:this._negotiator.handleSDP(e.type,t.sdp);break;case nf.Candidate:this._negotiator.handleCandidate(t.candidate);break;default:qp.default.warn("Unrecognized message type:",e.type,"from peer:",this.peer)}},t.ID_PREFIX="dc_",t.MAX_BUFFERED_AMOUNT=8388608,t}(xf.BaseConnection),If={};kp(If,"API",()=>Bf,e=>Bf=e);var kf=function(e,t,n,i){return new(n||(n=Promise))((function(r,s){function o(e){try{c(i.next(e))}catch(e){s(e)}}function a(e){try{c(i.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((i=i.apply(e,t||[])).next())}))},Of=function(e,t){var n,i,r,s,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,i&&(r=2&s[0]?i.return:s[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,s[1])).done)return r;switch(i=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,i=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(r=o.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){o.label=s[1];break}if(6===s[0]&&o.label<r[1]){o.label=r[1],r=s;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(s);break}r[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],i=0}finally{n=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}},Bf=function(){function e(e){this._options=e}return e.prototype._buildRequest=function(e){var t=this._options.secure?"https":"http",n=this._options,i=n.host,r=n.port,s=n.path,o=n.key,a=new URL("".concat(t,"://").concat(i,":").concat(r).concat(s).concat(o,"/").concat(e));return a.searchParams.set("ts","".concat(Date.now()).concat(Math.random())),a.searchParams.set("version",of.version),fetch(a.href,{referrerPolicy:this._options.referrerPolicy})},e.prototype.retrieveId=function(){return kf(this,void 0,Promise,(function(){var e,t,n;return Of(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this._buildRequest("id")];case 1:if(200!==(e=i.sent()).status)throw new Error("Error. Status:".concat(e.status));return[2,e.text()];case 2:throw t=i.sent(),qp.default.error("Error retrieving ID",t),n="","/"===this._options.path&&this._options.host!==zp.CLOUD_HOST&&(n=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."),new Error("Could not get an ID from the server."+n);case 3:return[2]}}))}))},e.prototype.listAllPeers=function(){return kf(this,void 0,Promise,(function(){var e,t,n;return Of(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this._buildRequest("peers")];case 1:if(200!==(e=i.sent()).status){if(401===e.status)throw t="",t=this._options.host===zp.CLOUD_HOST?"It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.":"You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.",new Error("It doesn't look like you have permission to list peers IDs. "+t);throw new Error("Error. Status:".concat(e.status))}return[2,e.json()];case 2:throw n=i.sent(),qp.default.error("Error retrieving list peers",n),new Error("Could not get list peers from the server."+n);case 3:return[2]}}))}))},e}(),Nf=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),zf=function(){return(zf=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},Ff=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Uf=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,r,s=n.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(i=s.next()).done;)o.push(i.value)}catch(e){r={error:e}}finally{try{i&&!i.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}return o},Hf=function(e){function t(n,i){var r,s=e.call(this)||this;return s._id=null,s._lastServerId=null,s._destroyed=!1,s._disconnected=!1,s._open=!1,s._connections=new Map,s._lostMessages=new Map,n&&n.constructor==Object?i=n:n&&(r=n.toString()),i=zf({debug:0,host:zp.CLOUD_HOST,port:zp.CLOUD_PORT,path:"/",key:t.DEFAULT_KEY,token:zp.randomToken(),config:zp.defaultConfig,referrerPolicy:"strict-origin-when-cross-origin"},i),s._options=i,"/"===s._options.host&&(s._options.host=window.location.hostname),s._options.path&&("/"!==s._options.path[0]&&(s._options.path="/"+s._options.path),"/"!==s._options.path[s._options.path.length-1]&&(s._options.path+="/")),void 0===s._options.secure&&s._options.host!==zp.CLOUD_HOST?s._options.secure=zp.isSecure():s._options.host==zp.CLOUD_HOST&&(s._options.secure=!0),s._options.logFunction&&qp.default.setLogFunction(s._options.logFunction),qp.default.logLevel=s._options.debug||0,s._api=new If.API(i),s._socket=s._createServerConnection(),zp.supports.audioVideo||zp.supports.data?r&&!zp.validateId(r)?(s._delayedAbort($p.InvalidID,'ID "'.concat(r,'" is invalid')),s):(r?s._initialize(r):s._api.retrieveId().then((function(e){return s._initialize(e)})).catch((function(e){return s._abort($p.ServerError,e)})),s):(s._delayedAbort($p.BrowserIncompatible,"The current browser does not support WebRTC"),s)}return Nf(t,e),Object.defineProperty(t.prototype,"id",{get:function(){return this._id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"options",{get:function(){return this._options},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"open",{get:function(){return this._open},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"socket",{get:function(){return this._socket},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"connections",{get:function(){var e,t,n=Object.create(null);try{for(var i=Ff(this._connections),r=i.next();!r.done;r=i.next()){var s=Uf(r.value,2),o=s[0],a=s[1];n[o]=a}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return n},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"destroyed",{get:function(){return this._destroyed},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"disconnected",{get:function(){return this._disconnected},enumerable:!1,configurable:!0}),t.prototype._createServerConnection=function(){var e=this,t=new sf.Socket(this._options.secure,this._options.host,this._options.port,this._options.path,this._options.key,this._options.pingInterval);return t.on(tf.Message,(function(t){e._handleMessage(t)})),t.on(tf.Error,(function(t){e._abort($p.SocketError,t)})),t.on(tf.Disconnected,(function(){e.disconnected||(e.emitError($p.Network,"Lost connection to server."),e.disconnect())})),t.on(tf.Close,(function(){e.disconnected||e._abort($p.SocketClosed,"Underlying socket is already closed.")})),t},t.prototype._initialize=function(e){this._id=e,this.socket.start(e,this._options.token)},t.prototype._handleMessage=function(e){var t,n,i=e.type,r=e.payload,s=e.src;switch(i){case nf.Open:this._lastServerId=this.id,this._open=!0,this.emit("open",this.id);break;case nf.Error:this._abort($p.ServerError,r.msg);break;case nf.IdTaken:this._abort($p.UnavailableID,'ID "'.concat(this.id,'" is taken'));break;case nf.InvalidKey:this._abort($p.InvalidKey,'API KEY "'.concat(this._options.key,'" is invalid'));break;case nf.Leave:qp.default.log("Received leave message from ".concat(s)),this._cleanupPeer(s),this._connections.delete(s);break;case nf.Expire:this.emitError($p.PeerUnavailable,"Could not connect to peer ".concat(s));break;case nf.Offer:var o=r.connectionId;if((p=this.getConnection(s,o))&&(p.close(),qp.default.warn("Offer received for existing Connection ID:".concat(o))),r.type===Qp.Media){var a=new pf.MediaConnection(s,this,{connectionId:o,_payload:r,metadata:r.metadata});p=a,this._addConnection(s,p),this.emit("call",a)}else{if(r.type!==Qp.Data)return void qp.default.warn("Received malformed connection type:".concat(r.type));var c=new Tf.DataConnection(s,this,{connectionId:o,_payload:r,metadata:r.metadata,label:r.label,serialization:r.serialization,reliable:r.reliable});p=c,this._addConnection(s,p),this.emit("connection",c)}var l=this._getMessages(o);try{for(var u=Ff(l),h=u.next();!h.done;h=u.next()){var d=h.value;p.handleMessage(d)}}catch(e){t={error:e}}finally{try{h&&!h.done&&(n=u.return)&&n.call(u)}finally{if(t)throw t.error}}break;default:if(!r)return void qp.default.warn("You received a malformed message from ".concat(s," of type ").concat(i));var p;o=r.connectionId;(p=this.getConnection(s,o))&&p.peerConnection?p.handleMessage(e):o?this._storeMessage(o,e):qp.default.warn("You received an unrecognized message:",e)}},t.prototype._storeMessage=function(e,t){this._lostMessages.has(e)||this._lostMessages.set(e,[]),this._lostMessages.get(e).push(t)},t.prototype._getMessages=function(e){var t=this._lostMessages.get(e);return t?(this._lostMessages.delete(e),t):[]},t.prototype.connect=function(e,t){if(void 0===t&&(t={}),this.disconnected)return qp.default.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."),void this.emitError($p.Disconnected,"Cannot connect to new Peer after disconnecting from server.");var n=new Tf.DataConnection(e,this,t);return this._addConnection(e,n),n},t.prototype.call=function(e,t,n){if(void 0===n&&(n={}),this.disconnected)return qp.default.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),void this.emitError($p.Disconnected,"Cannot connect to new Peer after disconnecting from server.");if(t){var i=new pf.MediaConnection(e,this,zf(zf({},n),{_stream:t}));return this._addConnection(e,i),i}qp.default.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.")},t.prototype._addConnection=function(e,t){qp.default.log("add connection ".concat(t.type,":").concat(t.connectionId," to peerId:").concat(e)),this._connections.has(e)||this._connections.set(e,[]),this._connections.get(e).push(t)},t.prototype._removeConnection=function(e){var t=this._connections.get(e.peer);if(t){var n=t.indexOf(e);-1!==n&&t.splice(n,1)}this._lostMessages.delete(e.connectionId)},t.prototype.getConnection=function(e,t){var n,i,r=this._connections.get(e);if(!r)return null;try{for(var s=Ff(r),o=s.next();!o.done;o=s.next()){var a=o.value;if(a.connectionId===t)return a}}catch(e){n={error:e}}finally{try{o&&!o.done&&(i=s.return)&&i.call(s)}finally{if(n)throw n.error}}return null},t.prototype._delayedAbort=function(e,t){var n=this;setTimeout((function(){n._abort(e,t)}),0)},t.prototype._abort=function(e,t){qp.default.error("Aborting!"),this.emitError(e,t),this._lastServerId?this.disconnect():this.destroy()},t.prototype.emitError=function(e,t){var n;qp.default.error("Error:",t),(n="string"==typeof t?new Error(t):t).type=e,this.emit("error",n)},t.prototype.destroy=function(){this.destroyed||(qp.default.log("Destroy peer with ID:".concat(this.id)),this.disconnect(),this._cleanup(),this._destroyed=!0,this.emit("close"))},t.prototype._cleanup=function(){var e,t;try{for(var n=Ff(this._connections.keys()),i=n.next();!i.done;i=n.next()){var r=i.value;this._cleanupPeer(r),this._connections.delete(r)}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}this.socket.removeAllListeners()},t.prototype._cleanupPeer=function(e){var t,n,i=this._connections.get(e);if(i)try{for(var r=Ff(i),s=r.next();!s.done;s=r.next()){s.value.close()}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}},t.prototype.disconnect=function(){if(!this.disconnected){var e=this.id;qp.default.log("Disconnect peer with ID:".concat(e)),this._disconnected=!0,this._open=!1,this.socket.close(),this._lastServerId=e,this._id=null,this.emit("disconnected",e)}},t.prototype.reconnect=function(){if(this.disconnected&&!this.destroyed)qp.default.log("Attempting reconnection to server with ID ".concat(this._lastServerId)),this._disconnected=!1,this._initialize(this._lastServerId);else{if(this.destroyed)throw new Error("This peer cannot reconnect to the server. It has already been destroyed.");if(this.disconnected||this.open)throw new Error("Peer ".concat(this.id," cannot reconnect because it is not disconnected from the server!"));qp.default.error("In a hurry? We're still trying to make the initial connection!")}},t.prototype.listAllPeers=function(e){var t=this;void 0===e&&(e=function(e){}),this._api.listAllPeers().then((function(t){return e(t)})).catch((function(e){return t._abort($p.ServerError,e)}))},t.DEFAULT_KEY="peerjs",t}(Up.EventEmitter);var Vf=new Proxy(localStorage,{get:(e,t)=>(t="__stm_"+t,localStorage[t]?JSON.parse(localStorage[t]):void 0),set:(e,t,n)=>(t="__stm_"+t,localStorage[t]=JSON.stringify(n),!0),deleteProperty(e,t){delete localStorage[t]}});const Gf=Object.freeze({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}),Wf=function(e){return void 0!==e?String(e).replace(/[&<>"']/g,(function(e){return Gf[e]})):e};class jf{constructor(e){this.connections=[],this.manager=e,void 0!==Vf.peerId&&(this.peer=new Hf(Vf.peerId),this.initPeer(this.peer))}initPeer(e){e.on("open",()=>{this.onConnectionOpen()}),e.on("close",()=>{window.VIRTUAL_ENVIRONMENT.UI_CONTROLLER.blockerScreen.menu.menuFooter.setPeerIdDisplay("Not Connected")})}createPeerWithId(e){Vf.peerId=e,this.peer=new Hf(e),this.initPeer(this.peer)}onConnectionOpen(){this.addMessageToChatBox("[info] Peer created with id: "+Vf.peerId),window.VIRTUAL_ENVIRONMENT.UI_CONTROLLER.blockerScreen.menu.menuDisplay.multiplayerPanel.update(),window.VIRTUAL_ENVIRONMENT.UI_CONTROLLER.blockerScreen.menu.menuFooter.setPeerIdDisplay("Connected as: "+Vf.peerId),this.peer.on("connection",e=>{window.VIRTUAL_ENVIRONMENT.UI_CONTROLLER.blockerScreen.menu.menuDisplay.multiplayerPanel.connectionsManagementDisplay.handleNewConnection(e),this.onConnectionConnect(e)}),this.initFriendList()}initFriendList(){void 0!==Vf.friendList?Vf.friendList.forEach(e=>{this.connectToPeer(e)}):Vf.friendList=[]}onConnectionConnect(e){this.addMessageToChatBox("[info] new connection to peer: "+e.peer),this.connections.push(e),setTimeout(()=>{e.send(this.jsonMessageFormatter("spawn"))},1e3),e.on("data",t=>{this.onReceiveData(e,t)}),e.on("close",()=>{this.onConnectionClose(e)})}onReceiveData(e,t){let n;try{n=JSON.parse(t)}catch(e){console.error("[RemoteController:onReceiveData] Error while parsing data to JSON.\nData: "+t)}if(void 0!==n.type)switch(n.type){case"spawn":n.pathname===window.location.pathname&&(this.addMessageToChatBox("[info] Spawning: "+e.peer),e.avatarController=new fl(this.manager),e.avatarController.spawnAvatar({}));case"stream":this.handleNewTransform(e,n);break;case"chat":this.addMessageToChatBox("["+e.peer+"] "+n.message)}}handleNewTransform(e,t){e.transform={position:new Y(t.transform.position.x,t.transform.position.y,t.transform.position.z),horizontalVelocity:new Y(t.transform.horizontalVelocity.x,0,t.transform.horizontalVelocity.z)},e.animation=t.animation,e.needUpdate=!0}connectToPeer(e){let t=!0;if(e===this.peer.id&&(console.warn("[RemoteController:connectToPeer] You are trying to connect to your own peerId. Current id: "+Vf.peerId),t=!1),this.connections.forEach(n=>{n.peer===e&&(console.warn("[RemoteController:connectToPeer] You are trying to duplicate a connection to peer: "+e),t=!1)}),t){this.addMessageToChatBox("[info] Trying connection to peer: "+e);const t=this.peer.connect(e);window.window.VIRTUAL_ENVIRONMENT.UI_CONTROLLER.blockerScreen.menu.menuDisplay.multiplayerPanel.connectionsManagementDisplay.handleNewConnection(t),t.on("open",()=>{this.onConnectionConnect(t)}),setTimeout(()=>{t.open||(VIRTUAL_ENVIRONMENT.UI_CONTROLLER.handleConnectionClose(t.peer),t.close())},3e3)}}onConnectionClose(e){void 0!==e.avatarController&&e.avatarController.removeAvatar();const t=this.connections.indexOf(e);this.connections.splice(t,1),VIRTUAL_ENVIRONMENT.UI_CONTROLLER.handleConnectionClose(e.peer),this.addMessageToChatBox("[info] disconnected from peer: "+e.peer)}disconnectPeer(e){this.connections.forEach((t,n)=>{t.peer===e&&t.close()})}sendChatMessage(e){let t=Wf(e);void 0!==this.peer?(this.addMessageToChatBox("["+this.peer.id+"] "+t),this.connections.forEach(e=>{e.send('{"type":"chat","message":"'+t+'"}')})):this.addMessageToChatBox("[info] You must connect to send messages in chat")}addMessageToChatBox(e){const t=Wf(e);VIRTUAL_ENVIRONMENT.UI_CONTROLLER.handleNewMessage(t)}updateFriendList(){let e=Vf.friendList;this.connections.forEach(t=>{let n=t.peer;Vf.friendList.indexOf(n)<=-1&&e.push(n)}),Vf.friendList=e}jsonMessageFormatter(e){let t={type:e};switch(e){case"spawn":t.pathname=window.location.pathname;case"stream":t.transform={position:LOCAL_PLAYER.position,horizontalVelocity:LOCAL_PLAYER.horizontalVelocity},t.animation=[LOCAL_PLAYER.currentAnimation,LOCAL_PLAYER.currentAnimationTime]}return JSON.stringify(t)}update(e){this.connections.forEach(t=>{if(t.needUpdate){LOCAL_PLAYER.position,LOCAL_PLAYER.horizontalVelocity;t.send(this.jsonMessageFormatter("stream")),void 0!==t.transform&&t.avatarController&&t.avatarController.update(e,t.transform.position,t.transform.horizontalVelocity,t.animation[0],t.animation[1]),t.needUpdate=!1}})}}class Jf{constructor(e){const t={type:"div",id:void 0,style:{},hover:void 0,onClick:void 0,innerHTML:void 0};for(let n in t)e[n]=void 0===e[n]?t[n]:e[n];this.options=e,this.element=document.createElement(e.type),void 0!==e.id&&(this.element.id=e.id),Object.assign(this.element.style,e.style),void 0!==e.hover&&(this.element.addEventListener("mouseenter",()=>{Object.assign(this.element.style,e.hover)}),this.element.addEventListener("mouseleave",()=>{Object.assign(this.element.style,e.style)})),void 0!==e.onClick&&this.element.addEventListener("click",e.onClick),void 0!==e.innerHTML&&(this.element.innerHTML=e.innerHTML)}appendChild(e){this.element.appendChild(e.element)}appendChildList(e){e.forEach(e=>{this.element.appendChild(e.element)})}}class Xf extends Jf{constructor(){super({id:"blocker",style:{width:"100%",height:"100%",background:"rgba(0, 0, 0, 0.5)",textAlign:"center",cursor:"pointer",fontSize:"16px",color:"white",transition:"all 0.5s ease"},hover:{background:"rgba(0, 0, 0, 0.3)",fontSize:"large"},innerHTML:"Click to play",onClick:()=>VIRTUAL_ENVIRONMENT.UI_CONTROLLER.handleControlsLock()})}}class qf extends Jf{constructor(e,t){super({style:{color:"back",cursor:"pointer",padding:"5px",fontWeight:"bold",textAlign:"center",transition:"all 0.5s ease"},hover:{background:"#d8d8d8",color:"#3a3a3a"},innerHTML:e,onClick:()=>{VIRTUAL_ENVIRONMENT.UI_CONTROLLER.blockerScreen.menu.handleMenuPanelSelection(e),t.toggleMenu()}})}}class Zf extends Jf{constructor(){super({id:"MenuHeader",style:{boxShadow:"0 4px 4px #888888",background:"#E0E0E0",zIndex:"100",height:"50px",position:"absolute",width:"350px",transition:"all 0.5s ease",overflow:"hidden"}}),this.isOpen=!1,this.toggleMenuButton=new Jf({innerHTML:"☰",style:{padding:"10px",cursor:"pointer"},onClick:()=>{this.toggleMenu()}}),this.chatPanelButton=new qf("chat",this),this.multiplayerPanelButton=new qf("multiplayer",this),this.avatarPanelButton=new qf("avatar",this),this.optionsPanelButton=new qf("options",this),this.mapPanelButton=new qf("map",this),this.optionList=new Jf({style:{display:"none",marginTop:"50px"}}),this.optionList.appendChildList([this.chatPanelButton,this.multiplayerPanelButton,this.avatarPanelButton,this.optionsPanelButton,this.mapPanelButton]),this.appendChildList([this.toggleMenuButton,this.optionList])}handleMenuHeaderSelection(e){switch(this.closeAllHeaders(),e){case"chat":this.chatPanelButton.element.style.background="#c8c8c8",this.chatPanelButton.options.style.background="#c8c8c8";break;case"multiplayer":this.multiplayerPanelButton.element.style.background="#c8c8c8",this.multiplayerPanelButton.options.style.background="#c8c8c8";break;case"avatar":this.avatarPanelButton.element.style.background="#c8c8c8",this.avatarPanelButton.options.style.background="#c8c8c8";break;case"options":this.optionsPanelButton.element.style.background="#c8c8c8",this.optionsPanelButton.options.style.background="#c8c8c8";break;case"map":this.mapPanelButton.element.style.background="#c8c8c8",this.mapPanelButton.options.style.background="#c8c8c8"}}toggleMenu(){this.isOpen?(this.element.style.height="50px",this.toggleMenuButton.element.innerHTML="☰",this.optionList.element.style.display="none"):(this.element.style.height="350px",this.toggleMenuButton.element.innerHTML="X",this.optionList.element.style.display="block"),this.isOpen=!this.isOpen}closeAllHeaders(){this.chatPanelButton.element.style.background="#e0e0e0",this.chatPanelButton.options.style.background="#e0e0e0",this.multiplayerPanelButton.element.style.background="#e0e0e0",this.multiplayerPanelButton.options.style.background="#e0e0e0",this.avatarPanelButton.element.style.background="#e0e0e0",this.avatarPanelButton.options.style.background="#e0e0e0",this.optionsPanelButton.element.style.background="#e0e0e0",this.optionsPanelButton.options.style.background="#e0e0e0",this.mapPanelButton.element.style.background="#e0e0e0",this.mapPanelButton.options.style.background="#e0e0e0"}}class Yf extends Jf{constructor(){super({id:"MenuFooter",style:{background:"#383838",textAlign:"center",height:"30px",transition:"all 0.5s ease",overflow:"hidden",position:"absolute",bottom:"0",width:"350px"}}),this.textInfo=new Jf({innerHTML:"Not Connected",style:{color:"white"}}),this.disconnectButton=new Jf({innerHTML:"Disconnect",style:{padding:"20px",margin:"20px",border:"1px solid #e0e0e0",borderRadius:"10px",background:"radial-gradient(circle, rgba(256,235,235,1) 0%, rgba(256,215,215,1) 48%, rgba(256,230,230,1) 100%)",boxShadow:"0 2px 2px #ff8888",textAlign:"center",cursor:"pointer"},hover:{background:"#ffc8c8"},onClick:()=>{VIRTUAL_ENVIRONMENT.remoteController.peer.destroy(),delete VIRTUAL_ENVIRONMENT.remoteController.peer,VIRTUAL_ENVIRONMENT.UI_CONTROLLER.blockerScreen.menu.menuDisplay.multiplayerPanel.update()}}),this.appendChildList([this.textInfo,this.disconnectButton]),this.element.addEventListener("mouseenter",()=>{void 0!==VIRTUAL_ENVIRONMENT.remoteController.peer&&(this.element.style.height="150px")}),this.element.addEventListener("mouseleave",()=>{this.element.style.height="30px"})}setPeerIdDisplay(e){this.textInfo.element.innerHTML=e}}class Kf extends Jf{constructor(){super({id:"ChatOutputDisplay",style:{height:"600px",background:"white",overflow:"scroll",overflowX:"hidden",wordBreak:"break-all",fontSize:"x-small"}})}displayNewMessage(e){this.element.innerHTML+="<br>"+e}}class Qf extends Jf{constructor(){super({id:"ChatFooter",style:{background:"#c8c8c8",padding:"5px"}}),this.inputBar=new Jf({id:"InputBar",type:"input",style:{width:"280px"}}),this.inputBar.element.addEventListener("keypress",e=>{"Enter"===e.key&&(e.preventDefault(),this.handleSendMessage())}),this.sendButton=new Jf({id:"SendButton",type:"button",innerHTML:"send",onClick:()=>this.handleSendMessage()}),this.appendChildList([this.inputBar,this.sendButton])}handleSendMessage(){const e=this.inputBar.element.value;""!==e&&(this.inputBar.element.value="",VIRTUAL_ENVIRONMENT.remoteController.sendChatMessage(e))}handleCreateJoinRoom(){const e=this.inputBar.element.value;""!==e&&(this.inputBar.element.value="",VIRTUAL_ENVIRONMENT.remoteController.createRoom(e))}}class $f extends Jf{constructor(){super({id:"ChatPanel",style:{height:"100%",display:"none",gridTemplateRows:"1fr 45px"}}),this.chatOutputDisplay=new Kf,this.chatFooter=new Qf,this.appendChildList([this.chatOutputDisplay,this.chatFooter])}}class em extends Jf{constructor(e){super({id:"GoLiveButton",type:"button",innerHTML:"Go live",onClick:e})}}class tm extends Jf{constructor(){super({id:"PeerIdInput",type:"input"})}}class nm extends Jf{constructor(e){super({id:"GoLiveDisplay",style:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",height:"100%"}}),this.inputs=new Jf({}),this.inputs.peerIdInput=new tm,this.inputs.appendChildList([this.inputs.peerIdInput,new em(e)]),this.title=new Jf({innerHTML:"enter a peer id",style:{width:"100%",fontWeight:"bold",fontSize:"25px",textAlign:"center",marginTop:"50px"}}),this.info=new Jf({style:{padding:"10px",fontSize:"xx-small",textAlign:"justify",width:"250px"},innerHTML:"This feature is still experimental. Please join our <a href='https://discord.gg/w6CzHy35E2'>Discord</a> if you have any difficulty or want to suggest an improvement."}),this.appendChildList([this.title,this.inputs,this.info])}}class im extends Jf{constructor(e,t,n,i){super({style:{display:"flex",flexDirection:"row"}}),this.closeConnection=new Jf({innerHTML:"&#9746;",style:{padding:"3px",cursor:"pointer",color:"black"},hover:{color:"#383838"},onClick:e}),this.starConnection=new Jf({innerHTML:t?"&#9733;":"&#9734;",style:{padding:"3px",cursor:"pointer",color:"black"},hover:{color:"#383838"},onClick:n}),this.appendChildList([this.starConnection,this.closeConnection])}setStar(e){this.starConnection.element.innerHTML="star"===e?"&#9733;":"&#9734;"}}class rm extends Jf{constructor(e){super({id:e.peer,style:{border:"1px solid black",display:"flex",flexDirection:"row",justifyContent:"space-between",margin:"5px",padding:"5px",borderRadius:"5px",boxShadow:"0 2px 2px #888888",background:"#e0e0e0"}}),this.connection=e,this.peer=e.peer,this.peerIdDisplay=new Jf({innerHTML:e.peer,style:{padding:"3px"}}),this.options=new im(()=>this.handleConnectionClose(),Vf.friendList.includes(this.peer),()=>this.handleClickOnStar()),this.appendChildList([this.peerIdDisplay,this.options])}handleClickOnStar(){if(Vf.friendList.includes(this.peer)){this.options.setStar("");let e=Vf.friendList;const t=e.indexOf(this.peer);e.splice(t,1),Vf.friendList=e,void 0===this.connection&&this.element.remove()}else{this.options.setStar("star");let e=Vf.friendList;e.push(this.peer),Vf.friendList=e}}handleConnectionClose(){VIRTUAL_ENVIRONMENT.remoteController.disconnectPeer(this.peer)}update(){void 0!==this.connection?this.connection.open?(this.element.style.border="1px solid green",this.element.style.background="#f0fff0"):(this.element.style.border="1px solid yellow",this.element.style.background="#fffff0"):(this.element.style.border="1px solid red",this.element.style.background="#fff0f0")}}class sm extends Jf{constructor(){super({id:"NewConnectionDisplay",style:{padding:"10px",margin:"10px",border:"1px solid #e0e0e0",borderRadius:"10px",background:"rgb(255,255,255)",background:"radial-gradient(circle, rgba(255,255,255,1) 0%, rgba(235,235,235,1) 48%, rgba(250,250,250,1) 100%)",boxShadow:"0 2px 2px #888888",textAlign:"center"}}),this.title=new Jf({innerHTML:"Connect to peers",style:{fontWeight:"bold",fontSize:"25px"}}),this.remoteIdInput=new Jf({type:"input"}),this.connectToPeer=new Jf({type:"button",innerHTML:"connect",onClick:()=>{VIRTUAL_ENVIRONMENT.remoteController.connectToPeer(this.remoteIdInput.element.value),this.remoteIdInput.element.value=""}}),this.info=new Jf({innerHTML:"Enter a peerId to attempt connection."}),this.appendChildList([this.title,this.remoteIdInput,this.connectToPeer,this.info])}}class om extends Jf{constructor(){super({id:"ConnectionManagementPanel",style:{display:"none"}}),this.connectionDisplayList=[],this.newConnectionDisplay=new sm,this.appendChild(this.newConnectionDisplay),this.appendChild(new Jf({innerHTML:"Connection List",style:{width:"100%",fontWeight:"bold",fontSize:"25px",textAlign:"center",marginTop:"50px"}})),this.appendChild(new Jf({innerHTML:"Activate the &#9733; icon to save a connection.",style:{fontSize:"xx-small",width:"100%",textAlign:"center"}}))}handleNewConnection(e){this.connectionDisplayList.forEach(t=>{t.peer===e.peer&&t.element.remove()});const t=new rm(e);this.connectionDisplayList.push(t),this.appendChild(t)}handleConnectionClose(e){if(Vf.friendList.includes(e))this.connectionDisplayList.forEach((t,n)=>{t.element.id===e&&delete this.connectionDisplayList[n].connection});else{const t=this.element.childNodes;for(let n=0;n<t.length;n++)t[n].id===e&&this.element.childNodes[n].remove();this.connectionDisplayList.forEach((t,n)=>{t.element.id===e&&this.connectionDisplayList.splice(n,1)})}}update(){this.connectionDisplayList.forEach(e=>{e.update()})}}class am extends Jf{constructor(){super({id:"MultiplayerPanel",style:{display:"none",height:"100%",paddingTop:"25px"}}),this.goLiveDisplay=new nm(()=>this.handleGoLive()),this.connectionsManagementDisplay=new om,this.appendChildList([this.goLiveDisplay,this.connectionsManagementDisplay])}handleGoLive(){const e=this.goLiveDisplay.inputs.peerIdInput.element.value;""!==e&&VIRTUAL_ENVIRONMENT.remoteController.createPeerWithId(e)}update(){void 0!==VIRTUAL_ENVIRONMENT.remoteController.peer?(this.goLiveDisplay.element.style.display="none",this.connectionsManagementDisplay.element.style.display="block"):(this.goLiveDisplay.element.style.display="flex",this.connectionsManagementDisplay.element.style.display="none")}}class cm extends Jf{constructor(e,t,n,i){super({innerHTML:e,style:{padding:"10px",margin:"10px",border:"1px solid #e0e0e0",borderRadius:"10px",background:"radial-gradient(circle, rgba(255,255,255,1) 0%, rgba(235,235,235,1) 48%, rgba(250,250,250,1) 100%)",boxShadow:"0 2px 2px #888888",textAlign:"center",cursor:"pointer",transition:"all 0.5s ease"},hover:{background:"#d8d8d8"}}),this.element.addEventListener("click",()=>{LOCAL_PLAYER.avatarController.changeAvatar(t,n,i)})}}const lm={walk:1,idle:2,run:3,jump:4,fall:4},um="https://elegant-truffle-070d6b.netlify.app/defaultAnimations.glb";class hm extends Jf{constructor(){super({style:{height:"100%",display:"none"}}),this.appendChild(new Jf({innerHTML:"Select an Avatar",style:{width:"100%",fontWeight:"bold",fontSize:"25px",textAlign:"center",paddingTop:"50px"}})),this.xBotAvatarSelectButton=new cm("xBot","https://elegant-truffle-070d6b.netlify.app/xBot.glb",um,lm),this.yBotAvatarSelectButton=new cm("yBot","https://elegant-truffle-070d6b.netlify.app/yBot.glb",um,lm),this.vanguardAvatarSelectButton=new cm("vanguard","https://elegant-truffle-070d6b.netlify.app/vanguard.glb",um,lm),this.appendChildList([this.xBotAvatarSelectButton,this.yBotAvatarSelectButton,this.vanguardAvatarSelectButton])}}class dm extends Jf{constructor(e,t,n){super({style:{margin:"15px",display:"grid",gridTemplateColumns:"225px 1fr"},onClick:()=>{this.toggle(),n()}}),this.isActive=t,this.optionName=new Jf({innerHTML:e}),this.toggleButton=new Jf({style:{width:"45px",height:"25px",borderRadius:"12.5px",background:this.isActive?"green":"red",position:"relative",transition:"all 0.5s ease"}}),this.pill=new Jf({style:{position:"absolute",height:"20px",width:"20px",margin:"2.5px",borderRadius:"50%",background:"grey",right:this.isActive?"0":"20px",transition:"all 0.5s ease"}}),this.toggleButton.appendChild(this.pill),this.appendChildList([this.optionName,this.toggleButton])}toggle(){this.isActive?(this.toggleButton.element.style.background="red",this.pill.element.style.right="20px"):(this.toggleButton.element.style.background="green",this.pill.element.style.right="0px"),this.isActive=!this.isActive}}class pm extends Jf{constructor(){super({style:{height:"100%",display:"none",marginTop:"150px"}}),this.appendChild(new dm("Toggle Shadows",!0,(function(){MAIN_SCENE.toggleShadows()}))),this.appendChild(new dm("Show Performances",!1,(function(){VIRTUAL_ENVIRONMENT.toggleStats()}))),this.appendChild(new dm("Show Hitbox",!1,(function(){LOCAL_PLAYER.toggleHitbox()}))),this.appendChild(new dm("Show Collider",!1,(function(){VIRTUAL_ENVIRONMENT.terrainController.toggleViewCollider()}))),this.appendChild(new dm("Show Triggers",!1,(function(){MAIN_SCENE.toggleInteractiveDebugBox()})))}}const fm={type:"change"},mm={type:"start"},gm={type:"end"};class vm extends h{constructor(e,t){super(),void 0===t&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),t===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=e,this.domElement=t,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new Y,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:r,MIDDLE:s,RIGHT:o},this.touches={ONE:a,TWO:l},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return p.phi},this.getAzimuthalAngle=function(){return p.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(e){e.addEventListener("keydown",$),this._domElementKeyEvents=e},this.saveState=function(){n.target0.copy(n.target),n.position0.copy(n.object.position),n.zoom0=n.object.zoom},this.reset=function(){n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.zoom=n.zoom0,n.object.updateProjectionMatrix(),n.dispatchEvent(fm),n.update(),h=i.NONE},this.update=function(){const t=new Y,r=(new Z).setFromUnitVectors(e.up,new Y(0,1,0)),s=r.clone().invert(),o=new Y,a=new Z,c=2*Math.PI;return function(){const e=n.object.position;t.copy(e).sub(n.target),t.applyQuaternion(r),p.setFromVector3(t),n.autoRotate&&h===i.NONE&&L(2*Math.PI/60/60*n.autoRotateSpeed),n.enableDamping?(p.theta+=f.theta*n.dampingFactor,p.phi+=f.phi*n.dampingFactor):(p.theta+=f.theta,p.phi+=f.phi);let l=n.minAzimuthAngle,u=n.maxAzimuthAngle;return isFinite(l)&&isFinite(u)&&(l<-Math.PI?l+=c:l>Math.PI&&(l-=c),u<-Math.PI?u+=c:u>Math.PI&&(u-=c),p.theta=l<=u?Math.max(l,Math.min(u,p.theta)):p.theta>(l+u)/2?Math.max(l,p.theta):Math.min(u,p.theta)),p.phi=Math.max(n.minPolarAngle,Math.min(n.maxPolarAngle,p.phi)),p.makeSafe(),p.radius*=m,p.radius=Math.max(n.minDistance,Math.min(n.maxDistance,p.radius)),!0===n.enableDamping?n.target.addScaledVector(g,n.dampingFactor):n.target.add(g),t.setFromSpherical(p),t.applyQuaternion(s),e.copy(n.target).add(t),n.object.lookAt(n.target),!0===n.enableDamping?(f.theta*=1-n.dampingFactor,f.phi*=1-n.dampingFactor,g.multiplyScalar(1-n.dampingFactor)):(f.set(0,0,0),g.set(0,0,0)),m=1,!!(v||o.distanceToSquared(n.object.position)>d||8*(1-a.dot(n.object.quaternion))>d)&&(n.dispatchEvent(fm),o.copy(n.object.position),a.copy(n.object.quaternion),v=!1,!0)}}(),this.dispose=function(){n.domElement.removeEventListener("contextmenu",ee),n.domElement.removeEventListener("pointerdown",J),n.domElement.removeEventListener("pointercancel",K),n.domElement.removeEventListener("wheel",Q),n.domElement.removeEventListener("pointermove",X),n.domElement.removeEventListener("pointerup",q),null!==n._domElementKeyEvents&&n._domElementKeyEvents.removeEventListener("keydown",$)};const n=this,i={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let h=i.NONE;const d=1e-6,p=new Ba,f=new Ba;let m=1;const g=new Y;let v=!1;const y=new _,x=new _,w=new _,b=new _,A=new _,S=new _,M=new _,T=new _,E=new _,C=[],R={};function P(){return Math.pow(.95,n.zoomSpeed)}function L(e){f.theta-=e}function D(e){f.phi-=e}const I=function(){const e=new Y;return function(t,n){e.setFromMatrixColumn(n,0),e.multiplyScalar(-t),g.add(e)}}(),k=function(){const e=new Y;return function(t,i){!0===n.screenSpacePanning?e.setFromMatrixColumn(i,1):(e.setFromMatrixColumn(i,0),e.crossVectors(n.object.up,e)),e.multiplyScalar(t),g.add(e)}}(),O=function(){const e=new Y;return function(t,i){const r=n.domElement;if(n.object.isPerspectiveCamera){const s=n.object.position;e.copy(s).sub(n.target);let o=e.length();o*=Math.tan(n.object.fov/2*Math.PI/180),I(2*t*o/r.clientHeight,n.object.matrix),k(2*i*o/r.clientHeight,n.object.matrix)}else n.object.isOrthographicCamera?(I(t*(n.object.right-n.object.left)/n.object.zoom/r.clientWidth,n.object.matrix),k(i*(n.object.top-n.object.bottom)/n.object.zoom/r.clientHeight,n.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),n.enablePan=!1)}}();function B(e){n.object.isPerspectiveCamera?m/=e:n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom*e)),n.object.updateProjectionMatrix(),v=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function N(e){n.object.isPerspectiveCamera?m*=e:n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/e)),n.object.updateProjectionMatrix(),v=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function z(e){y.set(e.clientX,e.clientY)}function F(e){b.set(e.clientX,e.clientY)}function U(){if(1===C.length)y.set(C[0].pageX,C[0].pageY);else{const e=.5*(C[0].pageX+C[1].pageX),t=.5*(C[0].pageY+C[1].pageY);y.set(e,t)}}function H(){if(1===C.length)b.set(C[0].pageX,C[0].pageY);else{const e=.5*(C[0].pageX+C[1].pageX),t=.5*(C[0].pageY+C[1].pageY);b.set(e,t)}}function V(){const e=C[0].pageX-C[1].pageX,t=C[0].pageY-C[1].pageY,n=Math.sqrt(e*e+t*t);M.set(0,n)}function G(e){if(1==C.length)x.set(e.pageX,e.pageY);else{const t=ie(e),n=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);x.set(n,i)}w.subVectors(x,y).multiplyScalar(n.rotateSpeed);const t=n.domElement;L(2*Math.PI*w.x/t.clientHeight),D(2*Math.PI*w.y/t.clientHeight),y.copy(x)}function W(e){if(1===C.length)A.set(e.pageX,e.pageY);else{const t=ie(e),n=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);A.set(n,i)}S.subVectors(A,b).multiplyScalar(n.panSpeed),O(S.x,S.y),b.copy(A)}function j(e){const t=ie(e),i=e.pageX-t.x,r=e.pageY-t.y,s=Math.sqrt(i*i+r*r);T.set(0,s),E.set(0,Math.pow(T.y/M.y,n.zoomSpeed)),B(E.y),M.copy(T)}function J(e){!1!==n.enabled&&(0===C.length&&(n.domElement.setPointerCapture(e.pointerId),n.domElement.addEventListener("pointermove",X),n.domElement.addEventListener("pointerup",q)),function(e){C.push(e)}(e),"touch"===e.pointerType?function(e){switch(ne(e),C.length){case 1:switch(n.touches.ONE){case a:if(!1===n.enableRotate)return;U(),h=i.TOUCH_ROTATE;break;case c:if(!1===n.enablePan)return;H(),h=i.TOUCH_PAN;break;default:h=i.NONE}break;case 2:switch(n.touches.TWO){case l:if(!1===n.enableZoom&&!1===n.enablePan)return;n.enableZoom&&V(),n.enablePan&&H(),h=i.TOUCH_DOLLY_PAN;break;case u:if(!1===n.enableZoom&&!1===n.enableRotate)return;n.enableZoom&&V(),n.enableRotate&&U(),h=i.TOUCH_DOLLY_ROTATE;break;default:h=i.NONE}break;default:h=i.NONE}h!==i.NONE&&n.dispatchEvent(mm)}(e):function(e){let t;switch(e.button){case 0:t=n.mouseButtons.LEFT;break;case 1:t=n.mouseButtons.MIDDLE;break;case 2:t=n.mouseButtons.RIGHT;break;default:t=-1}switch(t){case s:if(!1===n.enableZoom)return;!function(e){M.set(e.clientX,e.clientY)}(e),h=i.DOLLY;break;case r:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===n.enablePan)return;F(e),h=i.PAN}else{if(!1===n.enableRotate)return;z(e),h=i.ROTATE}break;case o:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===n.enableRotate)return;z(e),h=i.ROTATE}else{if(!1===n.enablePan)return;F(e),h=i.PAN}break;default:h=i.NONE}h!==i.NONE&&n.dispatchEvent(mm)}(e))}function X(e){!1!==n.enabled&&("touch"===e.pointerType?function(e){switch(ne(e),h){case i.TOUCH_ROTATE:if(!1===n.enableRotate)return;G(e),n.update();break;case i.TOUCH_PAN:if(!1===n.enablePan)return;W(e),n.update();break;case i.TOUCH_DOLLY_PAN:if(!1===n.enableZoom&&!1===n.enablePan)return;!function(e){n.enableZoom&&j(e),n.enablePan&&W(e)}(e),n.update();break;case i.TOUCH_DOLLY_ROTATE:if(!1===n.enableZoom&&!1===n.enableRotate)return;!function(e){n.enableZoom&&j(e),n.enableRotate&&G(e)}(e),n.update();break;default:h=i.NONE}}(e):function(e){if(!1===n.enabled)return;switch(h){case i.ROTATE:if(!1===n.enableRotate)return;!function(e){x.set(e.clientX,e.clientY),w.subVectors(x,y).multiplyScalar(n.rotateSpeed);const t=n.domElement;L(2*Math.PI*w.x/t.clientHeight),D(2*Math.PI*w.y/t.clientHeight),y.copy(x),n.update()}(e);break;case i.DOLLY:if(!1===n.enableZoom)return;!function(e){T.set(e.clientX,e.clientY),E.subVectors(T,M),E.y>0?B(P()):E.y<0&&N(P()),M.copy(T),n.update()}(e);break;case i.PAN:if(!1===n.enablePan)return;!function(e){A.set(e.clientX,e.clientY),S.subVectors(A,b).multiplyScalar(n.panSpeed),O(S.x,S.y),b.copy(A),n.update()}(e)}}(e))}function q(e){te(e),0===C.length&&(n.domElement.releasePointerCapture(e.pointerId),n.domElement.removeEventListener("pointermove",X),n.domElement.removeEventListener("pointerup",q)),n.dispatchEvent(gm),h=i.NONE}function K(e){te(e)}function Q(e){!1!==n.enabled&&!1!==n.enableZoom&&h===i.NONE&&(e.preventDefault(),n.dispatchEvent(mm),function(e){e.deltaY<0?N(P()):e.deltaY>0&&B(P()),n.update()}(e),n.dispatchEvent(gm))}function $(e){!1!==n.enabled&&!1!==n.enablePan&&function(e){let t=!1;switch(e.code){case n.keys.UP:O(0,n.keyPanSpeed),t=!0;break;case n.keys.BOTTOM:O(0,-n.keyPanSpeed),t=!0;break;case n.keys.LEFT:O(n.keyPanSpeed,0),t=!0;break;case n.keys.RIGHT:O(-n.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),n.update())}(e)}function ee(e){!1!==n.enabled&&e.preventDefault()}function te(e){delete R[e.pointerId];for(let t=0;t<C.length;t++)if(C[t].pointerId==e.pointerId)return void C.splice(t,1)}function ne(e){let t=R[e.pointerId];void 0===t&&(t=new _,R[e.pointerId]=t),t.set(e.pageX,e.pageY)}function ie(e){const t=e.pointerId===C[0].pointerId?C[1]:C[0];return R[t.pointerId]}n.domElement.addEventListener("contextmenu",ee),n.domElement.addEventListener("pointerdown",J),n.domElement.addEventListener("pointercancel",K),n.domElement.addEventListener("wheel",Q,{passive:!1}),this.update()}}const ym={getLocation(){const e=new URLSearchParams(window.location.search);return{x:parseInt(e.get("x")),y:parseInt(e.get("y")),z:parseInt(e.get("z"))}}};async function xm(e,t,n){const i=await fetch("https://balanced-bulldog-49.hasura.app/v1/graphql",{method:"POST",body:JSON.stringify({query:e,variables:n,operationName:t})});return await i.json()}async function wm(e){let t;if("string"==typeof e){if(e.length<3)return;t=(e=>`\n  query MyQuery {\n    search_chunks_aggregate(args: {search: "${e}"}) {\n      nodes {\n        name\n        logo\n        loc\n        x\n        y\n        z\n      }\n    }\n  }\n`)(e)}else n=e.x,i=e.y,r=e.z,t=`\n query MyQuery {\n   spaceState_v3(where: {x: {_eq: ${n}}, y: {_eq: ${i}}, z: {_eq: ${r}}}) {\n     loc\n     logo\n     name\n     x\n     y\n     z\n   }\n }\n`;var n,i,r;const{errors:s,data:o}=await function(e){return xm(e,"MyQuery",{})}(t);if(!s)return o;console.error(s)}async function bm(e,t,n,i,r,s){const o={};var a;fetch("https://raw.githubusercontent.com/Spacetime-Meta/spacetime-metadata/main/defaultChunk.json").then(e=>e.json()).then(e=>{a=e});const{errors:c,data:l}=await function(e,t,n,i,r,s){return xm(((e,t,n,i,r,s)=>`\nquery MyQuery {\n  spaceState_v3 (where: {x: {_gte: ${e}, _lte: ${t}}, y: {_gte: ${n}, _lte: ${i}}, z: {_gte: ${r}, _lte: ${s}}}){\n    planet\n    image\n    loc\n    logo\n    name\n    portal\n  }\n}\n`)(e,t,n,i,r,s),"MyQuery",{})}(e,t,n,i,r,s);c&&console.error(c);for(var u=0;u<l.spaceState_v3.length;u++){const e=l.spaceState_v3[u];o[e.loc]=Object.assign({},a),o[e.loc].location={x:parseInt(e.loc.split(",")[0]),y:parseInt(e.loc.split(",")[1]),z:parseInt(e.loc.split(",")[2])},""!==e.name&&(o[e.loc].name=e.name),""!==e.portal?o[e.loc].portal=e.portal:o[e.loc].portal=`${window.location.origin}/metaverse/planet/?x=${e.loc.split(",")[0]}&y=${e.loc.split(",")[1]}&z=${e.loc.split(",")[2]}`,""!==e.image&&(o[e.loc].image=e.image),""!==e.planet&&(o[e.loc].planet=e.planet)}return o}const Am=Array(256).fill(0).map((e,t)=>t);for(let e=0;e<256;e++)Am[256+e]=Am[e];for(let e=0;e<256;e++)Am[256+e]=Am[e];function Sm(e){return e*e*e*(e*(6*e-15)+10)}function _m(e,t,n){return t+e*(n-t)}function Mm(e,t,n,i){const r=15&e,s=r<8?t:n,o=r<4?n:12==r||14==r?t:i;return(0==(1&r)?s:-s)+(0==(2&r)?o:-o)}var Tm=n(22);const Em=[];for(let e=0;e<10;e++){const t=e%2==1?10:20,n=e/5*Math.PI;Em.push(new _(Math.cos(n)*t,Math.sin(n)*t))}const Cm=new Ys(Em),Rm=new To(Cm,{depth:4,bevelEnabled:!0,bevelSegments:2,steps:2,bevelSize:1,bevelThickness:1});Rm.applyMatrix4((new Ee).makeRotationZ(Math.PI/10)),Rm.applyMatrix4((new Ee).makeScale(.0075,.0075,.0075));let Pm=2;var Lm={rng:null,perlin:new class{seed(e){Am.sort(()=>e()-.5)}noise(e,t,n){const i=Math.floor(e),r=Math.floor(t),s=Math.floor(n),o=255&i,a=255&r,c=255&s,l=(e-=i)-1,u=(t-=r)-1,h=(n-=s)-1,d=Sm(e),p=Sm(t),f=Sm(n),m=Am[o]+a,g=Am[m]+c,v=Am[m+1]+c,y=Am[o+1]+a,x=Am[y]+c,w=Am[y+1]+c;return _m(f,_m(p,_m(d,Mm(Am[g],e,t,n),Mm(Am[x],l,t,n)),_m(d,Mm(Am[v],e,u,n),Mm(Am[w],l,u,n))),_m(p,_m(d,Mm(Am[g+1],e,t,h),Mm(Am[x+1],l,t,h)),_m(d,Mm(Am[v+1],e,u,h),Mm(Am[w+1],l,u,h))))}},icosahedron:new Co(1,20),smallicosahdron:new Co(1,5),star:Rm,seed(e){this.rng=Tm(e),this.perlin.seed(this.rng)},pickColor(){const e=this.rng;let t=e();return t<.1?new z(.5+.5*e(),e()/3,e()/3):t<.2?new z(e()/3,.5+.5*e(),e()/3):t<.3?new z(e()/3,e()/3,.5+.5*e()):t<.4?new z(.5+.5*e(),.5+.5*e(),e()/3):t<.5?new z(e()/3,.5+.5*e(),.5+.5*e()):t<.6?new z(.5+.5*e(),e()/3,.5+.5*e()):t<.7?new z(.5+.5*e(),.5+.5*e(),e()/3):new z(e(),e(),e())},generateRing(){const e=this.rng;return{detail:1+e()*e()*1,size:new Y(Math.max(1.4+1.2*(e()-.5),1.4),Math.max(1.4+1.2*(e()-.5),1.4),.5*(.75+.5*e())),tilt:{x:[e()>.5?Math.sin:Math.cos,1e3+e()*e()*5e3,1e6*e(),.05+.1*e(),(e()<.25?0:Math.PI/2)+.1*e()-.05],y:[e()>.5?Math.sin:Math.cos,1e3+e()*e()*5e3,1e6*e(),.05+.1*e(),.1*e()-.05],z:[e()>.5?Math.sin:Math.cos,1e3+e()*e()*5e3,1e6*e(),e(),.1*e()-.05]},color:this.pickColor(),glowing:e()<.1}},generateStar(e){const t=this.rng,n=new Y;for(n.x=2*(t()-.5),n.y=2*(t()-.5),n.z=2*(t()-.5);n.length()<1.375||n.length()>1.75;)n.x=2*(t()-.5),n.y=2*(t()-.5),n.z=2*(t()-.5);for(;;){let i=!1;for(const t of e)if(t.position.distanceTo(n)<.375){i=!0;break}if(!i)break;n.x=2*(t()-.5),n.y=2*(t()-.5),n.z=2*(t()-.5)}let i,r=t();return i=r<.025?new Y(0,1,1):r<.075?new Y(1,.25,.25):r<.15?new Y(1,.5,.25):new Y(1,1,r<.3?1:0),{position:n,size:.5+t(),color:i}},generateMoon(){const e=this.rng,t=.35+.25*e(),n=new Y;for(;n.length()<1+1.25*t;)n.x=4*(e()-.5),n.y=4*(e()-.5),n.z=4*(e()-.5),n.length()>2&&(n.x=0,n.y=0,n.z=0);return{seed:Math.floor(e()*2**32),size:.1+.1*e(),tilt:{x:[e()>.5?Math.sin:Math.cos,1e3+e()*e()*5e3,1e6*e(),.005*e(),.1*e()-.05],y:[e()>.5?Math.sin:Math.cos,1e3+e()*e()*5e3,1e6*e(),.005*e(),.1*e()-.05],z:[e()>.5?Math.sin:Math.cos,1e3+e()*e()*5e3,1e6*e(),.005*e(),.1*e()-.05]},glowing:e()<.1,x:n.x,y:n.y,z:n.z}},generatePlanetData(){const e=this.rng,t=1.5+1*e(),n=[];let i=.2*e()-.2,r=1,s=.1+.2*e(),o=.025+.025*e();for(;i<s;)i+=.15*e(),r+=o*e(),n.push({threshold:i,height:r,color:this.pickColor()});n.push({threshold:1/0,height:r+o*e(),color:this.pickColor()});let a=Math.round(e()*e()*e()*3);const c=[];for(let e=0;e<a;e++)c.push(this.generateRing());const l=[],u=e()>.5?Math.round(e()*e()*10):0;for(let e=0;e<u;e++)l.push(this.generateStar(l));const h=Math.round(e()*e()*e()*5),d=[];for(let e=0;e<h;e++)d.push(this.generateMoon());return{scale:t,levels:n,size:.5+1*e(),clouds:{height:1.05+.1*e(),color:new z(.5+e(),.5+e(),.5+e()),coverage:e()<.25?Math.max(e()-.5+.1,0):e()<.5?Math.max(e()-.5+.1,.15):1,offset:1e4*e(),scale:e()-.5+2.5,speed:.025+.05*e(),density:.25+.5*e()},rings:c,stars:l,moons:d}},generateMoonData(){const e=this.generatePlanetData();return e.stars=[],e.rings=[],e.clouds.coverage=1,e.moons=[],e},setHeightAt(e,t,n,i){let r;for(const t of e.levels)if(i<t.threshold){r=t.height;break}t.setX(n,t.getX(n)*r),t.setY(n,t.getY(n)*r),t.setZ(n,t.getZ(n)*r)},makePlanet(e,t=!1){const n=new Qe,i=t?this.smallicosahdron.clone():this.icosahedron.clone(),r=i.attributes.position,s=new Float32Array(3*r.count);let o=0;for(let t=0;t<r.count/3;t++){const n=r.getX(3*t),i=r.getX(3*t+1),a=r.getX(3*t+2),c=r.getY(3*t),l=r.getY(3*t+1),u=r.getY(3*t+2),h=r.getZ(3*t),d=r.getZ(3*t+1),p=r.getZ(3*t+2),f=this.perlin.noise(n*e.scale,c*e.scale,h*e.scale),m=this.perlin.noise(i*e.scale,l*e.scale,d*e.scale),g=this.perlin.noise(a*e.scale,u*e.scale,p*e.scale),v=(f+m+g)/3;this.setHeightAt(e,r,3*t,f),this.setHeightAt(e,r,3*t+1,m),this.setHeightAt(e,r,3*t+2,g);for(const t of e.levels)if(v<t.threshold){s[o]=t.color.r,o++,s[o]=t.color.g,o++,s[o]=t.color.b,o++,s[o]=t.color.r,o++,s[o]=t.color.g,o++,s[o]=t.color.b,o++,s[o]=t.color.r,o++,s[o]=t.color.g,o++,s[o]=t.color.b,o++;break}}i.computeVertexNormals(),i.setAttribute("color",new mt(new Float32Array(s),3));const a=new Wt(i,new Lo({color:new z(1,1,1),side:2,vertexColors:!0}));n.add(a);const c=t?this.smallicosahdron.clone():this.icosahedron.clone(),l=new Yt({transparent:!0,side:2,depthWrite:!1,uniforms:{time:{value:0},coverage:{value:0},scale:{value:0},speed:{value:0},color:{value:new Y},density:{value:0}},vertexShader:"\n            varying float opacity;\n            uniform float time;\n            uniform float coverage;\n            uniform float scale;\n            uniform float speed;\n        vec4 permute(vec4 x){return mod(((x*34.0)+1.0)*x, 289.0);}\n        float permute(float x){return floor(mod(((x*34.0)+1.0)*x, 289.0));}\n        vec4 taylorInvSqrt(vec4 r){return 1.79284291400159 - 0.85373472095314 * r;}\n        float taylorInvSqrt(float r){return 1.79284291400159 - 0.85373472095314 * r;}\n        \n        vec4 grad4(float j, vec4 ip){\n          const vec4 ones = vec4(1.0, 1.0, 1.0, -1.0);\n          vec4 p,s;\n        \n          p.xyz = floor( fract (vec3(j) * ip.xyz) * 7.0) * ip.z - 1.0;\n          p.w = 1.5 - dot(abs(p.xyz), ones.xyz);\n          s = vec4(lessThan(p, vec4(0.0)));\n          p.xyz = p.xyz + (s.xyz*2.0 - 1.0) * s.www; \n        \n          return p;\n        }\n        \n        float snoise(vec4 v){\n          const vec2  C = vec2( 0.138196601125010504,  // (5 - sqrt(5))/20  G4\n                                0.309016994374947451); // (sqrt(5) - 1)/4   F4\n        // First corner\n          vec4 i  = floor(v + dot(v, C.yyyy) );\n          vec4 x0 = v -   i + dot(i, C.xxxx);\n        \n        // Other corners\n        \n        // Rank sorting originally contributed by Bill Licea-Kane, AMD (formerly ATI)\n          vec4 i0;\n        \n          vec3 isX = step( x0.yzw, x0.xxx );\n          vec3 isYZ = step( x0.zww, x0.yyz );\n        //  i0.x = dot( isX, vec3( 1.0 ) );\n          i0.x = isX.x + isX.y + isX.z;\n          i0.yzw = 1.0 - isX;\n        \n        //  i0.y += dot( isYZ.xy, vec2( 1.0 ) );\n          i0.y += isYZ.x + isYZ.y;\n          i0.zw += 1.0 - isYZ.xy;\n        \n          i0.z += isYZ.z;\n          i0.w += 1.0 - isYZ.z;\n        \n          // i0 now contains the unique values 0,1,2,3 in each channel\n          vec4 i3 = clamp( i0, 0.0, 1.0 );\n          vec4 i2 = clamp( i0-1.0, 0.0, 1.0 );\n          vec4 i1 = clamp( i0-2.0, 0.0, 1.0 );\n        \n          //  x0 = x0 - 0.0 + 0.0 * C \n          vec4 x1 = x0 - i1 + 1.0 * C.xxxx;\n          vec4 x2 = x0 - i2 + 2.0 * C.xxxx;\n          vec4 x3 = x0 - i3 + 3.0 * C.xxxx;\n          vec4 x4 = x0 - 1.0 + 4.0 * C.xxxx;\n        \n        // Permutations\n          i = mod(i, 289.0); \n          float j0 = permute( permute( permute( permute(i.w) + i.z) + i.y) + i.x);\n          vec4 j1 = permute( permute( permute( permute (\n                     i.w + vec4(i1.w, i2.w, i3.w, 1.0 ))\n                   + i.z + vec4(i1.z, i2.z, i3.z, 1.0 ))\n                   + i.y + vec4(i1.y, i2.y, i3.y, 1.0 ))\n                   + i.x + vec4(i1.x, i2.x, i3.x, 1.0 ));\n        // Gradients\n        // ( 7*7*6 points uniformly over a cube, mapped onto a 4-octahedron.)\n        // 7*7*6 = 294, which is close to the ring size 17*17 = 289.\n        \n          vec4 ip = vec4(1.0/294.0, 1.0/49.0, 1.0/7.0, 0.0) ;\n        \n          vec4 p0 = grad4(j0,   ip);\n          vec4 p1 = grad4(j1.x, ip);\n          vec4 p2 = grad4(j1.y, ip);\n          vec4 p3 = grad4(j1.z, ip);\n          vec4 p4 = grad4(j1.w, ip);\n        \n        // Normalise gradients\n          vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n          p0 *= norm.x;\n          p1 *= norm.y;\n          p2 *= norm.z;\n          p3 *= norm.w;\n          p4 *= taylorInvSqrt(dot(p4,p4));\n        \n        // Mix contributions from the five corners\n          vec3 m0 = max(0.6 - vec3(dot(x0,x0), dot(x1,x1), dot(x2,x2)), 0.0);\n          vec2 m1 = max(0.6 - vec2(dot(x3,x3), dot(x4,x4)            ), 0.0);\n          m0 = m0 * m0;\n          m1 = m1 * m1;\n          return 49.0 * ( dot(m0*m0, vec3( dot( p0, x0 ), dot( p1, x1 ), dot( p2, x2 )))\n                       + dot(m1*m1, vec2( dot( p3, x3 ), dot( p4, x4 ) ) ) ) ;\n        \n        }\n            void main() {\n                vec4 worldPosition = modelMatrix * vec4(position, 1.0);\n                gl_Position = projectionMatrix * viewMatrix * worldPosition;\n                // Sample 4D noise at vertex position, if above coverage create cloud, otherwise fade out. \n                // Step through fourth dimension as time goes on to evolve cloud formations\n                if (snoise(vec4(position.xyz * scale, time * speed)) > coverage) {\n                    opacity = 1.0;\n                } else {\n                    opacity = 0.0;\n                }\n            }\n            ",fragmentShader:"\n            varying float opacity;\n            uniform float density;\n            uniform vec3 color;\n            void main() {\n                // Multiply opacity by density to vary cloud opacity by world\n                gl_FragColor = vec4(color, opacity * density);\n            }\n            "}),u=new Wt(c,l);u.scale.set(e.clouds.height,e.clouds.height,e.clouds.height),e.clouds.coverage<1&&n.add(u);const h=[];e.rings.forEach(e=>{const t=new Wt(new Po(1,.05,Math.round(4*e.detail),Math.round(10*e.detail)).applyMatrix4((new Ee).makeScale(...e.size)).toNonIndexed(),new Lo({color:e.color}));t.geometry.computeVertexNormals(),t.rotation.x=Math.PI/2,h.push(t),n.add(t)});const d=new us(Rm,new dt({color:new z(1,1,1)}),e.stars.length);e.stars.forEach((e,t)=>{const n=new Qe;n.position.x=e.position.x,n.position.y=e.position.y,n.position.z=e.position.z,n.scale.set(e.size,e.size,e.size),n.lookAt(0,0,0),n.updateMatrix(),d.setMatrixAt(t,n.matrix),d.setColorAt(t,e.color)}),n.add(d);const p=[];if(e.moons.forEach(e=>{this.seed(e.seed);const t=this.generateMoonData(),i=this.makePlanet(t,!0);i.scale.set(e.size,e.size,e.size),i.position.set(e.x,e.y,e.z);const r=new Qe;r.add(i),n.add(r),p.push(r)}),n.stars=d,n.crust=a,n.clouds=u,n.rings=h,n.moons=p,n.data=e,!t){n.selectId=Pm,Pm+=1;const e=new Wt(new Ro(1.1,16,16),new dt({color:new z(n.selectId)}));n.select=e}return n},update(e){const t=e.clouds.material,n=e.data;t.uniforms.time.value=performance.now()/1e3+n.clouds.offset,t.uniforms.coverage.value=n.clouds.coverage,t.uniforms.color.value=n.clouds.color,t.uniforms.speed.value=n.clouds.speed,t.uniforms.scale.value=n.clouds.scale,t.uniforms.density.value=n.clouds.density,e.rings.forEach((e,t)=>{const i=n.rings[t].tilt;e.rotation.x=i.x[4]+i.x[3]*i.x[0](performance.now()/i.x[1]+i.x[2]),e.rotation.y=i.y[4]+i.y[3]*i.y[0](performance.now()/i.y[1]+i.y[2]),e.rotation.z=i.z[4]+i.z[3]*i.z[0](performance.now()/i.z[1]+i.z[2])}),e.moons.forEach((e,t)=>{const i=n.moons[t].tilt;e.rotation.x+=i.x[3],e.rotation.y+=i.y[3],e.rotation.z+=i.z[3]})},newId(){const e=Pm;return Pm+=1,e},spawn(e,t,n){this.seed(parseInt(""+e*e*t+t*t*n+e*t*n));const i=this.makePlanet(this.generatePlanetData());return i.scale.set(i.data.size/4,i.data.size/4,i.data.size/4),i.position.set(e,t,n),i.chunk=new Y(e,t,n),i.source="generator",i}};class Dm extends Jf{constructor(){super({style:{background:"rgba(206, 206, 206, 0.8)",boxShadow:"0 4px 4px #484848",color:"white",padding:"5px",borderRadius:"5px",position:"absolute",display:"none",flexDirection:"row",alignItems:"center"}}),this.image=new Jf({type:"img",style:{height:"15px",width:"15px",borderRadius:"50%",paddingRight:"5px"}}),this.image.element.src="https://ipfs.io/ipfs/QmfD8B3U5pzKDxV5XC2SbmysVWUwDvQ4eVLrZuUfJMBGEt",this.name=new Jf({innerHTML:"Spacetime Meta"}),this.appendChildList([this.image,this.name])}setInfoContent(e){this.image.element.src=e.logo,this.name.element.innerHTML=e.name}}class Im extends Jf{constructor(e,t){super({style:{padding:"5px",display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",cursor:"pointer"},onClick:()=>{t.refToMap.handleNavigateMap(new Y(e.x,e.y,e.z)),t.resetSearch()}}),this.logo=new Jf({type:"img",style:{height:"15px",width:"15px",borderRadius:"50%",paddingRight:"5px"}}),"Qm"===e.logo.substring(0,2)&&(e.logo="https://ipfs.io/ipfs/"+e.logo),""===e.logo?this.logo.element.src="https://ipfs.io/ipfs/QmfD8B3U5pzKDxV5XC2SbmysVWUwDvQ4eVLrZuUfJMBGEt":this.logo.element.src=e.logo,this.name=new Jf({innerHTML:""===e.name?"New Planet":e.name,style:{fontSize:"xx-small"}}),this.logoName=new Jf({style:{display:"flex",flexDirection:"row"}}),this.logoName.appendChildList([this.logo,this.name]),this.appendChildList([this.logoName,new Jf({innerHTML:e.loc,style:{fontSize:"xx-small"}})])}}class km extends Jf{constructor(e){super({style:{position:"absolute",padding:"5.5px",margin:"5px",marginLeft:"55px",border:"1px solid #e0e0e0",borderRadius:"5px",background:"rgb(255,255,255)",boxShadow:"0 2px 2px #888888",transition:"all 0.5s ease",width:"260px"}}),this.refToMap=e,this.searchByName=!0,this.inputRow=new Jf({style:{alignItems:"center",display:"flex",flexDirection:"row",justifyContent:"space-between"}}),this.optionIcon=new Jf({type:"img",style:{width:"10px",marginRight:"5px",cursor:"pointer"},onClick:()=>{this.toggleSearchMode()}}),this.optionIcon.element.src="data:image/png;base64,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",this.inputBar=new Jf({type:"input",style:{width:"250px",background:"rgb(255,255,255)",border:"none",padding:"3px"}}),this.inputLocation=new Jf({style:{display:"none",flexDirection:"row"}}),this.inputX=new Jf({type:"input",style:{width:"30px",background:"rgb(255,255,255)",border:"none",marginRight:"10px"}}),this.inputY=new Jf({type:"input",style:{width:"30px",background:"rgb(255,255,255)",border:"none",marginRight:"10px"}}),this.inputZ=new Jf({type:"input",style:{width:"30px",background:"rgb(255,255,255)",border:"none",marginRight:"10px"}}),this.inputLocation.appendChildList([new Jf({innerHTML:" x:"}),this.inputX,new Jf({innerHTML:" y:"}),this.inputY,new Jf({innerHTML:" z:"}),this.inputZ]),this.searchIcon=new Jf({type:"img",style:{width:"10px",marginLeft:"5px",cursor:"pointer"},onClick:e=>{e.preventDefault(),this.handleSearch()}}),this.searchIcon.element.src="data:image/png;base64,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",this.clearIcon=new Jf({innerHTML:"X",style:{display:"none",cursor:"pointer"},onClick:()=>{this.resetSearch(),this.inputBar.element.value="",this.inputX.element.value="",this.inputY.element.value="",this.inputZ.element.value=""}}),this.inputX.element.addEventListener("change",()=>{this.resetSearch()}),this.inputY.element.addEventListener("change",()=>{this.resetSearch()}),this.inputZ.element.addEventListener("change",()=>{this.resetSearch()}),this.inputBar.element.addEventListener("change",()=>{this.resetSearch()}),this.inputRow.appendChildList([this.optionIcon,this.inputLocation,this.inputBar,this.searchIcon,this.clearIcon]),this.resultDisplay=new Jf({style:{borderTop:"1px solid black",display:"none",paddingTop:"10px",marginTop:"10px",maxHeight:"400px",overflow:"scroll",overflow:"auto"}}),this.appendChildList([this.inputRow,this.resultDisplay])}toggleSearchMode(){this.searchByName?(this.inputBar.element.style.display="none",this.inputLocation.element.style.display="flex"):(this.inputBar.element.style.display="block",this.inputLocation.element.style.display="none"),this.searchByName=!this.searchByName}handleSearch(){this.searchIcon.element.style.display="none",this.resultDisplay.element.innerHTML="",this.resultDisplay.element.style.display="none",this.clearIcon.element.style.display="block";let e=void 0;e=this.searchByName?this.inputBar.element.value:{x:this.inputX.element.value,y:this.inputY.element.value,z:this.inputZ.element.value},wm(e).then(e=>{void 0!==e?(e=void 0!==e.search_chunks_aggregate?e.search_chunks_aggregate.nodes:e.spaceState_v3).length>0?(this.resultDisplay.element.style.display="block",e.forEach(e=>{this.resultDisplay.appendChild(new Im(e,this))})):(this.resultDisplay.element.innerHTML="not results",this.resultDisplay.element.style.display="block",setTimeout(()=>{this.resetSearch()},3e3)):(this.resultDisplay.element.innerHTML="not a valid search",this.resultDisplay.element.style.display="block",setTimeout(()=>{this.resetSearch()},3e3))})}resetSearch(){this.clearIcon.element.style.display="none",this.searchIcon.element.style.display="block",this.resultDisplay.element.innerHTML="",this.resultDisplay.element.style.display="none"}}const Om=function(e,t,n){return`${e},${t},${n}`},Bm=function(e){return Om(e.x,e.y,e.z)},Nm=function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*e*(e*(6*e-15)+10)};class zm extends Jf{constructor(e){super({id:"map",style:{width:"350px",height:"350px"}}),this.parentPanel=e,this.hoverInfoBox=new Dm,this.appendChild(this.hoverInfoBox),this.searchBar=new km(this),this.appendChild(this.searchBar),this.homeButton=new Jf({style:{position:"absolute",padding:"5px",margin:"5px",border:"1px solid #e0e0e0",borderRadius:"5px",background:"rgb(255,255,255)",boxShadow:"0 2px 2px #888888",textAlign:"center",cursor:"pointer",transition:"all 0.5s ease"},hover:{background:"#d8d8d8"},onClick:()=>{this.handleNavigateMap(new Y)}});const t=new Jf({type:"img",style:{width:"10px"}});t.element.src="data:image/png;base64,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",this.homeButton.appendChild(t),this.shareButton=new Jf({style:{position:"absolute",padding:"5px",margin:"5px",marginLeft:"30px",border:"1px solid #e0e0e0",borderRadius:"5px",background:"rgb(255,255,255)",boxShadow:"0 2px 2px #888888",textAlign:"center",cursor:"pointer",transition:"all 0.5s ease"},hover:{background:"#d8d8d8"},onClick:()=>{navigator.clipboard.writeText(this.spaceState[Bm(this.selectedLocation)].portal)}});const n=new Jf({type:"img",style:{width:"10px"}});n.element.src="data:image/png;base64,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",this.shareButton.appendChild(n),this.appendChildList([this.homeButton,this.shareButton]),this.spaceState={},this.renderDistance=50,this.GLTFLoader=new hc,this.hoverIntersect=void 0,this.buildThreeJsScene();const i=ym.getLocation();isNaN(i.x)||isNaN(i.y)||isNaN(i.z)?this.handleNavigateMap(new Y):this.handleNavigateMap(new Y(i.x,i.y,i.z)),this.element.addEventListener("click",e=>{var t=this.getMouseIntersect(e);void 0!==t&&this.handleNavigateMap(t)}),this.element.addEventListener("mousemove",e=>{this.hoverIntersect=this.getMouseIntersect(e),void 0!==this.hoverIntersect?(this.hoverInfoBox.setInfoContent(this.spaceState[Bm(this.hoverIntersect)]),this.hoverInfoBox.element.style.left=e.pageX+5+"px",this.hoverInfoBox.element.style.top=e.pageY+5+"px",this.hoverInfoBox.element.style.display="flex"):this.hoverInfoBox.element.style.display="none"}),this.update()}async handleNavigateMap(e){this.selectedLocation=e,this.moveOrbit(e),await this.loadSector(e),this.parentPanel.setPortalPanelInfo(this.spaceState[Bm(e)]),this.removeOutOfRange(e);let t=0;const n=()=>{this.update(),this.controls.update(),t<60?(requestAnimationFrame(n),t++):cancelAnimationFrame(n)};requestAnimationFrame(n)}getMouseIntersect(e){var t=new Y(e.offsetX/this.element.clientWidth*2-1,e.offsetY/this.element.clientHeight*-2+1,0);this.raycaster.setFromCamera(t,this.camera);const n=this.raycaster.intersectObjects(this.scene.children);if(n.length>0){let e=n[0].object;try{for(;!e.chunk;)e=e.parent}catch(e){return}return e.chunk}}async loadSector(e){const t=await bm(e.x-this.renderDistance,e.x+this.renderDistance,e.y-this.renderDistance,e.y+this.renderDistance,e.z-this.renderDistance,e.z+this.renderDistance);Object.keys(t).forEach(e=>{if(void 0===this.spaceState[e])try{this.renderChunk(t[e])}catch(t){console.error("[SpacetimeMap] Error with spaceState key: "+e+" ====================== "+t)}}),this.spaceState={...this.spaceState,...t},this.update()}removeOutOfRange(e){for(var t=0;t<this.scene.children.length;t++){const n=this.scene.children[t];if(void 0!==n.chunk){const i=n.chunk;(i.x>e.x+this.renderDistance||i.x<e.x-this.renderDistance||i.y>e.y+this.renderDistance||i.y<e.y-this.renderDistance||i.z>e.z+this.renderDistance||i.z<e.z-this.renderDistance)&&(this.scene.remove(n),delete this.spaceState[Om(i.x,i.y,i.z)],t--)}}}renderChunk(e){if(""!==e.planet)this.GLBSpawner("https://ipfs.io/ipfs/"+e.planet,e.location.x,e.location.y,e.location.z);else{const t=Lm.spawn(e.location.x,e.location.y,e.location.z);this.scene.add(t)}}GLBSpawner(e,t,n,i){this.GLTFLoader.load(e,e=>{e.scene.position.set(t,n,i);var r=new Ha(e.scene,16777215);r.update();var s=r.geometry.boundingSphere.radius;s>1&&Om(t,n,i)!=Om(0,0,0)&&(e.scene.scale.x=e.scene.scale.x/s,e.scene.scale.y=e.scene.scale.y/s,e.scene.scale.z=e.scene.scale.z/s),e.scene.chunk=new Y(t,n,i),e.scene.source="gltf",this.scene.add(e.scene)},()=>{},()=>{console.log("Error with Chunk "+t+" "+n+" "+i)})}buildThreeJsScene(){this.renderer=new Vr,this.renderer.setPixelRatio(1),this.renderer.setSize(350,350),this.element.appendChild(this.renderer.domElement),this.scene=new Wr,this.scene.background=new z(0),this.camera=new Qt(75,1,.1,500),this.camera.position.set(10,10,10),this.scene.add(this.camera),this.controls=new vm(this.camera,this.renderer.domElement),this.controls.addEventListener("change",()=>{this.update()}),this.controls.maxDistance=200,this.controls.minDistance=1,this.controls.enablePan=!1,this.scene.add(new sa(6316128,4210752));const e=new ya(16777215);e.position.set(10,10,10).normalize(),this.scene.add(e),this.raycaster=new Ia}moveOrbit(e){this.controls.target.equals(e)||(this.originalCameraPos=this.camera.position.clone(),this.targetCameraPos=this.camera.position.clone().add(e.clone().sub(this.camera.position).normalize().multiplyScalar(e.clone().sub(this.camera.position).length()-10)),this.originalTargetPos=this.controls.target.clone(),this.targetTargetPos=e.clone(),this.cameraTransitionFrames=60)}updateCamera(){this.cameraTransitionFrames>0&&(this.camera.position.copy(this.originalCameraPos.clone().lerp(this.targetCameraPos,Nm(1-this.cameraTransitionFrames/60,0,1))),this.controls.target.copy(this.originalTargetPos.clone().lerp(this.targetTargetPos,Nm(1-this.cameraTransitionFrames/60,0,1))),this.cameraTransitionFrames--)}update(){this.renderer.render(this.scene,this.camera),this.updateCamera(),this.scene.children.forEach(e=>{"generator"===e.source&&Lm.update(e)})}}class Fm extends Jf{constructor(){super({style:{height:"100%",display:"none",flexDirection:"column",alignItems:"center"}}),this.isLoaded=!1}initMap(){this.isLoaded=!0,this.portalLocation=window.location.origin+"/metaverse/spawn-planet/",this.spacetimeMap=new zm(this),this.appendChild(this.spacetimeMap),this.visitWorldButton=new Jf({style:{padding:"10px",margin:"20px",border:"1px solid #e0e0e0",borderRadius:"10px",background:"rgb(245,245,245)",boxShadow:"0 2px 2px #888888",textAlign:"center",cursor:"pointer",transition:"all 0.5s ease"},hover:{background:"#d8d8d8"},onClick:()=>{window.location.href=this.portalLocation}}),this.locationLoc=new Jf({innerHTML:"x:0 y:0 z:0"}),this.locationName=new Jf({innerHTML:"Spacetime Meta"}),this.locationImg=new Jf({type:"img",style:{width:"300px"}}),this.locationImg.element.src="https://cdn.discordapp.com/attachments/925045793780543568/984261788549918802/newBack.png",this.visitWorldButton.appendChildList([this.locationLoc,this.locationName,this.locationImg,new Jf({innerHTML:"Enter Location"})]),this.appendChild(this.visitWorldButton)}setPortalPanelInfo(e){this.locationLoc.element.innerHTML=`x:${e.location.x} y:${e.location.y} z:${e.location.z}`,this.locationName.element.innerHTML=e.name,"Qm"===e.image.substring(0,2)&&(e.image="https://ipfs.io/ipfs/"+e.image),this.locationImg.element.src=e.image,this.portalLocation=e.portal}}class Um extends Jf{constructor(){super({id:"MenuDisplay",style:{marginTop:"50px"}}),this.chatPanel=new $f,this.multiplayerPanel=new am,this.avatarPanel=new hm,this.optionsPanel=new pm,this.mapPanel=new Fm,this.appendChildList([this.chatPanel,this.multiplayerPanel,this.avatarPanel,this.optionsPanel,this.mapPanel])}handleMenuPanelSelection(e){switch(this.closeAllPanels(),e){case"chat":this.chatPanel.element.style.display="grid";break;case"multiplayer":this.multiplayerPanel.element.style.display="block";break;case"avatar":this.avatarPanel.element.style.display="block";break;case"options":this.optionsPanel.element.style.display="block";break;case"map":this.mapPanel.element.style.display="flex",this.mapPanel.isLoaded||this.mapPanel.initMap()}}closeAllPanels(){this.chatPanel.element.style.display="none",this.multiplayerPanel.element.style.display="none",this.avatarPanel.element.style.display="none",this.optionsPanel.element.style.display="none",this.mapPanel.element.style.display="none"}}class Hm extends Jf{constructor(){super({id:"Menu",style:{background:"white",overflow:"scroll",overflow:"auto"}}),this.menuHeader=new Zf,this.menuDisplay=new Um,this.menuFooter=new Yf,this.appendChildList([this.menuHeader,this.menuDisplay,this.menuFooter]),this.handleMenuPanelSelection("multiplayer")}handleMenuPanelSelection(e){this.menuDisplay.handleMenuPanelSelection(e),this.menuHeader.handleMenuHeaderSelection(e)}}class Vm extends Jf{constructor(){super({id:"blockerScreen",style:{position:"absolute",top:"0",width:"100%",height:"100%",display:"grid",gridTemplateColumns:"350px 1fr"}}),this.blocker=new Xf,this.menu=new Hm,this.appendChildList([this.menu,this.blocker]),document.body.appendChild(this.element)}}class Gm extends Jf{constructor(e){super({id:"ControlInstructions",style:{position:"absolute",top:"0",left:"0",width:"100%",color:"rgba(256, 256, 256, 0.8)",display:"flex",justifyContent:"center",fontSize:"x-small"}}),this.appendChild(new Jf({id:"ControlsDisplayBox",style:{background:"rgba(0, 0, 0, 0.2)",padding:"2px",border:"1px solid rgba(256, 256, 256, 0.3)"},innerHTML:"<b>WASD</b> move, <b>SHIFT</b> run, <b>SPACE</b> jump, <b>V</b> view, <b>R</b> respawn",parent:e}))}}class Wm extends Jf{constructor(){super({innerHTML:"00000000",style:{position:"absolute",bottom:"0",right:"0",color:"white",fontWeight:"bold",fontSize:"25px"}}),this.isVictory=!1,document.body.addEventListener("keydown",e=>{"r"===e.key&&(this.startTime=void 0,this.isVictory=!1)})}stopTimer(){this.isVictory=!0}startTimer(){this.startTime=Date.now()}update(){if(!this.isVictory){const e=((Date.now()-this.startTime)/1e3).toFixed(2);this.element.innerHTML=`time: ${isNaN(e)?0:e}s`}}}class jm extends Jf{constructor(){super({id:"playScreen",style:{position:"absolute",top:"0",width:"100%",height:"100%",display:"none"}}),this.controlsInstructions=new Gm(this),this.appendChild(this.controlsInstructions),document.body.appendChild(this.element)}setupTimerBox(){this.timerBox=new Wm,this.appendChild(this.timerBox)}}class Jm{constructor(){this.blockerScreen=new Vm,this.playScreen=new jm,this.connectionsManagementDisplay=this.blockerScreen.menu.menuDisplay.multiplayerPanel.connectionsManagementDisplay,this.updatable=[],this.updatable.push(this.connectionsManagementDisplay)}handleControlsLock(){LOCAL_PLAYER.controls.lock(),this.blockerScreen.element.style.display="none",this.playScreen.element.style.display="block"}handleControlsUnlock(){this.blockerScreen.element.style.display="grid",this.playScreen.element.style.display="none"}handleNewMessage(e){this.blockerScreen.menu.menuDisplay.chatPanel.chatOutputDisplay.displayNewMessage(e)}handleConnectionClose(e){this.blockerScreen.menu.menuDisplay.multiplayerPanel.connectionsManagementDisplay.handleConnectionClose(e)}setupTimer(){this.playScreen.setupTimerBox(),this.updatable.push(this.playScreen.timerBox)}update(){this.updatable.forEach(e=>{e.update()})}}class Xm extends class{constructor(e){this.mesh=e}}{constructor(e,t){super(e),this.onTrigger=t,this.padSize={x:Math.abs(this.mesh.geometry.attributes.position.array[0]),y:Math.abs(this.mesh.geometry.attributes.position.array[1]),z:Math.abs(this.mesh.geometry.attributes.position.array[2])},this.debugBox=new Wt(new Jt(2*this.padSize.x,2,2*this.padSize.z)),this.debugBox.material.wireframe=!0,this.debugBox.position.copy(e.position),this.debugBox.position.y=e.position.y+1+this.padSize.y,this.isDebugActive=!1}toggleDebugBox(){this.isDebugActive?MAIN_SCENE.remove(this.debugBox):MAIN_SCENE.add(this.debugBox),this.isDebugActive=!this.isDebugActive}update(){const e=new Y;e.subVectors(LOCAL_PLAYER.position,this.mesh.position),Math.abs(e.x)<this.padSize.x&&e.y<2.1+this.padSize.y&&Math.abs(e.z)<this.padSize.z&&this.onTrigger()}}const qm=new Y(-30,100,-100);class Zm extends ya{constructor(){super(8947967,1),this.castShadow=!0,this.shadow.camera.near=.1,this.shadow.camera.far=200,this.shadow.camera.right=50,this.shadow.camera.left=-50,this.shadow.camera.top=50,this.shadow.camera.bottom=-50,this.shadow.mapSize.width=1024,this.shadow.mapSize.height=1024,this.shadow.bias=-.001}update(){this.position.addVectors(LOCAL_PLAYER.position,qm),this.target.position.copy(LOCAL_PLAYER.position)}}class Ym extends Wr{constructor(){super(),this.background=new z(6940404),this.fog=new Gr(new z(.8,.8,.8),10,150);const e=new sa(16772863,7829384,1);this.add(e),this.shadowLight=new Zm,this.add(this.shadowLight),this.add(this.shadowLight.target),this.interactives=[]}toggleShadows(){this.shadowLight.castShadow=!this.shadowLight.castShadow}toggleInteractiveDebugBox(){this.interactives.forEach(e=>{e.toggleDebugBox()})}buildInteractives(){this.children.forEach(e=>{"Scene"===e.name&&e.children.forEach(e=>{if("_stm_"===e.name.substring(0,5)){switch(e.name.substring(5).substring(0,e.name.substring(5).indexOf("_"))){case"launchpad":this.interactives.push(new Xm(e,()=>{LOCAL_PLAYER.velocity.y=50}));break;case"spawnPoint":LOCAL_PLAYER.spawnPoint=e.position,LOCAL_PLAYER.position.copy(e.position);break;case"startTime":VIRTUAL_ENVIRONMENT.UI_CONTROLLER.setupTimer(),this.interactives.push(new Xm(e,()=>{VIRTUAL_ENVIRONMENT.UI_CONTROLLER.playScreen.timerBox.startTimer()}));break;case"stopTime":this.interactives.push(new Xm(e,()=>{VIRTUAL_ENVIRONMENT.UI_CONTROLLER.playScreen.timerBox.stopTimer()}));break;case"portal":{const t=e.name.substring(12,12+e.name.substring(12).indexOf("_"));this.interactives.push(new Xm(e,()=>{window.location.href=VIRTUAL_ENVIRONMENT.portalMap[t]}))}}}})})}update(){this.shadowLight.update(),this.interactives.forEach(e=>{e.update()})}}const Km=new Aa;class Qm{constructor(){document.body.style.margin="0",document.body.style.fontFamily="Space Mono, monospace",this.isStatsActive=!1,this.portalMap={},this.loading(),this.stats=tc(),this.stats.dom.style.left="350px",this.renderer=new Vr({alpha:!0}),this.renderer.setPixelRatio(1),this.renderer.setSize(window.innerWidth-1,window.innerHeight-1),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=3,document.body.appendChild(this.renderer.domElement),window.MAIN_SCENE=new Ym,this.camera=new Qt(75,window.innerWidth/window.innerHeight,.1,200),this.dummyCamera=new Qt(75,window.innerWidth/window.innerHeight,.1,200),this.cameraPosition=new Y,this.cameraTarget=new Y,this.UI_CONTROLLER=new Jm,this.terrainController=new Lp(this.loadingManager),window.addEventListener("resize",()=>{return e=this.camera,t=this.renderer,e.aspect=window.innerWidth/window.innerHeight,e.updateProjectionMatrix(),void t.setSize(window.innerWidth,window.innerHeight);var e,t},!1),this.remoteController=new jf(this.loadingManager,MAIN_SCENE),window.VIRTUAL_ENVIRONMENT=this}loadTerrain(e,t,n,i,r,s=1){this.terrainController.loadTerrain(e,MAIN_SCENE,t,n,i,r,s)}generateTerrain(e){this.terrainController.generateTerrain(e)}spawnPlayer(e){window.LOCAL_PLAYER=new ml(e,this.dummyCamera,this.loadingManager),MAIN_SCENE.add(LOCAL_PLAYER)}newSolidGeometriesFromSource(e,t,n,i,r){this.terrainController.newSolidGeometriesFromSource(MAIN_SCENE,e,t,n,i,r)}newVideoDisplayPlane(e,t,n,i,r,s,o){const a=document.createElement("video");a.id=e,a.loop=!0,a.crossOrigin="anonymous",a.playsinline=!0,a.style.display="none";const c=document.createElement("source");c.src=e,c.type="video/mp4",a.appendChild(c),document.body.appendChild(a),document.onkeydown=function(e){80!=e.keyCode||this.videoHasPlayed?80==e.keyCode&&this.videoHasPlayed?(this.videoHasPlayed=!1,a.pause()):82==e.keyCode&&a.currentTime(0):(a.play(),this.videoHasPlayed=!0)};const l=new Wt(new dn(t,n),new ko({color:16777215,map:new Rs(a)}));l.position.set(i,r,s),l.rotateY(o),MAIN_SCENE.add(l)}loading(){this.loadingManager=new Ko,function(){const e=document.createElement("div");e.className="progress-bar-container",Object.assign(e.style,{position:"absolute",width:"100%",height:"100%",backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",zIndex:1e3});const t=document.createElement("label");t.innerHTML="Loading....",Object.assign(t.style,{color:"rgba(256, 256, 256, 0.8)",fontSize:"x-small"});const n=document.createElement("progress");n.id="progress-bar",n.value=0,n.max=100,Object.assign(n.style,{width:"30%",marginTop:"0.5%",height:"2%"}),e.appendChild(t),e.appendChild(n),document.body.appendChild(e)}(),dl(this.loadingManager)}toggleStats(){this.isStatsActive?document.body.removeChild(this.stats.dom):document.body.appendChild(this.stats.dom),this.isStatsActive=!this.isStatsActive}update(){this.stats.update(),MAIN_SCENE.update();const e=Math.min(Km.getDelta(),.1);if(this.terrainController.collider){LOCAL_PLAYER.update(e,this.terrainController.collider),this.camera.position.copy(LOCAL_PLAYER.position),this.camera.position.copy(LOCAL_PLAYER.position);const t=this.dummyCamera.getWorldDirection(new Y);this.camera.position.add(t.multiplyScalar(LOCAL_PLAYER.controlVector.z)),this.camera.lookAt(LOCAL_PLAYER.position);const n=new Ee,i=new Ia(LOCAL_PLAYER.position.clone(),this.camera.position.clone().sub(LOCAL_PLAYER.position.clone()).normalize());n.copy(this.terrainController.collider.matrixWorld).invert(),i.ray.applyMatrix4(n);const r=this.terrainController.collider.geometry.boundsTree.raycastFirst(i.ray);if(r){this.camera.position.copy(LOCAL_PLAYER.position);const e=this.dummyCamera.getWorldDirection(new Y);this.camera.position.add(e.multiplyScalar(.8*Math.min(r.point.distanceTo(LOCAL_PLAYER.position),1.25*LOCAL_PLAYER.controlVector.z))),this.camera.lookAt(LOCAL_PLAYER.position)}this.cameraPosition.lerp(this.camera.position,LOCAL_PLAYER.controlVector.w),this.cameraTarget.lerp(LOCAL_PLAYER.position,LOCAL_PLAYER.controlVector.w),this.camera.position.copy(this.cameraPosition),this.camera.lookAt(this.cameraTarget)}this.remoteController.update(e),this.renderer.render(MAIN_SCENE,this.camera),this.UI_CONTROLLER.update()}}}])}));